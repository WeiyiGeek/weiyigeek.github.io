<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ 8-Kuberneteså…¥é—¨åŸºç¡€ä¹‹è°ƒåº¦å™¨ä¸äº²å’Œæ€§ä»‹ç»|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="k8s">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
        
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>8-Kuberneteså…¥é—¨åŸºç¡€ä¹‹è°ƒåº¦å™¨ä¸äº²å’Œæ€§ä»‹ç»</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">8-Kuberneteså…¥é—¨åŸºç¡€ä¹‹è°ƒåº¦å™¨ä¸äº²å’Œæ€§ä»‹ç»</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-10-27T10:37:47.000Z" itemprop="datePublished" class="page-time">
  2020-10-27
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/OperationTools/">OperationTools</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
  <article id="post-è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/8-Kuberneteså…¥é—¨åŸºç¡€ä¹‹è°ƒåº¦å™¨ä¸äº²å’Œæ€§ä»‹ç»"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">8-Kuberneteså…¥é—¨åŸºç¡€ä¹‹è°ƒåº¦å™¨ä¸äº²å’Œæ€§ä»‹ç»</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-10-27 18:37:47" datetime="2020-10-27T10:37:47.000Z"  itemprop="datePublished">2020-10-27</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/OperationTools/">OperationTools</a></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<hr>
<h2 id="0x01-Scheduler-ä»»åŠ¡è°ƒåº¦å™¨"><a href="#0x01-Scheduler-ä»»åŠ¡è°ƒåº¦å™¨" class="headerlink" title="0x01 Scheduler-ä»»åŠ¡è°ƒåº¦å™¨"></a>0x01 Scheduler-ä»»åŠ¡è°ƒåº¦å™¨</h2><p><strong>Q: ä»€ä¹ˆæ˜¯Scheduler?</strong></p>
<blockquote>
<p>ç­”: Scheduler<code>ç¾ /ËˆskedÊ’uËlÉ™r/</code>æ˜¯ kubernetes ä¸­çš„è°ƒåº¦å™¨ç»„ä»¶, å…¶ä¸»è¦ä»»åŠ¡æ˜¯<code>æŠŠæŒ‡å®šçš„Podåˆ†é…åˆ°é›†ç¾¤å·¥ä½œèŠ‚ç‚¹(æˆ–è€…è¯´éæ±¡ç‚¹èŠ‚ç‚¹)ä¹‹ä¸Š</code>;<br>ä»–æ˜¯ä½œä¸ºå•ç‹¬çš„ç¨‹åºè¿è¡Œçš„å¯åŠ¨ä¹‹åä¼šä¸€ç›´å’ŒAPIServeræŒç»­è¿æ¥ï¼Œå½“ç„¶æœ‰ pod çš„èµ„æºæ¸…å•ä¸­  Pod.Spec.NodeName ä¸ºç©ºçš„æ—¶å€™ï¼Œå¯¹æ¯ä¸ªpodéƒ½ä¼šåˆ›å»ºä¸€ä¸ªbindingï¼Œè¡¨æ˜è¯¥ pod åº”è¯¥æ”¾åˆ°å“ªä¸ªèŠ‚ç‚¹ä¸Š</p>
</blockquote>
<p>Tips: ç”±äºPodè°ƒåº¦ç­–ç•¥çš„éšæœºæ€§ï¼Œå…¶ç›®çš„æ˜¯è‡ªå®šä¹‰Podè°ƒåº¦åˆ°å“ªä¸€ä¸ªèŠ‚ç‚¹;</p>
<p><br/></p>
<p><strong>Q: å®ç° Scheduler è°ƒåº¦å™¨éœ€è¦è€ƒè™‘çš„é—®é¢˜?</strong></p>
<blockquote>
<p>1.å…¬å¹³: å¦‚ä½•ä¿è¯æ¯ä¸ªèŠ‚ç‚¹éƒ½èƒ½è¢«åˆ†é….<br>2.èµ„æºé«˜æ•ˆåˆ©ç”¨: é›†ç¾¤æ‰€æœ‰èµ„æºæœ€å¤§åŒ–è¢«ä½¿ç”¨.<br>3.æ•ˆç‡: è°ƒåº¦çš„æ€§èƒ½è¦å¥½ï¼Œèƒ½å¤Ÿå°½å¿«åœ°å¯¹å¤§æ‰¹é‡çš„pod å®Œæˆè°ƒåº¦å·¥ä½œ.<br>4.çµæ´»: å…è®¸ç”¨æˆ·æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ§åˆ¶è°ƒåº¦çš„é€»è¾‘.</p>
</blockquote>
<hr>
<h3 id="1-è°ƒåº¦åŸºç¡€æ¦‚å¿µ"><a href="#1-è°ƒåº¦åŸºç¡€æ¦‚å¿µ" class="headerlink" title="1.è°ƒåº¦åŸºç¡€æ¦‚å¿µ"></a>1.è°ƒåº¦åŸºç¡€æ¦‚å¿µ</h3><p><strong>ï¼ˆ1ï¼‰è°ƒåº¦è¿‡ç¨‹ï¼ˆæ„æˆéƒ¨åˆ†ï¼‰è¯´æ˜:</strong></p>
<ul>
<li>1.é¦–å…ˆæ˜¯è¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º <code>predicate è‹± /ËˆprÉ›dÉªËŒkeÉªt/</code> - v. ä½¿â€¦â€¦åŸºäº;</li>
<li>2.ç„¶åå¯¹é€šè¿‡çš„èŠ‚ç‚¹æŒ‰ç…§ä¼˜å…ˆçº§æ’åºï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º<code>priority è‹± /praÉªËˆÉ’rÉ™ti/</code> - n. ä¼˜å…ˆ;ä¼˜å…ˆæƒ;</li>
<li>3.æœ€åä»ä¸­é€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„èŠ‚ç‚¹ã€‚</li>
</ul>
<p>Tips: å¦‚æœä¸­é—´ä»»ä½•ä¸€æ­¥éª¤æœ‰é”™è¯¯å°±ç›´æ¥è¿”å›é”™è¯¯;</p>
<ul>
<li><strong>Predicate ç³»åˆ—çš„ç®—æ³•</strong><ul>
<li>PodFitsResources ï¼šèŠ‚ç‚¹ä¸Šå‰©ä½™çš„èµ„æºæ˜¯å¦å¤§äº podè¯·æ±‚çš„èµ„æº</li>
<li>PodFitsHost ï¼šå¦‚æœpodæŒ‡å®šäº†NodeNameï¼Œæ£€æŸ¥èŠ‚ç‚¹åç§°æ˜¯å¦å’ŒNodeNameç›¸åŒ¹é…</li>
<li>PodFitsHostPorts ï¼šèŠ‚ç‚¹ä¸Šå·²ç»ä½¿ç”¨çš„portæ˜¯å¦å’Œ podç”³è¯·çš„portå†²çª</li>
<li>PodSelectorMatches : è¿‡æ»¤æ‰ å’Œ pod æŒ‡å®š çš„label ä¸åŒ¹é…çš„èŠ‚ç‚¹</li>
<li>NoDiskConflict ï¼š å·²ç» mount çš„ volume å’Œ pod æŒ‡å®šçš„ volume ä¸å†²çªï¼Œé™¤éå®ƒä»¬éƒ½æ˜¯åªè¯»</li>
</ul>
</li>
</ul>
<ul>
<li><strong>priority é€‰é¡¹</strong><br>æè¿°: ä¼˜å…ˆçº§ç”±ä¸€ç³»åˆ—é”®å€¼å¯¹ç»„æˆï¼Œé”®æ˜¯è¯¥ä¼˜å…ˆçº§é¡¹çš„åç§°ï¼Œå€¼æ˜¯å®ƒçš„æƒé‡ï¼ˆéå¸¸é‡è¦)ä¸€èˆ¬å¾—<code>æƒé‡è¶Šé«˜å³ä¼˜å…ˆçº§è¶Šé«˜</code>ï¼Œé€šè¿‡ç®—æ³•å¯¹æ‰€æœ‰çš„ä¼˜å…ˆçº§é¡¹ç›®å’Œæƒé‡è¿›è¡Œè®¡ç®—å¾—å‡ºæœ€ç»ˆçš„ç»“æœ;<br>è¿™äº›ä¼˜å…ˆçº§é€‰é¡¹åŒ…æ‹¬:<ul>
<li>LeastRequestedPriority : é€šè¿‡è®¡ç®—CPUå’Œ Memory çš„ä½¿ç”¨ç‡æ¥å†³å®šæƒé‡ï¼Œä½¿ç”¨ç‡è¶Šä½æƒé‡è¶Šé«˜ã€‚è¿™ä¸ªä¼˜å…ˆçº§æŒ‡æ ‡å€¾å‘äºèµ„æºä½¿ç”¨æ¯”ä¾‹æ›´ä½çš„èŠ‚ç‚¹;</li>
<li>BalancedResourceAllocation : èŠ‚ç‚¹ä¸Š CPU å’Œ Memory ä½¿ç”¨ç‡è¶Šæ¥è¿‘ï¼Œæƒé‡è¶Šé«˜ï¼Œè¯¥é¡¹éœ€è¦ä¸<code>LeastRequestedPriority</code>ä¸€èµ·ä½¿ç”¨ä¸èƒ½å•ç‹¬ä½¿ç”¨; <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…¶å«ä¹‰ç¤ºä¾‹æ˜¯è¡¨è¾¾å¦‚ä¸‹:</span></span><br><span class="line">Node1ï¼šCPU å ç”¨ 20% , Memory å ç”¨ 60 %;</span><br><span class="line">Node2: CPU å ç”¨ 50% , Memory å ç”¨ 50 %;</span><br><span class="line"><span class="comment"># æ­¤æ—¶ç”±äºNode2èµ„æºåˆ†é…æ›´åŠ å‡è¡¡æ­¤æ—¶æˆ‘ä»¬çš„Podå°†ä¼šä¼˜å…ˆè°ƒåº¦åˆ°æ­¤èŠ‚ç‚¹ä¹‹ä¸Š;</span></span><br></pre></td></tr></table></figure></li>
<li>ImageLocalityPriority : å€¾å‘äºå·²ç»æœ‰è¦ä½¿ç”¨é•œåƒçš„èŠ‚ç‚¹ï¼Œé•œåƒæ€»å¤§å°å€¼è¶Šå¤§ï¼Œæƒé‡è¶Šé«˜</li>
</ul>
</li>
</ul>
<p>Tips: å¦‚æœåœ¨ predicate è¿‡ç¨‹ä¸­æ²¡æœ‰åˆé€‚çš„èŠ‚ç‚¹ï¼Œpod ä¼šä¸€ç›´åœ¨ pending çŠ¶æ€ï¼Œä¸æ–­é‡è¯•è°ƒåº¦ç›´åˆ°æœ‰èŠ‚ç‚¹æ»¡è¶³æ¡ä»¶(<code>åé¢å°†ä¼šè¿›è¡Œå®è·µ</code>)ã€‚ä¹‹åå¦‚æœæœ‰å¤šä¸ªèŠ‚ç‚¹æ»¡è¶³æ­¤æ¡ä»¶å°±ç»§ç»­ priorities è¿‡ç¨‹<code>æŒ‰ç…§ä¼˜å…ˆçº§å¤§å°å¯¹èŠ‚ç‚¹æ’åº</code>;</p>
<p><br/></p>
<h3 id="2-è‡ªå®šä¹‰è°ƒåº¦å™¨"><a href="#2-è‡ªå®šä¹‰è°ƒåº¦å™¨" class="headerlink" title="2.è‡ªå®šä¹‰è°ƒåº¦å™¨"></a>2.è‡ªå®šä¹‰è°ƒåº¦å™¨</h3><p>æè¿°: é™¤äº† kubernetes è‡ªå¸¦çš„è°ƒåº¦å™¨å¼€å‘è€…ä¹Ÿå¯ä»¥ç¼–å†™è‡ªå·±çš„è°ƒåº¦å™¨, é€šè¿‡ <code>spec:schedulername</code> å‚æ•°æŒ‡å®šè°ƒåº¦å™¨çš„åå­—ï¼Œå¯ä»¥ä¸º pod é€‰æ‹©æŸä¸ªè°ƒåº¦å™¨è¿›è¡Œè°ƒåº¦;</p>
<p>Kubernetesä¹Ÿå…è®¸ç”¨æˆ·ç¼–å†™è‡ªå·±çš„è°ƒåº¦å™¨ç»„ä»¶ï¼Œå¹¶åœ¨åˆ›å»ºèµ„æºçš„æ—¶å€™å¼•ç”¨å®ƒã€‚å¤šä¸ªè°ƒåº¦å™¨å¯ä»¥åŒæ—¶è¿è¡Œå’Œå·¥ä½œï¼Œåªè¦åå­—ä¸å†²çª, Kubernetesæä¾›çš„<code>è°ƒåº¦å™¨åå­—æ˜¯default</code>ã€‚</p>
<p>ä¾‹å¦‚: ä½¿ç”¨æŸä¸ªè°ƒåº¦å™¨å°±æ˜¯åœ¨Podçš„<code>spec.schedulername</code>å­—æ®µä¸­å¡«å†™ä¸Šè°ƒåº¦å™¨çš„åå­—ã€‚å¦‚æœè‡ªå®šä¹‰çš„è°ƒåº¦å™¨åå­—æ˜¯my-schedulerï¼Œé‚£ä¹ˆåªæœ‰å½“spec.schedulernameå­—æ®µæ˜¯my-scheduleræ‰ä¼šè¢«è°ƒåº¦;</p>
<ul>
<li><p>èµ„æºæ¸…å•:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># èµ„æºå¯¹è±¡: pod.spec.schedulername</span></span><br><span class="line"><span class="comment"># é€šè¿‡ spec:schedulername å‚æ•°æŒ‡å®šè°ƒåº¦å™¨çš„åå­—ï¼Œå¯ä»¥ä¸ºpod é€‰æ‹©æŸä¸ªè°ƒåº¦å™¨è¿›è¡Œè°ƒåº¦</span></span><br><span class="line">apiVersion: v1 </span><br><span class="line">kind: Pod </span><br><span class="line">metadata:</span><br><span class="line">  name: annotation-second-scheduler </span><br><span class="line">  labels:</span><br><span class="line">    name: multischeduler-example </span><br><span class="line">spec:</span><br><span class="line">  schedulername: my-scheduler      <span class="comment"># å…³é”®ç‚¹ ï¼ˆé€‰æ‹©è°ƒåº¦å™¨ï¼‰</span></span><br><span class="line">  containers:</span><br><span class="line">  - name: pod-with-second-annotation-container </span><br><span class="line">    image: gcr.io/google_containers/pause:2.0</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç®€å•è°ƒåº¦è„šæœ¬: å®ƒé€šè¿‡kubectlå‘½ä»¤ä»apiserverè·å–æœªè°ƒåº¦çš„Podï¼ˆ<code>spec.schedulerName æ˜¯my-schedulerï¼Œå¹¶ä¸”spec.nodeName ä¸ºç©º</code>ï¼‰ï¼ŒåŒæ ·åœ°ï¼Œç”¨kubectlä»apiserverè·å–nodesçš„ä¿¡æ¯ï¼Œç„¶åéšæœºé€‰æ‹©ä¸€ä¸ªnodeä½œä¸ºè°ƒåº¦ç»“æœï¼Œå¹¶å†™å…¥åˆ°apiserverä¸­ã€‚æˆ‘ä»¬å¯é€šè¿‡<code>kubectl describe pod pod_name</code>æŸ¥çœ‹ä¸€ä¸ªPodé‡‡ç”¨çš„è°ƒåº¦å™¨;</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">SERVER=<span class="string">'localhost:8001'</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">for</span> PODNAME <span class="keyword">in</span> $(kubectl --server <span class="variable">$SERVER</span> get pods -o json | jq <span class="string">'.items[] | select(.spec.schedulerName == "my-scheduler") | select(.spec.nodeName == null) | .metadata.name'</span> | tr -d <span class="string">'"'</span>)</span><br><span class="line">;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        NODES=($(kubectl --server <span class="variable">$SERVER</span> get nodes -o json | jq <span class="string">'.items[].metadata.name'</span> | tr -d <span class="string">'"'</span>))</span><br><span class="line">        NUMNODES=<span class="variable">$&#123;#NODES[@]&#125;</span></span><br><span class="line">        CHOSEN=<span class="variable">$&#123;NODES[$[ $RANDOM % $NUMNODES ]]&#125;</span></span><br><span class="line">        curl --header <span class="string">"Content-Type:application/json"</span> --request POST --data <span class="string">'&#123;"apiVersion":"v1", "kind": "Binding", "metadata": &#123;"name": "'</span><span class="variable">$PODNAME</span><span class="string">'"&#125;, "target": &#123;"apiVersion": "v1", "kind"</span></span><br><span class="line"><span class="string">: "Node", "name": "'</span><span class="variable">$CHOSEN</span><span class="string">'"&#125;&#125;'</span> http://<span class="variable">$SERVER</span>/api/v1/namespaces/default/pods/<span class="variable">$PODNAME</span>/binding/</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Assigned <span class="variable">$PODNAME</span> to <span class="variable">$CHOSEN</span>"</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    sleep 1</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="3-nodeAffinity-èŠ‚ç‚¹äº²å’Œæ€§"><a href="#3-nodeAffinity-èŠ‚ç‚¹äº²å’Œæ€§" class="headerlink" title="3.nodeAffinity - èŠ‚ç‚¹äº²å’Œæ€§"></a>3.nodeAffinity - èŠ‚ç‚¹äº²å’Œæ€§</h3><p>èµ„æºå¯¹è±¡: pod.spec.nodeAffinity<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">è½¯ç­–ç•¥</span> <span class="string">:</span> <span class="string">Â·preferredDuringSchedulingIgnoredDuringExecution:</span> <span class="string">ã€æˆ‘æƒ³è¦å»è¿™ä¸ªèŠ‚ç‚¹ã€‘</span> <span class="bullet">-</span> <span class="string">adj.</span> <span class="string">ä¼˜å…ˆçš„ï¼›é¦–é€‰çš„</span></span><br><span class="line"><span class="string">ç¡¬ç­–ç•¥</span> <span class="string">:</span> <span class="string">Â·requiredDuringschedulinglgnoredDuringExecution:</span> <span class="string">ã€æˆ‘ä¸€å®šè¦å»è¿™ä¸ªèŠ‚ç‚¹ã€‘</span> <span class="bullet">-</span> <span class="string">adj.</span> <span class="string">å¿…éœ€çš„ï¼›ï¼ˆç¾ï¼‰å¿…ä¿®çš„</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>ä»€ä¹ˆæ˜¯Podè°ƒåº¦çš„è½¯ç­–ç•¥ä»¥åŠç¡¬ç­–ç•¥?</strong></p>
<blockquote>
<p>1.è½¯ç­–ç•¥: å³å¸Œæœ› , è¡¨ç¤ºæƒ³åˆ°æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹ä¸Šå»ï¼Œå½“ä¸æ»¡è¶³æ—¶å€™å°±åˆ°å…¶å®ƒèŠ‚ç‚¹ä¸Šå»ã€‚<br>2.ç¡¬ç­–ç•¥: å³å¼ºåˆ¶ , è¡¨ç¤ºä¸€å®šåˆ°æŸä¸€ä¸ªèŠ‚ç‚¹ä¸Šå», å½“ä¸æ»¡è¶³æ¡ä»¶æ—¶å€™å…¶å“ªä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿä¸å»ï¼Œ<code>æ³¨æ„å…¶ä¼˜å…ˆçº§é«˜äºè½¯ç­–ç•¥</code>;</p>
</blockquote>
<p><br/></p>
<p><strong>é”®å€¼è¿ç®—å…³ç³»(å³operatorçš„å¯ç”¨å€¼):</strong></p>
<ul>
<li>In:     label çš„å€¼åœ¨æŸä¸ªåˆ—è¡¨ä¸­</li>
<li>NotIn:  label çš„å€¼ä¸åœ¨æŸä¸ªåˆ—è¡¨ä¸­</li>
<li>Gt:     label çš„å€¼å¤§äºæŸä¸ªå€¼</li>
<li>Lt:     label çš„å€¼å°äºæŸä¸ªå€¼</li>
<li>Exists: æŸä¸ªlabelå­˜åœ¨</li>
<li>DoesNotExist: æŸä¸ªlabelä¸å­˜åœ¨</li>
</ul>
<!-- å¦‚æœ`nodeSelectorTerms`ä¸‹é¢æœ‰å¤šä¸ªé€‰é¡¹çš„è¯ï¼Œæ»¡è¶³ä»»ä½•ä¸€ä¸ªæ¡ä»¶å°±å¯ä»¥äº†ï¼›å¦‚æœ`matchExpressions`æœ‰å¤šä¸ªé€‰é¡¹çš„è¯ï¼Œåˆ™å¿…é¡»åŒæ—¶æ»¡è¶³è¿™äº›æ¡ä»¶æ‰èƒ½æ­£å¸¸è°ƒåº¦Pod -->
<p><br></p>
<h4 id="ç¡¬ç­–ç•¥"><a href="#ç¡¬ç­–ç•¥" class="headerlink" title="ç¡¬ç­–ç•¥"></a>ç¡¬ç­–ç•¥</h4><p>èµ„æºæ¸…å•: affinity-strong-demo.yaml<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&gt; affinity-strong-demo.yaml&lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">strong-affinity</span> </span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">node-strong-affinity-pod</span> </span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">with-strong-node-affinity</span> </span><br><span class="line"><span class="attr">    image:</span> <span class="string">harbor.weiyigeek.top/test/busbox:latest</span></span><br><span class="line"><span class="attr">    imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">    command:</span> <span class="string">["/bin/sh","-c","sleep</span> <span class="number">700</span><span class="string">"]</span></span><br><span class="line"><span class="string">  restartPolicy: Never          # é‡å¯ç­–ç•¥</span></span><br><span class="line"><span class="string">  affinity:                     # äº²å’Œæ€§</span></span><br><span class="line"><span class="string">    nodeAffinity:               # èŠ‚ç‚¹äº²å’Œæ€§</span></span><br><span class="line"><span class="string">      requiredDuringSchedulingIgnoredDuringExecution:  # ç¡¬ç­–ç•¥ï¼ˆå¿…é¡»å¾—ï¼‰</span></span><br><span class="line"><span class="string">        nodeSelectorTerms:          # èŠ‚ç‚¹é€‰æ‹©æ¡ä»¶</span></span><br><span class="line"><span class="string">        - matchExpressions:         # åŒ¹é…è¡¨è¾¾å¼</span></span><br><span class="line"><span class="string">          - key: kubernetes.io/hostname   # Key å€¼</span></span><br><span class="line"><span class="string">            operator: NotIn          # è¡¨è¾¾å¼ è¡¨ç¤º Nodeä¸»æœºåç§°ä¸èƒ½æ˜¯k8s-node-4å³è¡¨ç¤ºä¸èƒ½åœ¨node-4çš„èŠ‚ç‚¹ä¸Šè¿è¡Œè¯¥Pod;</span></span><br><span class="line"><span class="string">            values:</span></span><br><span class="line"><span class="string">            - k8s-node-4             # Value å€¼</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure></p>
<p>æ“ä½œç¤ºä¾‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) éƒ¨ç½²èµ„æºæ¸…å•</span></span><br><span class="line">~/K8s/Day9/demo1$ kubectl create -f affinity-strong-demo.yaml</span><br><span class="line">  <span class="comment"># pod/affinity created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) æŸ¥çœ‹è°ƒåº¦å™¨ (æ­¤æ—¶Podå°†ä¼šè°ƒåº¦åˆ°Node0-5ä¹‹ä¸Š)</span></span><br><span class="line">$ kubectl get pod -o wide --show-labels</span><br><span class="line">  <span class="comment"># NAME       READY   STATUS    RESTARTS   AGE   IP            NODE           LABELS</span></span><br><span class="line">  <span class="comment"># affinity   1/1     Running   0          64s   10.244.2.17   k8s-node-5             app=node-strong-affinity-pod</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) ä¿®æ”¹è°ƒåº¦å™¨</span></span><br><span class="line">~/K8s/Day9/demo1$ kubectl delete -f affinity-strong-demo.yaml   <span class="comment"># å…ˆåˆ é™¤åŸæ¥çš„Podä¸‹åŒ</span></span><br><span class="line">  <span class="comment"># pod "affinity" deleted</span></span><br><span class="line">$ vim affinity-strong-demo.yaml</span><br><span class="line"><span class="comment"># spec:</span></span><br><span class="line"><span class="comment">#   affinity:</span></span><br><span class="line"><span class="comment">#     nodeAffinity:</span></span><br><span class="line"><span class="comment">#       requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line"><span class="comment">#         nodeSelectorTerms:</span></span><br><span class="line"><span class="comment">#         - matchExpressions:</span></span><br><span class="line"><span class="comment">#           - key: kubernetes.io/hostname</span></span><br><span class="line"><span class="comment">#             operator: In   # ä¿®æ”¹ç‚¹  è¡¨ç¤º Nodeä¸»æœºåç§°æ˜¯k8s-node-4å³è¡¨ç¤ºåªèƒ½åœ¨ node-4 çš„èŠ‚ç‚¹ä¸Šè¿è¡Œè¯¥Pod</span></span><br><span class="line"><span class="comment">#             values:</span></span><br><span class="line"><span class="comment">#             - k8s-node-4</span></span><br><span class="line">~/K8s/Day9/demo1$ kubectl create -f affinity-strong-demo.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) éªŒè¯</span></span><br><span class="line">~/K8s/Day9/demo1$ kubectl get pod -o wide --show-labels</span><br><span class="line">  <span class="comment"># NAME              READY   STATUS    RESTARTS   AGE   IP             NODE           LABELS</span></span><br><span class="line">  <span class="comment"># strong-affinity   1/1     Running   0          6s    10.244.1.141   k8s-node-4             app=node-strong-affinity-pod</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (5) æ­¤æ—¶è®¾ç½®ä¸€ä¸ªä¸å¯æ»¡è¶³çš„æ¡ä»¶æ—¶ï¼ˆæˆ‘ä»¬æ ¹æœ¬éƒ½æ²¡æœ‰ä¸€ä¸ªnode-6å¾—èŠ‚ç‚¹ï¼‰ï¼Œæ­¤æ—¶Podå°†ä¼šä¸€ç›´å¤„äº Pending</span></span><br><span class="line"><span class="comment"># spec:</span></span><br><span class="line"><span class="comment">#   affinity:</span></span><br><span class="line"><span class="comment">#     nodeAffinity:</span></span><br><span class="line"><span class="comment">#       requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line"><span class="comment">#         nodeSelectorTerms:</span></span><br><span class="line"><span class="comment">#         - matchExpressions:</span></span><br><span class="line"><span class="comment">#           - key: kubernetes.io/hostname # è¡¨ç¤º Node ä¸»æœºåç§°</span></span><br><span class="line"><span class="comment">#             operator: In                # å³è¡¨ç¤ºåªèƒ½åœ¨ node-6 çš„èŠ‚ç‚¹ä¸Šè¿è¡Œè¯¥Pod</span></span><br><span class="line"><span class="comment">#             values:</span></span><br><span class="line"><span class="comment">#             - k8s-node-6                # åŒ¹é…å€¼æ˜¯ k8s-node-6</span></span><br><span class="line">~/K8s/Day9/demo1$ kubectl create -f affinity-strong-demo-2.yaml</span><br><span class="line">  <span class="comment"># pod/strong-affinity created</span></span><br><span class="line">~/K8s/Day9/demo1$ kubectl get pod -o wide</span><br><span class="line">  <span class="comment"># NAME              READY   STATUS            RESTARTS   AGE   IP       NODE    </span></span><br><span class="line">  <span class="comment"># strong-affinity   0/1     Pending ï¼ˆå…³é”®ç‚¹ï¼‰  0          10s   &lt;none&gt;   &lt;none&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="è½¯ç­–ç•¥"><a href="#è½¯ç­–ç•¥" class="headerlink" title="è½¯ç­–ç•¥"></a>è½¯ç­–ç•¥</h4><p>èµ„æºæ¸…å•: affinity-soft-demo.yaml<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&gt; affinity-soft-demo.yaml&lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">soft-affinity</span> </span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">node-soft-affinity-pod</span> </span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">with-soft-node-affinity</span> </span><br><span class="line"><span class="attr">    image:</span> <span class="string">harbor.weiyigeek.top/test/busbox:latest</span></span><br><span class="line"><span class="attr">    imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">    command:</span> <span class="string">["/bin/sh","-c","sleep</span> <span class="number">700</span><span class="string">"]</span></span><br><span class="line"><span class="string">  restartPolicy: Never          # é‡å¯ç­–ç•¥</span></span><br><span class="line"><span class="string">  affinity:                     # äº²å’Œæ€§</span></span><br><span class="line"><span class="string">    nodeAffinity:               # èŠ‚ç‚¹äº²å’Œæ€§</span></span><br><span class="line"><span class="string">      preferredDuringSchedulingIgnoredDuringExecution:  # è½¯ç­–ç•¥ï¼ˆä¼˜å…ˆçº§é¦–é€‰å¾—ï¼‰</span></span><br><span class="line"><span class="string">      - weight: 1               # æƒé‡(è¶Šé«˜å…¶åŒ¹é…ä¼˜å…ˆçº§è¶Šé«˜)</span></span><br><span class="line"><span class="string">        preference:             # åå‘</span></span><br><span class="line"><span class="string">          matchExpressions:     # åŒ¹é…è¡¨è¾¾å¼</span></span><br><span class="line"><span class="string">          - key: source         # Key å€¼</span></span><br><span class="line"><span class="string">            operator: In        # è¡¨è¾¾å¼  </span></span><br><span class="line"><span class="string">            values: </span></span><br><span class="line"><span class="string">            - k8s-node-3        # Value å€¼  è¡¨ç¤º æœ€æƒ³åŒ¹é…åˆ°node3èŠ‚ç‚¹</span></span><br><span class="line"><span class="string">      - weight: 2               # æƒé‡(è¶Šé«˜å…¶åŒ¹é…ä¼˜å…ˆçº§è¶Šé«˜)</span></span><br><span class="line"><span class="string">        preference:             # åå‘</span></span><br><span class="line"><span class="string">          matchExpressions:     # åŒ¹é…è¡¨è¾¾å¼</span></span><br><span class="line"><span class="string">          - key: source         # Key å€¼</span></span><br><span class="line"><span class="string">            operator: NotIn        # è¡¨è¾¾å¼  </span></span><br><span class="line"><span class="string">            values: </span></span><br><span class="line"><span class="string">            - k8s-node-4        # Value å€¼  è¡¨ç¤º ä¸æƒ³åŒ¹é…åˆ°node4èŠ‚ç‚¹</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure></p>
<p>æ“ä½œç¤ºä¾‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) åˆ›å»ºéƒ¨ç½²èŠ‚ç‚¹</span></span><br><span class="line">~/K8s/Day9/demo1$ kubectl create -f affinity-soft-demo.yaml</span><br><span class="line">  <span class="comment"># pod/soft-affinity created</span></span><br><span class="line">~/K8s/Day9/demo1$ kubectl get pod -o wide  <span class="comment">#æ­¤æ—¶å°†ä¼šè°ƒåº¦åˆ°node5ä¸Šé¢</span></span><br><span class="line">  <span class="comment"># NAME              READY   STATUS    RESTARTS   AGE   IP            NODE        </span></span><br><span class="line">  <span class="comment"># soft-affinity     1/1     Running   0          8s    10.244.2.19   k8s-node-5 </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) ä¿®æ”¹æƒé‡è¿½åŠ å¦‚ä¸‹</span></span><br><span class="line">      <span class="comment"># - weight: 3               # æƒé‡(è¶Šé«˜å…¶åŒ¹é…ä¼˜å…ˆçº§è¶Šé«˜)</span></span><br><span class="line">      <span class="comment">#   preference:             # åå‘</span></span><br><span class="line">      <span class="comment">#     matchExpressions:     # åŒ¹é…è¡¨è¾¾å¼</span></span><br><span class="line">      <span class="comment">#     - key: source         # Key å€¼</span></span><br><span class="line">      <span class="comment">#       operator: In        # è¡¨è¾¾å¼  </span></span><br><span class="line">      <span class="comment">#       values: </span></span><br><span class="line">      <span class="comment">#       - k8s-node-4        # Value å€¼è¡¨ç¤ºæƒ³åŒ¹é…åˆ°node4èŠ‚ç‚¹</span></span><br><span class="line">~/K8s/Day9/demo1$ kubectl delete -f affinity-soft-demo-1.yaml &amp;&amp; kubectl create -f affinity-soft-demo-1.yaml &amp;&amp; sleep 10 &amp;&amp; kubectl get pod -o wide</span><br><span class="line"><span class="comment"># æ­¤æ—¶è™½ç„¶æƒ³åˆ°node4èŠ‚ç‚¹çš„äº²å’Œæ€§è¾ƒé«˜ç„¶åå‰é¢æœ‰æƒé‡ä¸º2çš„ä¸å¸Œæœ›åˆ°node4ä¸Šï¼Œæ­¤æ—¶ä»–ä»»ç„¶ä¸ä¼šå°†Podè°ƒåº¦åœ¨node4ä¸Š;</span></span><br><span class="line">  <span class="comment"># NAME              READY   STATUS    RESTARTS   AGE     IP            NODE        </span></span><br><span class="line">  <span class="comment"># soft-affinity     1/1     Running   0          5m38s   10.244.2.22   k8s-node-5</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="ç¡¬è½¯ç­–ç•¥è”ä½¿"><a href="#ç¡¬è½¯ç­–ç•¥è”ä½¿" class="headerlink" title="ç¡¬è½¯ç­–ç•¥è”ä½¿"></a>ç¡¬è½¯ç­–ç•¥è”ä½¿</h4><p>æè¿° : ç¡¬ç­–ç•¥ä¸è½¯ç­–ç•¥(<code>required &amp; preferred</code>)å¯ä»¥ç»„åˆç›¸äº’è¿›è¡Œä½¿ç”¨;<br>èµ„æºæ¸…å•:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&gt; requiredpreferred-strategy.yaml&lt;&lt;'END'</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">affinity</span> </span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">node-affinity-pod</span> </span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">with-node-affinity</span> </span><br><span class="line"><span class="attr">    image:</span> <span class="string">harbor.weiyigeek.top/test/busbox:latest</span></span><br><span class="line"><span class="attr">    imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">    command:</span> <span class="string">["/bin/sh","-c","sleep</span> <span class="number">700</span><span class="string">"]</span></span><br><span class="line"><span class="string">  affinity:</span></span><br><span class="line"><span class="string">    nodeAffinity:                                         # èŠ‚ç‚¹äº²å’Œæ€§</span></span><br><span class="line"><span class="string">      requiredDuringSchedulingIgnoredDuringExecution:     # ç¡¬ç­–ç•¥</span></span><br><span class="line"><span class="string">        nodeSelectorTerms:</span></span><br><span class="line"><span class="string">        - matchExpressions:</span></span><br><span class="line"><span class="string">          - key: kubernetes.io/hostname </span></span><br><span class="line"><span class="string">            operator: NotIn </span></span><br><span class="line"><span class="string">            values:</span></span><br><span class="line"><span class="string">            - k8s-node02 </span></span><br><span class="line"><span class="string">      preferredDuringSchedulingIgnoredDuringExecution:    # è½¯ç­–ç•¥</span></span><br><span class="line"><span class="string">      - weight: 1 </span></span><br><span class="line"><span class="string">        preference:</span></span><br><span class="line"><span class="string">          matchExpressions:</span></span><br><span class="line"><span class="string">          - key: kubernetes.io/hostname</span></span><br><span class="line"><span class="string">            operator: In </span></span><br><span class="line"><span class="string">            values:</span></span><br><span class="line"><span class="string">            - k8s-node03</span></span><br><span class="line"><span class="string">END</span></span><br></pre></td></tr></table></figure></p>
<p>Tips : è¯¥Pod<code>ä¸€å®šä¸èƒ½è°ƒåº¦åˆ°k8s-node02èŠ‚ç‚¹</code>ï¼Œä½†å¦‚æœ<code>k8s-node03å¯ä»¥è¢«è°ƒåº¦æ—¶</code>ä¾¿ä¼šè°ƒåº¦åˆ°<code>k8s-node03</code>èŠ‚ç‚¹;</p>
<h4 id="å›ºå®šèŠ‚ç‚¹è°ƒåº¦ç­–ç•¥-fixed"><a href="#å›ºå®šèŠ‚ç‚¹è°ƒåº¦ç­–ç•¥-fixed" class="headerlink" title="å›ºå®šèŠ‚ç‚¹è°ƒåº¦ç­–ç•¥(fixed)"></a>å›ºå®šèŠ‚ç‚¹è°ƒåº¦ç­–ç•¥(fixed)</h4><p>æè¿°: ä¸Šè¿°è®²äº†äº²å’Œæ€§æ¥é€‰æ‹©è¿è¡Œçš„èŠ‚ç‚¹ï¼Œå¦‚æœæƒ³è¦Podè¿è¡Œåœ¨æŒ‡å®šçš„èŠ‚ç‚¹ä¹‹ä¸Šå°±éœ€è¦æŒ‰ç…§ä¸‹è¿°è¿›è¡Œè®¾ç½®å›ºå®šè°ƒåº¦çš„èŠ‚ç‚¹;</p>
<p>ä¸»è¦æœ‰ä»¥ä¸‹èµ„æºå¯¹è±¡å­—æ®µè®¾ç½®Podè¿è¡Œçš„å›ºå®šèŠ‚ç‚¹:</p>
<ul>
<li>1) <code>spec.template.spec.nodeName</code></li>
<li>2) <code>pod.spec.nodeSelector</code></li>
</ul>
<p><br/></p>
<p>æ–¹å¼1.èµ„æºæ¸…å•ç¤ºä¾‹ï¼š<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&gt; fixed-node-test.yaml &lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">fixed-node-test</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">fixed-node</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">5</span></span><br><span class="line"><span class="attr">  selector:</span>                  <span class="comment"># æ³¨æ„å®ƒæ˜¯åœ¨Deploymentæ§åˆ¶å™¨ä¸­éœ€è¦ä¾èµ–çš„</span></span><br><span class="line"><span class="attr">    matchLabels:</span>  </span><br><span class="line"><span class="attr">      app:</span> <span class="string">fixed-node</span>        <span class="comment"># åŒ¹é…çš„Podæ ‡ç­¾éå¸¸é‡è¦</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">fixed-node</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      nodeName:</span> <span class="string">k8s-node-4</span>      <span class="comment"># èŠ‚ç‚¹ç»‘å®š (å…³é”®ç‚¹)</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">fixed-node</span> </span><br><span class="line"><span class="attr">        image:</span> <span class="string">harbor.weiyigeek.top/test/busbox:latest</span></span><br><span class="line"><span class="attr">        imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">        command:</span> <span class="string">["/bin/sh","-c","sleep</span> <span class="number">700</span><span class="string">"]</span></span><br><span class="line"><span class="string">        ports:</span></span><br><span class="line"><span class="string">        - containerPort: 80</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure></p>
<p>æ“ä½œæµç¨‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) éƒ¨ç½²`deployment`ç®¡ç†çš„`fiexd`å›ºå®šæ§åˆ¶å™¨</span></span><br><span class="line">~/K8s/Day9/demo2$ kubectl create -f fixed-node-test.yaml</span><br><span class="line">  <span class="comment"># deployment.apps/fixed-node-test created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) æŸ¥çœ‹Podéƒ¨ç½²çŠ¶æ€</span></span><br><span class="line">~/K8s/Day9/demo2$ kubectl get pod</span><br><span class="line">  <span class="comment"># NAME                               READY   STATUS              RESTARTS   AGE</span></span><br><span class="line">  <span class="comment"># fixed-node-test-5f67b8645d-4c7vd   0/1     ContainerCreating   0          3s</span></span><br><span class="line">  <span class="comment"># fixed-node-test-5f67b8645d-bcrj7   0/1     ContainerCreating   0          3s</span></span><br><span class="line">  <span class="comment"># fixed-node-test-5f67b8645d-cnb5n   0/1     ContainerCreating   0          3s</span></span><br><span class="line">  <span class="comment"># fixed-node-test-5f67b8645d-sh5ld   0/1     ContainerCreating   0          3s</span></span><br><span class="line">  <span class="comment"># fixed-node-test-5f67b8645d-v5kfd   0/1     ContainerCreating   0          3s</span></span><br><span class="line">  <span class="comment"># taint-tolerations                  0/1     Pending             0          24m</span></span><br><span class="line">~/K8s/Day9/demo2$ kubectl get pod -o wide</span><br><span class="line">  <span class="comment"># NAME                               READY   STATUS    RESTARTS   AGE   IP             NODE        </span></span><br><span class="line">  <span class="comment"># fixed-node-test-5f67b8645d-4c7vd   1/1     Running   0          7s    10.244.1.148   k8s-node-4 </span></span><br><span class="line">  <span class="comment"># fixed-node-test-5f67b8645d-bcrj7   1/1     Running   0          7s    10.244.1.146   k8s-node-4 </span></span><br><span class="line">  <span class="comment"># fixed-node-test-5f67b8645d-cnb5n   1/1     Running   0          7s    10.244.1.145   k8s-node-4 </span></span><br><span class="line">  <span class="comment"># fixed-node-test-5f67b8645d-sh5ld   1/1     Running   0          7s    10.244.1.147   k8s-node-4 </span></span><br><span class="line">  <span class="comment"># fixed-node-test-5f67b8645d-v5kfd   1/1     Running   0          7s    10.244.1.149   k8s-node-4</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>æ–¹å¼2.èµ„æºæ¸…å•ç¤ºä¾‹:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&gt; fixed-node-test-1.yaml &lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">fixed-node-test-1</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">fixed-node-1</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">5</span></span><br><span class="line"><span class="attr">  selector:</span>                    <span class="comment"># æ³¨æ„å®ƒæ˜¯åœ¨Deploymentæ§åˆ¶å™¨ä¸­éœ€è¦ä¾èµ–çš„</span></span><br><span class="line"><span class="attr">    matchLabels:</span>  </span><br><span class="line"><span class="attr">      app:</span> <span class="string">fixed-node-1</span>        <span class="comment"># åŒ¹é…çš„Podæ ‡ç­¾éå¸¸é‡è¦</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">fixed-node-1</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      nodeSelector:</span></span><br><span class="line"><span class="attr">        nodetype:</span> <span class="string">fixed</span>           <span class="comment"># èŠ‚ç‚¹æ ‡ç­¾ (ä¸»è¦éœ€è¦ç»™èŠ‚ç‚¹æ‰“æ ‡ç­¾ç„¶åæ‰èƒ½æŒ‡å®š)</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">fixed-node-1</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">harbor.weiyigeek.top/test/busbox:latest</span></span><br><span class="line"><span class="attr">        imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">        command:</span> <span class="string">["/bin/sh","-c","sleep</span> <span class="number">700</span><span class="string">"]</span></span><br><span class="line"><span class="string">        ports:</span></span><br><span class="line"><span class="string">        - containerPort: 80       # å®¹å™¨æš´éœ²ç«¯å£ </span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure></p>
<p>éƒ¨ç½²æµç¨‹:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) èŠ‚ç‚¹æ‰“æ ‡ç­¾(åªæœ‰æ‰“äº†æ‰èƒ½ç”Ÿæ•ˆ)</span></span><br><span class="line">~/K8s/Day9/demo2$ kubectl label node k8s-node-5 nodetype=fixed</span><br><span class="line"><span class="comment"># node/k8s-node-5 labeled</span></span><br><span class="line">kubectl get node --show-labels <span class="comment"># æŸ¥çœ‹æ‰“çš„æ ‡ç­¾</span></span><br><span class="line">  <span class="comment"># NAME          STATUS   ROLES    AGE   VERSION   LABELS</span></span><br><span class="line">  <span class="comment"># weiyigeek-ubuntu   Ready    master   18d   v1.19.3   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=weiyigeek-ubuntu,kubernetes.io/os=linux,node-role.kubernetes.io/master=</span></span><br><span class="line">  <span class="comment"># k8s-node-4    Ready    &lt;none&gt;   18d   v1.19.3   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=k8s-node-4,kubernetes.io/os=linux</span></span><br><span class="line">  <span class="comment"># k8s-node-5    Ready    &lt;none&gt;   7d    v1.19.3   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=k8s-node-5,kubernetes.io/os=linux,nodetype=fixed</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) éƒ¨ç½²</span></span><br><span class="line">~/K8s/Day9/demo2$ kubectl create -f fixed-node-test-1.yaml</span><br><span class="line"><span class="comment"># deployment.apps/fixed-node-test-1 created</span></span><br><span class="line"></span><br><span class="line">~/K8s/Day9/demo2$ kubectl get pod -o wide  <span class="comment"># å¯ä»¥çœ‹è§æ‰€æœ‰çš„Podéƒ½è¿è¡Œåœ¨k8s-node-5ä¸Š</span></span><br><span class="line">  <span class="comment"># NAME                                 READY   STATUS    RESTARTS   AGE   IP             NODE        </span></span><br><span class="line">  <span class="comment"># fixed-node-test-1-6c996c5887-67ldb   1/1     Running   0          37s   10.244.2.30    k8s-node-5 </span></span><br><span class="line">  <span class="comment"># fixed-node-test-1-6c996c5887-g4gz8   1/1     Running   0          37s   10.244.2.28    k8s-node-5 </span></span><br><span class="line">  <span class="comment"># fixed-node-test-1-6c996c5887-j9f2k   1/1     Running   0          37s   10.244.2.27    k8s-node-5 </span></span><br><span class="line">  <span class="comment"># fixed-node-test-1-6c996c5887-msc5g   1/1     Running   0          37s   10.244.2.29    k8s-node-5 </span></span><br><span class="line">  <span class="comment"># fixed-node-test-1-6c996c5887-xfb6v   1/1     Running   0          37s   10.244.2.26    k8s-node-5 </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) æ›´è¿›ä¸€æ­¥å°†node4çš„æ ‡ç­¾æ›´æ”¹ä¸€è‡´ç„¶ååœ¨è¿›è¡ŒPodçš„æ‰©å±•æ“ä½œæŸ¥çœ‹æœ‰ä»€ä¹ˆæ•ˆæœ;</span></span><br><span class="line">kubectl label node k8s-node-4 nodetype=fixed</span><br><span class="line">  <span class="comment"># node/k8s-node-4 labeled</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) Deployment è¿›è¡Œæ‰©å®¹</span></span><br><span class="line">~/K8s/Day9/demo2$ kubectl scale --replicas=7 deploy fixed-node-test-1</span><br><span class="line">  <span class="comment"># deployment.apps/fixed-node-test-1 scaled</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (5) ç»“æœéªŒè¯</span></span><br><span class="line">~/K8s/Day9/demo2$ kubectl get pod -o wide | grep <span class="string">"fixed-node-test-1"</span></span><br><span class="line">  <span class="comment"># fixed-node-test-1-6c996c5887-67ldb   1/1     Running   0          37s   10.244.2.30    k8s-node-5 </span></span><br><span class="line">  <span class="comment"># fixed-node-test-1-6c996c5887-g4gz8   1/1     Running   0          37s   10.244.2.28    k8s-node-5 </span></span><br><span class="line">  <span class="comment"># fixed-node-test-1-6c996c5887-j9f2k   1/1     Running   0          37s   10.244.2.27    k8s-node-5 </span></span><br><span class="line">  <span class="comment"># fixed-node-test-1-6c996c5887-msc5g   1/1     Running   0          37s   10.244.2.29    k8s-node-5 </span></span><br><span class="line">  <span class="comment"># fixed-node-test-1-6c996c5887-xfb6v   1/1     Running   0          37s   10.244.2.26    k8s-node-5 </span></span><br><span class="line">  <span class="comment"># fixed-node-test-1-6c996c5887-tbnf4   1/1     Running   0          61s   10.244.1.152   k8s-node-4   # æ­¤æ—¶å¢åŠ ä¸¤ä¸ªPodè¿è¡Œåœ¨K8s-node-4ä¸Š</span></span><br><span class="line">  <span class="comment"># fixed-node-test-1-6c996c5887-xfb6v   1/1     Running   0          10m   10.244.2.26    k8s-node-4</span></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="4-podAffinity-Pod-äº²å’Œæ€§"><a href="#4-podAffinity-Pod-äº²å’Œæ€§" class="headerlink" title="4.podAffinity - Pod äº²å’Œæ€§"></a>4.podAffinity - Pod äº²å’Œæ€§</h3><p>æè¿°: åŒæ ·<code>PodAffinity</code>ä¹Ÿæœ‰<code>è½¯ç­–ç•¥å’Œç¡¬ç­–ç•¥</code>å…¶è§£é‡Šä¸èŠ‚ç‚¹äº²å’Œæ€§ç›¸åŒ;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) æ‰€å±å¯¹è±¡: pod.spec.affinity.podAffinity (äº²å’Œ) / podAntiAffinity (åäº²å’Œ)</span></span><br><span class="line">è½¯ç­–ç•¥ ï¼š* preferredDuringSchedulinglgnoredDuringExecution</span><br><span class="line">ç¡¬ç­–ç•¥ : * requiredDuringSchedulinglgnoredDuringExecution</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>èµ„æºæ¸…å•ç¤ºä¾‹:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) æ ¹æ®Podäº²å’Œæ€§åŒ¹é…è¯¥Podè¿è¡Œçš„èŠ‚ç‚¹,åäº²å’Œå°±æ˜¯ä¸å’Œæ»¡è¶³æ¡ä»¶çš„Podåœ¨åŒä¸€ä¸ªèŠ‚ç‚¹è¿è¡Œ;</span></span><br><span class="line"><span class="string">cat</span> <span class="string">&gt; pod-affinity-demo-1.yaml &lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">pod-affinity-demo1</span> </span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">pod-affinity</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">pod-affinity</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">harbor.weiyigeek.top/test/busbox:latest</span></span><br><span class="line"><span class="attr">    imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">    command:</span> <span class="string">["/bin/sh","-c","sleep</span> <span class="number">700</span><span class="string">"]</span></span><br><span class="line"><span class="string">  affinity:</span></span><br><span class="line"><span class="string">    podAffinity:  # Pod äº²å’Œæ€§</span></span><br><span class="line"><span class="string">      requiredDuringSchedulingIgnoredDuringExecution: # ç¡¬äº²å’Œ</span></span><br><span class="line"><span class="string">      - labelSelector:       # æ ‡ç­¾é€‰æ‹©å™¨</span></span><br><span class="line"><span class="string">          matchExpressions:  # åŒ¹é…è§„åˆ™</span></span><br><span class="line"><span class="string">          - key: app   </span></span><br><span class="line"><span class="string">            operator: In     # è¡¨ç¤º åŒ¹é…æ ‡ç­¾ä¸ºapp=node-soft-affinity-pod çš„Podåœ¨å“ªä¸€ä¸ªèŠ‚ç‚¹ä¹‹ä¸Š</span></span><br><span class="line"><span class="string">            values:</span></span><br><span class="line"><span class="string">            - node-soft-affinity-pod  </span></span><br><span class="line"><span class="string">        topologyKey: kubernetes.io/hostname </span></span><br><span class="line"><span class="string">    podAntiAffinity:  # Pod åäº²å’Œ</span></span><br><span class="line"><span class="string">      preferredDuringSchedulingIgnoredDuringExecution:  # è½¯äº²å’Œ</span></span><br><span class="line"><span class="string">      - weight: 1 </span></span><br><span class="line"><span class="string">        podAffinityTerm:</span></span><br><span class="line"><span class="string">          labelSelector:</span></span><br><span class="line"><span class="string">            matchExpressions:</span></span><br><span class="line"><span class="string">            - key: app </span></span><br><span class="line"><span class="string">              operator: In             # è¡¨ç¤º åŒ¹é…æ ‡ç­¾ä¸º`app=node-strong-affinity-pod`çš„ Pod åœ¨å“ªä¸€ä¸ªèŠ‚ç‚¹ä¹‹ä¸Š</span></span><br><span class="line"><span class="string">              values:</span></span><br><span class="line"><span class="string">              - node-strong-affinity-pod</span></span><br><span class="line"><span class="string">          topologyKey: kubernetes.io/hostname</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure></p>
<p>æ¸©é¦¨æç¤º: ä»€ä¹ˆæ˜¯ topologyKey? ä¸ªäººç†è§£ pod affinity çš„è°ƒåº¦èŒƒå›´ä¸º topologyã€‚</p>
<p>å®˜æ–¹è§£é‡Šï¼šå¦‚æœè¯¥Xå·²ç»åœ¨è¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªæ»¡è¶³è§„åˆ™Yçš„Podï¼Œåˆ™è¯¥Podåº”è¯¥ï¼ˆæˆ–è€…åœ¨éäº²å’Œæ€§çš„æƒ…å†µä¸‹ä¸åº”è¯¥ï¼‰åœ¨ X ä¸­è¿è¡Œ,Y è¡¨ç¤ºä¸ºLabelSelectorè§„åˆ™, X æ˜¯ä¸€ä¸ªæ‹“æ‰‘åŸŸï¼Œä¾‹å¦‚èŠ‚ç‚¹ï¼Œæœºæ¶ï¼Œäº‘æä¾›è€…åŒºåŸŸï¼Œäº‘æä¾›è€…åŒºåŸŸç­‰ã€‚æ‚¨å¯ä»¥ä½¿ç”¨topologyKeyè¿™æ˜¯ç³»ç»Ÿç”¨æ¥è¡¨ç¤ºè¿™ç§æ‹“æ‰‘åŸŸçš„èŠ‚ç‚¹æ ‡ç­¾çš„å¯†é’¥ã€‚</p>
<p><br/></p>
<p><strong>æ“ä½œæµç¨‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) éƒ¨ç½²</span></span><br><span class="line">~/K8s/Day9/demo1$ kubectl create -f pod-affinity-demo-1.yaml</span><br><span class="line">  <span class="comment"># pod/pod-affinity-demo1 created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) éªŒè¯å¯ä»¥çœ‹è§è¿è¡Œåœ¨ k8s-node-5 èŠ‚ç‚¹ä¸Š,è¿™æ˜¯ç”±äºæˆ‘ä»¬çš„Podäº²å’Œæ€§çš„å¼ºç­–ç•¥;</span></span><br><span class="line">~/K8s/Day9/demo1$ kubectl get pod --show-labels -o wide</span><br><span class="line">  <span class="comment"># NAME                 READY   STATUS    RESTARTS   AGE   IP            NODE           LABELS</span></span><br><span class="line">  <span class="comment"># pod-affinity-demo1   1/1     Running   0          4s    10.244.2.24   k8s-node-5             app=pod-affinity</span></span><br><span class="line">  <span class="comment"># soft-affinity        1/1     Running   0          10s   10.244.2.23   k8s-node-5             app=node-soft-affinity-pod</span></span><br><span class="line">  <span class="comment"># strong-affinity      0/1     Pending   0          88m   &lt;none&gt;        &lt;none&gt;                 app=node-strong-affinity-pod</span></span><br></pre></td></tr></table></figure></p>
<p>PS : åœ¨ä½¿ç”¨Podäº²å’Œæ€§æ—¶æœ‰ä¸€ä¸ªé—®é¢˜éœ€è¦éå¸¸é‡è§†å³ï¼Œä¸ä¹‹åŒ¹é…Podå¿…é¡»æ˜¯RUNNINGçŠ¶æ€ï¼Œå¦åˆ™è®¤ä¸ºä¸æ»¡è¶³è°ƒåº¦æ¡ä»¶åˆ™Podå°†ä¼šè¢«ç½®ä¸ºPendingçŠ¶æ€;</p>
<p><br/></p>
<p><strong>èŠ‚ç‚¹ä¸Podçš„Affinityäº²å’Œæ€§æ€»ç»“:</strong><br>æè¿°: èŠ‚ç‚¹ä¸Pod<code>äº²å’Œæ€§/åäº²å’Œæ€§</code>è°ƒåº¦ç­–ç•¥æ¯”è¾ƒå¦‚ä¸‹ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è°ƒåº¦ç­–ç•¥       åŒ¹é…æ ‡ç­¾ æ“ä½œç¬¦                                   æ‹“æ‰‘åŸŸ æ”¯æŒè°ƒåº¦ç›®æ ‡</span></span><br><span class="line">nodeAffinity    ä¸»æœº     In, NotIn, Exists,DoesNotExist, Gt, Lt  å¦     æŒ‡å®šä¸»æœº</span><br><span class="line">podAffinity     POD      In, NotIn, Exists,DoesNotExist          æ˜¯     PODä¸æŒ‡å®šPODåŒä¸€æ‹“æ‰‘åŸŸ</span><br><span class="line">podAnitAffinity POD      In, NotIn, Exists,DoesNotExist          æ˜¯     PODä¸æŒ‡å®šPODä¸åœ¨åŒä¸€æ‹“æ‰‘åŸŸ</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>è¡¥å……è¯´æ˜.è§£å†³è´Ÿè½½ä¸å‡è¡¡çš„é—®é¢˜, å¯ä»¥ç»™Podå®¹å™¨è®¾ç½®åäº²å’Œï¼Œè®©è¿™äº›å®¹å™¨å¹³å‡çš„åˆ†å¸ƒåœ¨å„ä¸ªèŠ‚ç‚¹ä¸Šï¼ˆä¸è¦èšåœ¨ä¸€èµ·ï¼‰</strong><br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># èŠ‚ç‚¹ &amp; Pod åäº²å’Œ</span></span><br><span class="line"><span class="attr">affinity:</span></span><br><span class="line"><span class="attr">  nodeAffinity:</span></span><br><span class="line"><span class="attr">    requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line"><span class="attr">      nodeSelectorTerms:</span></span><br><span class="line"><span class="attr">      - matchExpressions:</span></span><br><span class="line"><span class="attr">        - key:</span> <span class="string">node</span></span><br><span class="line"><span class="attr">          operator:</span> <span class="string">In</span></span><br><span class="line"><span class="attr">          values:</span></span><br><span class="line"><span class="bullet">          -</span> <span class="string">work</span></span><br><span class="line"><span class="attr">  podAntiAffinity:</span></span><br><span class="line"><span class="attr">    preferredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line"><span class="attr">    - podAffinityTerm:</span></span><br><span class="line"><span class="attr">        labelSelector:</span></span><br><span class="line"><span class="attr">          matchExpressions:</span></span><br><span class="line"><span class="attr">          - key:</span> <span class="string">app.kubernetes.io/name</span></span><br><span class="line"><span class="attr">            operator:</span> <span class="string">In</span></span><br><span class="line"><span class="attr">            values:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">        topologyKey:</span> <span class="string">kubernetes.io/hostname</span></span><br><span class="line"><span class="attr">      weight:</span> <span class="number">100</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="5-Priority-Pod-ä¼˜å…ˆçº§"><a href="#5-Priority-Pod-ä¼˜å…ˆçº§" class="headerlink" title="5.Priority - Pod ä¼˜å…ˆçº§"></a>5.Priority - Pod ä¼˜å…ˆçº§</h3><p>æè¿°: ä¸å‰é¢æ‰€è®²çš„è°ƒåº¦ä¼˜é€‰ç­–ç•¥ä¸­çš„<code>ä¼˜å…ˆçº§ï¼ˆPrioritiesï¼‰</code>ä¸åŒï¼Œå‰æ–‡æ‰€è®²çš„ä¼˜å…ˆçº§æŒ‡çš„æ˜¯èŠ‚ç‚¹ä¼˜å…ˆçº§ï¼Œè€Œ<code>pod priority</code>æŒ‡çš„æ˜¯Podçš„ä¼˜å…ˆçº§ï¼Œé«˜ä¼˜å…ˆçº§çš„Podä¼šä¼˜å…ˆè¢«è°ƒåº¦ï¼Œæˆ–è€…åœ¨èµ„æºä¸è¶³ä½æƒ…å†µç‰ºç‰²ä½ä¼˜å…ˆçº§çš„Podä»¥ä¾¿äºé‡è¦çš„Podèƒ½å¤Ÿå¾—åˆ°èµ„æºéƒ¨ç½²ã€‚</p>
<p>ä¸ºäº†å®šä¹‰Podä¼˜å…ˆçº§ï¼Œéœ€è¦å…ˆå®šä¹‰PriorityClasså¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ²¡æœ‰Namespaceé™åˆ¶ï¼Œå®˜ç½‘ç¤ºä¾‹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) </span></span><br><span class="line">~$ kubectl api-resources | grep <span class="string">"priorityclasses"</span></span><br><span class="line">priorityclasses   pc   scheduling.k8s.io   <span class="literal">false</span>   PriorityClass</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) èµ„æºæ¸…å•</span></span><br><span class="line">apiVersion: scheduling.k8s.io/v1</span><br><span class="line">kind: PriorityClass</span><br><span class="line">metadata:</span><br><span class="line">  name: high-priority</span><br><span class="line">value: 1000000</span><br><span class="line">globalDefault: <span class="literal">false</span></span><br><span class="line">description: <span class="string">"This priority class should be used for XYZ service pods only."</span></span><br></pre></td></tr></table></figure></p>
<p>ç„¶åé€šè¿‡åœ¨Podçš„spec. priorityClassNameä¸­æŒ‡å®šå·²å®šä¹‰çš„PriorityClassåç§°å³å¯ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx</span><br><span class="line">  labels:</span><br><span class="line">    env: <span class="built_in">test</span></span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx</span><br><span class="line">    image: nginx</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">  priorityClassName: high-priority</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="6-Preemption-Pod-æŠ¢å "><a href="#6-Preemption-Pod-æŠ¢å " class="headerlink" title="6.Preemption - Pod æŠ¢å "></a>6.Preemption - Pod æŠ¢å </h3><p>æè¿°: å½“èŠ‚ç‚¹æ²¡æœ‰è¶³å¤Ÿçš„èµ„æºä¾›<code>è°ƒåº¦å™¨è°ƒåº¦Podã€å¯¼è‡´Podå¤„äºpendingæ—¶ï¼ŒæŠ¢å ï¼ˆpreemptionï¼‰</code>é€»è¾‘ä¼šè¢«è§¦å‘ã€‚Preemptionä¼šå°è¯•ä»ä¸€ä¸ªèŠ‚ç‚¹åˆ é™¤ä½ä¼˜å…ˆçº§çš„Podï¼Œä»è€Œé‡Šæ”¾èµ„æºä½¿é«˜ä¼˜å…ˆçº§çš„Podå¾—åˆ°èŠ‚ç‚¹èµ„æºè¿›è¡Œéƒ¨ç½²ã€‚</p>
<hr>
<h2 id="0x02-Taints-æ±¡ç‚¹"><a href="#0x02-Taints-æ±¡ç‚¹" class="headerlink" title="0x02 Taints - æ±¡ç‚¹"></a>0x02 Taints - æ±¡ç‚¹</h2><p>æè¿°: å‰é¢æˆ‘ä»¬è®²è¿°åˆ°èŠ‚ç‚¹äº²å’Œæ€§æ˜¯podçš„ä¸€ç§å±æ€§ï¼ˆåå¥½æˆ–ç¡¬æ€§è¦æ±‚), å®ƒå¯ä»¥ä½¿å¾—podè¿è¡Œåœ¨æ»¡è¶³æ¡ä»¶çš„ç‰¹å®šèŠ‚ç‚¹ä¹‹ä¸Š;</p>
<p><em>Q: é‚£ä»€ä¹ˆåˆæ˜¯Taint(æ±¡ç‚¹)?</em></p>
<blockquote>
<p>ç­”: Taint æ°æ°ä¸ä¹‹ç›¸å, å®ƒ<code>ä½¿èŠ‚ç‚¹èƒ½å¤Ÿæ’æ–¥ä¸€ç±»ç‰¹å®šçš„pod</code>ã€‚æ³¨æ„æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½å¯ä»¥åº”ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªtaint, å¦‚æœ<code>è®¾ç½®äº†å®¹å¿çš„Podå°†å¯ä»¥å®¹å¿æ±¡ç‚¹çš„å­˜åœ¨ï¼Œå¯ä»¥è¢«è°ƒåº¦åˆ°å­˜åœ¨æ±¡ç‚¹çš„ Node ä¸Š</code>;</p>
</blockquote>
<p>Tips : ä½¿ç”¨ kubectl çš„ taint å‘½ä»¤å¯ä»¥ç»™æŸä¸ªNodeèŠ‚ç‚¹è®¾ç½®æ±¡ç‚¹ï¼ŒNodeè¢«è®¾ç½®ä¸Šæ±¡ç‚¹ä¹‹åå°±å’ŒPodä¹‹é—´å­˜åœ¨äº†ä¸€ç§ç›¸æ–¥çš„å…³ç³»ï¼Œå¯ä»¥è®©Nodeæ‹’ç» Pod çš„è°ƒåº¦æ‰§è¡Œï¼Œç”šè‡³å°†Nodeå·²ç»å­˜åœ¨çš„Podé©±é€å‡ºå»ï¼›<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Syntax : å…¶ä¸­ value å¯ä»¥ä¸ºç©º effect æè¿°æ±¡ç‚¹çš„ä½œç”¨</span></span><br><span class="line">kubectl taint node [nodeName] key=value:[effect]   <span class="comment"># æ¯ä¸ªæ±¡ç‚¹æœ‰ä¸€ä¸ªkeyå’Œ valueä½œä¸ºæ±¡ç‚¹çš„æ ‡ç­¾</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‚æ•°å€¼</span></span><br><span class="line"><span class="comment"># å…¶ä¸­ [effect] å¯å–å€¼ : [ NoSchedule | PreferNoSchedule | NoExecute ]</span></span><br><span class="line">* NoSchedule : è¡¨ç¤ºk8så°†ä¸ä¼šå°†Pod è°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„ Node ä¸Š;</span><br><span class="line">* PreferNoSchedule : è¡¨ç¤ºk8så°†å°½é‡é¿å…å°†Podè°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„ Node ä¸Š;</span><br><span class="line">* NoExecute : è¡¨ç¤ºk8så°†ä¸ä¼šå°† Podè°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„Nodeä¸Šï¼ŒåŒæ—¶ä¼šå°†Nodeä¸Šå·²ç»å­˜åœ¨çš„ Pod é©±é€å‡ºå»;</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>æ¡ˆä¾‹æ¼”ç¤º:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0) æŸ¥çœ‹æŒ‡å®šèŠ‚ç‚¹taint</span></span><br><span class="line">$ kubectl describe node master1| grep <span class="string">"Taints"</span>  <span class="comment"># æŸ¥æ‰¾ Taints å­—æ®µ </span></span><br><span class="line">  <span class="comment"># Taints: node-role.kubernetes.io/master:NoSchedule</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰æ±¡ç‚¹ç­–ç•¥æ˜¾ç¤ºä¸‰ä¸ªmasterèŠ‚ç‚¹éƒ½æ˜¯NoSchedule</span></span><br><span class="line">$ kubectl get no -o yaml | grep taint -A 5</span><br><span class="line"><span class="comment">#     taints:</span></span><br><span class="line"><span class="comment">#     - effect: NoSchedule</span></span><br><span class="line"><span class="comment">#       key: node-role.kubernetes.io/master</span></span><br><span class="line"><span class="comment">#   status:</span></span><br><span class="line"><span class="comment">#     addresses:</span></span><br><span class="line"><span class="comment">#     - address: master1çš„IP</span></span><br><span class="line"><span class="comment"># --</span></span><br><span class="line"><span class="comment">#     taints:</span></span><br><span class="line"><span class="comment">#     - effect: NoSchedule</span></span><br><span class="line"><span class="comment">#       key: node-role.kubernetes.io/master</span></span><br><span class="line"><span class="comment">#   status:</span></span><br><span class="line"><span class="comment">#     addresses:</span></span><br><span class="line"><span class="comment">#     - address: master2çš„IP</span></span><br><span class="line"><span class="comment"># --</span></span><br><span class="line"><span class="comment">#     taints:</span></span><br><span class="line"><span class="comment">#     - effect: NoSchedule</span></span><br><span class="line"><span class="comment">#       key: node-role.kubernetes.io/master</span></span><br><span class="line"><span class="comment">#   status:</span></span><br><span class="line"><span class="comment">#     addresses:</span></span><br><span class="line"><span class="comment">#     - address: master3çš„IP</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 1) æ‰‹åŠ¨ä¸ºmasterèŠ‚ç‚¹è®¾ç½®taints</span></span><br><span class="line">$ kubectl taint nodes node1 key1=value1:NoSchedule </span><br><span class="line">$ kubectl taint nodes master1 node-role.kubernetes.io/master=:NoSchedule</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2) å»é™¤æ±¡ç‚¹çš„è®¾ç½®</span></span><br><span class="line">kubectl taint nodes node1 key1:NoSchedule-  <span class="comment"># è¿™é‡Œçš„keyå¯ä»¥ä¸ç”¨æŒ‡å®švalueä»£è¡¨åˆ é™¤æŒ‡å®škeyæ‰€æœ‰çš„effect;</span></span><br><span class="line">  <span class="comment"># de1 key1: NoSchedule-</span></span><br><span class="line">$ kubectl taint nodes k8s-master-1 node-role.kubernetes.io/master=:NoSchedule-</span><br><span class="line">  <span class="comment"># node/k8s-master-1untainted</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3ï¼‰ å–æ¶ˆæ±¡ç‚¹åç»“æœ</span></span><br><span class="line">$ kubectl describe node k8s-master-1 | grep <span class="string">"Taints"</span></span><br><span class="line">  <span class="comment"># Taints:             &lt;none&gt;                     # å–æ¶ˆæ±¡ç‚¹å</span></span><br><span class="line"></span><br><span class="line">$ kubectl get node --show-labels</span><br><span class="line">  <span class="comment"># NAME          STATUS   ROLES    AGE   VERSION   LABELS</span></span><br><span class="line">  <span class="comment"># weiyigeek-ubuntu   Ready    master   18d   v1.19.3   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=weiyigeek-ubuntu,kubernetes.io/os=linux,node-role.kubernetes.io/master=</span></span><br><span class="line">  <span class="comment"># k8s-node-4    Ready    &lt;none&gt;   18d   v1.19.3   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=k8s-node-4,kubernetes.io/os=linux</span></span><br><span class="line">  <span class="comment"># k8s-node-5    Ready    &lt;none&gt;   7d    v1.19.3   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=k8s-node-5,kubernetes.io/os=linux,nodetype=fixed</span></span><br><span class="line"></span><br><span class="line">~/K8s/Day9/demo1$ kubectl get no k8s-node-5 -o yaml | grep <span class="string">"key"</span> -C 3</span><br><span class="line">  <span class="comment">#   - 10.244.2.0/24</span></span><br><span class="line">  <span class="comment">#   taints:</span></span><br><span class="line">  <span class="comment">#   - effect: NoExecute</span></span><br><span class="line">  <span class="comment">#     key: node-role.kubernetes.io/master</span></span><br><span class="line">  <span class="comment"># status:</span></span><br><span class="line">  <span class="comment">#   addresses:</span></span><br><span class="line">  <span class="comment">#   - address: 10.10.107.215</span></span><br><span class="line"></span><br><span class="line">$ kubectl taint nodes k8s-node-5 node-role.kubernetes.io/master-</span><br><span class="line">  <span class="comment"># node/k8s-node-5 untainted</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>è¡¥å……æ“ä½œ:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1) å»é™¤æ±¡ç‚¹å…è®¸ master èŠ‚ç‚¹éƒ¨ç½² pod;</span></span><br><span class="line">[root@master1 ~]$ kubectl taint nodes --all node-role.kubernetes.io/master-</span><br><span class="line">  <span class="comment"># node/master1 untainted</span></span><br><span class="line">  <span class="comment"># node/master2 untainted</span></span><br><span class="line">  <span class="comment"># node/master3 untainted</span></span><br><span class="line">  <span class="comment"># error: taint "node-role.kubernetes.io/master" not found</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># 2) å†æ¬¡æŸ¥çœ‹æ— æ˜¾ç¤ºè¯´æ˜æ±¡ç‚¹å»é™¤æˆåŠŸ</span></span><br><span class="line">kubectl get no -o yaml | grep taint -A 5</span><br></pre></td></tr></table></figure></p>
<p>Tips : ä¸º master è®¾ç½®çš„è¿™ä¸ª taint ä¸­<code>node-role.kubernetes.io/master</code>ä¸º key/value ä¸ºç©º effect ä¸ºNoSchedule;<br>Tips : å¦‚æœè¾“å…¥å‘½ä»¤æ—¶ä½ ä¸¢æ‰äº†= ç¬¦å·, å†™æˆäº†<code>node-role.kubernetes.io/master:NoSchedule</code>, ä¼šæŠ¥ <code>error: at least one taint update is required</code> é”™è¯¯;</p>
<hr>
<h2 id="0x03-Toleration-å®¹å¿"><a href="#0x03-Toleration-å®¹å¿" class="headerlink" title="0x03 Toleration - å®¹å¿"></a>0x03 Toleration - å®¹å¿</h2><p><strong>Q: ä»€ä¹ˆæ˜¯Tolerationå®¹å¿?</strong></p>
<blockquote>
<p>ç­”: å³è¡¨ç¤ºè¿™äº› pod å¯ä»¥(ä½†ä¸è¦æ±‚)è¢«è°ƒåº¦åˆ°å…·æœ‰åŒ¹é… taint çš„èŠ‚ç‚¹ä¸Š, ç®€å•çš„è¯´</p>
</blockquote>
<p>Tips: Taint å’Œ Toleration ç›¸äº’é…åˆå¯ä»¥ç”¨æ¥é¿å…podè¢«åˆ†é…åˆ°ä¸åˆé€‚çš„èŠ‚ç‚¹ä¸Šã€‚è¡¨ç¤ºå¯¹äºé‚£äº›ä¸èƒ½å®¹å¿è¿™äº› taint çš„ pod æ˜¯ä¸ä¼šè¢«è¯¥èŠ‚ç‚¹æ¥å—çš„, ä½†æ˜¯é’ˆå¯¹ <code>Pod</code> æ²¡æœ‰èŠ‚ç‚¹è¿è¡Œæ—¶å¯ä»¥é€‰ä¸€å°æ±¡ç‚¹çš„èŠ‚ç‚¹è¿è¡ŒPod;</p>
<p>åœ¨ pod çš„ spec ä¸­è®¾ç½® tolerations å­—æ®µ:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.å½“ä¸æŒ‡å®škeyå€¼æ—¶è¡¨ç¤ºå®¹å¿æ‰€æœ‰çš„æ±¡ç‚¹key:</span></span><br><span class="line"><span class="attr">tolerations:</span></span><br><span class="line"><span class="attr">- operator:</span> <span class="string">"Exists"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.å½“ä¸æŒ‡å®š effect å€¼æ—¶è¡¨ç¤ºå®¹å¿æ‰€æœ‰çš„æ±¡ç‚¹ä½œç”¨ </span></span><br><span class="line"><span class="attr">tolerations:</span></span><br><span class="line"><span class="attr">- key:</span> <span class="string">"key"</span></span><br><span class="line"><span class="attr">  operator:</span> <span class="string">"Exists"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æŸ¥çœ‹å®¹å¿</span></span><br><span class="line"><span class="string">~$</span> <span class="string">kubectl</span> <span class="string">describe</span> <span class="string">pod</span></span><br><span class="line"><span class="attr">Tolerations:</span> <span class="string">node.kubernetes.io/not-ready:NoExecute</span> <span class="string">op=Exists</span> <span class="string">for</span> <span class="number">300</span><span class="string">s</span></span><br><span class="line">             <span class="string">node.kubernetes.io/unreachable:NoExecute</span> <span class="string">op=Exists</span> <span class="string">for</span> <span class="number">300</span><span class="string">s</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>Tolerations èµ„æºæ¸…å•æ¼”ç¤º:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pod.spec.tolerations</span></span><br><span class="line"><span class="attr">tolerationstolerations:</span></span><br><span class="line"><span class="attr">- key:</span> <span class="string">"key1"</span></span><br><span class="line"><span class="attr">  operator:</span> <span class="string">"Equal"</span>         <span class="comment"># å…¶ä¸­key, vaule, effect è¦ä¸Nodeä¸Šè®¾ç½®çš„ taintä¿æŒä¸€è‡´ </span></span><br><span class="line"><span class="attr">  value:</span> <span class="string">"value1"</span></span><br><span class="line"><span class="attr">  effect:</span> <span class="string">"NoSchedule"</span></span><br><span class="line"><span class="attr">  tolerationSeconds:</span> <span class="number">3600</span>   <span class="comment"># ç”¨äºæè¿°å½“Podéœ€è¦è¢«é©±é€æ—¶å¯ä»¥åœ¨ Podä¸Šç»§ç»­ä¿ç•™è¿è¡Œçš„æ—¶é—´ </span></span><br><span class="line"><span class="attr">- key:</span> <span class="string">"key1"</span></span><br><span class="line"><span class="attr">  operator:</span> <span class="string">"Equal"</span></span><br><span class="line"><span class="attr">  value:</span> <span class="string">"value1"</span></span><br><span class="line"><span class="attr">  effect:</span> <span class="string">"NoExecute"</span></span><br><span class="line"><span class="attr">- key:</span> <span class="string">"key2"</span></span><br><span class="line"><span class="attr">  operator:</span> <span class="string">"Exists"</span>                     <span class="comment"># ä¸ºExistså°†ä¼šå¿½ç•¥valueå€¼ </span></span><br><span class="line"><span class="attr">  effect:</span> <span class="string">"NoSchedule"</span></span><br><span class="line"><span class="attr">- key:</span> <span class="string">"node-role.kubernetes.io/master"</span>  <span class="comment"># å®¹å¿ tolerations ä¸»èŠ‚ç‚¹çš„ taints </span></span><br><span class="line"><span class="attr">  operator:</span> <span class="string">"Equal"</span>    </span><br><span class="line"><span class="attr">  value:</span> <span class="string">""</span> </span><br><span class="line"><span class="attr">  effect:</span> <span class="string">"PreferNoSchedule"</span>             <span class="comment"># å°½å¯èƒ½ä¸è°ƒåº¦Podåˆ°è¯¥èŠ‚ç‚¹ä¹‹ä¸Š</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>æ“ä½œå®ä¾‹:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (0) æœ‰å¤šä¸ªMaster å­˜åœ¨æ—¶é˜²æ­¢èµ„æºæµªè´¹ï¼Œå¯ä»¥å¦‚ä¸‹è®¾ç½®</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">taint</span> <span class="string">nodes</span> <span class="string">Node-Name</span> <span class="string">node-role.kubernetes.io/master=:PreferNoSchedule</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (1) å½“èŠ‚ç‚¹æœ‰æ•…éšœéœ€è¦é€€å‡ºæ—¶ï¼Œéœ€è¦å°†Podä»æŒ‡å®šNodeèŠ‚ç‚¹è¿›è¡Œé©±é€åï¼Œæ–¹å¯åˆ é™¤èŠ‚ç‚¹</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">taint</span> <span class="string">nodes</span> <span class="string">k8s-master-4</span> <span class="string">node-role.kubernetes.io/master=:NoExecute</span></span><br><span class="line">  <span class="comment"># node/k8s-node-5 tainted</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) æŸ¥çœ‹Podè¿è¡ŒèŠ‚ç‚¹</span></span><br><span class="line"><span class="string">$</span> <span class="string">kubectl</span> <span class="string">get</span> <span class="string">pod</span> <span class="bullet">-o</span> <span class="string">wide</span></span><br><span class="line">  <span class="comment"># NAME                 READY   STATUS        RESTARTS   AGE     IP            NODE      </span></span><br><span class="line">  <span class="comment"># pod-affinity-demo1   1/1     Terminating   335        2d17h   10.244.2.24   k8s-node-5</span></span><br><span class="line"><span class="string">~/K8s/Day9/demo1$</span> <span class="string">kubectl</span> <span class="string">get</span> <span class="literal">no</span> <span class="string">k8s-node-4</span> <span class="bullet">-o</span> <span class="string">yaml</span> <span class="string">| grep "key" -C 3</span></span><br><span class="line"><span class="string">  - 10.244.1.0/24</span></span><br><span class="line"><span class="string"></span><span class="attr">  taints:</span></span><br><span class="line"><span class="attr">  - effect:</span> <span class="string">NoSchedule</span></span><br><span class="line"><span class="attr">    key:</span> <span class="string">node-role.kubernetes.io/master</span>  <span class="comment"># å…³é”®ç‚¹</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line"><span class="attr">  addresses:</span></span><br><span class="line"><span class="attr">  - address:</span> <span class="number">10.10</span><span class="number">.107</span><span class="number">.214</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) æ¼”ç¤ºæ¡ˆä¾‹</span></span><br><span class="line"><span class="string">cat</span> <span class="string">&gt; taint-Tolerations-mode.yaml &lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">taint-tolerations</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">taint-tolerations-mode</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">with-soft-node-affinity</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">harbor.weiyigeek.top/test/busbox:latest</span></span><br><span class="line"><span class="attr">    imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">    command:</span> <span class="string">["/bin/sh","-c","sleep</span> <span class="number">700</span><span class="string">"]</span></span><br><span class="line"><span class="string">  restartPolicy: Never                # é‡å¯ç­–ç•¥(ç»ä¸é™¤éç§»é™¤é€€å‡º)</span></span><br><span class="line"><span class="string">  tolerations:                        </span></span><br><span class="line"><span class="string">  - key: "</span><span class="string">kubernetes.io/hostname"</span></span><br><span class="line"><span class="attr">    operator:</span> <span class="string">"Equal"</span>                 <span class="comment"># supported values: "Equal", "Exists"</span></span><br><span class="line"><span class="attr">    value:</span> <span class="string">"k8s-node-5"</span></span><br><span class="line"><span class="attr">    effect:</span> <span class="string">"NoExecute"</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) æ­¤æ—¶Podä¸ä¼šè¿è¡Œåœ¨k8s-node-5ä¸»æœºä¸Š</span></span><br><span class="line"><span class="string">~/K8s/Day9/demo1$</span> <span class="string">kubectl</span> <span class="string">create</span> <span class="bullet">-f</span> <span class="string">taint-Tolerations-mode.yaml</span></span><br><span class="line">  <span class="comment"># pod/taint-tolerations created</span></span><br><span class="line"><span class="string">~/K8s/Day9/demo1$</span> <span class="string">kubectl</span> <span class="string">get</span> <span class="string">pod</span> <span class="bullet">-o</span> <span class="string">wide</span></span><br><span class="line">  <span class="comment"># NAME                READY   STATUS    RESTARTS   AGE   IP             NODE       </span></span><br><span class="line">  <span class="comment"># taint-tolerations   1/1     Running   0          33s   10.244.1.143   k8s-node-4 </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (5) æ­¤æ—¶å¦‚æœå°†node-4ã€5ä¸»æœºéƒ½è®¾ç½®æˆä¸ºæ±¡ç‚¹åˆ™åˆ é™¤é‡å»ºPodå°†ä¼šè¿è¡Œk8s-node-5æœ‰æ±¡ç‚¹çš„è¿™å°æœºå™¨ï¼Œè¿™æ˜¯å› ä¸ºä¸Šé¢ tolerations å®¹å¿é…ç½®çš„åŸå› ;</span></span><br><span class="line"><span class="string">~/K8s/Day9/demo1$</span> <span class="string">kubectl</span> <span class="string">taint</span> <span class="string">nodes</span> <span class="string">k8s-node-4</span> <span class="string">node-role.kubernetes.io/master=:NoSchedule</span></span><br><span class="line"><span class="string">~/K8s/Day9/demo1$</span> <span class="string">kubectl</span> <span class="string">taint</span> <span class="string">nodes</span> <span class="string">k8s-node-5</span> <span class="string">node-role.kubernetes.io/master=:NoSchedule</span></span><br><span class="line"><span class="string">~/K8s/Day9/demo1$</span> <span class="string">kubectl</span> <span class="string">delete</span> <span class="bullet">-f</span> <span class="string">taint-Tolerations-mode.yaml</span></span><br><span class="line"><span class="string">~/K8s/Day9/demo1$</span> <span class="string">kubectl</span> <span class="string">get</span> <span class="string">pod</span> <span class="bullet">-o</span> <span class="string">wide</span></span><br><span class="line">  <span class="comment"># NAME                READY   STATUS    RESTARTS   AGE   IP       NODE    </span></span><br><span class="line">  <span class="comment"># taint-tolerations                    1/1     Running       0          10s   10.244.2.33   k8s-node-4   &lt;none&gt;           &lt;none&gt;</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="0x04-Cordon-Node-éš”ç¦»ä¸æ¢å¤"><a href="#0x04-Cordon-Node-éš”ç¦»ä¸æ¢å¤" class="headerlink" title="0x04 Cordon - Node éš”ç¦»ä¸æ¢å¤"></a>0x04 Cordon - Node éš”ç¦»ä¸æ¢å¤</h2><p>æè¿°: åœ¨æŸäº›åœºæ™¯ä¸‹éœ€è¦å¯¹Nodeè¿›è¡Œéš”ç¦»ï¼Œæ¯”å¦‚ç¡¬ä»¶å‡çº§æˆ–è€…ç»´æŠ¤ï¼Œç›®å‰éš”ç¦»çš„Nodeæœ‰ä¸¤ç§æ–¹å¼ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) ä½¿ç”¨ kubectl cordon å‘½ä»¤å¯ä»¥å¯¹æŸä¸€ä¸ªNodeè¿›è¡Œéš”ç¦»ï¼Œåœ¨éš”ç¦»åå°±ä¸ä¼šå‘è¯¥NodeèŠ‚ç‚¹è°ƒåº¦Podã€‚</span></span><br><span class="line">$ kubectl get node | grep <span class="string">"224"</span></span><br><span class="line">  <span class="comment"># weiyigeek-224   Ready    &lt;none&gt;   72d   v1.19.6</span></span><br><span class="line">$ kubectl cordon weiyigeek-224</span><br><span class="line">  <span class="comment"># node/weiyigeek-224 cordoned</span></span><br><span class="line">$ kubectl get node <span class="comment"># Tips ï¼šéš”ç¦»æ“ä½œå¹¶ä¸ä¼šåœæ­¢æˆ–è€…åˆ é™¤æ­£åœ¨è¿è¡Œçš„Podéœ€è¦äººå·¥è¿›è¡Œå¹²é¢„ï¼Œæ‰€ä»¥å°½ç®¡å·²ç»å¯¹224è¿›è¡Œéš”ç¦»ï¼Œä½†æ˜¯å…¶åœ¨ä¸Šé¢è¿è¡Œçš„PodçŠ¶æ€å¹¶æ²¡æœ‰å—åˆ°ä»»ä½•å½±å“ã€‚</span></span><br><span class="line">  <span class="comment"># NAME       STATUS                     ROLES    AGE   VERSION</span></span><br><span class="line">  <span class="comment"># weiyigeek-224   Ready,SchedulingDisabled   &lt;none&gt;   72d   v1.19.6</span></span><br><span class="line">$ ansible weiyigeek-224 -m shell -a <span class="string">"docker ps"</span></span><br><span class="line">  <span class="comment"># weiyigeek-224 | CHANGED | rc=0 &gt;&gt;</span></span><br><span class="line">  <span class="comment"># CONTAINER ID        IMAGE                                                           COMMAND                  CREATED             STATUS              PORTS               NAMES</span></span><br><span class="line">  <span class="comment"># 558fa21e1993        caa6655434a5                                                    "/conf/update-node.sâ€¦"   2 months ago        Up 2 months                             k8s_redis_redis-cluster-3_database_db60bf69-de70-4aa4-b8e6-84ebbb37992b_0</span></span><br><span class="line">  <span class="comment"># a515551a4f71        registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.2   "/pause"                 2 months ago        Up 2 months                             k8s_POD_redis-cluster-3_database_db60bf69-de70-4aa4-b8e6-84ebbb37992b_0</span></span><br><span class="line">  <span class="comment"># ffe033537640        183b53858d7d                                                    "start_runit"            2 months ago        Up 2 months                             k8s_calico-node_calico-node-7jcwh_kube-system_5c66e41b-f6d8-4ed8-a5b6-d08a5e734214_0</span></span><br><span class="line">  <span class="comment"># 6dbb52c66413        registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.2   "/pause"                 2 months ago        Up 2 months                             k8s_POD_calico-node-7jcwh_kube-system_5c66e41b-f6d8-4ed8-a5b6-d08a5e734214_0</span></span><br><span class="line">  <span class="comment"># 22bad44b05f4        dbcc366449b0                                                    "/usr/local/bin/kubeâ€¦"   2 months ago        Up 2 months                             k8s_kube-proxy_kube-proxy-25tts_kube-system_89870e87-ecb3-48fd-b42d-2b7662631d51_0</span></span><br><span class="line">  <span class="comment"># d0619946b54e        registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.2   "/pause"                 2 months ago        Up 2 months                             k8s_POD_kube-proxy-25tts_kube-system_89870e87-ecb3-48fd-b42d-2b7662631d51_0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) ç»Ÿä¸€çš„æ¢å¤æ–¹å¼:</span></span><br><span class="line">~$ kubectl uncordon weiyigeek-224</span><br><span class="line">  <span class="comment"># node/weiyigeek-224 uncordoned</span></span><br><span class="line">~$ kubectl get node | grep <span class="string">"224"</span></span><br><span class="line">  <span class="comment"># weiyigeek-224   Ready    &lt;none&gt;   72d   v1.19.6</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="FAQ-çŸ¥è¯†æ‰©å±•"><a href="#FAQ-çŸ¥è¯†æ‰©å±•" class="headerlink" title="FAQ - çŸ¥è¯†æ‰©å±•"></a>FAQ - çŸ¥è¯†æ‰©å±•</h2><h3 id="Qï¼šæ™®é€šç”¨æˆ·æœ‰è‡ªå®šä¹‰Podä¼˜å…ˆçº§çš„æƒé™å—ï¼Ÿ"><a href="#Qï¼šæ™®é€šç”¨æˆ·æœ‰è‡ªå®šä¹‰Podä¼˜å…ˆçº§çš„æƒé™å—ï¼Ÿ" class="headerlink" title="Qï¼šæ™®é€šç”¨æˆ·æœ‰è‡ªå®šä¹‰Podä¼˜å…ˆçº§çš„æƒé™å—ï¼Ÿ"></a>Qï¼šæ™®é€šç”¨æˆ·æœ‰è‡ªå®šä¹‰Podä¼˜å…ˆçº§çš„æƒé™å—ï¼Ÿ</h3><blockquote>
<p>Aï¼šå¯ä»¥ï¼ŒPodä¼˜å…ˆçº§å®šä¹‰ä¸åˆ›å»ºæ™®é€šPodç±»ä¼¼ï¼Œå¹¶æ²¡æœ‰ç‰¹åˆ«æƒé™æ§åˆ¶ã€‚å®šä¹‰Podä¼˜å…ˆçº§ï¼Œéœ€è¦å…ˆå®šä¹‰kindä¸ºPriorityClassç±»å‹çš„èµ„æºå¯¹è±¡ï¼Œç„¶åé€šè¿‡åœ¨Podçš„spec. priorityClassNameä¸­æŒ‡å®šå·²å®šä¹‰çš„PriorityClassåç§°å³å¯ã€‚</p>
</blockquote>
<p><br/></p>
<h3 id="Qï¼šKubernetes-scheduler-extenderèƒ½ä»‹ç»ä¸€ä¸‹ä¹ˆï¼Ÿ"><a href="#Qï¼šKubernetes-scheduler-extenderèƒ½ä»‹ç»ä¸€ä¸‹ä¹ˆï¼Ÿ" class="headerlink" title="Qï¼šKubernetes scheduler extenderèƒ½ä»‹ç»ä¸€ä¸‹ä¹ˆï¼Ÿ"></a>Qï¼šKubernetes scheduler extenderèƒ½ä»‹ç»ä¸€ä¸‹ä¹ˆï¼Ÿ</h3><blockquote>
<p>Aï¼šextenderå¯ç†è§£ä¸ºKubernetesè°ƒåº¦ç­–ç•¥å’Œç®—æ³•çš„æ‰©å±•ï¼Œå±äºè‡ªå®šä¹‰è°ƒåº¦å™¨çš„ä¸€ç§æ–¹å¼ï¼Œä¸Kubernetesé»˜è®¤è°ƒåº¦å™¨çš„è¿‡ç¨‹ç±»ä¼¼ï¼Œä¸»è¦æ˜¯é’ˆå¯¹ä¸€äº›ä¸ç®—å—é›†ç¾¤æœ¬èº«æ§åˆ¶çš„èµ„æºï¼ˆæ¯”å¦‚ç½‘ç»œï¼‰ï¼Œéœ€è¦é€šè¿‡å¤–éƒ¨è°ƒç”¨æ¥è¿›è¡Œè°ƒåº¦çš„æƒ…å†µã€‚</p>
</blockquote>
<p><br/></p>
<h3 id="Qï¼šç”¨æˆ·ä½¿ç”¨äº†NodeSelectoræŒ‡å®šäº†Podè°ƒåº¦çš„nodeèŠ‚ç‚¹åï¼Œå¦‚æœnodeä¸å¯ç”¨ï¼Œé‚£ä¹ˆschedulerä¼šé‡‡ç”¨åˆ«çš„ç­–ç•¥å—ï¼Ÿ"><a href="#Qï¼šç”¨æˆ·ä½¿ç”¨äº†NodeSelectoræŒ‡å®šäº†Podè°ƒåº¦çš„nodeèŠ‚ç‚¹åï¼Œå¦‚æœnodeä¸å¯ç”¨ï¼Œé‚£ä¹ˆschedulerä¼šé‡‡ç”¨åˆ«çš„ç­–ç•¥å—ï¼Ÿ" class="headerlink" title="Qï¼šç”¨æˆ·ä½¿ç”¨äº†NodeSelectoræŒ‡å®šäº†Podè°ƒåº¦çš„nodeèŠ‚ç‚¹åï¼Œå¦‚æœnodeä¸å¯ç”¨ï¼Œé‚£ä¹ˆschedulerä¼šé‡‡ç”¨åˆ«çš„ç­–ç•¥å—ï¼Ÿ"></a>Qï¼šç”¨æˆ·ä½¿ç”¨äº†NodeSelectoræŒ‡å®šäº†Podè°ƒåº¦çš„nodeèŠ‚ç‚¹åï¼Œå¦‚æœnodeä¸å¯ç”¨ï¼Œé‚£ä¹ˆschedulerä¼šé‡‡ç”¨åˆ«çš„ç­–ç•¥å—ï¼Ÿ</h3><blockquote>
<p>Aï¼šnodeSelectoræ˜¯ç›®å‰æœ€ä¸ºç®€å•çš„ä¸€ç§podè¿è¡Œæ—¶è°ƒåº¦é™åˆ¶ï¼Œç›®å‰åœ¨Kubernetes 1.7.xåŠä»¥ä¸‹ç‰ˆæœ¬å¯ç”¨ã€‚Pod.spec.nodeSelectoré€šè¿‡kubernetesçš„label-selectoræœºåˆ¶é€‰æ‹©èŠ‚ç‚¹ï¼Œç”±è°ƒåº¦å™¨è°ƒåº¦ç­–ç•¥åŒ¹é…labelï¼Œè€Œåè°ƒåº¦Podåˆ°ç›®æ ‡èŠ‚ç‚¹ï¼Œè¯¥åŒ¹é…è§„åˆ™å±äºå¼ºåˆ¶çº¦æŸï¼Œå¦‚æœnodeä¸å¯ç”¨ï¼ŒPodä¼šä¸€ç›´å¤„äºpendingçŠ¶æ€ã€‚nodeAffinityå…·å¤‡nodeSelectorçš„å…¨éƒ¨åŠŸèƒ½ï¼Œæ‰€ä»¥æœªæ¥Kubernetesä¼šå°†nodeSelectoråºŸé™¤ã€‚</p>
</blockquote>
<h3 id="Q-å¦‚ä½•è®©å¤šä¸ªPodå‡åŒ€éƒ¨ç½²åˆ°å„ä¸ªèŠ‚ç‚¹ä¸Šï¼Ÿ"><a href="#Q-å¦‚ä½•è®©å¤šä¸ªPodå‡åŒ€éƒ¨ç½²åˆ°å„ä¸ªèŠ‚ç‚¹ä¸Šï¼Ÿ" class="headerlink" title="Q: å¦‚ä½•è®©å¤šä¸ªPodå‡åŒ€éƒ¨ç½²åˆ°å„ä¸ªèŠ‚ç‚¹ä¸Šï¼Ÿ"></a>Q: å¦‚ä½•è®©å¤šä¸ªPodå‡åŒ€éƒ¨ç½²åˆ°å„ä¸ªèŠ‚ç‚¹ä¸Šï¼Ÿ</h3><p>æè¿°: é€šè¿‡å‰é¢å­¦ä¹ æˆ‘ä»¬çŸ¥é“åœ¨K8Sä¸­kube-schedulerç»„ä»¶è´Ÿè´£Podçš„è°ƒåº¦å¯¹æ¯ä¸€ä¸ªæ–°åˆ›å»ºçš„ Pod æˆ–è€…æ˜¯æœªè¢«è°ƒåº¦çš„ Podï¼Œkube-scheduler ä¼šé€‰æ‹©ä¸€ä¸ªæœ€ä¼˜çš„èŠ‚ç‚¹å»è¿è¡Œè¿™ä¸ª Podï¼Œé‚£æˆ‘ä»¬å¦‚ä½•å°†Podéƒ¨ç½²åˆ°å„ä¸ªèŠ‚ç‚¹ä¸Šå‘¢?</p>
<p>é€šå¸¸ä¸¤ç§æ–¹å¼ï¼Œé¦–å…ˆè€ƒè™‘ä½¿ç”¨å·¥ä½œè´Ÿè½½åäº²å’Œç‰¹æ€§è®©Podä¹‹é—´å°½é‡â€œäº’æ–¥â€ï¼Œå…¶æ¬¡æ˜¯å¯ä»¥ä½¿ç”¨<code>daemonsets.apps</code>èµ„æºæ§åˆ¶å™¨ç®¡ç†Podèµ„æºï¼Œè¿™æ ·å°±èƒ½å°½é‡å‡åŒ€çš„åˆ†å¸ƒåœ¨å„èŠ‚ç‚¹ä¸Šã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># äº²å’Œæ€§</span></span><br><span class="line">affinity:</span><br><span class="line">  podAntiAffinity:                                      <span class="comment"># å·¥ä½œè´Ÿè½½åäº²å’Œ</span></span><br><span class="line">    preferredDuringSchedulingIgnoredDuringExecution:    <span class="comment"># å°½é‡æ»¡è¶³å¦‚ä¸‹æ¡ä»¶</span></span><br><span class="line">      - podAffinityTerm:</span><br><span class="line">          labelSelector:                                <span class="comment"># é€‰æ‹©Podçš„æ ‡ç­¾ï¼Œä¸å·¥ä½œè´Ÿè½½æœ¬èº«åäº²å’Œ</span></span><br><span class="line">            matchExpressions:</span><br><span class="line">              - key: app</span><br><span class="line">                operator: In</span><br><span class="line">                values:</span><br><span class="line">                  - nginx</span><br><span class="line">          namespaces:</span><br><span class="line">            - default</span><br><span class="line">          topologyKey: kubernetes.io/hostname           <span class="comment"># åœ¨æŒ‡å®šèŠ‚ç‚¹ä¸Šèµ·ä½œç”¨</span></span><br></pre></td></tr></table></figure></p>

        </div>
        <!-- Google å¹¿å‘Š -->
          

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>
  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·ä¸Visit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº" >
    <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ã€è½¬ä¸ªå‘ã€èµä¸ªåŠ©ã€‘</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°†æŒç»­æ•´ç†å‘å¸ƒæ›´å¤šä¼˜è´¨åŸåˆ›æ–‡ç« ï¼ã€‚</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-05-27T03:53:55.490Z" itemprop="dateUpdated">2022-05-27 11:53:55</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/8-Kuberneteså…¥é—¨åŸºç¡€ä¹‹è°ƒåº¦å™¨ä¸äº²å’Œæ€§ä»‹ç».md" target="_blank" rel="noopener noreferrer">_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/8-Kuberneteså…¥é—¨åŸºç¡€ä¹‹è°ƒåº¦å™¨ä¸äº²å’Œæ€§ä»‹ç».md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2020/10-27-532.html" target="_blank" rel="external">https://blog.weiyigeek.top/2020/10-27-532.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">â˜•ï¸ è¯·ä½œè€…å–æ¯å’–å•¡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/10-27-532.html&title=ã€Š8-Kuberneteså…¥é—¨åŸºç¡€ä¹‹è°ƒåº¦å™¨ä¸äº²å’Œæ€§ä»‹ç»ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/10-27-532.html&title=ã€Š8-Kuberneteså…¥é—¨åŸºç¡€ä¹‹è°ƒåº¦å™¨ä¸äº²å’Œæ€§ä»‹ç»ã€‹ â€” WeiyiGeek Blog&source=WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ª..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/10-27-532.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š8-Kuberneteså…¥é—¨åŸºç¡€ä¹‹è°ƒåº¦å™¨ä¸äº²å’Œæ€§ä»‹ç»ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/10-27-532.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/10-27-532.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2020/11-18-544.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">ç½‘é¡µæ€§èƒ½ä¼˜åŒ–æµ…è°ˆä¸å®è·µ</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2020/10-27-535.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">9-Kuberneteså…¥é—¨åŸºç¡€ä¹‹é›†ç¾¤å®‰å…¨ä»‹ç»</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-Scheduler-ä»»åŠ¡è°ƒåº¦å™¨"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x01 Scheduler-ä»»åŠ¡è°ƒåº¦å™¨</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-è°ƒåº¦åŸºç¡€æ¦‚å¿µ"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">1.è°ƒåº¦åŸºç¡€æ¦‚å¿µ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-è‡ªå®šä¹‰è°ƒåº¦å™¨"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">2.è‡ªå®šä¹‰è°ƒåº¦å™¨</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-nodeAffinity-èŠ‚ç‚¹äº²å’Œæ€§"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">3.nodeAffinity - èŠ‚ç‚¹äº²å’Œæ€§</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ç¡¬ç­–ç•¥"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text">ç¡¬ç­–ç•¥</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#è½¯ç­–ç•¥"><span class="post-toc-number">1.3.2.</span> <span class="post-toc-text">è½¯ç­–ç•¥</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ç¡¬è½¯ç­–ç•¥è”ä½¿"><span class="post-toc-number">1.3.3.</span> <span class="post-toc-text">ç¡¬è½¯ç­–ç•¥è”ä½¿</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#å›ºå®šèŠ‚ç‚¹è°ƒåº¦ç­–ç•¥-fixed"><span class="post-toc-number">1.3.4.</span> <span class="post-toc-text">å›ºå®šèŠ‚ç‚¹è°ƒåº¦ç­–ç•¥(fixed)</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-podAffinity-Pod-äº²å’Œæ€§"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">4.podAffinity - Pod äº²å’Œæ€§</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-Priority-Pod-ä¼˜å…ˆçº§"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">5.Priority - Pod ä¼˜å…ˆçº§</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#6-Preemption-Pod-æŠ¢å "><span class="post-toc-number">1.6.</span> <span class="post-toc-text">6.Preemption - Pod æŠ¢å </span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x02-Taints-æ±¡ç‚¹"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x02 Taints - æ±¡ç‚¹</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x03-Toleration-å®¹å¿"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x03 Toleration - å®¹å¿</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x04-Cordon-Node-éš”ç¦»ä¸æ¢å¤"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x04 Cordon - Node éš”ç¦»ä¸æ¢å¤</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#FAQ-çŸ¥è¯†æ‰©å±•"><span class="post-toc-number">5.</span> <span class="post-toc-text">FAQ - çŸ¥è¯†æ‰©å±•</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Qï¼šæ™®é€šç”¨æˆ·æœ‰è‡ªå®šä¹‰Podä¼˜å…ˆçº§çš„æƒé™å—ï¼Ÿ"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">Qï¼šæ™®é€šç”¨æˆ·æœ‰è‡ªå®šä¹‰Podä¼˜å…ˆçº§çš„æƒé™å—ï¼Ÿ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Qï¼šKubernetes-scheduler-extenderèƒ½ä»‹ç»ä¸€ä¸‹ä¹ˆï¼Ÿ"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">Qï¼šKubernetes scheduler extenderèƒ½ä»‹ç»ä¸€ä¸‹ä¹ˆï¼Ÿ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Qï¼šç”¨æˆ·ä½¿ç”¨äº†NodeSelectoræŒ‡å®šäº†Podè°ƒåº¦çš„nodeèŠ‚ç‚¹åï¼Œå¦‚æœnodeä¸å¯ç”¨ï¼Œé‚£ä¹ˆschedulerä¼šé‡‡ç”¨åˆ«çš„ç­–ç•¥å—ï¼Ÿ"><span class="post-toc-number">5.3.</span> <span class="post-toc-text">Qï¼šç”¨æˆ·ä½¿ç”¨äº†NodeSelectoræŒ‡å®šäº†Podè°ƒåº¦çš„nodeèŠ‚ç‚¹åï¼Œå¦‚æœnodeä¸å¯ç”¨ï¼Œé‚£ä¹ˆschedulerä¼šé‡‡ç”¨åˆ«çš„ç­–ç•¥å—ï¼Ÿ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Q-å¦‚ä½•è®©å¤šä¸ªPodå‡åŒ€éƒ¨ç½²åˆ°å„ä¸ªèŠ‚ç‚¹ä¸Šï¼Ÿ"><span class="post-toc-number">5.4.</span> <span class="post-toc-text">Q: å¦‚ä½•è®©å¤šä¸ªPodå‡åŒ€éƒ¨ç½²åˆ°å„ä¸ªèŠ‚ç‚¹ä¸Šï¼Ÿ</span></a></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    


    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå°±è¯·ä½œè€…å–æ¯ Coffee â˜•ï¸â˜•ï¸!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      

    <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
    
      <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½æœ‹å‹,å¯ä»¥å…³ä¸ªæ³¨å—? â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
        
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/search-wechat.jpg" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">åšä¸»Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">åšä¸»Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">çŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.modb.pro/u/506690" target="_blank">å¢¨å¤©è½®</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.ixigua.com/home/3984243135350727" target="_blank">è¥¿ç“œè§†é¢‘</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/><a id="SiteRunTime"></a>
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener">
            <img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto">
          </a>
        </div>
      </p>
    </div>
</footer>



    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/10-27-532.html&title=ã€Š8-Kuberneteså…¥é—¨åŸºç¡€ä¹‹è°ƒåº¦å™¨ä¸äº²å’Œæ€§ä»‹ç»ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/10-27-532.html&title=ã€Š8-Kuberneteså…¥é—¨åŸºç¡€ä¹‹è°ƒåº¦å™¨ä¸äº²å’Œæ€§ä»‹ç»ã€‹ â€” WeiyiGeek Blog&source=WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ª..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/10-27-532.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š8-Kuberneteså…¥é—¨åŸºç¡€ä¹‹è°ƒåº¦å™¨ä¸äº²å’Œæ€§ä»‹ç»ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/10-27-532.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/10-27-532.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJklEQVR42u3aQU4DMQwF0N7/0kVixWY6/8dToJmXVQUoySuSZcd+POL1/F7J558r+Zuj9XjHwsDA+FhGst3RVZJ9kh3W2BgYGHdjtEH2qnCZ807ujIGBgXFwwGQdnY6BgYFxbcB9vU9+6RyJgYFxZ0ayXQKYhNdfqsUxMDA+kHFtY+Daz3/W38DAwPg3jHcXovMwHd0BAwNja8bronQS35ISNEEWgRgDA2NTxmtAW9a2z3D513SSsGJgYNyA0W69lvzlsbFtWmBgYOzNSFqSk0f/PNVrf3v4P8HAwNiO0RaueXo3bz/kYR0DA2NvRpIgXjUMkYxutA95RZ6LgYHxsYwkwOXlaP7Q3yaFJ8kiBgbGDRhJcJyH46tGMeoqHAMDYwvGWiWYND7Xvqx21AMDA+M+jLw9sBY61wYsirEwDAyMTRnzJG+trG2boEUTAgMDYztGPZcxSOnaoYo80GNgYNyHkT/ur5WabTAtRsQwMDC2ZuRlanLFtg05L6qjLgcGBsZGjJaUBNPJGEedhmJgYNyAMX/QzxO+ZLWPgxgYGHsz3t2qrJO8SWGMgYGxHeNZrrUmaNu8rJNIDAyMrRlt6zEpLOeHTc7CwMDYlbH20J8H6OTnbcp4kttiYGBsypgEvkmonQxwYGBgYOSDWW04npx+ccDFwMDYjtE+qLWp3lpYx8DAuA8jL0TXkr+1/YuzMDAwtmZMHuvbBuSkRbo2ooGBgfHhjC8xj4mH/86ctQAAAABJRU5ErkJggg==" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
<script type="text/javascript">
// ç«™ç‚¹è¿è¡Œæ—¶é—´
var BootDate = new Date("2018/01/01 00:00:00");
function ShowRunTime(id) {
  var NowDate = new Date();
  var RunDateM = parseInt(NowDate - BootDate);
  var RunDays = Math.floor(RunDateM/(24*3600*1000));
  var RunHours = Math.floor(RunDateM%(24*3600*1000)/(3600*1000));
  var RunMinutes = Math.floor(RunDateM%(24*3600*1000)%(3600*1000)/(60*1000));
  var RunSeconds = Math.round(RunDateM%(24*3600*1000)%(3600*1000)%(60*1000)/1000);
  var RunTime = RunDays + "å¤©" + RunHours + "æ—¶" + RunMinutes + "åˆ†" + RunSeconds + "ç§’";
  document.getElementById(id).innerHTML = "ç½‘ç«™å·²åœ¨é£é›¨ä¸­å‹‰å‹‰å¼ºå¼ºè¿è¡Œäº†ã€" + RunTime + "ã€‘";
}
setInterval("ShowRunTime('SiteRunTime')", 1000);
</script>
</body>
</html>