{"title":"Nginx负载均衡高可用实践指南","slug":"系统运维/Application/Web/WebApp/Nginx/11.Nginx实践之负载均衡高可用","date":"2019-09-02T05:34:30.000Z","updated":"2022-08-12T06:53:56.420Z","url":"2019/9-2-123.html","path":"api/articles/2019/9-2-123.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190916170435.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190908095423.png"],"content":"<p><strong>本章目录</strong></p>\n<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"1-引言\"><a href=\"#1-引言\" class=\"headerlink\" title=\"1. 引言\"></a>1. 引言</h4><h5 id=\"1-1-描述\"><a href=\"#1-1-描述\" class=\"headerlink\" title=\"1.1 描述\"></a>1.1 描述</h5><p>描述:nginx作为负载均衡器所有请求都到了nginx 服务器中, 可见nginx处于非常重点的位置，如果nginx服务器宕机后端web服务将无法提供服务影响严重。所以为了屏蔽负载均衡服务器的宕机我们需要实现nginx的高可用以及需要实现备份机;</p>\n<h5 id=\"1-2-名词解析\"><a href=\"#1-2-名词解析\" class=\"headerlink\" title=\"1.2 名词解析\"></a>1.2 名词解析</h5><p><em>什么是负载均衡高可用?</em><br>答:为了屏蔽负载均衡服务器的宕机，需要建立一个备份机。主服务器和备份机上都运行高可用(High Availability)监控程序，通过传送诸如“I am alive”这样的信息来监控对方的运行状况。当备份机不能在一定的时间内收到这样的信息时，它就接管主服务器的服务IP并继续提供负载均衡服务;当备份管理器又从主管理器收到“I am alive”这样的信息时，它就释放服务IP地址，主服务器就又开始再次提供负载均衡服务。</p>\n<h5 id=\"1-3-实现方式\"><a href=\"#1-3-实现方式\" class=\"headerlink\" title=\"1.3 实现方式\"></a>1.3 实现方式</h5><p>方式1 : keepalived + nginx 主备 </p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190916170435.png\" alt=\"WeiyiGeek.Nginx高可用\"></p>\n<hr>\n\n<h4 id=\"2-部署实现\"><a href=\"#2-部署实现\" class=\"headerlink\" title=\"2.部署实现\"></a>2.部署实现</h4><h5 id=\"2-1-Keepalive实现\"><a href=\"#2-1-Keepalive实现\" class=\"headerlink\" title=\"2.1 Keepalive实现\"></a>2.1 Keepalive实现</h5><p><em>什么是keepalived?</em><br>答:keepalived是集群管理中保证集群高可用的一个服务软件，用来防止单点故障。</p>\n<p><strong>keepalived工作原理:</strong><br>keepalived是以VRRP协议为实现基础的，VRRP全称<code>Virtual Router Redundancy Protocol</code>即虚拟路由冗余协议。</p>\n<p><em>什么是虚拟路由冗余协议?</em><br>答:实现路由器高可用的协议，即将N台提供相同功能的路由器组成一个路由器组;组里存在一个Master以及多个slave(backup),master上有一个对外提供服务的vip(VIP = Virtual IP Address，虚拟IP地址，该路由器所在局域网内其他机器的默认路由为该vip)，master会发组播当backup收不到VRRP包时就认为master宕掉了，这时就需要根据VRRP的优先级来选举一个backup当master</p>\n<p>keepalived主要有三个模块分别是core、check和VRRP。</p>\n<ul>\n<li>core模块为keepalived的核心，负责主进程的启动、维护以及全局配置文件的加载和解析。</li>\n<li>check负责健康检查，包括常见的各种检查方式。</li>\n<li>VRRP模块是来实现VRRP协议的。</li>\n</ul>\n<p><strong>Keepalived实现流程:</strong><br>Keepalived的作用是检测web服务器的状态，如果有一台web服务器死机，或工作出现故障，Keepalived将检测到，并将有故障的web服务器从系统中剔除，当web服务器工作正常后, Keepalived自动将web服务器加入到服务器群中并且切换的工作全部自动完成;</p>\n<p>安装环境：Centos7.x + Nginx 最新版本 + keepalive<br>名称| IP | VIP<br>—|—|—<br>nginx均衡服务器(主) | 192.168.1.2 | 192.168.101.100<br>nginx均衡服务器(从) | 192.168.1.3<br>Web应用容器 Tomcat | 192.168.1.4:8080</p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190908095423.png\" alt=\"WeiyiGeek.主机宕机\" title=\"\" class=\"\">\n                <p>WeiyiGeek.主机宕机</p>\n            </figure>","comments":true,"excerpt":"本章目录[TOC]","categories":[{"name":"容灾恢复","path":"api/categories/容灾恢复.json"}],"tags":[{"name":"Nginx","path":"api/tags/Nginx.json"}]}