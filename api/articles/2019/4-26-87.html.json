{"title":"MYSQL多实例配置详解.md","slug":"数据存储/Database-运维/MySQL/运维实战/MYSQL主从多实例配置详解","date":"2019-04-26T06:34:30.000Z","updated":"2023-01-31T02:29:07.993Z","url":"2019/4-26-87.html","path":"api/articles/2019/4-26-87.html.json","covers":["https://img.weiyigeek.top/2019/20190428145740.png","https://img.weiyigeek.top/2019/20190428150935.png","https://img.weiyigeek.top/2019/20190428160932.png","https://img.weiyigeek.top/2019/20190428152655.png","https://img.weiyigeek.top/2019/20190428152925.png"],"content":"<p>[TOC]<br><a id=\"more\"></a></p>\n<h4 id=\"0-MySQL多实例介绍\"><a href=\"#0-MySQL多实例介绍\" class=\"headerlink\" title=\"0. MySQL多实例介绍\"></a>0. MySQL多实例介绍</h4><p><em>Q:什么是MySQL多实例？</em><br>答：简单的说，就是在一台机器上开启多个不同的服务端口（如： 3306、 3307 ) ，运行多个 MysQL 服务进程，服务进程通过不同的 socket 监听不同的服务端口来提供各自的服务。 </p>\n<p>这些 MySQL 多实例共用一套 MySQL 安装程序，使用不同（也可以相同）的 my . cnf 配里文件、启动程序，数据文件。在提供服务时，多实例 MySQL 在逻辑上看来是各自独立的，多个实例的自身是根据配里文件对应的设定值，来取得服务器的相关硬件资源多少。<br>比如： MysQL 多实例相当于房子的多个卧室一样，每个实例可以看作一个卧室，整个服务器就是一套房子，服务器的硬件资源（ cPu , meln . disk ）可以看作房子的卫生间、厨房、厅一样，感房子的公用资源，北漂蜗居在一起，肯定要共用上述资源。</p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190428145740.png\" alt=\"WeiyiGeek.多示例图示\" title=\"\" class=\"\">\n                <p>WeiyiGeek.多示例图示</p>\n            </figure>\n<p><em>多实例的优势和问题介绍：</em></p>\n<ul>\n<li>优势：<ul>\n<li>有效利用服务器资源，充分利用资源提供更多的服务；（一般服务器利用率到达60~70%）</li>\n<li>节约服务器成本，数据库需要独立的提供服务，需要主从同步的技术的，多实例就比较好了；</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li>问题：<ul>\n<li>资源互相抢占问题，当服务器某个实例进行并发高或者有慢查询时候，会消耗更多的内存，CPU，磁盘IO资源，导致服务器的其他的实例提供服务的质量下降。</li>\n</ul>\n</li>\n</ul>\n<p><em>多实例的门户企业应用场景:</em></p>\n<ul>\n<li>资金紧张型公司的选择，需要交叉主从同步进行等技术提供备份或读写分离服务时，基本台服务器部署3-4个实例，这样的服务是相对独立的；</li>\n<li>并发访问部署特别大的业务，MySQL多实例一个很值得使用的技术，即使并发很大，合理分配好系统资源，也不会有太大问题；</li>\n<li>门户网站应用多实例场景，门户网站使用多实例的目的是配硬件好的服务器，节省IDC机柜空间，同时跑多实例让硬件资源不浪费；</li>\n</ul>\n<hr>\n\n<h4 id=\"1-MySQL多实例常见配置方案\"><a href=\"#1-MySQL多实例常见配置方案\" class=\"headerlink\" title=\"1. MySQL多实例常见配置方案\"></a>1. MySQL多实例常见配置方案</h4><p>常见的两种方法： </p>\n<ul>\n<li>1.多配置文件部署方案，通过配置多个配置文件即多个启动程序；（优势逻辑简单，配置简单，缺点是管理起来不太方便；）</li>\n<li>2.单一配置文件部署方案，在my.cnf配置文件样例，mysql_mutil 进行配置并且启动； (定制每个实例的配置不太方面，优点是管理起来很方便，集中管理；)<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql_mutil --config-file=/data/mysql/my_multi.cnf start 1,2,3,4,5 <span class=\"comment\">#启动的实例号s</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>同一开发环境下安装两个数据库，必须处理以下问题:</p>\n<ul>\n<li>1.配置文件安装路径不能相同</li>\n<li>2.数据库目录不能相同</li>\n<li>3.启动脚本不能同名</li>\n<li>4.端口不能相同</li>\n<li>5.socket文件的生成路径不能相同</li>\n<li>6.主从设置不同server-id</li>\n</ul>\n<hr>\n\n<h4 id=\"2-MySQL多实例配置实战\"><a href=\"#2-MySQL多实例配置实战\" class=\"headerlink\" title=\"2. MySQL多实例配置实战\"></a>2. MySQL多实例配置实战</h4><h5 id=\"1-5-5-23的源码编译安装多实例方法（多配置文件）\"><a href=\"#1-5-5-23的源码编译安装多实例方法（多配置文件）\" class=\"headerlink\" title=\"(1) 5.5.23的源码编译安装多实例方法（多配置文件）\"></a>(1) 5.5.23的源码编译安装多实例方法（多配置文件）</h5><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//安装依赖</span><br><span class=\"line\">yum install libaio-devel -y</span><br><span class=\"line\"></span><br><span class=\"line\">//创建数据存储目录</span><br><span class=\"line\">[root@WeiyiGeek ~]$ mkdir -p /data/&#123;3306,3307&#125;/data  //递归创建多个文件</span><br><span class=\"line\">[root@WeiyiGeek data]<span class=\"comment\"># ls /application/mysql/support-files/my-*  //数据库默认提供多个配置模板,根据硬件修改</span></span><br><span class=\"line\">/application/mysql/support-files/my-huge.cnf</span><br><span class=\"line\">/application/mysql/support-files/my-innodb-heavy-4G.cnf</span><br><span class=\"line\">/application/mysql/support-files/my-large.cnf</span><br><span class=\"line\">/application/mysql/support-files/my-medium.cnf</span><br><span class=\"line\">/application/mysql/support-files/my-small.cnf  //复制到 3306 3307 中</span><br><span class=\"line\"></span><br><span class=\"line\">//我们为每一个实例建立一个配置文件,一个启动文件,对应数据文件;</span><br><span class=\"line\">cp /application/mysql/support-files/my-small.cnf /data/&#123;3306,3307&#125;/data/my.cnf</span><br><span class=\"line\">tree /data</span><br><span class=\"line\"></span><br><span class=\"line\">//在vim编辑器下：%s/3306/3307/g，并修改my.cnf下server-id与其他实例不同id（server-id = 1或2总之不一样就行）</span><br><span class=\"line\">[client]</span><br><span class=\"line\">port            = 3306                                   </span><br><span class=\"line\">socket          = /data/3306/mysql.sock</span><br><span class=\"line\"></span><br><span class=\"line\">[mysql]</span><br><span class=\"line\">no-auto-rehash</span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">user    = mysql</span><br><span class=\"line\">port    = 3306</span><br><span class=\"line\">socket  = /data/3306/mysql.sock</span><br><span class=\"line\">basedir = /application/mysql      <span class=\"comment\">#需要根据实际情况更改： 比如 yum 默认安装的mysql 8.0 /var/bin/mysql</span></span><br><span class=\"line\">datadir = /data/3306/data</span><br><span class=\"line\">open_files_limit    = 1024</span><br><span class=\"line\">back_log = 600</span><br><span class=\"line\">max_connections = 800</span><br><span class=\"line\">max_connect_errors = 3000</span><br><span class=\"line\">table_cache = 614</span><br><span class=\"line\">external-locking = FALSE</span><br><span class=\"line\">max_allowed_packet =8M</span><br><span class=\"line\">sort_buffer_size = 1M</span><br><span class=\"line\">join_buffer_size = 1M</span><br><span class=\"line\">thread_cache_size = 100</span><br><span class=\"line\">thread_concurrency = 2</span><br><span class=\"line\">query_cache_size = 2M</span><br><span class=\"line\">query_cache_limit = 1M</span><br><span class=\"line\">query_cache_min_res_unit = 2k</span><br><span class=\"line\"><span class=\"comment\">#default_table_type = InnoDB</span></span><br><span class=\"line\">thread_stack = 192K</span><br><span class=\"line\"><span class=\"comment\">#transaction_isolation = READ-COMMITTED</span></span><br><span class=\"line\">tmp_table_size = 2M</span><br><span class=\"line\">max_heap_table_size = 2M</span><br><span class=\"line\">long_query_time = 1</span><br><span class=\"line\"><span class=\"comment\">#log_long_format</span></span><br><span class=\"line\"><span class=\"comment\">#log-error = /data/3306/error.log</span></span><br><span class=\"line\"><span class=\"comment\">#log-slow-queries = /data/3306/slow.log</span></span><br><span class=\"line\">pid-file = /data/3306/mysql.pid</span><br><span class=\"line\"><span class=\"built_in\">log</span>-bin = /data/3306/mysql-bin</span><br><span class=\"line\">relay-log = /data/3306/relay-bin</span><br><span class=\"line\">relay-log-info-file = /data/3306/relay-log.info</span><br><span class=\"line\">binlog_cache_size = 1M</span><br><span class=\"line\">max_binlog_cache_size = 1M</span><br><span class=\"line\">max_binlog_size = 2M</span><br><span class=\"line\">expire_logs_days = 7</span><br><span class=\"line\">key_buffer_size = 16M</span><br><span class=\"line\">read_buffer_size = 1M</span><br><span class=\"line\">read_rnd_buffer_size = 1M</span><br><span class=\"line\">bulk_insert_buffer_size = 1M</span><br><span class=\"line\"><span class=\"comment\">#myisam_sort_buffer_size = 1M</span></span><br><span class=\"line\"><span class=\"comment\">#myisam_max_sort_file_size = 10G</span></span><br><span class=\"line\"><span class=\"comment\">#myisam_max_extra_sort_file_size = 10G</span></span><br><span class=\"line\"><span class=\"comment\">#myisam_repair_threads = 1</span></span><br><span class=\"line\"><span class=\"comment\">#myisam_recover</span></span><br><span class=\"line\">lower_case_table_names = 1</span><br><span class=\"line\">skip-name-resolve</span><br><span class=\"line\">slave-skip-errors = 1032,1062</span><br><span class=\"line\">replicate-ignore-db=mysql</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#下面这里是不一样的</span></span><br><span class=\"line\">server-id = 1</span><br><span class=\"line\">innodb_additional_mem_pool_size = 4M</span><br><span class=\"line\">innodb_buffer_pool_size = 32M</span><br><span class=\"line\">innodb_data_file_path = ibdata1:128M:autoextend</span><br><span class=\"line\">innodb_file_io_threads = 4</span><br><span class=\"line\">innodb_thread_concurrency = 8</span><br><span class=\"line\">innodb_flush_log_at_trx_commit = 2</span><br><span class=\"line\">innodb_log_buffer_size = 2M</span><br><span class=\"line\">innodb_log_file_size = 4M</span><br><span class=\"line\">innodb_log_files_in_group = 3</span><br><span class=\"line\">innodb_max_dirty_pages_pct = 90</span><br><span class=\"line\">innodb_lock_wait_timeout = 120</span><br><span class=\"line\">innodb_file_per_table = 0</span><br><span class=\"line\"></span><br><span class=\"line\">[mysqldump]</span><br><span class=\"line\">quick</span><br><span class=\"line\">max_allowed_packet = 2M</span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld_safe]</span><br><span class=\"line\"><span class=\"built_in\">log</span>-error = /data/3306/mysql_3306.err</span><br><span class=\"line\">pid-file = /data/3306/mysqld.pid</span><br></pre></td></tr></table></figure>\n<p><em>在3306和3307中建立一个mmysqld.sh脚本文件:</em><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#init</span></span><br><span class=\"line\">port=3306   <span class=\"comment\">#必须</span></span><br><span class=\"line\">mysql_user=<span class=\"string\">\"root\"</span>  <span class=\"comment\">#需求更改</span></span><br><span class=\"line\">mysql_pwd=<span class=\"string\">\"System123@\"</span>  <span class=\"comment\">#需求更改</span></span><br><span class=\"line\">CmdPath=<span class=\"string\">\"/application/mysql/bin\"</span> </span><br><span class=\"line\">mysql_sock=<span class=\"string\">\"/data/<span class=\"variable\">$&#123;port&#125;</span>/mysql.sock\"</span> </span><br><span class=\"line\"><span class=\"comment\">#startup function</span></span><br><span class=\"line\">function_start_mysql()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ ! -e <span class=\"string\">\"<span class=\"variable\">$mysql_sock</span>\"</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">      <span class=\"built_in\">printf</span> <span class=\"string\">\"Starting MySQL...\\n\"</span></span><br><span class=\"line\">      /bin/sh <span class=\"variable\">$&#123;CmdPath&#125;</span>/mysqld_safe --defaults-file=/data/<span class=\"variable\">$&#123;port&#125;</span>/my.cnf 2&gt;&amp;1 &gt; /dev/null &amp;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      <span class=\"built_in\">printf</span> <span class=\"string\">\"MySQL is running...\\n\"</span></span><br><span class=\"line\">      <span class=\"built_in\">exit</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#stop function</span></span><br><span class=\"line\">function_stop_mysql()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ ! -e <span class=\"string\">\"<span class=\"variable\">$mysql_sock</span>\"</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">       <span class=\"built_in\">printf</span> <span class=\"string\">\"MySQL is stopped...\\n\"</span></span><br><span class=\"line\">       <span class=\"built_in\">exit</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">       <span class=\"built_in\">printf</span> <span class=\"string\">\"Stoping MySQL...\\n\"</span></span><br><span class=\"line\">       <span class=\"variable\">$&#123;CmdPath&#125;</span>/mysqladmin -u <span class=\"variable\">$&#123;mysql_user&#125;</span> -p<span class=\"variable\">$&#123;mysql_pwd&#125;</span> -S /data/<span class=\"variable\">$&#123;port&#125;</span>/mysql.sock shutdown</span><br><span class=\"line\">   <span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#restart function</span></span><br><span class=\"line\">function_restart_mysql()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span> <span class=\"string\">\"Restarting MySQL...\\n\"</span></span><br><span class=\"line\">    function_stop_mysql</span><br><span class=\"line\">    sleep 2</span><br><span class=\"line\">    function_start_mysql</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">case</span> <span class=\"variable\">$1</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">start)</span><br><span class=\"line\">    function_start_mysql</span><br><span class=\"line\">;;</span><br><span class=\"line\">stop)</span><br><span class=\"line\">    function_stop_mysql</span><br><span class=\"line\">;;</span><br><span class=\"line\">restart)</span><br><span class=\"line\">    function_restart_mysql</span><br><span class=\"line\">;;</span><br><span class=\"line\">*)</span><br><span class=\"line\">    <span class=\"built_in\">printf</span> <span class=\"string\">\"Usage: /data/<span class=\"variable\">$&#123;port&#125;</span>/mmysqld.sh &#123;start|stop|restart&#125;\\n\"</span></span><br><span class=\"line\"><span class=\"keyword\">esac</span></span><br></pre></td></tr></table></figure></p>\n<p>授权及增加执行权限并且初始化数据库（两个实例分别初始化）：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#授权</span></span><br><span class=\"line\">chown -R mysql.mysql /data</span><br><span class=\"line\">find /data/ -<span class=\"built_in\">type</span> f -name <span class=\"string\">\"mysql\"</span>|xargs chmod +x</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#初始化脚本</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /application/mysql/scripts/</span><br><span class=\"line\">./mysql_install_db --basedir=/application/mysql --datadir=/data/3306/data --user=mysql</span><br><span class=\"line\">./mysql_install_db --basedir=/application/mysql --datadir=/data/3307/data --user=mysql</span><br><span class=\"line\"></span><br><span class=\"line\">//单实例初始化</span><br><span class=\"line\">./mysql_install_db --user=mysql</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#多实例数据库停止与启动：(在mmysqld.sh文件中)</span></span><br><span class=\"line\">[启动]</span><br><span class=\"line\">/application/mysql/bin/mysqld_safe --defaults-file=/data/3307/my.cnf 2&gt;&amp;1 &gt; /dev/null &amp;</span><br><span class=\"line\">/application/mysql/bin/mysqld_safe --defaults-file = /data/3307/my.cnf 2&gt;&amp;1 &gt; /dev/null &amp;</span><br><span class=\"line\"></span><br><span class=\"line\">[停止]</span><br><span class=\"line\">mysqladmin -usystem -psystem -S /data/3306/mysql.sock shutdwon</span><br><span class=\"line\">mysqladmin -usystem -psystem -S /data/3307/mysql.sock shutdwon</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#启动脚本</span></span><br><span class=\"line\">/data/3306/mmysqld.sh restart</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#可以利用一个shell添加一个实例3308端口Mysql：</span></span><br><span class=\"line\"><span class=\"comment\">#!/usr/bin</span></span><br><span class=\"line\">mkdir /data/3308/data -p</span><br><span class=\"line\">cp /data/3307/my.cnf /data/3308/</span><br><span class=\"line\">cp /data/3307/mmysqld.sh /data/3308/</span><br><span class=\"line\">sed -i <span class=\"string\">'s#3307#3308#g'</span> /data/3308/my.cnf</span><br><span class=\"line\">sed -i <span class=\"string\">'s#3307#3308#g'</span> /data/3308/mmysqld.sh</span><br><span class=\"line\">chmod +x /data/3308/mysql</span><br><span class=\"line\">chown -R mysql.mysql /data/3308/</span><br><span class=\"line\">/application/mysql/scripts/mysql_install_db --basedir=/application/mysql/ --datadir=/data/3308/data/ --user=mysql</span><br><span class=\"line\">/data/3308/mysql start</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190428150935.png\" alt=\"WeiyiGeek.5.5.x源码安装多实例\" title=\"\" class=\"\">\n                <p>WeiyiGeek.5.5.x源码安装多实例</p>\n            </figure></p>\n<p><br></p>\n<h5 id=\"2-5-7-24的二进制安装多实例方法（多配置文件）\"><a href=\"#2-5-7-24的二进制安装多实例方法（多配置文件）\" class=\"headerlink\" title=\"(2) 5.7.24的二进制安装多实例方法（多配置文件）\"></a>(2) 5.7.24的二进制安装多实例方法（多配置文件）</h5><p>补充 MySQL 5.7.X 多实例化：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1. 创建一个mysql用户和组并设置/sbin/nologin</span></span><br><span class=\"line\"><span class=\"comment\">#2. 实例化文件目录以及权限</span></span><br><span class=\"line\">mkdir -vp /data/&#123;3306,3307&#125;/&#123;data,binlog&#125;</span><br><span class=\"line\">chown -R mysql:mysql /usr/<span class=\"built_in\">local</span>/mysql/ /data</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3. 创建多实例配置文件</span></span><br><span class=\"line\"><span class=\"comment\"># /data/3306/my.cnf</span></span><br><span class=\"line\"><span class=\"comment\">#----------------------------------</span></span><br><span class=\"line\">[client]</span><br><span class=\"line\">port            = 3306                                   </span><br><span class=\"line\">socket          = /data/3306/mysql.sock</span><br><span class=\"line\">default-character-set=utf8   <span class=\"comment\"># 设置mysql客户端默认字符集 </span></span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">user    = mysql</span><br><span class=\"line\">port    = 3306</span><br><span class=\"line\">socket  = /data/3306/mysql.sock</span><br><span class=\"line\">basedir = /usr/<span class=\"built_in\">local</span>/mysql           <span class=\"comment\">#需要根据实际情况路径更改</span></span><br><span class=\"line\">datadir = /data/3306/data</span><br><span class=\"line\"><span class=\"built_in\">log</span>-error= /data/3306/mysql-error.log</span><br><span class=\"line\"><span class=\"built_in\">log</span>-bin = /data/3306/binlog</span><br><span class=\"line\">server-id = 3306</span><br><span class=\"line\">character-set-server=utf8  <span class=\"comment\">#服务端默认字符集 </span></span><br><span class=\"line\">explicit_defaults_for_timestamp  <span class=\"comment\">#时区</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># /data/3307/my.cnf</span></span><br><span class=\"line\"><span class=\"comment\">#------------------------------------</span></span><br><span class=\"line\">[client]</span><br><span class=\"line\">port            = 3307                                   </span><br><span class=\"line\">socket          = /data/3307/mysql.sock</span><br><span class=\"line\">default-character-set=utf8   <span class=\"comment\"># 设置mysql客户端默认字符集 </span></span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">user    = mysql</span><br><span class=\"line\">port    = 3307</span><br><span class=\"line\">socket  = /data/3307/mysql.sock</span><br><span class=\"line\">basedir = /usr/<span class=\"built_in\">local</span>/mysql           <span class=\"comment\">#需要根据实际情况路径更改</span></span><br><span class=\"line\">datadir = /data/3307/data</span><br><span class=\"line\"><span class=\"built_in\">log</span>-error= /data/3307/mysql-error.log</span><br><span class=\"line\"><span class=\"built_in\">log</span>-bin = /data/3307/binlog</span><br><span class=\"line\">server-id = 3307</span><br><span class=\"line\">character-set-server=utf8  <span class=\"comment\">#服务端默认字符集 </span></span><br><span class=\"line\">explicit_defaults_for_timestamp  <span class=\"comment\">#时区</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#4. 初始化数据库以及启动</span></span><br><span class=\"line\">mysqld --defaults-file=/data/3306/my.cnf --initialize --user=mysql --basedir=/usr/<span class=\"built_in\">local</span>/mysql --explicit_defaults_for_timestamp</span><br><span class=\"line\">mysqld --defaults-file=/data/3307/my.cnf --initialize --user=mysql --basedir=/usr/<span class=\"built_in\">local</span>/mysql --explicit_defaults_for_timestamp</span><br><span class=\"line\"></span><br><span class=\"line\">mysqld_safe --defaults-file=/data/3306/my.cnf --user=mysql &amp;</span><br><span class=\"line\">mysqld_safe --defaults-file=/data/3307/my.cnf --user=mysql &amp;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#5. 查看登录密码 + 登录数据库</span></span><br><span class=\"line\">cat mysql-error.log | grep <span class=\"string\">\"passowrd\"</span>   <span class=\"comment\">#在设置的log文件下</span></span><br><span class=\"line\">root@localhost: &lt;S!Ka6+8f6MJ</span><br><span class=\"line\">root@localhost: i?+WDyVav8L?</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#登陆数据库</span></span><br><span class=\"line\">mysql -uroot -p<span class=\"string\">'yxi9CG&lt;9D5go'</span> -S /data/3306/mysql.sock</span><br><span class=\"line\">mysql -uroot -p<span class=\"string\">'i?+WDyVav8L?'</span> -S /data/3307/mysql.sock</span><br><span class=\"line\">ALTER USER <span class=\"string\">'root'</span>@<span class=\"string\">'localhost'</span> IDENTIFIED BY <span class=\"string\">'System123@'</span>;</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190428160932.png\" alt=\"WeiyiGeek.5.7.24多实例\" title=\"\" class=\"\">\n                <p>WeiyiGeek.5.7.24多实例</p>\n            </figure></p>\n<p><br></p>\n<h5 id=\"3-8-x的二进制安装多实例方法（多配置文件）\"><a href=\"#3-8-x的二进制安装多实例方法（多配置文件）\" class=\"headerlink\" title=\"(3) 8.x的二进制安装多实例方法（多配置文件）\"></a>(3) 8.x的二进制安装多实例方法（多配置文件）</h5><p>实验环境版本： MySQL 8.0.13<br>系统环境：cat /etc/redhat-release<br>CentOS Linux release 7.6.1810 (Core) 3.10.0-957.1.3.el7.x86_64</p>\n<p>执行步骤：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## 1. 创建一个mysql用户和组并设置/sbin/nologin</span></span><br><span class=\"line\">groupadd -g 500 mysql</span><br><span class=\"line\">useradd -r -g mysql -s /sbin/nologin mysql</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 2. 创建多实例化目录</span></span><br><span class=\"line\">mkdir -vp /data/mysqldata/&#123;&#123;3306,3307&#125;/&#123;data,tmp,binlog,innodb_ts,innodb_log,logs&#125;,backup,scripts&#125;</span><br><span class=\"line\">touch /data/mysqldata/3306/tmp/mysql-error.log /data/mysqldata/3307/tmp/mysql-error.log</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 3. 授权建立得目录（非常重要 常常会使mysql报错）</span></span><br><span class=\"line\">chown -R mysql:mysql /data/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 4. 在实例化文件中写一个mysql.cnf配置</span></span><br><span class=\"line\"><span class=\"comment\"># my.cnf  我这里以3307为例</span></span><br><span class=\"line\">[client]</span><br><span class=\"line\">default-character-set=utf8   <span class=\"comment\"># 设置mysql客户端默认字符集 </span></span><br><span class=\"line\">port = 3307 </span><br><span class=\"line\">socket = /data/mysqldata/3307/mysql.sock </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># The MySQL server </span></span><br><span class=\"line\">[mysqld] </span><br><span class=\"line\">port = 3307 </span><br><span class=\"line\">mysqlx_port = 33070 </span><br><span class=\"line\">user = mysql</span><br><span class=\"line\">server-id = 3307</span><br><span class=\"line\">socket = /data/mysqldata/3307/mysql.sock </span><br><span class=\"line\">mysqlx_socket=/data/mysqldata/3307/mysqlx.sock </span><br><span class=\"line\">pid-file = /data/mysqldata/3307/mysql.pid </span><br><span class=\"line\">basedir = /usr/<span class=\"built_in\">local</span>/mysql8 </span><br><span class=\"line\">datadir = /data/mysqldata/3307/data </span><br><span class=\"line\">tmpdir = /data/mysqldata/3307/tmp <span class=\"comment\">#非必须</span></span><br><span class=\"line\"><span class=\"built_in\">log</span>-bin = /data/mysqldata/3307/binlog/mysql-bin</span><br><span class=\"line\"><span class=\"built_in\">log</span>-error = /data/mysqldata/3307/mysql-error.log</span><br><span class=\"line\">explicit_defaults_for_timestamp</span><br><span class=\"line\">character-set-server=utf8  <span class=\"comment\">#服务端默认字符集 </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#------------------------- 配置文档分割线 ------------------------------------#</span></span><br><span class=\"line\"></span><br><span class=\"line\">[root@centos7 ]$ cp /3307/my.cnf ../3306/my.cnf</span><br><span class=\"line\">[root@centos7 ]$ sed -i <span class=\"string\">'s/3307/3306/g'</span> ../3306/my.cnf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#初始化实例与启动数据库：</span></span><br><span class=\"line\">/usr/<span class=\"built_in\">local</span>/mysql8/bin/mysqld --defaults-file=/data/mysqldata/3307/3307.cnf --initialize --user=mysql --basedir=/usr/<span class=\"built_in\">local</span>/mysql8</span><br><span class=\"line\">/usr/<span class=\"built_in\">local</span>/mysql8/bin/mysqld --defaults-file=/data/mysqldata/3306/3306.cnf --initialize --user=mysql --basedir=/usr/<span class=\"built_in\">local</span>/mysql8</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#实例化后在我们配置的mysql-error.log查看密码;</span></span><br><span class=\"line\">[root@centos7 3307]<span class=\"comment\"># grep \"password\" /data/mysqldata/3306/mysql-error.log</span></span><br><span class=\"line\">2019-01-18T02:58:28.529902Z 5 [Note] [MY-010454] [Server] A temporary password is generated <span class=\"keyword\">for</span> root@localhost: l&gt;(J9/P8dt*f</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#启动数据库</span></span><br><span class=\"line\">/usr/<span class=\"built_in\">local</span>/mysql8/bin/mysqld_safe --defaults-file=/data/mysqldata/3307/3307.cnf --user=mysql &amp;</span><br><span class=\"line\">/usr/<span class=\"built_in\">local</span>/mysql8/bin/mysqld_safe --defaults-file=/data/mysqldata/3306/3306.cnf --user=mysql &amp;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#登录数据库以及密码更改：</span></span><br><span class=\"line\">mysql -u root -p<span class=\"string\">';!u&gt;iE9hf(ah'</span> -S /data/mysqldata/3307/mysql.sock</span><br><span class=\"line\">mysql -u root -p<span class=\"string\">'fllyBv!ud9gu'</span> -S /data/mysqldata/3306/mysql.sock</span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt;ALTER USER <span class=\"string\">'root'</span>@<span class=\"string\">'localhost'</span> IDENTIFIED BY <span class=\"string\">'System123@'</span>;   <span class=\"comment\">#密码强度是有要求的，这也是MYSQL8的特性 </span></span><br><span class=\"line\">Query OK, 0 rows affected (0.14 sec)</span><br><span class=\"line\">mysql&gt;ALTER USER <span class=\"string\">'root'</span>@<span class=\"string\">'%'</span> IDENTIFIED WITH mysql_native_password BY <span class=\"string\">'System123@!'</span>;  <span class=\"comment\">#认证方式</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190428152655.png\" alt=\"WeiyiGeek.8.0多实例化\" title=\"\" class=\"\">\n                <p>WeiyiGeek.8.0多实例化</p>\n            </figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190428152925.png\" alt=\"WeiyiGeek.8.0多实例化登陆成功\" title=\"\" class=\"\">\n                <p>WeiyiGeek.8.0多实例化登陆成功</p>\n            </figure>\n<p><br></p>\n<h5 id=\"4-MySQL-5-7-X多实例化-单配置文件未实现\"><a href=\"#4-MySQL-5-7-X多实例化-单配置文件未实现\" class=\"headerlink\" title=\"(4). MySQL 5.7.X多实例化(单配置文件未实现)\"></a>(4). MySQL 5.7.X多实例化(单配置文件未实现)</h5><p>系统环境：CentOS release 6.10 (Final) 2.6.32-754.10.1.el6.i686<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">###1. 创建相关目录与实例化目录权限：###</span></span><br><span class=\"line\">[root@WeiyiGeek ~]<span class=\"comment\"># mkdir -vp /usr/local/mysql</span></span><br><span class=\"line\">mkdir: created directory `/usr/<span class=\"built_in\">local</span>/mysql`</span><br><span class=\"line\"></span><br><span class=\"line\">* 创建 MySQL 软链接 （不起作用）</span><br><span class=\"line\">ln -s /usr/<span class=\"built_in\">local</span>/mysql-5.7.24-linux-glibc2.12-i686/ /usr/<span class=\"built_in\">local</span>/mysql</span><br><span class=\"line\"></span><br><span class=\"line\">* 创建 用户建立 软链接</span><br><span class=\"line\">groupadd -g 500 mysql </span><br><span class=\"line\">useradd -r -g mysql -u 500 -s /sbin/nologin mysql</span><br><span class=\"line\"></span><br><span class=\"line\">* 在 MySQL 二进制包目录中创建 mysql-files 目录 [MySQL 数据导入/导出数据专放目录]</span><br><span class=\"line\">mkdir -v /usr/<span class=\"built_in\">local</span>/mysql/mysql-files</span><br><span class=\"line\">mkdir -vp /data/mysql_data&#123;1..4&#125;/&#123;data,logs&#125;</span><br><span class=\"line\">chown mysql.mysql -R /usr/<span class=\"built_in\">local</span>/mysql/mysql-files /data/mysql_data&#123;1..4&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">###2.编辑my.cnf文档:####</span></span><br><span class=\"line\"> mysqld_multi --example &gt; my.cnf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#单一配置文件部署方案</span></span><br><span class=\"line\">* 配置 MySQL 配置文件 /etc/my.cnf</span><br><span class=\"line\">[mysqld_multi]</span><br><span class=\"line\">mysqld    = /usr/<span class=\"built_in\">local</span>/mysql/bin/mysqld </span><br><span class=\"line\">mysqladmin = /usr/<span class=\"built_in\">local</span>/mysql/bin/mysqladmin</span><br><span class=\"line\"><span class=\"built_in\">log</span>        = /tmp/mysql_multi.log</span><br><span class=\"line\"> </span><br><span class=\"line\">[mysqld1]</span><br><span class=\"line\"><span class=\"comment\"># 设置数据目录　[多实例中一定要不同]</span></span><br><span class=\"line\">datadir = /data/mysql_data1</span><br><span class=\"line\"><span class=\"comment\"># 设置sock存放文件名　[多实例中一定要不同]</span></span><br><span class=\"line\">socket = /tmp/3306mysql.sock</span><br><span class=\"line\"><span class=\"comment\"># 设置监听开放端口　[多实例中一定要不同]</span></span><br><span class=\"line\">port = 3306</span><br><span class=\"line\"><span class=\"comment\"># 设置运行用户</span></span><br><span class=\"line\">user = mysql</span><br><span class=\"line\"><span class=\"comment\"># 关闭监控</span></span><br><span class=\"line\">performance_schema = off</span><br><span class=\"line\"><span class=\"comment\"># 设置innodb 缓存大小</span></span><br><span class=\"line\">innodb_buffer_pool_size = 32M</span><br><span class=\"line\"><span class=\"comment\"># 设置监听IP地址</span></span><br><span class=\"line\">bind_address = 0.0.0.0</span><br><span class=\"line\"><span class=\"comment\"># 关闭DNS 反向解析</span></span><br><span class=\"line\">skip-name-resolve = 0</span><br><span class=\"line\">server-id = 1</span><br><span class=\"line\">basedir = /usr/<span class=\"built_in\">local</span>/mysql</span><br><span class=\"line\"> </span><br><span class=\"line\">[mysqld2]</span><br><span class=\"line\">datadir = /data/mysql_data2</span><br><span class=\"line\">socket = /tmp/3307mysql.sock</span><br><span class=\"line\">port = 3307</span><br><span class=\"line\">user = mysql</span><br><span class=\"line\">server-id = 2</span><br><span class=\"line\">basedir = /usr/<span class=\"built_in\">local</span>/mysql</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">####3. 初始化数据库：#####</span></span><br><span class=\"line\"><span class=\"comment\">#mysql_install_db --basedir=/usr/local/mysql/ --datadir=/data/mysql_3306/data</span></span><br><span class=\"line\"><span class=\"comment\">#或者采用 --defaults-file=/etc/my.cnf  --initialize-insecure #建立的密码为空   --user=mysql 指定用户</span></span><br><span class=\"line\">mysqld --defaults-file=/data/my.cnf --initialize --user=mysql --basedir=/usr/<span class=\"built_in\">local</span>/mysql --datadir=/data/mysql_data1 --explicit_defaults_for_timestamp  </span><br><span class=\"line\">mysqld --initialize --basedir=/usr/<span class=\"built_in\">local</span>/mysql8/ --datadir=/app/mysql/mysqldata/3306/data/ --explicit_defaults_for_timestamp  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#各实例开启 SSL 连接</span></span><br><span class=\"line\">/usr/<span class=\"built_in\">local</span>/mysql/bin/mysql_ssl_rsa_setup --user=mysql --basedir=/usr/<span class=\"built_in\">local</span>/mysql --datadir=/app/mysql/mysqldata/3306/data/   </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#查看数据库是否初始化成功</span></span><br><span class=\"line\">mysqld_multi进行多实例管理</span><br><span class=\"line\"></span><br><span class=\"line\">启动全部实例：/usr/<span class=\"built_in\">local</span>/mysql/bin/mysqld_multi start</span><br><span class=\"line\">查看全部实例状态：/usr/<span class=\"built_in\">local</span>/mysql/bin/mysqld_multi report </span><br><span class=\"line\">启动单个实例：/usr/<span class=\"built_in\">local</span>/mysql/bin/mysqld_multi start 3306 </span><br><span class=\"line\">停止单个实例：/usr/<span class=\"built_in\">local</span>/mysql/bin/mysqld_multi stop 3306 </span><br><span class=\"line\">查看单个实例状态：/usr/<span class=\"built_in\">local</span>/mysql/bin/mysqld_multi report 3306 </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#登录以及修改密码：</span></span><br><span class=\"line\">mysql的root用户初始密码是空，所以需要登录mysql进行修改密码，下面以3306为例： </span><br><span class=\"line\">mysql -S /tmp/mysql_3306.sock   </span><br><span class=\"line\"><span class=\"built_in\">set</span> password <span class=\"keyword\">for</span> root@<span class=\"string\">'localhost'</span>=password(<span class=\"string\">'123456'</span>);   <span class=\"comment\">#&lt;=5.7.x</span></span><br><span class=\"line\">flush privileges;</span><br></pre></td></tr></table></figure><br><br></p>\n<h5 id=\"5-MySQL-8-x多实例化-单配置文件未实现\"><a href=\"#5-MySQL-8-x多实例化-单配置文件未实现\" class=\"headerlink\" title=\"(5). MySQL 8.x多实例化(单配置文件未实现)\"></a>(5). MySQL 8.x多实例化(单配置文件未实现)</h5><p>环境与上面是一致得：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. 与 MySQL 8.X 多实例化 （多配置文件）建立</span></span><br><span class=\"line\">mkdir -vp /app/mysql/mysqldata/&#123;&#123;3307,3308&#125;/&#123;data,tmp,binlog,innodb_ts,innodb_log,undo&#125;,backup,scripts&#125;</span><br><span class=\"line\">touch /app/mysql/mysqldata/3307/mysql-error.log /app/mysql/mysqldata/3308/mysql-error.log</span><br><span class=\"line\">chown -R mysql:mysql /app/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2. 使用mysqld_multi，需要3个配置文件，其中两个是用于初始化，另一个是用于mysqld_multi使用：</span></span><br><span class=\"line\">[mysqld_multi] </span><br><span class=\"line\">mysqld = /usr/<span class=\"built_in\">local</span>/mysql8/bin/mysqld_safe</span><br><span class=\"line\">mysqladmin = /usr/<span class=\"built_in\">local</span>/mysql8/bin/mysqladmin </span><br><span class=\"line\"><span class=\"built_in\">log</span> = /app/mysql/mysqldata/mysqld_multi.log </span><br><span class=\"line\">user = root</span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld3307]</span><br><span class=\"line\">port=3307 </span><br><span class=\"line\">user=mysql</span><br><span class=\"line\">basedir=/usr/<span class=\"built_in\">local</span>/mysql8</span><br><span class=\"line\">socket=/tmp/mysql3307.sock </span><br><span class=\"line\">pid-file=/app/mysql/mysqldata/3307/mysql3307.pid </span><br><span class=\"line\">datadir=/app/mysql/mysqldata/3307/data </span><br><span class=\"line\"><span class=\"built_in\">log</span>-error=/app/mysql/mysqldata/3307/mysql-error.log</span><br><span class=\"line\">explicit_defaults_for_timestamp</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3. 初始化：</span></span><br><span class=\"line\">mysqld --initialize --defaults-file=/app/my.cnf --user=mysql --datadir=/app/mysql/mysqldata/3307/data --basedir=/usr/<span class=\"built_in\">local</span>/mysql8</span><br><span class=\"line\"></span><br><span class=\"line\">$ mysqld --initialize --user=root --datadir=/app/mysql/mysqldata/3307/data --basedir=/usr/<span class=\"built_in\">local</span>/mysql8 --defaults-file=/etc/mysql.cnf</span><br><span class=\"line\">    root@localhost: I0pFT4aNqh<span class=\"comment\">#r</span></span><br><span class=\"line\">$ mysqld --initialize --user=root --datadir=/app/mysql/mysqldata/3308/data --basedir=/usr/<span class=\"built_in\">local</span>/mysql8</span><br><span class=\"line\">    root@localhost: F,3Dv%mRLY*f</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#4. 开启及其登录</span></span><br><span class=\"line\">/usr/<span class=\"built_in\">local</span>/mysql8/bin/mysqld_safe --port=3308 --user=root --basedir=/usr/<span class=\"built_in\">local</span>/mysql8 --socket=/app/mysql/mysqldata/3308/mysql3308.sock --pid-file=/app/mysql/mysqldata/3308/mysql3308.pid --<span class=\"built_in\">log</span>-error=/app/mysql/mysqldata/3308/mysql-error.log --explicit_defaults_for_timestamp &amp;</span><br><span class=\"line\">/usr/<span class=\"built_in\">local</span>/mysql8/bin/mysqld --basedir=/usr/<span class=\"built_in\">local</span>/mysql8 --datadir=/app/mysql/mysqldata/3308/data --plugin-dir=/usr/<span class=\"built_in\">local</span>/mysql8/lib/plugin --user=root --explicit-defaults-for-timestamp --<span class=\"built_in\">log</span>-error=/app/mysql/mysqldata/3308/mysql-error.log --pid-file=/app/mysql/mysqldata/3308/mysql3308.pid --socket=/app/mysql/mysqldata/3308/mysql3308.sock --port=3308 &amp;</span><br><span class=\"line\"></span><br><span class=\"line\">/usr/<span class=\"built_in\">local</span>/mysql8/bin/mysqld_safe --port=3307 --user=root --basedir=/usr/<span class=\"built_in\">local</span>/mysql8 --socket=/app/mysql/mysqldata/3307/mysql3307.sock --pid-file=/app/mysql/mysqldata/3307/mysql3307.pid --<span class=\"built_in\">log</span>-error=/app/mysql/mysqldata/3307/mysql-error.log --explicit_defaults_for_timestamp &amp;</span><br><span class=\"line\">/usr/<span class=\"built_in\">local</span>/mysql8/bin/mysqld --basedir=/usr/<span class=\"built_in\">local</span>/mysql8 --datadir=/app/mysql/mysqldata/3307/data --plugin-dir=/usr/<span class=\"built_in\">local</span>/mysql8/lib/plugin --user=root --explicit-defaults-for-timestamp --<span class=\"built_in\">log</span>-error=/app/mysql/mysqldata/3307/mysql-error.log --pid-file=/app/mysql/mysqldata/3307/mysql3307.pid --socket=/app/mysql/mysqldata/3307/mysql3307.sock --port=3307 &amp;</span><br><span class=\"line\"></span><br><span class=\"line\">mysql -uroot -p<span class=\"string\">'F,3Dv%mRLY*f'</span> -S /app/mysql/mysqldata/3308/mysql3308.sock</span><br><span class=\"line\">mysql -uroot -p<span class=\"string\">'-KdgrGN1pkR:'</span> -S /app/mysql/mysqldata/3307/mysql3307.sock</span><br></pre></td></tr></table></figure></p>\n<hr>\n\n<h4 id=\"3-MySQL多实例登陆与安全配置\"><a href=\"#3-MySQL多实例登陆与安全配置\" class=\"headerlink\" title=\"3. MySQL多实例登陆与安全配置\"></a>3. MySQL多实例登陆与安全配置</h4><p>多实例数据库的登陆：（比较特殊）<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#本地登陆：</span></span><br><span class=\"line\">mysql -S /data/3306/mysql.sock    <span class=\"comment\">#需要指定socket</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#远程登录(非本机LINUX)：端口号是实例中的端口（逻辑连接位置）</span></span><br><span class=\"line\">mysql –h主机名 -u用户名 –p密码 –P3306</span><br><span class=\"line\">mysql&gt; system mysql -S /data/3307/mysql.sock    <span class=\"comment\">#（直接登录到3306的数据库）</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#为用户增加密码，修改密码</span></span><br><span class=\"line\">mysqladmin -S /data/3306/mysql.sock -uroot password <span class=\"string\">'123.asd'</span></span><br><span class=\"line\">mysqladmin -S /data/3307/mysql.sock –uroot –p123.asd password <span class=\"string\">'123456'</span></span><br></pre></td></tr></table></figure></p>\n<p><strong>MySQL多实例配置数据库进行安全配置</strong><br>1）设置mysql的shell脚本中password为空，分别进行设置；<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#即这样得形式mysql -uroot -p  #使之不在从命令行中输入账号密码</span></span><br><span class=\"line\">username = <span class=\"variable\">$1</span></span><br><span class=\"line\">password = <span class=\"variable\">$2</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">\"Usage: /data/<span class=\"variable\">$&#123;port&#125;</span>/mysql username password &#123;start|stop|restart&#125;\\n\"</span></span><br></pre></td></tr></table></figure></p>\n<p>2）设置mysql的权限与所属用户和组<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@WeiyiGeek ~]$ find /data/ -<span class=\"built_in\">type</span> f -name <span class=\"string\">\"mysql\"</span> -<span class=\"built_in\">exec</span> chown root:root &#123;&#125; \\;</span><br><span class=\"line\">[root@WeiyiGeek ~]$ find /data/ -<span class=\"built_in\">type</span> f -name <span class=\"string\">\"mysql\"</span> -<span class=\"built_in\">exec</span> chmod 700 &#123;&#125; \\;</span><br><span class=\"line\">[root@WeiyiGeek ~]$ find /data/ -<span class=\"built_in\">type</span> f -name <span class=\"string\">\"mysql\"</span> -<span class=\"built_in\">exec</span> ls -lsh &#123;&#125; \\;</span><br><span class=\"line\">4.0K -rwx------. 1 root root 1013 6月  26 22:38 /data/3306/mysql</span><br><span class=\"line\">4.0K -rwx------. 1 root root 1013 6月  26 22:36 /data/3307/mysql</span><br></pre></td></tr></table></figure></p>\n<p>3）再次启动开启查看然后关闭测试<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@WeiyiGeek ~]$ /data/3306/mysql root 123.asd start <span class=\"comment\">#实际不建议这种形式容易泄露密码</span></span><br><span class=\"line\">Starting MySQL...</span><br><span class=\"line\">[root@WeiyiGeek ~]$ /data/3307/mysql root 123.asd start</span><br><span class=\"line\">Starting MySQL...</span><br><span class=\"line\"></span><br><span class=\"line\">[root@WeiyiGeek ~]$ ss -tlnp </span><br><span class=\"line\">*:3307</span><br></pre></td></tr></table></figure></p>\n<p><br>__</p>\n<h4 id=\"4-MySQL多实例配置数据库-故障排除\"><a href=\"#4-MySQL多实例配置数据库-故障排除\" class=\"headerlink\" title=\"4. MySQL多实例配置数据库-故障排除\"></a>4. MySQL多实例配置数据库-故障排除</h4><p>1）查看端口服务是不是启用；<br>2）查看MySQL的错误日志；<br>3）细看执行启动命令后的屏幕输出；<br>4）查看系统的/var/log/messages/；<br>5）如果是关联服务则需要看相关服务的LOG；</p>\n","comments":true,"excerpt":"[TOC]<br>","categories":[{"name":"Database","path":"api/categories/Database.json"},{"name":"DBA","path":"api/categories/DBA.json"}],"tags":[{"name":"MYSQL","path":"api/tags/MYSQL.json"}]}