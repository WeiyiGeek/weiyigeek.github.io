<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ 2.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineè¯­æ³•å…¥é—¨å­¦ä¹ |WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="Jenkins">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>2.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineè¯­æ³•å…¥é—¨å­¦ä¹ </span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">2.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineè¯­æ³•å…¥é—¨å­¦ä¹ </h1>
        <h5 class="subtitle">
            
                <time datetime="2020-12-29T04:34:30.000Z" itemprop="datePublished" class="page-time">
  2020-12-29
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/DevOps/">DevOps</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/DevOps/CI-CD/">CI-CD</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/CI-CD/Jenkins/2.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineè¯­æ³•å…¥é—¨å­¦ä¹ "
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">2.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineè¯­æ³•å…¥é—¨å­¦ä¹ </h1>
        <div class="post-meta">
            <time class="post-time" title="2020-12-29 12:34:30" datetime="2020-12-29T04:34:30.000Z"  itemprop="datePublished">2020-12-29</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/DevOps/">DevOps</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/DevOps/CI-CD/">CI-CD</a></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h2 id="0x00-å‰è¨€ç®€è¿°"><a href="#0x00-å‰è¨€ç®€è¿°" class="headerlink" title="0x00 å‰è¨€ç®€è¿°"></a>0x00 å‰è¨€ç®€è¿°</h2><h3 id="Pipeline-ä»‹ç»"><a href="#Pipeline-ä»‹ç»" class="headerlink" title="Pipeline ä»‹ç»"></a>Pipeline ä»‹ç»</h3><p><strong>Q: ä»€ä¹ˆæ˜¯ Pipelineï¼Ÿ</strong></p>
<blockquote>
<p>ç­”: Pipelineï¼ˆæµæ°´çº¿ï¼‰æ˜¯ Jenkins 2.0 çš„ç²¾é«“å®ƒåŸºäºGroovyè¯­è¨€å®ç°çš„ä¸€ç§DSL(é¢†åŸŸç‰¹å®šè¯­è¨€)ï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯ä¸€å¥—è¿è¡ŒäºJenkinsä¸Šçš„å·¥ä½œæµæ¡†æ¶ï¼Œç”¨äºæè¿°æ•´æ¡æµæ°´çº¿æ˜¯å¦‚ä½•è¿›è¡Œçš„ã€‚<br>å®ƒå°†åŸæœ¬ç‹¬ç«‹è¿è¡Œäºå•ä¸ªæˆ–è€…å¤šä¸ªèŠ‚ç‚¹çš„ä»»åŠ¡è¿æ¥èµ·æ¥ï¼Œå®ç°å•ä¸ªä»»åŠ¡éš¾ä»¥å®Œæˆçš„<code>å¤æ‚æµç¨‹ç¼–æ’ä¸å¯è§†åŒ–</code>ã€‚</p>
</blockquote>
<p><br></p>
<p><strong>Q: ä»€ä¹ˆæ˜¯DSL?</strong></p>
<blockquote>
<p>ç­”: DSLå³ <code>(Domain Specific Language)</code> é¢†åŸŸä¸“ç”¨è¯­è¨€ï¼Œä¸“é—¨é’ˆå¯¹ä¸€ä¸ªç‰¹å®šçš„é—®é¢˜é¢†åŸŸï¼Œå…·æœ‰å»ºæ¨¡æ‰€éœ€çš„è¯­æ³•å’Œè¯­ä¹‰çš„è¯­è¨€ã€‚åœ¨ä¸é—®é¢˜åŸŸç›¸åŒçš„æŠ½è±¡å±‚æ¬¡å¯¹æ¦‚å¿µå»ºæ¨¡ã€‚<br>DSL æ˜¯ Jenkins æœåŠ¡ç‰¹æœ‰çš„ä¸€ä¸ªè¯­è¨€ï¼Œåº•å±‚é€šè¿‡ Groovy ç¼–ç¨‹è¯­è¨€æ¥å®ç°ã€‚åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å¾ˆå¥½çš„ç»“åˆ Groovyã€‚Jenkins Job DSL Plugin æä¾›äº†ä¸°å¯Œçš„APIï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™äº›APIå®ç°å¯¹ Jenkinis ä¸­Viewã€Job ç­‰ç®¡ç†ã€‚<br>Tips: Jenkins å†…ç½®äº† Groovy çš„å¼•æ“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Groovy ç¼–ç¨‹è¯­è¨€åœ¨ DSL API ä¸­æ·»åŠ é€»è¾‘ç¼–ç¨‹ã€‚</p>
</blockquote>
<p><br></p>
<p><strong>Q: ä»€ä¹ˆæ˜¯ Groovy è¯­è¨€</strong><br>ç­”: Groovy æ˜¯ Apache æ——ä¸‹çš„ä¸€é—¨åŸºäº JVM å¹³å°çš„åŠ¨æ€/æ•æ·ç¼–ç¨‹è¯­è¨€ï¼Œåœ¨è¯­è¨€çš„è®¾è®¡ä¸Šå®ƒå¸çº³äº† Pythonã€Ruby å’Œ Smalltalk è¯­è¨€çš„ä¼˜ç§€ç‰¹æ€§ï¼Œè¯­æ³•éå¸¸ç®€ç»ƒå’Œä¼˜ç¾ï¼Œå¼€å‘æ•ˆç‡ä¹Ÿéå¸¸é«˜ï¼ˆç¼–ç¨‹è¯­è¨€çš„å¼€å‘æ•ˆç‡å’Œæ€§èƒ½æ˜¯ç›¸äº’çŸ›ç›¾çš„ï¼Œè¶Šé«˜çº§çš„ç¼–ç¨‹è¯­è¨€æ€§èƒ½è¶Šå·®ï¼Œå› ä¸ºæ„å‘³ç€æ›´å¤šåº•å±‚çš„å°è£…ï¼Œä¸è¿‡å¼€å‘æ•ˆç‡ä¼šæ›´é«˜ï¼Œéœ€ç»“åˆä½¿ç”¨åœºæ™¯åšå–èˆï¼‰</p>
<p><strong>Tips: PipeLineåœ¨Jenkinsä¸­çš„å‘å±•å†å²</strong></p>
<ul>
<li>1.Jenkins 1.x æ”¯æŒ Pipeline ï¼Œåªä¸è¿‡æ˜¯é€šè¿‡é¡µé¢æ‰‹åŠ¨é…ç½®æµæ°´çº¿ã€‚</li>
<li>2.Jenkins 2.x å¼€å§‹æ”¯æŒ pipeline as code ,å¯ä»¥é€šè¿‡ä»£ç æ¥é…ç½®æµæ°´çº¿äº†ã€‚</li>
</ul>
<p><br/></p>
<p><strong>Q: ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Pipeline?</strong></p>
<blockquote>
<p>1.Pipelineæ˜¯Jenkins2.Xçš„æœ€æ ¸å¿ƒçš„ç‰¹æ€§ï¼Œå¸®åŠ©Jenkinså®ç°ä»<code>CIåˆ°CD</code>ä¸<code>AutoDevOps</code>çš„è½¬å˜;<br>2.Pipelineæ˜¯ä¸€ç»„æ’ä»¶å®ƒå¯ä»¥è®©Jenkinså¯ä»¥å®ç°æŒç»­äº¤ä»˜ Pipelineçš„è½åœ°å’Œå®æ–½ã€‚<br>3.Pipelineæä¾›äº†ä¸€ç»„å¯æ‰©å±•çš„å·¥å…·ï¼Œé€šè¿‡<code>Pipeline Domain Specific Language(DSL) syntax</code>å¯ä»¥è¾¾åˆ° Pipeline as Codeï¼ˆJenkinsfileå­˜å‚¨åœ¨é¡¹ç›®çš„æºä»£ç åº“ï¼‰çš„ç›®çš„ã€‚</p>
</blockquote>
<p>Tips: æµæ°´çº¿çš„å†…å®¹åŒ…æ‹¬æ‰§è¡Œç¼–è¯‘ã€æ‰“åŒ…ã€æµ‹è¯•ã€è¾“å‡ºæµ‹è¯•æŠ¥å‘Šç­‰æ­¥éª¤ã€‚<br>Tips: æŒç»­äº¤ä»˜<code>Pipeline (CD Pipeline)</code>æ˜¯å°†è½¯ä»¶ä»ç‰ˆæœ¬æ§åˆ¶é˜¶æ®µåˆ°äº¤ä»˜ç»™ç”¨æˆ·æˆ–å®¢æˆ·çš„å®Œæ•´è¿‡ç¨‹çš„è‡ªåŠ¨åŒ–è¡¨ç°, è½¯ä»¶çš„æ¯ä¸€æ¬¡æ›´æ”¹ï¼ˆæäº¤åˆ°æºä»£ç ç®¡ç†ç³»ç»Ÿï¼‰éƒ½è¦ç»è¿‡ä¸€ä¸ªå¤æ‚çš„è¿‡ç¨‹æ‰èƒ½è¢«å‘å¸ƒã€‚</p>
<p><br></p>
<p><strong>Pipelineäº”å¤§ç‰¹æ€§ï¼ˆä¼˜ç‚¹ï¼‰</strong></p>
<ul>
<li>ä»£ç : Pipelineä»¥ä»£ç çš„å½¢å¼å®ç°ï¼Œé€šå¸¸è¢«æ£€å…¥æºä»£ç æ§åˆ¶ï¼Œä½¿å›¢é˜Ÿèƒ½å¤Ÿç¼–è¾‘ã€å®¡æŸ¥å’Œè¿­ä»£å…¶CDæµç¨‹ã€‚</li>
<li>å¯æŒç»­æ€§ï¼šJenklinsé‡å¯æˆ–è€…ä¸­æ–­åéƒ½ä¸ä¼šå½±å“Pipeline Jobã€‚</li>
<li>åœé¡¿ï¼šPipelineå¯ä»¥é€‰æ‹©åœæ­¢å¹¶ç­‰å¾…æ„å»ºäººå‘˜çš„è¾“å…¥æˆ–æ‰¹å‡†ï¼Œç„¶åå†ç»§ç»­Pipelineè¿è¡Œã€‚</li>
<li>å¤šåŠŸèƒ½ï¼šPipelineæ”¯æŒç°å®ä¸–ç•Œçš„å¤æ‚CDè¦æ±‚ï¼ŒåŒ…æ‹¬fork/joinå­è¿›ç¨‹ï¼Œå¾ªç¯å’Œå¹¶è¡Œæ‰§è¡Œå·¥ä½œçš„èƒ½åŠ›</li>
<li>å¯æ‰©å±•ï¼šPipelineæ’ä»¶æ”¯æŒå…¶<code>DSL</code>çš„è‡ªå®šä¹‰æ‰©å±•ä»¥åŠä¸å…¶ä»–æ’ä»¶é›†æˆçš„å¤šä¸ªé€‰é¡¹ã€‚</li>
</ul>
<p>Tips: å®ƒå®ç°æŒç»­é›†æˆä¸éƒ¨ç½²ã€èŠ‚çœäº§å“å‘å¸ƒæ—¶é—´ã€ä¼˜åŒ–éƒ¨ç½²ç­–ç•¥ã€èŠ‚çœäººåŠ›æˆæœ¬ã€ä»¥åŠè‡ªåŠ¨åŒ–è„šæœ¬å¤ç”¨ç­‰ç­‰;</p>
<p><br></p>
<p><strong>Q: æ€æ ·å®‰è£…Pipelineæ’ä»¶?</strong></p>
<blockquote>
<p>ç­”: ç†Ÿè¯è¯´å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨ï¼Œç¬¬ä¸€æ­¥å½“ç„¶éœ€è¦å®‰è£…Jenkinsä½¿ç”¨Pipelineæ‰€éœ€çš„æ’ä»¶;</p>
</blockquote>
<p>Jenkins pipeline ç›¸å…³æ’ä»¶å®‰è£…: æ‰“å¼€ Jenkins æ‰¾åˆ° <code>ã€ç³»ç»Ÿç®¡ç†ã€‘-&gt;ã€æ’ä»¶ç®¡ç†ã€‘-&gt;ã€å¯é€‰æ’ä»¶ã€‘</code> ç„¶ååœ¨æœç´¢æ¡†è¾“å…¥ <code>Pipeline</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Pipeline å‘½ä»¤è¡Œæ¥å£ æ‚é¡¹ ä»£ç†å¯åŠ¨å™¨å’Œæ§åˆ¶å™¨ æ„å»ºè§¦å‘å™¨  2.6 	2 å¹´ 3 æœˆ ago </span><br><span class="line"><span class="comment"># è¯´æ˜ï¼šä¸€å¥—æ’ä»¶ï¼Œè®©æ‚¨ç¼–æ’è‡ªåŠ¨åŒ–ï¼Œç®€å•æˆ–å¤æ‚ã€‚æ›´å¤šç»†èŠ‚è¯·å‚é˜…Jenkinsçš„ Pipelineä»£ç ã€‚</span></span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=2.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineè¯­æ³•å…¥é—¨å­¦ä¹  href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210106230344.png" target="_blank" title="WeiyiGeek.Pipeline-Plug" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210106230344.png" alt="WeiyiGeek.Pipeline-Plug" title="" class=""></a>
                <p>WeiyiGeek.Pipeline-Plug</p>
            </figure></p>
<p><br></p>
<h3 id="Pipeline-åŸºç¡€çŸ¥è¯†"><a href="#Pipeline-åŸºç¡€çŸ¥è¯†" class="headerlink" title="Pipeline åŸºç¡€çŸ¥è¯†"></a>Pipeline åŸºç¡€çŸ¥è¯†</h3><p><strong>åŸºç¡€è¯´æ˜:</strong></p>
<blockquote>
<ul>
<li>Pipeline è„šæœ¬æ˜¯ç”± Groovy è¯­è¨€ç»“åˆ DSL è¯­è¨€å®ç°çš„ã€‚</li>
<li>Pipeline æ”¯æŒä¸¤ç§è¯­æ³•ï¼š<code>Declarative Pipeline (å£°æ˜å¼ - 2.5 å¼•å…¥)</code> å’Œ <code>Scripted Pipeline (è„šæœ¬å¼)</code>è¯­æ³•</li>
<li>Pipeline ä¹Ÿæœ‰ä¸¤ç§åˆ›å»ºæ–¹æ³•ï¼š<ul>
<li>æ–¹å¼1ã€åœ¨ Jenkins çš„ Web UI ç•Œé¢ä¸­è¾“å…¥è„šæœ¬ï¼›</li>
<li>æ–¹å¼2ã€é€šè¿‡åˆ›å»ºä¸€ä¸ª Jenkinsfile è„šæœ¬æ–‡ä»¶(<code>Groovy è¯­è¨€ç»“åˆ DSL å¼€å‘</code>)æ”¾å…¥é¡¹ç›®æºç åº“ä¸­ (<code>æ¨èåœ¨ Jenkins ä¸­ç›´æ¥ä»æºä»£ç æ§åˆ¶(SCMD) ä¸­ç›´æ¥è½½å…¥ Jenkinsfile Pipeline</code>)</li>
</ul>
</li>
</ul>
</blockquote>
<p><br></p>
<p><strong>è¯­æ³•å·®å¼‚:</strong><br>æè¿°: æœ€åˆåˆ›å»º Jenkins Pipeline æ—¶ Groovy è¯­è¨€è¢«é€‰ä¸ºåŸºç¡€ã€‚Jenkinsé•¿æœŸä»¥æ¥ä¸€ç›´æä¾›åµŒå…¥å¼Groovyå¼•æ“ï¼Œä»¥ä¸ºç®¡ç†å‘˜å’Œç”¨æˆ·æä¾›é«˜çº§è„šæœ¬åŠŸèƒ½ã€‚å¦å¤–Jenkins Pipelineçš„å®ç°è€…å‘ç°Groovyæ˜¯æ„å»ºç°åœ¨ç§°ä¸ºâ€è„šæœ¬ Pipelinâ€ DSLçš„åšå®åŸºç¡€ã€‚</p>
<p>ç”±äºå®ƒæ˜¯åŠŸèƒ½é½å…¨çš„ç¼–ç¨‹ç¯å¢ƒï¼Œå› æ­¤è„šæœ¬åŒ– Pipelineä¸ºJenkinsç”¨æˆ·æä¾›äº†æå¤§çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚Groovyå­¦ä¹ æ›²çº¿é€šå¸¸ä¸æ˜¯ç»™å®šå›¢é˜Ÿçš„æ‰€æœ‰æˆå‘˜æ‰€å¸Œæœ›çš„ï¼Œå› æ­¤åˆ›å»ºäº†å£°æ˜å¼ Pipelineï¼Œä»¥ä¸ºç¼–å†™Jenkins Pipelineæä¾›æ›´ç®€å•ï¼Œæ›´è‡ªä»¥ä¸ºæ˜¯çš„è¯­æ³•ã€‚</p>
<p>ä¸¤è€…åŸºæœ¬ä¸Šæ˜¯ä¸‹é¢çš„ç›¸åŒ Pipelineå­ç³»ç»Ÿã€‚å®ƒä»¬éƒ½æ˜¯â€œ Pipelineä½œä¸ºä»£ç â€çš„æŒä¹…å®ç°ã€‚ä»–ä»¬éƒ½å¯ä»¥ä½¿ç”¨å†…ç½®åœ¨Pipelineä¸­æˆ–ç”±æ’ä»¶æä¾›çš„æ­¥éª¤ã€‚ä¸¤è€…éƒ½å¯ä»¥åˆ©ç”¨ å…±äº«åº“</p>
<p>ä½†æ˜¯å®ƒä»¬çš„åŒºåˆ«åœ¨äºè¯­æ³•å’Œçµæ´»æ€§ã€‚å£°æ˜æ€§é™åˆ¶ä½¿ç”¨æ›´ä¸¥æ ¼å’Œé¢„å®šä¹‰çš„ç»“æ„ä¸ºç”¨æˆ·æä¾›çš„åŠŸèƒ½ï¼Œä½¿å…¶æˆä¸ºæ›´ç®€å•çš„è¿ç»­äº¤ä»˜ Pipelineçš„ç†æƒ³é€‰æ‹©ã€‚è„šæœ¬åŒ–è„šæœ¬æä¾›çš„é™åˆ¶éå¸¸å°‘ï¼Œä»¥è‡³äºå¯¹ç»“æ„å’Œè¯­æ³•çš„å”¯ä¸€é™åˆ¶å¾€å¾€æ˜¯ç”±Groovyæœ¬èº«å®šä¹‰çš„ï¼Œè€Œä¸æ˜¯ç”±ä»»ä½•ç‰¹å®šäº Pipelineçš„ç³»ç»Ÿå®šä¹‰çš„ï¼Œå› æ­¤ï¼Œå®ƒæˆä¸ºé«˜çº§ç”¨æˆ·å’Œè¦æ±‚æ›´å¤æ‚çš„ç”¨æˆ·çš„ç†æƒ³é€‰æ‹©ã€‚é¡¾åæ€ä¹‰ï¼Œå£°æ˜æ€§æµæ°´çº¿é¼“åŠ±ä½¿ç”¨å£°æ˜æ€§ç¼–ç¨‹æ¨¡å‹ï¼Œè€Œè„šæœ¬ Pipeline éµå¾ªæ›´å¼ºåˆ¶æ€§çš„ç¼–ç¨‹æ¨¡å‹ã€‚</p>
<p><br></p>
<p><strong>Q: é€‰æ‹©<code>Declarative Pipeline</code>è¿˜æ˜¯<code>Scripted Pipeline</code>?</strong></p>
<blockquote>
<p>ç­”: æœ€å¼€å§‹<code>Pipeline plugin</code>ä»…æ”¯æŒ<code>Scripted Pipeline</code>ä¸€ç§è„šæœ¬ç±»å‹,è€Œ <code>Declarative Pipeline</code> ä¸ºPipeline pluginåœ¨2.5ç‰ˆæœ¬ä¹‹åæ–°å¢çš„ä¸€ç§è„šæœ¬ç±»å‹ä¸åŸå…ˆçš„<code>Scripted Pipeline</code>ä¸€æ ·éƒ½å¯ä»¥ç”¨æ¥ç¼–å†™è„šæœ¬ã€‚</p>
<p>ç”±äºåœ¨æˆ‘ä»¬ä½¿ç”¨BlueOceanæµæ°´çº¿UIæ’ä»¶åï¼ŒDeclarative Pipeline ä¸ BlueOcean è„šæœ¬ç¼–è¾‘å™¨æ˜¯å¯ä»¥å…¼å®¹ä½¿ç”¨ï¼Œ<code>å¹¶ä¸”åœ¨eclarative Pipelineä¸­ï¼Œä¹Ÿæ˜¯å¯ä»¥å†…åµŒScripted Pipelineä»£ç çš„</code>ï¼Œæ‰€ä»¥é€šå¸¸å»ºè®®ä½¿ç”¨ <code>Declarative Pipeline</code> (<code>è‹± /dÉªËˆklÃ¦rÉ™tÉªv/</code>)çš„æ–¹å¼è¿›è¡Œç¼–å†™</p>
</blockquote>
<p><br></p>
<p><strong>Declarative pipelineå’ŒScripted pipelineçš„æ¯”è¾ƒ?</strong></p>
<ul>
<li>1.å…±åŒç‚¹:  <ul>
<li>å£°æ˜å¼å’Œè„šæœ¬å¼æµæ°´çº¿éƒ½æ˜¯ DSL è¯­è¨€ï¼Œç”¨æ¥æè¿°è½¯ä»¶äº¤ä»˜æµæ°´çº¿çš„ä¸€éƒ¨åˆ†ã€‚</li>
<li>ä¸¤è€…éƒ½èƒ½å¤Ÿä½¿ç”¨pipelineå†…ç½®çš„æ’ä»¶æˆ–è€…æ’ä»¶æä¾›çš„stepæ­¥éª¤éƒ¨åˆ†ã€‚</li>
<li>ä¸¤è€…éƒ½å¯ä»¥åˆ©ç”¨å…±äº«åº“æ‰©å±•ã€‚</li>
</ul>
</li>
<li>2.åŒºåˆ«: ä¸¤è€…ä¸åŒä¹‹å¤„åœ¨äºè¯­æ³•å’Œçµæ´»æ€§;<ul>
<li>Declarative pipeline è¯­æ³•æ›´ä¸¥æ ¼ (<code>ä¾‹å¦‚å¿…é¡»ä»¥ pipeline å…³é”®è¯æ‰“å¤´</code>)ï¼Œæœ‰å›ºå®šçš„ç»„ç»‡ç»“æ„ä½†æ›´å®¹æ˜“ç”Ÿæˆä»£ç æ®µï¼Œæ‰€ä»¥å®ƒæˆä¸ºç”¨æˆ·æ›´ç†æƒ³çš„é€‰æ‹©ã€‚</li>
<li>Scripted pipeline è¯­æ³•æ›´åŠ çµæ´»ï¼Œå› ä¸ºGroovyæœ¬èº«åªèƒ½å¯¹ç»“æ„å’Œè¯­æ³•è¿›è¡Œé™åˆ¶ï¼Œå¯¹äºæ›´å¤æ‚çš„pipelineæ¥è¯´ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡è¿›è¡Œçµæ´»çš„å®ç°å’Œæ‰©å±•ã€‚</li>
</ul>
</li>
</ul>
<p>Tips: è„šæœ¬å¼è¯­æ³•çš„ç¡®çµæ´»ã€å¯æ‰©å±•ï¼Œä½†æ˜¯ä¹Ÿæ„å‘³ç€æ›´å¤æ‚ã€‚è€Œå£°æ˜å¼è¯­æ³•ä¾›æ›´ç®€å•ã€æ›´ç»“æ„åŒ–ï¼ˆmore opinionatedï¼‰çš„è¯­æ³• (<code>æ¨¡å—åŒ–çš„æ„Ÿè§‰</code>)ã€‚</p>
<p><br></p>
<h3 id="Pipeline-æ‰©å±•å…±äº«åº“"><a href="#Pipeline-æ‰©å±•å…±äº«åº“" class="headerlink" title="Pipeline æ‰©å±•å…±äº«åº“"></a>Pipeline æ‰©å±•å…±äº«åº“</h3><p>æè¿°: ç”±äºæµæ°´çº¿è¢«ç»„ç»‡ä¸­è¶Šæ¥è¶Šå¤šçš„é¡¹ç›®æ‰€é‡‡ç”¨ï¼Œå¸¸è§çš„æ¨¡å¼å¾ˆå¯èƒ½ä¼šå‡ºç°åœ¨å¤šä¸ªé¡¹ç›®ä¹‹é—´å…±äº«æµæ°´çº¿, <code>å…±äº«æµæ°´çº¿æœ‰åŠ©äºå‡å°‘å†—ä½™å¹¶ä¿æŒä»£ç  â€œDRYï¼ˆDonâ€™t Repeat Yourselfï¼‰â€</code>ã€‚</p>
<p><strong>Q: å¦‚ä½•å®šä¹‰å…±äº«åº“?</strong></p>
<blockquote>
<p>ç­”: æˆ‘ä»¬å°†ä¸€äº›é€šç”¨çš„ä»£ç æˆ–è€…ä»£ç åŒ…ï¼Œå°è£…å®šä¹‰ä¸ºåº•å±‚ä»£ç åº“ï¼Œæ–¹ä¾¿æµæ°´çº¿åˆ›å»ºã€‚</p>
</blockquote>
<p>ç‰¹å®šçš„ç›®å½•ç»“æ„:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(root)</span><br><span class="line">+- src                     <span class="comment"># Groovy source files</span></span><br><span class="line">|   +- org</span><br><span class="line">|     +- foo</span><br><span class="line">|       +- Bar.groovy      <span class="comment"># for org.foo.Bar class</span></span><br><span class="line">+- vars</span><br><span class="line">|   +- foo.groovy          <span class="comment"># for global 'foo' variable</span></span><br><span class="line">|   +- foo.txt             <span class="comment"># help for 'foo' variable</span></span><br><span class="line">+- resources               <span class="comment"># resource files (external libraries only)</span></span><br><span class="line">|   +- org</span><br><span class="line">|       +- foo</span><br><span class="line">|           +- bar.json    <span class="comment"># static helper data for org.foo.Bar</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>ç›®å½•ç»“æ„è§£æ:</strong></p>
<ul>
<li>1ã€src ç›®å½•åº”è¯¥çœ‹èµ·æ¥åƒæ ‡å‡†çš„ Java æºç›®å½•ç»“æ„ã€‚å½“æ‰§è¡Œæµæ°´çº¿æ—¶ï¼Œè¯¥ç›®å½•è¢«æ·»åŠ åˆ°ç±»è·¯å¾„ä¸‹ã€‚</li>
<li>2ã€vars ç›®å½•å®šä¹‰å¯ä»æµæ°´çº¿è®¿é—®çš„å…¨å±€å˜é‡çš„è„šæœ¬ã€‚ æ¯ä¸ª <em>.groovy æ–‡ä»¶çš„åŸºååº”è¯¥æ˜¯ä¸€ä¸ª Groovy (~ Java) æ ‡è¯†ç¬¦, é€šå¸¸æ˜¯ é©¼å³°å‘½åæ³•ï¼ˆcamelCasedï¼‰ã€‚ åŒ¹é… </em>.txt, å¦‚æœå­˜åœ¨å¯ä»¥åŒ…å«æ–‡æ¡£, é€šè¿‡ç³»ç»Ÿçš„é…ç½®æ ‡è®°æ ¼å¼åŒ–ä»å¤„ç† (æ‰€ä»¥å¯èƒ½æ˜¯ HTML, Markdown ç­‰ï¼Œè™½ç„¶ txt æ‰©å±•æ˜¯å¿…éœ€çš„)ã€‚è¿™äº›ç›®å½•ä¸­çš„ Groovy æºæ–‡ä»¶ åœ¨è„šæœ¬åŒ–æµæ°´çº¿ä¸­çš„ â€œCPS transformationâ€ ä¸€æ ·ã€‚</li>
<li>3ã€resources ç›®å½•å…è®¸ä»å¤–éƒ¨åº“ä¸­ä½¿ç”¨ libraryResource æ­¥éª¤æ¥åŠ è½½æœ‰å…³çš„é Groovy æ–‡ä»¶ã€‚ ç›®å‰ï¼Œå†…éƒ¨åº“ä¸æ”¯æŒè¯¥ç‰¹æ€§ã€‚</li>
<li>4ã€æ ¹ç›®å½•ä¸‹çš„å…¶ä»–ç›®å½•è¢«ä¿ç•™ä¸‹æ¥ä»¥ä¾¿äºå°†æ¥çš„å¢å¼ºã€‚</li>
</ul>
<p><br/></p>
<p><strong>Q: å¦‚ä½•å°†å°†å…±äº«åº“è®¾ç½®ä¸ºå…¨å±€å…±äº«åº“ï¼Ÿ</strong></p>
<blockquote>
<p>æè¿°: åœ¨Jenkins ç®¡ç†é¡µé¢ä¸­çš„ â€œConfigure Systemâ€ é¡µé¢ä¸­çš„ â€œGlobal Pipeline Librariesâ€ ä¸­è®¾ç½®å…¨å±€å…±äº«åº“ã€‚</p>
</blockquote>
<p><strong>Q: å¦‚ä½•ä½¿ç”¨å°è£…çš„ä»£ç åº“</strong></p>
<blockquote>
<p>ç­”: Jenkinsfile æ–‡ä»¶ä¸­éœ€è¦ä½¿ç”¨ @Library æ³¨è§£ï¼ŒæŒ‡å®šåº“çš„åå­—ã€‚å¦å¤–å…³äºä»£ç åº“çš„åŠ¨æ€åŠ è½½ã€ç‰ˆæœ¬ç®¡ç†å’Œæ£€ç´¢æ–¹å¼ç­‰ï¼Œè¯·è§å®˜ç½‘ã€‚</p>
</blockquote>
<p><strong>Q: å¦‚ä½•ç¼–å†™è‡ªå·±çš„ Jenkins å…±äº«åº“ï¼Œå…±äº«åº“ä¸­çš„å˜é‡ä½œç”¨åŸŸ?</strong></p>
<blockquote>
<p>ç­”: å…¶ä»–å…³äºå†™åº“çš„è®¿é—®æ­¥éª¤ã€å®šä¹‰å…¨å±€å˜é‡ è¯·è§å®˜ç½‘ã€‚</p>
</blockquote>
<p><br></p>
<h3 id="BlueOcean-ä»‹ç»"><a href="#BlueOcean-ä»‹ç»" class="headerlink" title="BlueOcean ä»‹ç»"></a>BlueOcean ä»‹ç»</h3><p><strong>Q: ä»€ä¹ˆæ˜¯BlueOcean?</strong></p>
<blockquote>
<p>A: BlueOcean é‡æ–°è€ƒè™‘äº† Jenkins çš„ç”¨æˆ·ä½“éªŒè€Œé‡æ–°è®¾ç½®UIç•Œé¢,ä»è€Œæ›´åŠ ç›´è§‚çš„å±•ç°Pipelineå„æµç¨‹æ‰§è¡Œæƒ…å†µ;<br>BlueOceanç”±Jenkins Pipelineè®¾è®¡ï¼Œä½†ä»ç„¶å…¼å®¹è‡ªç”±å¼å·¥ä½œï¼Œå‡å°‘äº†å›¢é˜Ÿæˆå‘˜çš„æ··ä¹±ï¼Œå¢åŠ äº†æ¸…æ™°åº¦ã€‚</p>
</blockquote>
<p><strong>Q: ä¸ºå•¥è¦ä½¿ç”¨BlueOcean?</strong></p>
<blockquote>
<p>è¿ç»­äº¤ä»˜ï¼ˆCDï¼‰Pipelineçš„å¤æ‚å¯è§†åŒ–ï¼Œå…è®¸å¿«é€Ÿå’Œç›´è§‚åœ°äº†è§£Pipelineçš„çŠ¶æ€ã€‚<br>Pipelineç¼–è¾‘å™¨é€šè¿‡å¼•å¯¼ç”¨æˆ·ç›´è§‚å’Œå¯è§†åŒ–çš„è¿‡ç¨‹åˆ›å»ºPipelineï¼Œä½¿åˆ›å»ºPipelineå¹³æ˜“è¿‘äººã€‚<br>ä¸ªæ€§åŒ–ï¼Œä»¥é€‚åº”å›¢é˜Ÿæ¯ä¸ªæˆå‘˜çš„è§’è‰²éœ€æ±‚ã€‚<br>éœ€è¦å¹²é¢„å’Œ/æˆ–å‡ºç°é—®é¢˜æ—¶ç¡®å®šç²¾åº¦ã€‚BlueOceanæ˜¾ç¤ºäº†Pipelineéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œä¾¿äºå¼‚å¸¸å¤„ç†å’Œæé«˜ç”Ÿäº§ç‡ã€‚<br>ç”¨äºåˆ†æ”¯å’Œæ‹‰å–è¯·æ±‚çš„æœ¬åœ°é›†æˆå¯ä»¥åœ¨GitHubå’ŒBitbucketä¸­ä¸å…¶ä»–äººè¿›è¡Œä»£ç åä½œæ—¶æœ€å¤§é™åº¦æé«˜å¼€å‘äººå‘˜çš„ç”Ÿäº§åŠ›ã€‚</p>
</blockquote>
<p><strong>Q: å¦‚ä½•å®‰è£…BlueOcean?</strong></p>
<blockquote>
<p>A: åŒæ ·æ˜¯åœ¨æ’ä»¶ä¸­æœç´¢ â€Blue Oceanâ€œ ä¸‹è½½å®‰è£…å³å¯<br>Blue Ocean - å¤–éƒ¨å·¥å…·é›†æˆ ç”¨æˆ·ç•Œé¢ - BlueOcean Aggregator  - 1.24.3     2 æœˆ 5 å¤© ago </p>
</blockquote>
<hr>
<h2 id="0x01-Pipeline-Syntax"><a href="#0x01-Pipeline-Syntax" class="headerlink" title="0x01 Pipeline Syntax"></a>0x01 Pipeline Syntax</h2><h3 id="0-Groovy-Basic-Syntax"><a href="#0-Groovy-Basic-Syntax" class="headerlink" title="(0) Groovy Basic Syntax"></a>(0) Groovy Basic Syntax</h3><p>æè¿°: æˆ‘ä»¬å‰é¢è¯´è¿‡ä¸ç®¡æ˜¯å£°æ˜å¼è¿˜æ˜¯è„šæœ¬å¼éƒ½æ˜¯åŸºäºGroovyè¯­è¨€,æ‰€ä»¥å­¦ä¹  Groovy åŸºç¡€çŸ¥è¯†æ˜¯å¿…é¡»çš„ã€‚</p>
<ul>
<li>1.è™½ç„¶GroovyåŒæ—¶æ”¯æŒé™æ€ç±»å‹å’ŒåŠ¨æ€ç±»å‹ï¼Œä½†æ˜¯åœ¨å®šä¹‰å˜é‡æ—¶ï¼Œåœ¨Groovyä¸­æˆ‘ä»¬ä¹ æƒ¯ä½¿ç”¨defå…³é”®å­—<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def x&#x3D;&quot;abc&quot;</span><br><span class="line">def y&#x3D;1</span><br></pre></td></tr></table></figure></li>
<li><p>2.ä¸åƒ Javaè¯­æ³•è¯­å¥,Groovyè¯­å¥æœ€åçš„åˆ†å·ä¸æ˜¯å¿…éœ€çš„ã€‚</p>
</li>
<li><p>3.Groovyä¸­çš„æ–¹æ³•è°ƒç”¨å¯ä»¥çœç•¥æ‹¬å·ï¼Œæ¯”å¦‚System.out.println â€œHello worldâ€ã€‚</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.out.println x</span><br><span class="line">println t</span><br></pre></td></tr></table></figure>
</li>
<li><p>4.æ”¯æŒå•å¼•å·ã€åŒå¼•å·ã€‚åŒå¼•å·æ”¯æŒæ’å€¼(å˜é‡)ï¼Œå•å¼•å·ä¸æ”¯æŒã€‚</p>
</li>
<li><p>5.æ”¯æŒä¸‰å¼•å·ã€‚ä¸‰å¼•å·åˆ†ä¸ºä¸‰å•å¼•å·å’Œä¸‰åŒå¼•å·ã€‚å®ƒä»¬éƒ½æ”¯æŒæ¢è¡Œï¼ŒåŒºåˆ«åœ¨äºåªæœ‰ä¸‰åŒå¼•å·æ”¯æŒæ’å€¼(å˜é‡)ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def var = <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">This is Variable!</span></span><br><span class="line"><span class="string">&lt;br&gt;</span></span><br><span class="line"><span class="string">Test defiend</span></span><br><span class="line"><span class="string">"</span><span class="string">""</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>6.æ”¯æŒå‡½æ•°ã€‚</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> getSecure(String Ticket_Token) &#123;</span><br><span class="line">  <span class="keyword">def</span> token = <span class="string">"Ticket Token is "</span> + Ticket_Token</span><br><span class="line">  <span class="keyword">return</span> token</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">println getSecure(<span class="string">"weiyigeek"</span>)  <span class="comment">//Ticket Token is weiyigeek</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>7.æ”¯æŒé—­åŒ…ã€‚</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// # é—­åŒ…çš„å®šä¹‰æ–¹æ³•ï¼š</span></span><br><span class="line"><span class="keyword">def</span> codeBlock = &#123;print <span class="string">"hello world!"</span>&#125;</span><br><span class="line"><span class="comment">// codeBlock() //</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// # é—­åŒ…çš„å¦ç±»ç”¨æ³•:</span></span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªstageå‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> stage(String name, closue) &#123;</span><br><span class="line">  println name</span><br><span class="line">  <span class="keyword">def</span> closue() &#123;</span><br><span class="line">    println <span class="string">"é—­åŒ…è°ƒç”¨çš„ closue function!"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">stage(<span class="string">"stage name"</span>,&#123;println <span class="string">"closue"</span>&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>8.æ”¯æŒç±»å®šä¹‰å’Œå®ä¾‹åŒ–ã€‚</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Greet</span> &#123;</span></span><br><span class="line">  <span class="keyword">def</span> name</span><br><span class="line">  Greet(who) &#123; name = who[<span class="number">0</span>].toUpperCase() + who[<span class="number">1.</span>.<span class="number">-1</span>] &#125;</span><br><span class="line">  <span class="keyword">def</span> salute() &#123; println <span class="string">"Hello "</span> + name + <span class="string">"!"</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">g = <span class="keyword">new</span> Greet(<span class="string">'world'</span>)  <span class="comment">// create object</span></span><br><span class="line">g.salute()   <span class="comment">// Hello World!</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<h3 id="1-Scripted-Pipeline-Syntax"><a href="#1-Scripted-Pipeline-Syntax" class="headerlink" title="(1) Scripted Pipeline Syntax"></a>(1) Scripted Pipeline Syntax</h3><p>æè¿°: Scripted Pipeline æ˜¯åŸºäº groovy çš„ä¸€ç§ <code>DSL</code> è¯­è¨€ç›¸æ¯”äº Declarative pipelineï¼Œå®ƒä¸ºjenkinsç”¨æˆ·æä¾›äº†æ›´å·¨å¤§çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
<p><strong>Scripted Pipeline åŸºç¡€ç»“æ„è¯´æ˜:</strong></p>
<ul>
<li>Nodeï¼šèŠ‚ç‚¹ï¼Œä¸€ä¸ª Node å°±æ˜¯ä¸€ä¸ª Jenkins èŠ‚ç‚¹ï¼ŒMaster æˆ–è€… Agentï¼Œæ˜¯æ‰§è¡Œ Step çš„å…·ä½“è¿è¡Œç¯å¢ƒï¼Œæ¯”å¦‚æˆ‘ä»¬ä¹‹å‰åŠ¨æ€è¿è¡Œçš„ Jenkins Slave å°±æ˜¯ä¸€ä¸ª Node èŠ‚ç‚¹</li>
<li>Stageï¼šé˜¶æ®µï¼Œä¸€ä¸ª Pipeline å¯ä»¥åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ª Stageï¼Œæ¯ä¸ª Stage ä»£è¡¨ä¸€ç»„æ“ä½œï¼Œæ¯”å¦‚ï¼šBuildã€Testã€Deployï¼ŒStage æ˜¯ä¸€ä¸ªé€»è¾‘åˆ†ç»„çš„æ¦‚å¿µï¼Œå¯ä»¥è·¨å¤šä¸ª Node</li>
<li>Stepï¼šæ­¥éª¤ï¼ŒStep æ˜¯æœ€åŸºæœ¬çš„æ“ä½œå•å…ƒï¼Œå¯ä»¥æ˜¯æ‰“å°ä¸€å¥è¯ï¼Œä¹Ÿå¯ä»¥æ˜¯æ„å»ºä¸€ä¸ª Docker é•œåƒï¼Œç”±å„ç±» Jenkins æ’ä»¶æä¾›ï¼ŒÂ·<code>æ¯”å¦‚å‘½ä»¤ï¼šsh &#39;make&#39;ï¼Œå°±ç›¸å½“äºæˆ‘ä»¬å¹³æ—¶ shell ç»ˆç«¯ä¸­æ‰§è¡Œ make å‘½ä»¤ä¸€æ ·ã€‚</code> (æ³¨æ„:æ­¤å¤„Stepä¸æ˜¯cripted Pipelineå…³é”®å­—è€Œæ˜¯ä»£è¡¨ä¸€æ¡æ‰§è¡Œè¯­å¥)</li>
</ul>
<p><strong>Scripted Pipeline è¯­æ³•ç¤ºä¾‹:</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Jenkinsfile (Scripted Pipeline)</span></span><br><span class="line"><span class="comment">// #ç»“æ„1</span></span><br><span class="line">node &#123;</span><br><span class="line">    <span class="comment">// @å˜é‡å®šä¹‰</span></span><br><span class="line">    <span class="keyword">def</span> mvnHome</span><br><span class="line">    <span class="comment">// #ç»“æ„2</span></span><br><span class="line">    stage(<span class="string">'Preparation'</span>) &#123;</span><br><span class="line">      <span class="comment">// # ç»“æ„3 - å®ƒå°±æ˜¯ Step åŸºæœ¬æ“ä½œå•å…ƒ</span></span><br><span class="line">      echo <span class="string">"Scripted Pipeline"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Tips : æ³¨é‡Šï¼ˆCommentsï¼‰å’ŒJavaä¸€æ ·ï¼Œ<code>æ”¯æŒå•è¡Œï¼ˆä½¿ç”¨//ï¼‰ã€å¤šè¡Œï¼ˆ/* */ï¼‰å’Œæ–‡æ¡£æ³¨é‡Šï¼ˆä½¿ç”¨/** */ï¼‰</code>ã€‚</p>
<p><br></p>
<h4 id="Hello-World-å®è·µ"><a href="#Hello-World-å®è·µ" class="headerlink" title="Hello-World å®è·µ"></a>Hello-World å®è·µ</h4><p>Step 1.åœ¨Jenkinsçš„WEB UI -&gt; æ–°å»ºä»»åŠ¡ -&gt; simple-pipeline-demo ä»»åŠ¡åç§° -&gt; é€‰æ‹©æµæ°´çº¿ -&gt; ç¡®å®š</p>
<p>Step 2.åœ¨ Dashboard -&gt; simple-pipeline-demo -&gt; æµæ°´çº¿ -&gt; å¯ä»¥é€‰æ‹©pipeline scriptï¼ˆæˆ–è€…ç›´æ¥ä»scmæ‹‰å–Jenkinsfileï¼‰æ­¤å¤„ä¸ºäº†æ¼”ç¤ºåªæ˜¯ç®€å•çš„äº†è§£ -&gt; åº”ç”¨ä¿å­˜</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Scripted Pipeline è„šæœ¬å¼</span></span><br><span class="line">node &#123;</span><br><span class="line">  stage(<span class="string">'Clone'</span>) &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"1.Clone Stage"</span></span><br><span class="line">  &#125;</span><br><span class="line">  stage(<span class="string">'Test'</span>) &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"2.Test Stage"</span></span><br><span class="line">  &#125;</span><br><span class="line">  stage(<span class="string">'Build'</span>) &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"3.Build Stage"</span></span><br><span class="line">  &#125;</span><br><span class="line">  stage(<span class="string">'Deploy'</span>) &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"4. Deploy Stage"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=2.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineè¯­æ³•å…¥é—¨å­¦ä¹  href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210114103627.png" target="_blank" title="WeiyiGeek.Create PipeLine æµæ°´çº¿é¡¹ç›®" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210114103627.png" alt="WeiyiGeek.Create PipeLine æµæ°´çº¿é¡¹ç›®" title="" class=""></a>
                <p>WeiyiGeek.Create PipeLine æµæ°´çº¿é¡¹ç›®</p>
            </figure>
<p>Step 3.ç«‹å³æ„å»º -&gt; æŸ¥çœ‹é˜¶æ®µè§†å›¾ (æˆ–è€…åˆ©ç”¨blue-Oceanæ’ä»¶)è¿›è¡Œæ›´åŠ ç›´è§‚çš„æŸ¥çœ‹ -&gt;  è§‚å¯Ÿæ„å»ºçš„æ—¥å¿—ä¿¡æ¯<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Started by user admin</span><br><span class="line">Running <span class="keyword">in</span> Durability level: MAX_SURVIVABILITY</span><br><span class="line">[Pipeline] Start of Pipeline</span><br><span class="line">[Pipeline] node</span><br><span class="line">Running on Jenkins <span class="keyword">in</span> /var/lib/jenkins/workspace/simple-pipeline-demo</span><br><span class="line">[Pipeline] &#123;</span><br><span class="line">[Pipeline] stage</span><br><span class="line">[Pipeline] &#123; (Clone)</span><br><span class="line">[Pipeline] <span class="built_in">echo</span></span><br><span class="line">1.Clone Stage</span><br><span class="line">[Pipeline] &#125;</span><br><span class="line">[Pipeline] // stage</span><br><span class="line">[Pipeline] stage</span><br><span class="line">[Pipeline] &#123; (Test)</span><br><span class="line">[Pipeline] <span class="built_in">echo</span></span><br><span class="line">2.Test Stage</span><br><span class="line">[Pipeline] &#125;</span><br><span class="line">[Pipeline] // stage</span><br><span class="line">[Pipeline] stage</span><br><span class="line">[Pipeline] &#123; (Build)</span><br><span class="line">[Pipeline] <span class="built_in">echo</span></span><br><span class="line">3.Build Stage</span><br><span class="line">[Pipeline] &#125;</span><br><span class="line">[Pipeline] // stage</span><br><span class="line">[Pipeline] stage</span><br><span class="line">[Pipeline] &#123; (Deploy)</span><br><span class="line">[Pipeline] <span class="built_in">echo</span></span><br><span class="line">4. Deploy Stage</span><br><span class="line">[Pipeline] &#125;</span><br><span class="line">[Pipeline] // stage</span><br><span class="line">[Pipeline] &#125;</span><br><span class="line">[Pipeline] // node</span><br><span class="line">[Pipeline] End of Pipeline</span><br><span class="line">Finished: SUCCESS</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=2.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineè¯­æ³•å…¥é—¨å­¦ä¹  href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210114104250.png" target="_blank" title="WeiyiGeek.jenkinsæµæ°´çº¿æ‰§è¡Œç»“æœä¸blue-Ocean" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210114104250.png" alt="WeiyiGeek.jenkinsæµæ°´çº¿æ‰§è¡Œç»“æœä¸blue-Ocean" title="" class=""></a>
                <p>WeiyiGeek.jenkinsæµæ°´çº¿æ‰§è¡Œç»“æœä¸blue-Ocean</p>
            </figure>
<p>PS : ä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨BlueOceanæˆ–è€…jenkinsåŸç”Ÿçš„æµæ°´æ§åˆ¶å°å±•ç¤ºä¸¤åˆ™å¹¶ä¸å†²çªï¼Œä½†æ˜¯éœ€è¦æ³¨æ„Scripted pipelineä¸å®Œå…¨å…¼å®¹<code>BlueOcean</code>;</p>
<p><br></p>
<h4 id="å˜é‡å-Identifiers"><a href="#å˜é‡å-Identifiers" class="headerlink" title="å˜é‡å-Identifiers"></a>å˜é‡å-Identifiers</h4><p>æè¿°: æ ‡è¯†ç¬¦ï¼ˆIdentifiersï¼‰ä¹Ÿç§°å˜é‡å, <code>ä»¥å­—æ¯ã€ç¾å…ƒç¬¦å·$æˆ–ä¸‹åˆ’çº¿_å¼€å§‹</code>ï¼Œä¸èƒ½ä»¥æ•°å­—å¼€å§‹ã€‚<br>ä¾‹å¦‚ä»¥ä¸‹æ˜¯å¯ç”¨çš„æ ‡è¯†ç¬¦ï¼š<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> name</span><br><span class="line"><span class="keyword">def</span> item3</span><br><span class="line"><span class="keyword">def</span> with_underscore</span><br><span class="line"><span class="keyword">def</span> $dollarStart</span><br></pre></td></tr></table></figure><br>ä»¥ä¸‹æ˜¯ä¸å¯ç”¨çš„æ ‡è¯†ç¬¦ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="number">3</span>tier <span class="comment">// ä¸èƒ½ä»¥æ•°å­—å¼€å§‹</span></span><br><span class="line"><span class="keyword">def</span> a+b <span class="comment">// "+"å·æ˜¯éæ³•å­—ç¬¦</span></span><br><span class="line">def a#b // #å·ä¹Ÿä¸æ˜¯å¯ç”¨çš„å­—ç¬¦</span><br></pre></td></tr></table></figure></p>
<p>Tips : åœ¨ç‚¹å·åæ˜¯å¯ä»¥ä½¿ç”¨å…³é”®å­—ä½œä¸ºæ ‡è¯†ç¬¦æ—¶äº§ç”Ÿ<code>org.codehaus.groovy.control.MultipleCompilationErrorsException: startup failed:</code>é”™è¯¯;<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">foo.<span class="keyword">as</span></span><br><span class="line">foo.<span class="keyword">assert</span></span><br><span class="line">foo.<span class="keyword">break</span></span><br><span class="line">foo.<span class="keyword">case</span></span><br><span class="line">foo.<span class="keyword">catch</span></span><br></pre></td></tr></table></figure><br><br></p>
<h4 id="å­—ç¬¦ä¸²-String"><a href="#å­—ç¬¦ä¸²-String" class="headerlink" title="å­—ç¬¦ä¸²-String"></a>å­—ç¬¦ä¸²-String</h4><p>æè¿°: åœ¨Groovyä¸­å­—ç¬¦ä¸²æœ‰ä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯JavaåŸç”Ÿçš„<code>java.lang.String</code>ï¼›å¦ä¸€ç§æ˜¯<code>groovy.lang.GString</code>ï¼Œåˆå«æ’å€¼å­—ç¬¦ä¸²(interpolated strings)ã€‚</p>
<ul>
<li><p>(1) å•å¼•å·å­—ç¬¦ä¸²ï¼ˆSingle quoted stringï¼‰<br>åœ¨Groovyä¸­ï¼Œä½¿ç”¨å•å¼•å·æ‹¬ä½çš„å­—ç¬¦ä¸²å°±æ˜¯java.lang.Stringï¼Œä¸æ”¯æŒæ’å€¼ï¼š</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> name = <span class="string">'yjiyjgie'</span></span><br><span class="line">println name.<span class="keyword">class</span> <span class="comment">// class java.lang.String</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>(2) ä¸‰å•å¼•å·å­—ç¬¦ä¸²ï¼ˆTriple single quoted stringï¼‰<br>ä½¿ç”¨ä¸‰å•å¼•å·æ‹¬ä½å­—ç¬¦ä¸²æ”¯æŒå¤šè¡Œï¼Œä¹Ÿæ˜¯java.lang.Stringå®ä¾‹ï¼Œåœ¨ç¬¬ä¸€ä¸ªâ€™â€˜â€™èµ·å§‹å¤„åŠ ä¸€ä¸ªåæ–œæ \å¯ä»¥åœ¨æ–°ä¸€è¡Œå¼€å§‹æ–‡æœ¬ï¼š</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> strippedFirstNewline = <span class="string">'''line one</span></span><br><span class="line"><span class="string">line two</span></span><br><span class="line"><span class="string">line three</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ä»¥å†™æˆä¸‹é¢è¿™ç§å½¢å¼ï¼Œå¯è¯»æ€§æ›´å¥½</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> strippedFirstNewline = <span class="string">'''\</span></span><br><span class="line"><span class="string">line one</span></span><br><span class="line"><span class="string">line two</span></span><br><span class="line"><span class="string">line three</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>(3) åŒå¼•å·å­—ç¬¦ä¸²ï¼ˆDouble quoted stringï¼‰<br>å¦‚æœåŒå¼•å·æ‹¬ä½çš„å­—ç¬¦ä¸²ä¸­æ²¡æœ‰æ’å€¼è¡¨è¾¾å¼ï¼ˆinterpolated expressionï¼‰ï¼Œé‚£å®ƒå°±æ˜¯java.lang.Stringï¼›å¦‚æ˜¯æœ‰æ’å€¼è¡¨è¾¾å¼ï¼Œé‚£å®ƒå°±æ˜¯groovy.lang.GStringï¼š</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> normalStr = <span class="string">"yjiyjige"</span> <span class="comment">// è¿™æ˜¯ä¸€ä¸ªjava.lang.String</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> interpolatedStr = <span class="string">"my name is $&#123;normalStr&#125;"</span> <span class="comment">// è¿™æ˜¯ä¸€ä¸ªgroovy.lang.GString</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>(4) å­—ç¬¦ä¸²æ’å€¼ï¼ˆString interpolationï¼‰<br>åœ¨Groovyæ‰€æœ‰çš„å­—ç¬¦ä¸²å­—é¢é‡è¡¨ç¤ºä¸­ï¼Œé™¤äº†å•å¼•å·å­—ç¬¦ä¸²å’Œä¸‰å•å¼•å·å­—ç¬¦ä¸²ï¼Œå…¶ä»–å½¢å¼éƒ½æ”¯æŒå­—ç¬¦ä¸²æ’å€¼ã€‚å­—ç¬¦ä¸²æ’å€¼ä¹Ÿå³å°†å ä½è¡¨è¾¾å¼ä¸­çš„ç»“æœæœ€ç»ˆæ›¿æ¢åˆ°å­—ç¬¦ä¸²ç›¸åº”çš„ä½ç½®ä¸­ï¼š</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> name = <span class="string">'Guillaume'</span>          <span class="comment">// a plain string</span></span><br><span class="line"><span class="keyword">def</span> greeting = <span class="string">"Hello $&#123;name&#125;"</span> <span class="comment">// nameå˜é‡çš„å€¼ä¼šè¢«æ›¿æ¢è¿›å»</span></span><br><span class="line"><span class="keyword">assert</span> greeting.toString()  == <span class="string">'Hello Guillaume'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å½“ä½¿ç”¨ç‚¹å·è¡¨è¾¾å¼æ—¶ï¼Œå¯ä»¥åªç”¨$ä»£æ›¿$&#123;&#125;ï¼š</span></span><br><span class="line"><span class="keyword">def</span> person = [<span class="string">name:</span> <span class="string">'Guillaume'</span>, <span class="string">age:</span> <span class="number">36</span>]</span><br><span class="line">println <span class="string">"$person.name is $person.age years old"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>è¡¥å……è¯´æ˜:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ’å€¼å ä½ç¬¦ä¸­è¿˜æ”¯æŒé—­åŒ…ï¼Œè€Œé—­åŒ…çš„ä¸€ä¸ªå¥½å¤„æ˜¯æƒ°æ€§æ±‚å€¼ï¼ˆlazy evaluationï¼‰ï¼š</span></span><br><span class="line"><span class="keyword">def</span> number = <span class="number">1</span></span><br><span class="line"><span class="keyword">def</span> eagerGString = <span class="string">"value == $&#123;number&#125;"</span> <span class="comment">// æ™®é€šå½¢å¼</span></span><br><span class="line"><span class="keyword">def</span> lazyGString = <span class="string">"value == $&#123;-&gt; number&#125;"</span> <span class="comment">// è¿™æ˜¯ä¸€ä¸ªé—­åŒ…</span></span><br><span class="line"></span><br><span class="line">println eagerGString <span class="comment">// == "value == 1"</span></span><br><span class="line">println lazyGString  <span class="comment">// == "value == 1"</span></span><br><span class="line"></span><br><span class="line">number = <span class="number">2</span></span><br><span class="line">println eagerGString <span class="comment">// == "value == 1" // eagerGStringå·²ç»è¢«å›ºå®šä¸‹æ¥äº†</span></span><br><span class="line">println lazyGString  <span class="comment">// == "value == 2" // lazyGStringçš„å€¼ä¼šè¢«é‡æ–°è®¡ç®—</span></span><br></pre></td></tr></table></figure></p>
<p>Tips: GStringä¸Stringçš„hashCodeæ˜¯ä¸ä¸€æ ·çš„å³ä½¿ä»–ä»¬æœ€ç»ˆç»“æœä¸€æ ·ã€‚æ‰€ä»¥åœ¨Mapä¸­ä¸åº”è¯¥ç”¨GStringå»åšå…ƒç´ çš„Keyï¼Œè€Œåˆä½¿ç”¨æ™®é€šçš„Stringå»å–å€¼;<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å½“ä¸€ä¸ªæ–¹æ³•çš„éœ€è¦ä¸€ä¸ªjava.lang.Stringå˜é‡ï¼Œè€Œæˆ‘ä»¬ä¼ é€’çš„æ˜¯ä¸€ä¸ªgroovy.lang.GStringå®ä¾‹æ—¶ï¼ŒGStringçš„toStringæ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ï¼Œçœ‹èµ·æ¥åƒæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†ä¸€ä¸ªGStringèµ‹å€¼ç»™ä¸€ä¸ªStringå˜é‡ä¸€æ ·ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> key = <span class="string">"a"</span></span><br><span class="line"><span class="keyword">def</span> m = [<span class="string">"$&#123;key&#125;"</span>: <span class="string">"letter $&#123;key&#125;"</span>] <span class="comment">// keyç±»å‹æ˜¯ä¸€ä¸ªGString</span></span><br><span class="line"><span class="keyword">assert</span> m[<span class="string">"a"</span>] <span class="comment">// == null // ç”¨ä¸€ä¸ªæ™®é€šStringç±»å‹çš„keyå»å–å€¼å–ä»£çš„å€¼ä¸ºnull è€Œå¹¶é letter a</span></span><br></pre></td></tr></table></figure></p>
<p>Tips : å¯¹äºè¾“å‡ºå¯¹è±¡å¸¦æœ‰æŒ‡å®šæ–¹æ³•æ—¶å¦‚æœ‰éœ€è¦æ‹¼æ¥å…¶å®ƒå­—ç¬¦ä¸²éœ€è¦ä»¥<code>${å¯¹è±¡.æ–¹æ³•}</code>è¿›è¡ŒåŒ…å«;<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> number = <span class="number">3.14</span></span><br><span class="line">println <span class="string">"$number.toString()"</span> <span class="comment">// è¿™é‡Œä¼šæŠ¥å¼‚å¸¸,å› ä¸ºç›¸å½“äº"$&#123;number.toString&#125;()"</span></span><br><span class="line">println <span class="string">"$&#123;number.toString()&#125; -- Other Stringã€"</span> <span class="comment">// è¿™æ ·å°±æ­£å¸¸äº†</span></span><br></pre></td></tr></table></figure><br><br></p>
<h4 id="æ•°å­—-Numbers"><a href="#æ•°å­—-Numbers" class="headerlink" title="æ•°å­— - Numbers"></a>æ•°å­— - Numbers</h4><p>æè¿°: å½“ä½¿ç”¨defæŒ‡æ˜æ•´æ•°å­—é¢é‡æ—¶ï¼Œå˜é‡çš„ç±»å‹ä¼šæ ¹æ®æ•°å­—çš„å¤§å°è‡ªåŠ¨è°ƒæ•´ï¼š<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœè¦å¼ºåˆ¶æŒ‡æ˜ä¸€ä¸ªæ•°å­—çš„å­—é¢é‡ç±»å‹ï¼Œå¯ä»¥ç»™å­—é¢é‡åŠ ä¸Šç±»å‹åç¼€ï¼š</span></span><br><span class="line">BigInteger ä½¿ç”¨Gæˆ–g</span><br><span class="line">Long ä½¿ç”¨Læˆ–l</span><br><span class="line">Integer ä½¿ç”¨Iæˆ–i</span><br><span class="line">BigDecimal ä½¿ç”¨Gæˆ–g</span><br><span class="line">Double ä½¿ç”¨Dæˆ–d</span><br><span class="line">Float ä½¿ç”¨Fæˆ–f</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> a = <span class="number">1</span></span><br><span class="line"><span class="keyword">assert</span> a <span class="keyword">instanceof</span> Integer</span><br><span class="line"></span><br><span class="line"><span class="comment">// Integer.MAX_VALUE</span></span><br><span class="line"><span class="keyword">def</span> b = <span class="number">2147483647</span></span><br><span class="line"><span class="keyword">assert</span> b <span class="keyword">instanceof</span> Integer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Integer.MAX_VALUE + 1</span></span><br><span class="line"><span class="keyword">def</span> c = <span class="number">2147483648</span></span><br><span class="line"><span class="keyword">assert</span> c <span class="keyword">instanceof</span> Long</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Long.MAX_VALUE</span></span><br><span class="line"><span class="keyword">def</span> d = <span class="number">9223372036854775807</span></span><br><span class="line"><span class="keyword">assert</span> d <span class="keyword">instanceof</span> Long</span><br><span class="line"></span><br><span class="line"><span class="comment">// Long.MAX_VALUE + 1</span></span><br><span class="line"><span class="keyword">def</span> e = <span class="number">9223372036854775808</span></span><br><span class="line"><span class="keyword">assert</span> e <span class="keyword">instanceof</span> BigInteger</span><br></pre></td></tr></table></figure><br>Tips : ä¸ºäº†ç²¾ç¡®åœ°è®¡ç®—å°æ•°ï¼Œåœ¨Groovyä¸­ä½¿ç”¨defå£°æ˜çš„å°æ•°æ˜¯BigDecimalç±»å‹çš„ï¼š<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> decimal = <span class="number">123.456</span></span><br><span class="line">println decimal.getClass() <span class="comment">// class java.math.BigDecimal</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="åˆ—è¡¨-List"><a href="#åˆ—è¡¨-List" class="headerlink" title="åˆ—è¡¨-List"></a>åˆ—è¡¨-List</h4><p>æè¿°ï¼šé»˜è®¤æƒ…å†µä¸‹Groovyçš„åˆ—è¡¨ä½¿ç”¨çš„æ˜¯<code>java.util.ArrayList</code>ï¼Œç”¨ä¸­æ‹¬å·[]æ‹¬ä½ï¼Œä½¿ç”¨é€—å·åˆ†éš”ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  å®šä¹‰ä¸€ä¸ª list éšå¼</span></span><br><span class="line">def numbers = [1, 2, 3]</span><br><span class="line">println numbers.getClass() <span class="comment"># // class java.util.ArrayList</span></span><br><span class="line"></span><br><span class="line">def arrayList = [1, 2, 3]  <span class="comment"># // é»˜è®¤ç±»å‹</span></span><br><span class="line"><span class="comment"># assert arrayList instanceof java.util.ArrayList</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœè¦ä½¿ç”¨å…¶å®ƒç±»å‹çš„åˆ—è¡¨ï¼ˆå¦‚ï¼šLinkedListï¼‰å¯ä»¥ä½¿ç”¨asæ“ä½œç¬¦æˆ–æ˜¾å¼åˆ†é…ç»™ä¸€ä¸ªæŒ‡å®šç±»å‹çš„å˜é‡ï¼š</span></span><br><span class="line">def linkedList = [2, 3, 4] as LinkedList <span class="comment"># // ä½¿ç”¨asæ“ä½œç¬¦</span></span><br><span class="line"><span class="comment"># assert linkedList instanceof java.util.LinkedList</span></span><br><span class="line"></span><br><span class="line">LinkedList otherLinked = [3, 4, 5]         <span class="comment"># // æ˜¾å¼æŒ‡æ˜ç±»å‹</span></span><br><span class="line"><span class="comment"># assert otherLinked instanceof java.util.LinkedList</span></span><br></pre></td></tr></table></figure></p>
<p>Groovyé‡è½½äº†åˆ—è¡¨çš„[]å’Œ&lt;&lt;æ“ä½œç¬¦ï¼Œå¯ä»¥é€šè¿‡List[index]è®¿é—®æŒ‡å®šä½ç½®å…ƒç´ ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>List &lt;&lt; element</code>å¾€åˆ—è¡¨æœ«å°¾æ·»åŠ å…ƒç´ ï¼š<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªlist</span></span><br><span class="line"><span class="keyword">def</span> letters = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>]</span><br><span class="line"><span class="keyword">assert</span> letters[<span class="number">0</span>]  <span class="comment">//  == 'a'</span></span><br><span class="line"><span class="keyword">assert</span> letters[<span class="number">1</span>]  <span class="comment">// == 'b'</span></span><br><span class="line"><span class="keyword">assert</span> letters[<span class="number">-1</span>] <span class="comment">// == 'd' ä»åé¢è®¿é—® å€’æ•°ç¬¬ä¸€ä¸ª</span></span><br><span class="line"><span class="keyword">assert</span> letters[<span class="number">-2</span>] <span class="comment">// == 'c' // ä»åé¢è®¿é—® å€’æ•°ç¬¬äºŒä¸ª</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ƒç´ ä¿®æ”¹</span></span><br><span class="line">letters[<span class="number">2</span>] = <span class="string">'C'</span>    </span><br><span class="line"><span class="keyword">assert</span> letters[<span class="number">2</span>]   <span class="comment">//  == 'C'</span></span><br><span class="line"></span><br><span class="line">letters &lt;&lt; <span class="string">'e'</span> <span class="comment">// å¾€æœ€åé¢æ·»åŠ å…ƒç´ </span></span><br><span class="line"><span class="keyword">assert</span> letters[<span class="number">4</span>] == <span class="string">'e'</span></span><br><span class="line"><span class="keyword">assert</span> letters[<span class="number">-1</span>] == <span class="string">'e'</span></span><br><span class="line"><span class="keyword">assert</span> letters[<span class="number">1</span>, <span class="number">3</span>] == [<span class="string">'b'</span>, <span class="string">'d'</span>]      <span class="comment">// æå–æŒ‡å®šå…ƒç´ </span></span><br><span class="line"><span class="keyword">assert</span> letters[<span class="number">2.</span><span class="number">.4</span>] == [<span class="string">'C'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>] <span class="comment">// æ”¯æŒèŒƒå›´ï¼ˆrangesï¼‰æ“ä½œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// äºŒç»´åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">def</span> multi = [[<span class="number">0</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">3</span>]]</span><br><span class="line"><span class="keyword">assert</span> multi[<span class="number">1</span>][<span class="number">0</span>] == <span class="number">2</span></span><br></pre></td></tr></table></figure></p>
<p><strong>å¸¸ç”¨æ–¹æ³•</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> mylist = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="string">"weiyigeek.top"</span>,<span class="string">"devops"</span>,<span class="string">"jenkins"</span>]</span><br><span class="line"> </span><br><span class="line"><span class="comment">// é€šè¿‡ç´¢å¼•è·å–åˆ—è¡¨å…ƒç´ </span></span><br><span class="line">println(numList[<span class="number">5</span>])  <span class="comment">// weiyigeek.top</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ—è¡¨çš„é•¿åº¦</span></span><br><span class="line">println(mylist.size())</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¡ç®—åˆ—è¡¨ä¸­å…ƒç´ å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line">println(numList.count(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­å…ƒç´ æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">println(mylist.isEmpty())</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ—è¡¨å…ƒç´ å¢åˆ </span></span><br><span class="line"><span class="comment">// + æ“ä½œç¬¦æ€§èƒ½æ¯”è¾ƒä½,ä»è€Œå»ºè®®ä½¿ç”¨&lt;&lt;</span></span><br><span class="line"><span class="keyword">def</span> newlist = mylist.add(<span class="string">"gitlab"</span>)</span><br><span class="line">println(mylist + <span class="string">"jenkins"</span>)</span><br><span class="line">println(mylist - <span class="string">"devops"</span>)</span><br><span class="line">println(mylist &lt;&lt; <span class="string">"java"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ—è¡¨å…ƒç´ ç§»é™¤</span></span><br><span class="line">println(mylist.remove(<span class="string">"java"</span>)) <span class="comment">// ç§»é™¤æŒ‡å®šå…ƒç´ ,æˆåŠŸåˆ™è¿”å›True</span></span><br><span class="line">println(mylist.removeAll())</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•´æ•°å–æœ€å€¼ã€æ±‚å’Œ</span></span><br><span class="line">println(mylist.min())</span><br><span class="line">println(mylist.max())</span><br><span class="line">println(mylist.sum())</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ—è¡¨å»é‡</span></span><br><span class="line">println(mylist.unique())</span><br><span class="line"> </span><br><span class="line"><span class="comment">// åˆ—è¡¨åè½¬</span></span><br><span class="line">println(mylist.reverse())</span><br><span class="line"> </span><br><span class="line"><span class="comment">// åˆ—è¡¨æ’åº</span></span><br><span class="line">println(mylist.sort())</span><br><span class="line"> </span><br><span class="line"><span class="comment">// å–äº¤é›†ã€åˆ¤æ–­æ˜¯å¦æœ‰äº¤é›†</span></span><br><span class="line">println(mylist.intersect([<span class="number">2</span>,<span class="number">3</span>]))</span><br><span class="line">println(mylist.disjoint([<span class="number">2</span>,<span class="number">3</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­åˆ—è¡¨æ˜¯å¦åŒ…å«å…ƒç´ </span></span><br><span class="line">println(mylist.contains(<span class="string">"devops"</span>))</span><br><span class="line"><span class="comment">// æˆ–è€…ä½¿ç”¨inå…³é”®å­—</span></span><br><span class="line"><span class="keyword">def</span> isContains = <span class="string">'devops'</span> <span class="keyword">in</span> strList</span><br><span class="line">println(isContains)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ—è¡¨æ‹¼æ¥æ’å…¥åˆ°ä¸­é—´</span></span><br><span class="line">println(mylist.join(<span class="string">"geek"</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ—è¡¨å…‹éš†</span></span><br><span class="line"><span class="keyword">def</span> list = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]</span><br><span class="line"><span class="keyword">def</span> newlist = list.clone()</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå¹¶åµŒå¥—åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">def</span> mylist = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,[<span class="number">4</span>,<span class="number">5</span>],<span class="number">5</span>,<span class="string">"weiyigeek.top"</span>,<span class="string">"devops"</span>,<span class="string">"jenkins"</span>]</span><br><span class="line">println(mylist.flatten())</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰©å±•åˆ—è¡¨å®šä¹‰æ–¹å¼</span></span><br><span class="line">String[] stus = [<span class="string">"Weiyi"</span>, <span class="string">"Geek"</span>,<span class="string">"Top"</span>]</span><br><span class="line"><span class="keyword">def</span> numList = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">6</span>] <span class="keyword">as</span> <span class="keyword">int</span>[]</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†listé›†åˆé€šè¿‡è°ƒç”¨collect()æŠŠlistä¸­çš„å€¼*2æ„æˆä¸€ä¸ªæ–°çš„é›†åˆï¼Œæ„æˆçš„æ–°é›†åˆæ˜¯[2,4,6]</span></span><br><span class="line"><span class="keyword">def</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">def</span> newList = list.collect &#123; it * <span class="number">2</span> &#125;</span><br><span class="line"><span class="keyword">def</span> newList = list*.multiply(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŠŠå…ƒç´ é‡å¤çš„å¤åˆ¶å‡ æ¬¡</span></span><br><span class="line"><span class="keyword">def</span> list = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="keyword">def</span> newList = list*<span class="number">3</span></span><br><span class="line"><span class="keyword">def</span> newList = list.multiply(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨findAll()æ‰¾åˆ°æ‰€æœ‰åŒ¹é…çš„å…ƒç´ </span></span><br><span class="line">println(list.findAll&#123; it &gt; <span class="number">1</span> &#125;)  <span class="comment">// [2,3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­é›†åˆä¸­çš„å€¼æ˜¯å¦éƒ½å°äº5(ä¸)</span></span><br><span class="line"><span class="keyword">def</span> isTrue = list.every &#123; it &lt; <span class="number">5</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­é›†åˆä¸­çš„å€¼æ˜¯å¦å­˜åœ¨å°äº5(æˆ–)</span></span><br><span class="line"><span class="keyword">def</span> isTrue = list.any &#123; it &lt; <span class="number">5</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨inject(index) æ–¹æ³• é›†åˆä¸­å…ƒç´ ç›¸åŠ åå†åŠ index</span></span><br><span class="line"><span class="keyword">def</span> list = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>]</span><br><span class="line"><span class="keyword">def</span> num = list.inject(<span class="number">93</span>)&#123; count, item -&gt; count + item &#125;</span><br><span class="line">println (num) <span class="comment">// 100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨findIndexOf()æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå…ƒç´ åŒ¹é…æ ‡å‡†çš„ç´¢å¼•</span></span><br><span class="line"><span class="keyword">def</span> strList =  [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>]</span><br><span class="line"><span class="keyword">def</span> index =  strList.findIndexOf &#123;</span><br><span class="line">  it <span class="keyword">in</span> [<span class="string">'c'</span>, <span class="string">'e'</span>, <span class="string">'g'</span>]</span><br><span class="line">&#125;</span><br><span class="line">println(index)  <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨indexOf()æŸ¥æ‰¾é›†åˆæŸä¸ªå€¼å¯¹åº”çš„ä¸‹æ ‡å€¼</span></span><br><span class="line"><span class="keyword">def</span> index =  strList.indexOf(<span class="string">'c'</span>)  </span><br><span class="line">println(index)  <span class="comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°å°±è¿”å›-1å¦åˆ™è¿”å›ä¸‹æ ‡å€¼</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="å­—å…¸-Maps"><a href="#å­—å…¸-Maps" class="headerlink" title="å­—å…¸ - Maps"></a>å­—å…¸ - Maps</h4><p>æè¿°: Groovyä½¿ç”¨ä¸­æ‹¬å·[]æ¥å®šä¹‰å­—å…¸ï¼Œå…ƒç´ éœ€è¦åŒ…å«keyå’Œvalueä½¿ç”¨å†’å·åˆ†éš”ï¼Œå…ƒç´ ä¸å…ƒç´ ä¹‹é—´ç”¨é€—å·åˆ†éš”ï¼š<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// keyéƒ¨åˆ†å…¶å®æ˜¯å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="keyword">def</span> colors = [<span class="string">red:</span> <span class="string">'#FF0000'</span>, <span class="string">green:</span> <span class="string">'#00FF00'</span>, <span class="string">blue:</span> <span class="string">'#0000FF'</span>]</span><br><span class="line"><span class="keyword">assert</span> colors[<span class="string">'red'</span>] == <span class="string">'#FF0000'</span> <span class="comment">// ä½¿ç”¨ä¸­æ‹¬å·è®¿é—®</span></span><br><span class="line"><span class="keyword">assert</span> colors.green == <span class="string">'#00FF00'</span> <span class="comment">// ä½¿ç”¨ç‚¹è¡¨è¾¾å¼è®¿é—®</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸¤ç§æ–¹å¼</span></span><br><span class="line">colors[<span class="string">'pink'</span>] = <span class="string">'#FF00FF'</span></span><br><span class="line">colors.yellow = <span class="string">'#FFFF00'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> colors.pink      <span class="comment">// == '#FF00FF'</span></span><br><span class="line"><span class="keyword">assert</span> colors[<span class="string">'yellow'</span>] <span class="comment">// == '#FFFF00'</span></span><br><span class="line"><span class="keyword">assert</span> colors <span class="keyword">instanceof</span> java.util.LinkedHashMap <span class="comment">// é»˜è®¤ä½¿ç”¨LinkedHashMapç±»å‹</span></span><br></pre></td></tr></table></figure></p>
<p>åœ¨ä¸Šè¾¹çš„ä¾‹å­ä¸­ï¼Œè™½ç„¶æ²¡æœ‰æ˜ç¡®çš„ä½¿ç”¨å­—ç¬¦ä¸²<code>â€™redâ€˜ã€â€™greenâ€˜</code>ï¼Œä½†Groovyä¼šè‡ªåŠ¨æŠŠé‚£äº›keyè½¬åŒ–ä¸ºå­—ç¬¦ä¸²ã€‚å¹¶ä¸”åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œåˆå§‹åŒ–å­—å…¸æ—¶keyä¹Ÿä¸ä¼šå»ä½¿ç”¨å·²ç»å­˜åœ¨çš„å˜é‡ï¼š<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> keyVal = <span class="string">'name'</span></span><br><span class="line"><span class="keyword">def</span> persons = [<span class="string">keyVal:</span> <span class="string">'Guillaume'</span>] <span class="comment">// éå¸¸æ³¨æ„: æ­¤å¤„çš„keyæ˜¯å­—ç¬¦ä¸²keyValè€Œä¸æ˜¯name</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> !persons.containsKey(<span class="string">'name'</span>)</span><br><span class="line"><span class="keyword">assert</span> persons.containsKey(<span class="string">'keyVal'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœè¦ä½¿ç”¨ä¸€ä¸ªå˜é‡ä½œä¸ºkeyï¼Œéœ€è¦ç”¨æ‹¬å·æ‹¬ä½ï¼š</span></span><br><span class="line"><span class="keyword">def</span> keyVal = <span class="string">'name'</span></span><br><span class="line"><span class="keyword">def</span> persons = [(keyVal): <span class="string">'Guillaume'</span>] <span class="comment">// ç›¸å½“äº[ 'name' : 'Guillaume' ]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> persons.containsKey(<span class="string">'name'</span>)</span><br><span class="line"><span class="keyword">assert</span> !persons.containsKey(<span class="string">'keyVal'</span>)</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="æ¡ä»¶è¯­å¥-Condition"><a href="#æ¡ä»¶è¯­å¥-Condition" class="headerlink" title="æ¡ä»¶è¯­å¥ - Condition"></a>æ¡ä»¶è¯­å¥ - Condition</h4><p><strong>if è¯­å¥</strong><br>ç¬¬ä¸€ä¸ªå†³ç­–è¯­å¥æ˜¯ if è¯­å¥ã€‚è¿™ç§è¯´æ³•çš„ä¸€èˆ¬å½¢å¼æ˜¯<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// # syntax</span></span><br><span class="line"><span class="keyword">if</span>(condition) &#123;</span><br><span class="line">  statement #1</span><br><span class="line">  statement #2</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¾‹å­:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@ æµç¨‹æ§åˆ¶Groovyè¡¨è¾¾å¼å¦‚if/elseæ¡ä»¶è¯­å¥</span></span><br><span class="line"><span class="keyword">if</span> (env.BRANCH_NAME == <span class="string">'master'</span>) &#123;</span><br><span class="line">  echo <span class="string">'I only execute on the master branch'</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  echo <span class="string">'I execute elsewhere'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>Forå¾ªç¯</strong><br>for è¯­å¥ç”¨äºéå†ä¸€ç»„å€¼ã€‚for è¯­å¥é€šå¸¸ä»¥ä»¥ä¸‹æ–¹å¼ä½¿ç”¨ã€‚<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(variable declaration;expression;Increment) &#123;</span><br><span class="line">  statement #1</span><br><span class="line">  statement #2</span><br><span class="line">  â€¦</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ä¾‹å­ï¼š<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¸¸è§„</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;<span class="number">5</span>;i++) &#123;</span><br><span class="line">  println(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// List å¾ªç¯è¿­ä»£</span></span><br><span class="line"><span class="keyword">def</span> mylist = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="string">"weiyigeek.top"</span>,<span class="string">"devops"</span>,<span class="string">"jenkins"</span>]</span><br><span class="line">mylist.each&#123; println(it) &#125;</span><br><span class="line"><span class="comment">// 'it'æ˜¯å½“å‰å…ƒç´ ï¼Œè€Œ'i'æ˜¯ç´¢å¼•</span></span><br><span class="line">mylist.eachWithIndex &#123; it, i -&gt;  println <span class="string">"$i: $it"</span> &#125;</span><br><span class="line">mylist.eachWithIndex &#123; count, count -&gt; count + item &#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>Switch è¯­å¥</strong><br>Swict è¯­å¥ç”¨äºæ¡ä»¶åˆ¤æ–­, åŸºç¡€è¯­æ³•å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">switch () &#123;</span><br><span class="line">  case &#39;1&#39;:</span><br><span class="line">    echo 1</span><br><span class="line">    break</span><br><span class="line">  case &#39;2&#39;:</span><br><span class="line">    echo 2</span><br><span class="line">    break</span><br><span class="line">  default:</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br></p>
<h4 id="å¼‚å¸¸-Exception"><a href="#å¼‚å¸¸-Exception" class="headerlink" title="å¼‚å¸¸ - Exception"></a>å¼‚å¸¸ - Exception</h4><p>æè¿°:æµç¨‹æ§åˆ¶æ˜¯Groovyçš„å¼‚å¸¸å¤„ç†æœºåˆ¶,åœ¨å®é™…è¿‡ç¨‹ä¸­å»ºè®®åŒæ—¶ä½¿ç”¨tryâ€¦catch..finallyè¿›è¡Œæ•è·å¼‚å¸¸;<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">      helloWorld()  <span class="comment">// == Scripted Pipeline - Hello Wrold - STARTED - 1024!</span></span><br><span class="line">      dir(<span class="string">"place"</span>) &#123;</span><br><span class="line">          sh <span class="string">'id'</span>  <span class="comment">// == uid=112(jenkins) gid=117(jenkins) groups=117(jenkins)</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="comment">// If there was an exception thrown, the build failed</span></span><br><span class="line">      currentBuild.result = <span class="string">"FAILED"</span></span><br><span class="line">      <span class="keyword">throw</span> e</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      println <span class="string">"success or failure, always send notifications"</span>   <span class="comment">// == Success or failure, always send notifications </span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="å‡½æ•°-Functions"><a href="#å‡½æ•°-Functions" class="headerlink" title="å‡½æ•° - Functions"></a>å‡½æ•° - Functions</h4><p>æè¿°ï¼šGroovyä¸­çš„æ–¹æ³•æ˜¯ä½¿ç”¨è¿”å›ç±»å‹æˆ–ä½¿ç”¨defå…³é”®å­—å®šä¹‰çš„, æ–¹æ³•å¯ä»¥æ¥æ”¶ä»»æ„æ•°é‡çš„å‚æ•°å¹¶å®šä¹‰å‚æ•°æ—¶ä¸å¿…æ˜¾å¼å®šä¹‰ç±»å‹ï¼Œå¯ä»¥æ·»åŠ ä¿®é¥°ç¬¦å¦‚<code>publicï¼Œprivateå’Œprotected</code>ã€‚</p>
<p>Tips : æ³¨æ„äº‹é¡¹</p>
<ul>
<li>é»˜è®¤æƒ…å†µä¸‹å¦‚æœæœªæä¾›å¯è§æ€§ä¿®é¥°ç¬¦åˆ™è¯¥æ–¹æ³•ä¸ºpublicã€‚</li>
<li>æ³¨æ„: å‡½æ•°å®šä¹‰ä¸èƒ½è¢«åŒ…å«åœ¨<code>node{}å—</code>ä¹‹ä¸­, è€Œå‡½æ•°è°ƒç”¨æ˜¯åœ¨ <code>node { stage() { å‡½æ•°åç§°} }</code> ä¹‹ä¸­çš„;</li>
<li>æ³¨æ„: å‡½æ•°å‚æ•°æœ‰å®šä¹‰é»˜è®¤å€¼</li>
</ul>
<p><strong>ç®€å•ç¤ºä¾‹</strong>:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.å‡½æ•°å‘½ä»¤ä»¥åŠå‡½æ•°å‚æ•°</span></span><br><span class="line"><span class="keyword">def</span> methodName(String param)&#123;</span><br><span class="line">  println param  <span class="comment">//Method code</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 2.æ”¯æŒå‡½æ•°é‡è½½ï¼Œå½“å‚æ•°ä¸ªæ•°ä¸åŒæ—¶ï¼Œå‡½æ•°åç§°å¯ä»¥åŒå</span></span><br><span class="line"><span class="keyword">def</span> methodName(String param = <span class="string">'default1'</span>,<span class="keyword">int</span> number = <span class="number">1024</span>) &#123;</span><br><span class="line">  println <span class="string">"Hello Wrold function - $&#123;param&#125; - $&#123;age&#125;!"</span> </span><br><span class="line">  println param+<span class="string">" "</span>+age</span><br><span class="line">  <span class="comment">// å¦‚æœæ²¡æœ‰æ˜¾å¼åœ°ä½¿ç”¨returnå…³é”®å­—ï¼Œåˆ™è¿”å›å‡½æ•°æœ€åä¸€è¡Œè¯­å¥çš„è¿è¡Œç»“æœã€‚</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">"Hello Wrold function - $&#123;param&#125; - $&#123;age&#125;!"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 3.Groovyæ”¯æŒä¸å®šé•¿å‚æ•°</span></span><br><span class="line"><span class="keyword">def</span> methodName(... param)&#123;</span><br><span class="line">  println param[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 4.å‡½æ•°å¯ä»¥èµ‹å€¼ç»™å…¶å®ƒå‡½æ•°ï¼Œä½¿ç”¨è¯­æ³•æ ‡è®°&amp;å°†å‡½æ•°èµ‹äºˆæ–°çš„å‡½æ•°ã€‚</span></span><br><span class="line"><span class="keyword">def</span> printHello=<span class="keyword">this</span>.&amp;methodName</span><br><span class="line"></span><br><span class="line">node &#123; </span><br><span class="line">  stage(<span class="string">'å‡½æ•°è°ƒç”¨'</span>) &#123; </span><br><span class="line">    res00 = methodName(<span class="string">"WeiyiGeek"</span>)</span><br><span class="line">    res01 = methodName(<span class="string">"WeiyiGeek"</span>,<span class="number">1024</span>)</span><br><span class="line">    res02 = printHello(<span class="string">"WeiyiGeek"</span>)</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>é—­åŒ…å‡½æ•°</strong><br>æè¿°: Groovyä¸­é—­åŒ…æ˜¯è¿™ä¹ˆå®šä¹‰çš„,å¯ä»¥ç”¨ä½œå‡½æ•°å‚æ•°å’Œæ–¹æ³•å‚æ•°çš„ä»£ç å—, å¯ä»¥æŠŠè¿™ä¸ªä»£ç å—ç†è§£ä¸ºä¸€ä¸ªå‡½æ•°æŒ‡é’ˆã€‚</p>
<p>Tips: é—­åŒ…å¯ä»¥è®¿é—®å¤–éƒ¨çš„å˜é‡ï¼Œè®°ä½ä¸€ç‚¹æ–¹æ³•æ˜¯ä¸èƒ½è®¿é—®å¤–éƒ¨å˜é‡çš„ã€‚</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// # é—­åŒ…æ ¼å¼</span></span><br><span class="line"><span class="keyword">def</span> xxx = &#123; params -&gt; code &#125;</span><br><span class="line"><span class="keyword">def</span> xxx=&#123;code&#125; <span class="comment">//æˆ–è€…</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.é—­åŒ…å¯è®¿é—®å¤–éƒ¨å˜é‡</span></span><br><span class="line"><span class="keyword">def</span> str=<span class="string">"hello world"</span></span><br><span class="line"><span class="keyword">def</span> closure=&#123;</span><br><span class="line">  println str</span><br><span class="line">&#125;</span><br><span class="line">closure()  <span class="comment">//hello world</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.é—­åŒ…è°ƒç”¨çš„ä¸¤ç§æ–¹å¼</span></span><br><span class="line"><span class="keyword">def</span> closure = &#123;</span><br><span class="line">  param -&gt; println param</span><br><span class="line">&#125;</span><br><span class="line">closure(<span class="string">"hello world"</span>)</span><br><span class="line">closure <span class="string">"hello world"</span></span><br><span class="line">closure.call(<span class="string">"hell call"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.é—­åŒ…æ˜¯æœ‰è¿”å›å€¼çš„ï¼Œé»˜è®¤æœ€åä¸€è¡Œè¯­å¥å°±æ˜¯è¯¥é—­åŒ…çš„è¿”å›å€¼ï¼Œå¦‚æœæœ€åä¸€è¡Œè¯­å¥æ²¡æœ‰ä¸è¾“å…¥ä»»ä½•ç±»å‹ï¼Œé—­åŒ…å°†è¿”å›null</span></span><br><span class="line"><span class="keyword">def</span> noReturn=&#123;</span><br><span class="line">    println <span class="string">"hello world"</span></span><br><span class="line">&#125;</span><br><span class="line">println noReturn()</span><br><span class="line"><span class="comment">//hello world</span></span><br><span class="line"><span class="comment">//null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.é—­åŒ…å¯é¢„å®šå‚æ•°ï¼Œå¦‚æ²¡æœ‰é¢„å®šåˆ™æœ‰ä¸€ä¸ªéšå¼çš„é»˜è®¤å‚æ•°itï¼Œå€¼å¾—éå¸¸æ³¨æ„é—­åŒ…ä¸­å‚æ•°åç§°ä¸èƒ½ä¸é—­åŒ…å†…æˆ–é—­åŒ…å¤–çš„å‚æ•°åé‡åã€‚</span></span><br><span class="line"><span class="keyword">def</span> closure=&#123;</span><br><span class="line">  println <span class="string">"hello $it"</span></span><br><span class="line">&#125;</span><br><span class="line">closure(<span class="string">"admin"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> closure=&#123;</span><br><span class="line">  param01,param02,param03-&gt;println param01+param02+param03</span><br><span class="line">&#125;</span><br><span class="line">closure <span class="string">"hello"</span>,<span class="string">"world"</span>,<span class="string">"ok"</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> closure=&#123;</span><br><span class="line">  println it</span><br><span class="line">&#125;</span><br><span class="line">closure <span class="string">"hello world"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 5.é—­åŒ…å¯ä»¥ä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ é€’ç»™å¦ä¸€ä¸ªé—­åŒ…ï¼Œä¹Ÿå¯ä»¥åœ¨é—­åŒ…ä¸­è¿”å›ä¸€ä¸ªé—­åŒ…ã€‚</span></span><br><span class="line"><span class="keyword">def</span> toTriple = &#123; n -&gt; n * <span class="number">3</span> &#125;</span><br><span class="line"><span class="keyword">def</span> runTwice = &#123; a, c -&gt; c(c(a)) &#125;</span><br><span class="line">println runTwice(<span class="number">5</span>, toTriple)  <span class="comment">// 15 * 3 =  45</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> times = &#123; x -&gt; &#123; y -&gt; x * y &#125; &#125;</span><br><span class="line">println times(<span class="number">3</span>)(<span class="number">4</span>)<span class="comment">//12</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 6.å½“é—­åŒ…ä½œä¸ºé—­åŒ…æˆ–æ–¹æ³•çš„æœ€åä¸€ä¸ªå‚æ•°ï¼Œå¯ä»¥å°†é—­åŒ…ä»å‚æ•°åœ†æ‹¬å·ä¸­æå–å‡ºæ¥æ¥åœ¨æœ€åã€‚</span></span><br><span class="line"><span class="keyword">def</span> runTwice = &#123; a, c -&gt; c(c(a)) &#125;</span><br><span class="line">println runTwice(<span class="number">5</span>, &#123; it * <span class="number">3</span> &#125;) <span class="comment">//45 usual syntax</span></span><br><span class="line"><span class="comment">//å½“å¤šä¸ªé—­åŒ…ä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°æ—¶</span></span><br><span class="line"><span class="keyword">def</span> runTwoClosures = &#123; a, c1, c2 -&gt; c1(c2(a)) &#125;</span><br><span class="line"><span class="keyword">assert</span> runTwoClosures(<span class="number">5</span>, &#123; it * <span class="number">3</span> &#125;, &#123; it * <span class="number">4</span> &#125;) == <span class="number">60</span> <span class="comment">//usual syntax</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 7.é—­åŒ…æ¥å—å‚æ•°çš„è§„åˆ™ï¼Œä¼šå°†å‚æ•°åˆ—è¡¨ä¸­æ‰€æœ‰æœ‰é”®å€¼å…³ç³»çš„å‚æ•°ï¼Œä½œä¸ºä¸€ä¸ªmapç»„è£…ï¼Œä¼ å…¥é—­åŒ…ä½œä¸ºè°ƒç”¨é—­åŒ…çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚</span></span><br><span class="line"><span class="keyword">def</span> f= &#123;m, i, j-&gt; i + j + m.x + m.y &#125;</span><br><span class="line">println f(<span class="number">6</span>, <span class="string">x:</span><span class="number">4</span>, <span class="string">y:</span><span class="number">3</span>, <span class="number">7</span>)<span class="comment">//20</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 8.å¦‚æœé—­åŒ…çš„å‚æ•°å£°æ˜ä¸­æ²¡æœ‰listï¼Œé‚£ä¹ˆä¼ å…¥å‚æ•°å¯ä»¥è®¾ç½®ä¸ºlistï¼Œé‡Œé¢çš„å‚æ•°å°†åˆ†åˆ«ä¼ å…¥é—­åŒ…å‚æ•°ã€‚</span></span><br><span class="line"><span class="keyword">def</span> c = &#123; a, b, c -&gt; a + b + c &#125;</span><br><span class="line"><span class="keyword">def</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">println c(list) <span class="comment">// 6</span></span><br></pre></td></tr></table></figure>
<p>å‚è€ƒåœ°å€: <a href="https://stackoverflow.com/questions/40870657/groovy-method-definition-not-expected-here" target="_blank" rel="noopener">https://stackoverflow.com/questions/40870657/groovy-method-definition-not-expected-here</a></p>
<p><br></p>
<h4 id="ç±»å’Œå¯¹è±¡"><a href="#ç±»å’Œå¯¹è±¡" class="headerlink" title="ç±»å’Œå¯¹è±¡"></a>ç±»å’Œå¯¹è±¡</h4><p>Groovyç±»ä¸Javaç±»ä¼¼ï¼Œåœ¨å­—èŠ‚ç çº§éƒ½è¢«ç¼–è¯‘æˆJavaç±»ï¼Œç”±äºå…¶åœ¨å®šä¹‰å˜é‡ä¸Šé¢çš„çµæ´»æ€§ï¼Œæ‰€ä»¥åœ¨æ–°å»ºä¸€ä¸ªGroovyç±»æ—¶è¿˜æ˜¯æœ‰ä¸€äº›ä¸åŒçš„ï¼Œå¢åŠ äº†è®¸å¤šçµæ´»æ€§ã€‚</p>
<p>1.ç”±äºGroovyæ˜¯æ¾æ•£å‹è¯­è¨€ï¼Œå®ƒå¹¶ä¸å¼ºåˆ¶ä½ ç»™å±æ€§ã€æ–¹æ³•å‚æ•°å’Œè¿”å›å€¼å®šä¹‰ç±»å‹ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šç±»å‹ï¼Œåœ¨å­—èŠ‚ç çº§åˆ«ä¼šè¢«ç¼–è¯‘æˆObject,æ‰€ä»¥åœ¨å®šä¹‰ç±»çš„å±æ€§æ—¶ä¸ç”¨åˆ»æ„åŠ ä¸Šæƒé™ä¿®é¥°ç¬¦ï¼Œé»˜è®¤å°±æ˜¯publicçš„ã€‚</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span>&#123;</span></span><br><span class="line">  <span class="keyword">def</span> title</span><br><span class="line">  String author</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> price</span><br><span class="line">  <span class="comment">// æ˜¯å¦ä¸Javaçš„ç±»å·®ä¸å¤š</span></span><br><span class="line">  <span class="keyword">public</span> Book(title)&#123;</span><br><span class="line">    <span class="keyword">this</span>.title=title</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// é»˜è®¤public</span></span><br><span class="line">  <span class="keyword">boolean</span> order(<span class="keyword">int</span> isbn)&#123;</span><br><span class="line">    <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">def</span> title()&#123;</span><br><span class="line">    <span class="string">"Booke Title"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ä¾‹åŒ–å¯¹è±¡</span></span><br><span class="line">Book book=<span class="keyword">new</span> Book(<span class="string">"Hello Groovy"</span>)</span><br><span class="line">book.order(<span class="number">1001</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨è¯´æ˜</span></span><br><span class="line">book.title   <span class="comment">//è·å–å±æ€§</span></span><br><span class="line">book.title() <span class="comment">//è®¿é—®æ–¹æ³•</span></span><br></pre></td></tr></table></figure>
<p>2.Groovyåœ¨ç¼–è¯‘å®Œæˆåä¼šè‡ªåŠ¨å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆgetterä¸setteræ–¹æ³•ï¼Œä½†æ˜¯ç§æœ‰å±æ€§é™¤å¤–ä¹Ÿå°±æ˜¯è¯´ price å±æ€§æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨getterä¸setteræ–¹æ³•ã€‚<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¾‹å¦‚ title å±æ€§çš„ getter ä¸ setter æ–¹æ³•ã€‚</span></span><br><span class="line">Book book=<span class="keyword">new</span> Book(<span class="string">"Hello Groovy"</span>)</span><br><span class="line">println book.getTitle() <span class="comment">// Hello Groovy</span></span><br><span class="line"> </span><br><span class="line">book.setTitle(<span class="string">"New Groovy"</span>)</span><br><span class="line">println book.getTitle() <span class="comment">// New Groovy</span></span><br><span class="line">println book.title      <span class="comment">// New Groovy</span></span><br></pre></td></tr></table></figure></p>
<p>3.åœ¨Groovyä¸­ç±»åå’Œæ–‡ä»¶åå¹¶ä¸éœ€è¦ä¸¥æ ¼çš„æ˜ å°„å…³ç³»ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨Javaä¸­ä¸»ç±»åå¿…é¡»ä¸æ–‡ä»¶åŒåï¼Œä½†æ˜¯åœ¨Groovyä¸­ä¸€ä¸ªæ–‡ä»¶å¯ä»¥å®šä¹‰å¤šä¸ªpublicç±»ã€‚<br>åœ¨Groovyä¸­å¯ä»¥å®šä¹‰ä¸ä»»ä½•ç±»ä¸ç›¸å…³çš„æ–¹æ³•å’Œè¯­å¥ï¼Œè¿™äº›æ–¹æ³•é€šå¸¸ç§°ä¸ºç‹¬ç«‹æ–¹æ³•æˆ–è€…æ¾æ–¹æ³•ã€‚</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Hello ç±»ä¸­æœ‰ä¸€ä¸ªçš„å…¬å…±é™æ€ hello æ–¹æ³•</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hello</span>&#123;</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String hello()&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"hello"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">World</span>&#123;</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String world()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"world"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">println Hello.hello()+World.world()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> helloWorld()&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"hello world"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä¸€ä¸ªæ–‡ä»¶åå®šä¹‰ä¸ºStructure.groovyï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­åŒ…å«äº†ç±»çš„å®šä¹‰å’Œç‹¬ç«‹æ–¹æ³•å£°æ˜ï¼Œå®ƒç¼–è¯‘ä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ã€‚</p>
<p>é¦–å…ˆä¼šç”Ÿæˆä¸€ä¸ªä¸æ–‡ä»¶åŒåçš„classæ–‡ä»¶ï¼Œæ‰€æœ‰çš„æ¾è¯­å¥éƒ½é›†ä¸­åœ¨runæ–¹æ³•ä¸­ï¼Œå¹¶ä¸”runæ–¹æ³•è¢«è¯¥ç±»çš„mainæ–¹æ³•è°ƒç”¨ã€‚<br>ç‹¬ç«‹æ–¹æ³•è¢«ç¼–è¯‘æˆäº†ç±»çš„é™æ€æ–¹æ³•ï¼Œä¸Javaç›¸ä¼¼æ¯ä¸€ä¸ªç‹¬ç«‹çš„ç±»éƒ½ä¼šè¢«ç¼–è¯‘æˆä¸€ä¸ªå•ç‹¬çš„classæ–‡ä»¶ã€‚<br>å› æ­¤ç¼–è¯‘Structure.groovyæ–‡ä»¶æœ€åä¼šè¢«ç¼–è¯‘æˆ<code>Hello.classã€World.classå’ŒStructure.class</code>ã€‚</p>
<p><br></p>
<h4 id="å­—ç¬¦ä¸²å¤„ç†"><a href="#å­—ç¬¦ä¸²å¤„ç†" class="headerlink" title="å­—ç¬¦ä¸²å¤„ç†"></a>å­—ç¬¦ä¸²å¤„ç†</h4><p><strong>å­—ç¬¦ä¸²åˆ†éš”</strong></p>
<ul>
<li>split() ï¼šç»“æœä¸ºå­—ç¬¦ä¸²æ•°ç»„ã€ä¿ç•™ç©ºå­—ç¬¦ä¸²ã€æŒ‰ç…§å•è¯åˆ‡å‰²ã€æ”¯æŒä½¿ç”¨ä½¿ç”¨æ­£åˆ™</li>
<li>tokenize() ï¼šç»“æœä¸ºListã€ä½†ä¸ä¼šä¿ç•™ç©ºå­—ç¬¦ä¸²ã€æŒ‰å­—ç¬¦ä¸²åˆ‡å‰²ã€ä¸æ”¯æŒä½¿ç”¨ä½¿ç”¨æ­£åˆ™<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def demo_string = <span class="string">"Hello WeiyiGeek"</span></span><br><span class="line">out1 = demo_string.split(<span class="string">"l"</span>)       <span class="comment"># [He, , o WeiyiGeek]</span></span><br><span class="line">out2 = demo_string.tokenize(<span class="string">"l"</span>)    <span class="comment"># [He, o WeiyiGeek]</span></span><br><span class="line"></span><br><span class="line">out3 = demo_string.split(<span class="string">'lo'</span>)      <span class="comment"># [Hel, WeiyiGeek]</span></span><br><span class="line">out4 = demo_string.tokenize(<span class="string">'li'</span>)   <span class="comment"># [Hel, We, y, Geek]</span></span><br><span class="line"></span><br><span class="line">out5 = demo_string.split(/We\w&#123;3&#125;/) <span class="comment"># [Hello , Geek]</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<h4 id="è¯­æ³•æ€»ç»“"><a href="#è¯­æ³•æ€»ç»“" class="headerlink" title="è¯­æ³•æ€»ç»“"></a>è¯­æ³•æ€»ç»“</h4><p>æè¿°: æ­¤æ¬¡å¯¹ <code>Scripted Pipeline</code> è¯­æ³•çš„ä½¿ç”¨è¿›è¡Œä¸€ä¸ªç®€å•çš„æ€»ç»“, æˆ–è®¸åœ¨åé¢çš„Declarative Pipelineä¸­å¯ä»¥è¿›è¡Œä½¿ç”¨;<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line">node &#123;</span><br><span class="line">  <span class="comment">// å˜é‡å®šä¹‰</span></span><br><span class="line">  <span class="keyword">def</span> foo</span><br><span class="line">  <span class="comment">// å­—ç¬¦ä¸²</span></span><br><span class="line">  <span class="keyword">def</span> project=<span class="string">"HelloWorld"</span></span><br><span class="line">  <span class="comment">// å•å¼•å·å­—ç¬¦ä¸²ï¼ˆSingle quoted stringï¼‰ä¸èƒ½è§£æå˜é‡</span></span><br><span class="line">  <span class="keyword">def</span> name=<span class="string">'weiyigeek - $&#123;project&#125;'</span></span><br><span class="line">  <span class="comment">// ä¸‰å•å¼•å·å­—ç¬¦ä¸²ï¼ˆTriple single quoted stringï¼‰ä¸èƒ½è§£æå˜é‡</span></span><br><span class="line">  <span class="keyword">def</span> line=<span class="string">'''\</span></span><br><span class="line"><span class="string">  Line one</span></span><br><span class="line"><span class="string">  Line $&#123;project&#125;</span></span><br><span class="line"><span class="string">  '''</span></span><br><span class="line">  <span class="comment">// å®šä¹‰å­—å…¸Maps</span></span><br><span class="line">  <span class="keyword">def</span> person = [<span class="string">name:</span> <span class="string">'WeiyiGeek'</span>, <span class="string">age:</span> <span class="number">96</span>]  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  stage(<span class="string">'Scripted Pipeline Syntax'</span>) &#123;</span><br><span class="line">    <span class="comment">// (1) å˜é‡å£°æ˜</span></span><br><span class="line">    foo=<span class="string">"Identifiers"</span></span><br><span class="line">    <span class="comment">// (2) å˜é‡è°ƒç”¨</span></span><br><span class="line">    echo <span class="string">"$&#123;foo&#125; -- $&#123;project&#125;"</span> <span class="comment">// == Identifiers -- HelloWorld</span></span><br><span class="line">    <span class="comment">// (3) å­—ç¬¦ä¸²è¾“å‡º</span></span><br><span class="line">    echo <span class="string">"my name is $&#123;name&#125;"</span> <span class="comment">// == my name is weiyigeek - $&#123;project&#125;</span></span><br><span class="line">    <span class="comment">// (4) å¤šè¡Œå­—ç¬¦ä¸²è¾“å‡º</span></span><br><span class="line">    echo <span class="string">"$&#123;line&#125;"</span> <span class="comment">/* ==</span></span><br><span class="line"><span class="comment">    Line one</span></span><br><span class="line"><span class="comment">    Line $&#123;project&#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// (5) å˜é‡å¯¹è±¡å±æ€§è¾“å‡º</span></span><br><span class="line">    echo <span class="string">"$person.name is $person.age years old"</span> <span class="comment">// == WeiyiGeek is 96 years old</span></span><br><span class="line">    </span><br><span class="line">    name = <span class="string">'WeiyiGeek'</span>         </span><br><span class="line">    project = <span class="string">"my name is $&#123;name&#125;"</span></span><br><span class="line">    <span class="keyword">def</span> greeting = <span class="string">"Hello $&#123;name&#125;"</span> <span class="comment">// nameå˜é‡çš„å€¼ä¼šè¢«æ›¿æ¢è¿›å»</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// (6) å­—ç¬¦ä¸²æ ¼å¼åŒ–å£°æ˜</span></span><br><span class="line">    <span class="keyword">assert</span> greeting.toString()</span><br><span class="line">    println <span class="string">"$&#123;project.toString()&#125;"</span> <span class="comment">//è°ƒç”¨æ–¹æ³•åç›´æ¥è¾“å‡º ==  my name is  WeiyiGeek</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é—­åŒ…</span></span><br><span class="line">    <span class="keyword">def</span> number = <span class="number">1</span></span><br><span class="line">    <span class="keyword">def</span> eagerGString = <span class="string">"value == $&#123;number&#125;"</span>   <span class="comment">// æ™®é€šå½¢å¼</span></span><br><span class="line">    <span class="keyword">def</span> lazyGString = <span class="string">"value == $&#123;-&gt; number&#125;"</span> <span class="comment">// è¿™æ˜¯ä¸€ä¸ªé—­åŒ…</span></span><br><span class="line">    println eagerGString <span class="comment">// == value == 1</span></span><br><span class="line">    println lazyGString  <span class="comment">// æ­¤å¤„è¾“å‡ºä¸ºç©º (value == 1)</span></span><br><span class="line">    number=<span class="number">1024</span></span><br><span class="line">    echo <span class="string">"-----------------"</span></span><br><span class="line">    println eagerGString <span class="comment">// == value == 1</span></span><br><span class="line">    println lazyGString  <span class="comment">// æ­¤å¤„è¾“å‡ºä¸ºç©º (value == 1024)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// (7) å˜é‡ç±»å‹è¾“å‡º</span></span><br><span class="line">    println <span class="string">"å˜é‡nameç±»å‹ï¼š"</span>+name.<span class="keyword">class</span>+<span class="string">", \n å˜é‡projectç±»å‹: "</span>+project.<span class="keyword">class</span>+<span class="string">", \n å˜é‡greetingç±»å‹: "</span>+greeting.<span class="keyword">class</span> </span><br><span class="line">    <span class="comment">/* == å˜é‡nameç±»å‹ï¼šclass java.lang.String, </span></span><br><span class="line"><span class="comment">          å˜é‡projectç±»å‹: class org.codehaus.groovy.runtime.GStringImpl, </span></span><br><span class="line"><span class="comment">          å˜é‡greetingç±»å‹: class org.codehaus.groovy.runtime.GStringImpl */</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// (8) æ•°å€¼ç±»å‹ä¸ç±»å‹å¼ºè½¬</span></span><br><span class="line">    <span class="keyword">def</span> decimal = <span class="number">123.456</span></span><br><span class="line">    println <span class="string">"$&#123;decimal.getClass()&#125; -- $&#123;decimal&#125; "</span> <span class="comment">// ==  class java.math.BigDecimal -- 123.456</span></span><br><span class="line">    <span class="comment">//assert decimal instanceof BigDecimal</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// (9) æ•°ç»„åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">def</span> arrayList = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="string">"number"</span>]</span><br><span class="line">    println arrayList[<span class="number">0</span>]   <span class="comment">// == 1</span></span><br><span class="line">    arrayList &lt;&lt; <span class="string">'5'</span> </span><br><span class="line">    echo <span class="string">"assert $&#123;arrayList[0]&#125; ---  $&#123;arrayList[-2]&#125; --- $&#123;arrayList[-1]&#125;"</span>   <span class="comment">// == assert 1 ---  number --- 5</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> multi = [[<span class="number">0</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">3</span>]]  <span class="comment">// äºŒç»´æ•°ç»„</span></span><br><span class="line">    echo <span class="string">"assert $&#123;multi[1][0]&#125;"</span>  <span class="comment">// == 2</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// (10) å­—å…¸Map</span></span><br><span class="line">    <span class="keyword">def</span> colors = [<span class="string">red:</span> <span class="string">'#FF0000'</span>, <span class="string">green:</span> <span class="string">'#00FF00'</span>, <span class="string">blue:</span> <span class="string">'#0000FF'</span>]</span><br><span class="line">    colors[<span class="string">'pink'</span>] = <span class="string">'#FF00FF'</span>  </span><br><span class="line">    colors.yellow = <span class="string">'#FFFF00'</span></span><br><span class="line">    println <span class="string">"colors ç±»å‹ : "</span>+ colors.pink.<span class="keyword">class</span> + <span class="string">", assert colors.pink : "</span> + colors.pink + <span class="string">",assert colors['yellow'] : "</span> + colors[<span class="string">'yellow'</span>]</span><br><span class="line">    <span class="comment">/*       colors ç±»å‹ : class java.lang.String, assert colors.pink : #FF00FF,assert colors['yellow'] : #FFFF00     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœè¦ä½¿ç”¨ä¸€ä¸ªå˜é‡ä½œä¸ºkeyï¼ˆç¼ºçœä¸ºå­—ç¬¦ä¸²ï¼‰ï¼Œéœ€è¦ç”¨æ‹¬å·æ‹¬ä½ï¼š</span></span><br><span class="line">    <span class="keyword">def</span> keyVal = <span class="string">'name'</span></span><br><span class="line">    <span class="keyword">def</span> persons = [(keyVal): <span class="string">'WeiyiGeek'</span>] <span class="comment">// ç›¸å½“äº[ 'name' : 'WeiyiGeek' ]</span></span><br><span class="line">    println <span class="string">"key is name: "</span> + persons.containsKey(<span class="string">'name'</span>) + <span class="string">" , Key not is KeyVal : "</span> + !persons.containsKey(<span class="string">'keyVal'</span>)</span><br><span class="line">    <span class="comment">/* key is name: true , Key is  KeyVal : true */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// (11) æ¡ä»¶è¯­å¥ - if - for - switch</span></span><br><span class="line">    <span class="keyword">if</span> ( keyVal == <span class="string">'name'</span> ) &#123;</span><br><span class="line">      echo <span class="string">"keyVal value is name"</span>   <span class="comment">// == keyVal value is name</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      echo <span class="string">"keyVal value is not name"</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (env.BRANCH_NAME == <span class="string">'master'</span>) &#123;</span><br><span class="line">      echo <span class="string">'I only execute on the master branch'</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      echo <span class="string">'I execute elsewhere'</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">      println arrayList[i]  <span class="comment">// å¦‚æœè¶Šç•Œæ˜¾ç¤ºåˆ™ `null` // == 1,2,3,number,5</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> option = <span class="string">"deploy"</span></span><br><span class="line">    <span class="keyword">switch</span> (<span class="string">"$&#123;option&#125;"</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'deploy'</span>:</span><br><span class="line">          echo <span class="string">"deploy"</span>   <span class="comment">// == deploy</span></span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">'rollback'</span>:</span><br><span class="line">          echo <span class="string">"rollback"</span></span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line"><span class="symbol">      default:</span></span><br><span class="line">          echo <span class="string">"default"</span></span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">    <span class="comment">// (12) å¼‚å¸¸æ•è·</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        helloWorld()  <span class="comment">// == Scripted Pipeline - Hello Wrold - STARTED - 1024!</span></span><br><span class="line">        dir(<span class="string">"place"</span>) &#123;</span><br><span class="line">            sh <span class="string">'id'</span>  <span class="comment">// == uid=112(jenkins) gid=117(jenkins) groups=117(jenkins)</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="comment">// If there was an exception thrown, the build failed</span></span><br><span class="line">        currentBuild.result = <span class="string">"FAILED"</span></span><br><span class="line">        <span class="keyword">throw</span> e</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        println <span class="string">"success or failure, always send notifications"</span>   <span class="comment">// == Success or failure, always send notifications </span></span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="comment">// ï¼ˆ13ï¼‰å‡½æ•°è°ƒç”¨ </span></span><br><span class="line">    helloWorld(<span class="string">"weiyigeek"</span>)  <span class="comment">/* Scripted Pipeline - Hello Wrold - weiyigeek - 1024! */</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// (13) å‡½æ•°å£°æ˜å®šä¹‰æ—¶ ä¸èƒ½åŒ…æ‹¬åœ¨nodeä¸­</span></span><br><span class="line"><span class="keyword">def</span> helloWorld (String username = <span class="string">'STARTED'</span>,<span class="keyword">int</span> age = <span class="number">1024</span>) &#123;</span><br><span class="line">    println <span class="string">"Scripted Pipeline - Hello Wrold - $&#123;username&#125; - $&#123;age&#125;!"</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=2.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineè¯­æ³•å…¥é—¨å­¦ä¹  href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210129121425.png" target="_blank" title="WeiyiGeek.Scripted Pipeline ç¤ºä¾‹" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210129121425.png" alt="WeiyiGeek.Scripted Pipeline ç¤ºä¾‹" title="" class=""></a>
                <p>WeiyiGeek.Scripted Pipeline ç¤ºä¾‹</p>
            </figure>
<hr>
<h3 id="2-Declarative-Pipeline-Syntax"><a href="#2-Declarative-Pipeline-Syntax" class="headerlink" title="(2) Declarative Pipeline Syntax"></a>(2) Declarative Pipeline Syntax</h3><p>æè¿°: å‰é¢è¯´è¿‡<code>Declarative Pipeline</code>æ˜¯ Jenkins Pipeline çš„ä¸€ä¸ªç›¸å¯¹è¾ƒæ–°çš„è¡¥å……, å®ƒåœ¨Pipelineå­ç³»ç»Ÿä¹‹ä¸Šæå‡ºäº†ä¸€ç§æ›´ä¸ºç®€åŒ–å’Œæœ‰æ„ä¹‰çš„è¯­æ³•ã€‚</p>
<p><code>Declarative Pipeline</code> ä¸­çš„åŸºæœ¬è¯­å¥å’Œè¡¨è¾¾å¼éµå¾ªä¸Groovyè¯­æ³•ç›¸åŒçš„è§„åˆ™ ï¼Œä½†æœ‰ä»¥ä¸‹ä¾‹å¤–ï¼š</p>
<ul>
<li>1.Pipelineçš„é¡¶å±‚å¿…é¡»æ˜¯å—,å³æ‰€æœ‰æœ‰æ•ˆçš„<code>Declarative Pipeline</code>å¿…é¡»åŒ…å«åœ¨ä¸€ä¸ªpipelineå—å†….</li>
<li>2.æ²¡æœ‰åˆ†å·ä½œä¸ºè¯­å¥åˆ†éš”ç¬¦,æ¯ä¸ªå£°æ˜å¿…é¡»åœ¨è‡ªå·±çš„ä¸€è¡Œã€‚</li>
<li>3.å—åªèƒ½åŒ…å«<code>Sections, Directives, Steps</code>æˆ–èµ‹å€¼è¯­å¥ã€‚</li>
<li>4.å±æ€§å¼•ç”¨è¯­å¥è¢«è§†ä¸ºæ— å‚æ–¹æ³•è°ƒç”¨ã€‚(ä¾‹å¦‚: è¾“å…¥è¢«è§†ä¸ºinput)</li>
</ul>
<p>å‚è€ƒæµæ°´çº¿è¯­æ³•: <a href="http://jenkins.weiyigeek.top:8080/job/simple-pipeline-demo/pipeline-syntax" target="_blank" rel="noopener">http://jenkins.weiyigeek.top:8080/job/simple-pipeline-demo/pipeline-syntax</a></p>
<p><br/></p>
<p>ç®€å•è¯­æ³•è§„èŒƒç¤ºä¾‹:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// (1) æ‰€æœ‰ä»£ç åŒ…è£¹åœ¨ Pipeline å—ä¹‹ä¸­</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">  <span class="comment">// (2) å®šä¹‰ä»»åŠ¡åœ¨é‚£å°ä¸»æœºä¸Šè¿è¡Œå¯ä»¥æ˜¯anyã€none(å¯ä»¥å®ç°åˆ†å¸ƒå¼çš„æ„å»º)ç­‰</span></span><br><span class="line">  agent any</span><br><span class="line">  <span class="comment">// (3) å®šä¹‰çš„ç¯å¢ƒå˜é‡æ¯”å¦‚PATHè·¯å¾„</span></span><br><span class="line">  environment &#123;</span><br><span class="line">    hostname=<span class="string">'Jenkins Pipeline'</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// (4) å…¶ç±»ä¼¼ä¸€ä¸ªå¤§é¡¹ç›®ä»»åŠ¡çš„é›†åˆä¸»è¦åŒ…å«æ‰€æœ‰stageå­é¡¹ç›®</span></span><br><span class="line">  stages &#123;</span><br><span class="line">    <span class="comment">// (5) å…¶ç±»ä¼¼ä¸€ä¸ªé¡¹ç›®ä¸­çš„å•ä¸ªä»»åŠ¡ä¸»è¦æ¥åŒ…å«æ‰€æœ‰stageå­ä»»åŠ¡</span></span><br><span class="line">    stage (<span class="string">'clone'</span>) &#123;</span><br><span class="line">      <span class="comment">// (6) ç”¨æ¥å®ç°å…·ä½“çš„æ‰§è¡Œçš„åŠ¨ä½œ</span></span><br><span class="line">      steps &#123;</span><br><span class="line">        <span class="comment">// (7) å†…ç½®å‘½ä»¤æ‰§è¡Œ(ä¿¡æ¯æ‰“å°)</span></span><br><span class="line">        echo <span class="string">"git Clone Stage!"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage (<span class="string">'build'</span>) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        <span class="comment">// (8) shell å‘½ä»¤æ‰§è¡Œ (Shell Script)</span></span><br><span class="line">        sh <span class="string">"echo $hostname"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// (9) æ¶ˆæ¯é€šçŸ¥</span></span><br><span class="line">  post &#123;</span><br><span class="line">    always &#123;</span><br><span class="line">      echo <span class="string">"æ„å»ºæˆåŠŸ"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>è¯­æ³•æ ¼å¼è¯´æ˜:</strong><br>pipelineï¼šä»£è¡¨æ•´æ¡æµæ°´çº¿ï¼ŒåŒ…å«æ•´æ¡æµæ°´çº¿çš„é€»è¾‘ã€‚</p>
<ul>
<li>agent éƒ¨åˆ†ï¼šæŒ‡å®šæµæ°´çº¿çš„æ‰§è¡Œä½ç½®ï¼ˆJenkins agentï¼‰ã€‚æµæ°´çº¿ä¸­çš„æ¯ä¸ªé˜¶æ®µéƒ½å¿…é¡»åœ¨æŸä¸ªåœ°æ–¹ï¼ˆç‰©ç†æœºã€è™šæ‹Ÿæœºæˆ–Dockerå®¹å™¨ï¼‰æ‰§è¡Œã€‚</li>
<li>stage éƒ¨åˆ†ï¼šé˜¶æ®µï¼Œä»£è¡¨æµæ°´çº¿çš„é˜¶æ®µã€‚æ¯ä¸ªé˜¶æ®µéƒ½å¿…é¡»æœ‰åç§°ã€‚æœ¬ä¾‹ä¸­ï¼Œbuildå°±æ˜¯æ­¤é˜¶æ®µçš„åç§°ã€‚<ul>
<li>stages éƒ¨åˆ†ï¼šæµæ°´çº¿ä¸­å¤šä¸ªstageçš„å®¹å™¨ã€‚stageséƒ¨åˆ†è‡³å°‘åŒ…å«ä¸€ä¸ªstageã€‚<ul>
<li>steps éƒ¨åˆ†ï¼šä»£è¡¨é˜¶æ®µä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå…·ä½“æ­¥éª¤ï¼ˆstepï¼‰çš„å®¹å™¨ã€‚stepséƒ¨åˆ†è‡³å°‘åŒ…å«ä¸€ä¸ªæ­¥éª¤ã€‚</li>
</ul>
</li>
<li>post éƒ¨åˆ†ï¼šåŒ…å«çš„æ˜¯åœ¨æ•´ä¸ªpipelineæˆ–é˜¶æ®µå®Œæˆåä¸€äº›é™„åŠ çš„æ­¥éª¤ (å¯é€‰)</li>
</ul>
</li>
</ul>
<p><br></p>
<h4 id="2-1-Sections-ç« èŠ‚"><a href="#2-1-Sections-ç« èŠ‚" class="headerlink" title="2.1) Sections - ç« èŠ‚"></a>2.1) Sections - ç« èŠ‚</h4><p>æè¿°: å£°æ˜æ€§ Pipelineä¸­çš„èŠ‚é€šå¸¸åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡ä»¤æˆ–æ­¥éª¤(Steps)ã€‚</p>
<h5 id="agent-ä»£ç†"><a href="#agent-ä»£ç†" class="headerlink" title="agent - ä»£ç†"></a>agent - ä»£ç†</h5><p>æè¿°: æŒ‡å®šæ•´ä¸ªPipelineæˆ–ç‰¹å®šé˜¶æ®µå°†åœ¨Jenkinsç¯å¢ƒä¸­æ‰§è¡Œçš„ä½ç½®ï¼Œå…·ä½“å–å†³äºè¯¥<code>agent</code> éƒ¨åˆ†çš„æ”¾ç½®ä½ç½®;</p>
<p><strong>è¯­æ³•å‚æ•°:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">å¿…é¡»: YES</span><br><span class="line">å‚æ•°ï¼šany / none / label /ã€€node / docker / dockerfile / kubernetes</span><br><span class="line">  - 1.åœ¨ä»»ä½•å¯ç”¨çš„ agent ä¸Šæ‰§è¡ŒPipelineæˆ–stage</span><br><span class="line">  - 2.åœ¨pipelineå—çš„é¡¶å±‚åº”ç”¨æ—¶ï¼Œä¸ä¼šä¸ºæ•´ä¸ª Pipelineè¿è¡Œåˆ†é…å…¨å±€ä»£ç†ï¼Œå¹¶ä¸”æ¯ä¸ªstageéƒ¨åˆ†éƒ½éœ€è¦åŒ…å«è‡ªå·±çš„agentéƒ¨åˆ†ã€‚</span><br><span class="line">  - 3.ä½¿ç”¨æä¾›çš„æ ‡ç­¾åœ¨Jenkinsç¯å¢ƒä¸­å¯ç”¨çš„ä»£ç†ä¸Šæ‰§è¡Œ Pipelineæˆ–é˜¶æ®µ, æ³¨æ„æ ‡ç­¾æ¡ä»¶ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚</span><br><span class="line">  - 4.nodeä½¿ç”¨ä¸lableç±»ä¼¼</span><br><span class="line">  - 5.æ‰§è¡ŒPipelineæˆ–stageæ—¶ä¼šåŠ¨æ€ä¾›åº”ä¸€ä¸ªdockerèŠ‚ç‚¹å»æ¥å—Docker-basedçš„Pipelinesã€‚</span><br><span class="line">  - 6.ä½¿ç”¨ä»Dockerfileæºå­˜å‚¨åº“ä¸­åŒ…å«çš„å®¹å™¨æ„å»ºçš„å®¹å™¨æ‰§è¡Œ Pipelineæˆ–é˜¶æ®µï¼ŒJenkinsfile å¿…é¡»ä»å¤šåˆ†æ”¯ Pipelineæˆ– SCM PipelineåŠ è½½ã€‚</span><br><span class="line">  - 7.åœ¨Kubernetesé›†ç¾¤ä¸Šéƒ¨ç½²çš„Podå†…æ‰§è¡Œ Pipelineæˆ–é˜¶æ®µï¼ŒåŒæ ·Jenkinsfile å¿…é¡»ä»å¤šåˆ†æ”¯ Pipelineæˆ– SCM PipelineåŠ è½½ï¼ŒPodæ¨¡æ¿åœ¨kubernetes &#123;&#125; å—å†…å®šä¹‰ã€‚</span><br><span class="line">å…è®¸ï¼šåœ¨é¡¶å±‚pipelineå—å’Œæ¯ä¸ªstageå—ä¸­ã€‚</span><br></pre></td></tr></table></figure></p>
<p><strong>è¯­æ³•ç¤ºä¾‹:</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line"></span><br><span class="line">  agent none</span><br><span class="line"></span><br><span class="line">  agent &#123; </span><br><span class="line">    label <span class="string">'my-label1 &amp;&amp; my-label2'</span> </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  agent &#123; node &#123; label <span class="string">'labelName'</span> &#125; &#125;  <span class="comment">// ç­‰åŒäº agent &#123; label 'labelName' &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// docker è¿˜å¯ä»¥æ¥å—ä¸€ä¸ªargsç›´æ¥ä¼ é€’ç»™`docker run`è°ƒç”¨ä»¥åŠä¸€ä¸ª alwaysPull é€‰é¡¹</span></span><br><span class="line">  <span class="comment">// registryUrlå’ŒregistryCredentialsIdå‚æ•° æœ‰åŠ©äºæŒ‡å®šè¦ä½¿ç”¨çš„Dockeræ³¨å†Œè¡¨åŠå…¶å‡­æ®</span></span><br><span class="line">  agent &#123;</span><br><span class="line">    docker &#123;</span><br><span class="line">      image <span class="string">'maven:3-alpine'</span></span><br><span class="line">      label <span class="string">'my-defined-label'</span></span><br><span class="line">      args  <span class="string">'-v /tmp:/tmp'</span></span><br><span class="line">      registryUrl <span class="string">'https://myregistry.com/'</span></span><br><span class="line">      registryCredentialsId <span class="string">'myPredefinedCredentialsInJenkins'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// dockerfile</span></span><br><span class="line">  agent &#123;</span><br><span class="line">    <span class="comment">// ç­‰åŒäº to "docker build -f Dockerfile.build --build-arg version=1.0.2 ./build/</span></span><br><span class="line">    dockerfile &#123;</span><br><span class="line">        filename <span class="string">'Dockerfile.build'</span></span><br><span class="line">        <span class="comment">// å¦‚æœè¦Dockerfileåœ¨å¦ä¸€ä¸ªç›®å½•ä¸­æ„å»ºï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹diré€‰é¡¹</span></span><br><span class="line">        dir <span class="string">'build'</span></span><br><span class="line">        label <span class="string">'my-defined-label'</span></span><br><span class="line">        additionalBuildArgs  <span class="string">'--build-arg version=1.0.2'</span></span><br><span class="line">        args <span class="string">'-v /tmp:/tmp'</span></span><br><span class="line">        <span class="comment">// åŒæ ·ä¹Ÿæ¥å—registryUrlå’ŒregistryCredentialsIdå‚æ•°</span></span><br><span class="line">        registryUrl <span class="string">'https://myregistry.com/'</span></span><br><span class="line">        registryCredentialsId <span class="string">'myPredefinedCredentialsInJenkins'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// kubernetes: ä¾‹å¦‚å¦‚æœè¦åœ¨å…¶ä¸­è£…æœ‰Kanikoå®¹å™¨çš„å®¹å™¨</span></span><br><span class="line">  agent &#123;</span><br><span class="line">    kubernetes &#123;</span><br><span class="line">      label podlabel</span><br><span class="line">      yaml <span class="string">"""</span></span><br><span class="line"><span class="string">  kind: Pod</span></span><br><span class="line"><span class="string">  metadata:</span></span><br><span class="line"><span class="string">    name: jenkins-agent</span></span><br><span class="line"><span class="string">  spec:</span></span><br><span class="line"><span class="string">    containers:</span></span><br><span class="line"><span class="string">    - name: kaniko</span></span><br><span class="line"><span class="string">      image: gcr.io/kaniko-project/executor:debug</span></span><br><span class="line"><span class="string">      imagePullPolicy: Always</span></span><br><span class="line"><span class="string">      command:</span></span><br><span class="line"><span class="string">      - /busybox/cat</span></span><br><span class="line"><span class="string">      tty: true</span></span><br><span class="line"><span class="string">      volumeMounts:</span></span><br><span class="line"><span class="string">        - name: aws-secret</span></span><br><span class="line"><span class="string">          mountPath: /root/.aws/</span></span><br><span class="line"><span class="string">        - name: docker-registry-config</span></span><br><span class="line"><span class="string">          mountPath: /kaniko/.docker</span></span><br><span class="line"><span class="string">    restartPolicy: Never</span></span><br><span class="line"><span class="string">    volumes:</span></span><br><span class="line"><span class="string">      - name: aws-secret</span></span><br><span class="line"><span class="string">        secret:</span></span><br><span class="line"><span class="string">          secretName: aws-secret</span></span><br><span class="line"><span class="string">      - name: docker-registry-config</span></span><br><span class="line"><span class="string">        configMap:</span></span><br><span class="line"><span class="string">          name: docker-registry-config</span></span><br><span class="line"><span class="string">  """</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>å¸¸ç”¨é€‰é¡¹:</strong><br>æè¿°: ä¸‹é¢å¯ä»¥åº”ç”¨äºä¸¤ä¸ªæˆ–è€…å¤šä¸ªagentå®ç°çš„é€‰é¡¹å³labelã€customWorkspaceã€reuseNode;</p>
<ul>
<li>1.label (å‚æ•°:å­—ç¬¦ä¸²): è¿è¡Œ Pipelineæˆ–å•ä¸ª Pipelineçš„æ ‡ç­¾æˆ–æ ‡ç­¾æ¡ä»¶stageã€‚ ã€æ­¤é€‰é¡¹å¯¹nodeï¼Œdockerå’Œæœ‰æ•ˆå¯¹dockerfileå¿…éœ€ nodeã€‚ã€‘</li>
<li>2.customWorkspace (å‚æ•°: å­—ç¬¦ä¸²) : è¿è¡Œ Pipelineæˆ–ä¸ªäºº stage è¿™ agent æ˜¯è¿™ä¸ªè‡ªå®šä¹‰çš„å·¥ä½œç©ºé—´å†…çš„åº”ç”¨ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„, å®ƒå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ï¼ˆ<code>åœ¨è¿™ç§æƒ…å†µä¸‹è‡ªå®šä¹‰å·¥ä½œç©ºé—´å°†ä½äºèŠ‚ç‚¹ä¸Šçš„å·¥ä½œç©ºé—´æ ¹ç›®å½•ä¸‹</code>ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ã€‚ã€æ­¤é€‰é¡¹æ˜¯æœ‰æ•ˆçš„nodeï¼Œdockerå’Œdockerfileã€‚ã€‘</li>
<li>3.reuseNodeï¼ˆå‚æ•°: å¸ƒå°”å€¼-falseï¼‰: å¦‚æœä¸ºtrueåœ¨åŒä¸€å·¥ä½œç©ºé—´ä¸­åœ¨ Pipelineé¡¶çº§æŒ‡å®šçš„èŠ‚ç‚¹ä¸Šè¿è¡Œå®¹å™¨ï¼Œè€Œä¸æ˜¯åœ¨æ•´ä¸ªæ–°èŠ‚ç‚¹ä¸Šè¿è¡Œ</li>
<li>4.args (å‚æ•°: å­—ç¬¦ä¸²): è¦ä¼ é€’ç»™çš„è¿è¡Œæ—¶å‚æ•°docker run,æ­¤é€‰é¡¹å¯¹dockerå’Œæœ‰æ•ˆdockerfileã€‚</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¤ºä¾‹1. Dockerä»£ç†ï¼Œå£°æ˜æ€§ Pipeline</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">  <span class="comment">// V.åœ¨å…·æœ‰ç»™å®šåç§°å’Œæ ‡ç­¾ï¼ˆmaven:3-alpineï¼‰çš„æ–°åˆ›å»ºå®¹å™¨ä¸­æ‰§è¡Œæ­¤ Pipelineä¸­å®šä¹‰çš„æ‰€æœ‰æ­¥éª¤ã€‚</span></span><br><span class="line">  agent &#123; docker <span class="string">'maven:3-alpine'</span> &#125; </span><br><span class="line">  stages &#123;</span><br><span class="line">      stage(<span class="string">'Example Build'</span>) &#123;</span><br><span class="line">          steps &#123;</span><br><span class="line">              sh <span class="string">'mvn -B clean verify'</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¾‹å­2.é˜¶æ®µçº§ä»£ç†éƒ¨åˆ†</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">  <span class="comment">/* agent noneåœ¨ Pipelineçš„é¡¶å±‚è¿›è¡Œå®šä¹‰å¯ç¡®ä¿ ä¸ä¼šä¸å¿…è¦åœ°åˆ†é…æ‰§è¡Œç¨‹åºã€‚ä½¿ç”¨agent noneè¿˜ä¼šå¼ºåˆ¶æ¯ä¸ªstageéƒ¨åˆ†åŒ…å«å…¶è‡ªå·±çš„agentéƒ¨åˆ†ã€‚ */</span></span><br><span class="line">  agent none </span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(<span class="string">'Example Build'</span>) &#123;</span><br><span class="line">      <span class="comment">/* ä½¿ç”¨æ­¤æ˜ åƒåœ¨æ–°åˆ›å»ºçš„å®¹å™¨ä¸­æ‰§è¡Œæ­¤é˜¶æ®µä¸­çš„æ­¥éª¤ã€‚*/</span></span><br><span class="line">      agent &#123; docker <span class="string">'maven:3-alpine'</span> &#125; </span><br><span class="line">      steps &#123;</span><br><span class="line">          echo <span class="string">'Hello, Maven'</span></span><br><span class="line">          sh <span class="string">'mvn --version'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(<span class="string">'Example Test'</span>) &#123;</span><br><span class="line">      <span class="comment">/* ä½¿ç”¨ä¸ä¸Šä¸€é˜¶æ®µä¸åŒçš„å›¾åƒåœ¨æ–°åˆ›å»ºçš„å®¹å™¨ä¸­æ‰§è¡Œæ­¤é˜¶æ®µä¸­çš„æ­¥éª¤ã€‚ */</span></span><br><span class="line">      agent &#123; docker <span class="string">'openjdk:8-jre'</span> &#125; </span><br><span class="line">      steps &#123;</span><br><span class="line">          echo <span class="string">'Hello, JDK'</span></span><br><span class="line">          sh <span class="string">'java -version'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h5 id="stages-é˜¶æ®µ"><a href="#stages-é˜¶æ®µ" class="headerlink" title="stages - é˜¶æ®µ"></a>stages - é˜¶æ®µ</h5><p>æè¿°: Stages æ˜¯ Pipelineæè¿°çš„å¤§éƒ¨åˆ†â€œå·¥ä½œâ€æ‰€åœ¨çš„ä½ç½®, è¯¥éƒ¨åˆ†åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªé˜¶æ®µæŒ‡ä»¤çš„åºåˆ—ã€‚å¯¹äºè¿ç»­äº¤ä»˜è¿‡ç¨‹çš„æ¯ä¸ªç¦»æ•£éƒ¨åˆ†ï¼Œå»ºè®®stagesè‡³å°‘åŒ…å«ä¸€ä¸ªé˜¶æ®µæŒ‡ä»¤ï¼Œä¾‹å¦‚Buildï¼ŒTestå’ŒDeployã€‚</p>
<p>ä½ç½®&amp;å‚æ•°:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¿…é¡»: YES</span><br><span class="line">å‚æ•°ï¼šNONE</span><br><span class="line">å…è®¸ï¼špipelineå—å†…åªæœ‰ä¸€æ¬¡</span><br></pre></td></tr></table></figure></p>
<p>ä¾‹å­.é˜¶æ®µå£°æ˜æ€§ Pipeline<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    <span class="comment">// stageséƒ¨åˆ†å°†å…¸å‹åœ°éµå¾ªæŒ‡ä»¤ï¼Œä¾‹å¦‚agentï¼Œ optionsç­‰</span></span><br><span class="line">    stages &#123; </span><br><span class="line">        stage(<span class="string">'Example'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">'Hello World'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Tips : è¯¥éƒ¨åˆ†å¿…é¡»åœ¨pipelineå—å†…çš„é¡¶å±‚å®šä¹‰ï¼Œä½†stageçº§ä½¿ç”¨æ˜¯å¯é€‰çš„ã€‚<br>Tips : é¡¶çº§ä»£ç†å’Œé˜¶æ®µä»£ç†ä¹‹é—´çš„ç»†å¾®å·®åˆ«ï¼Œè€Œåœ¨optionsåº”ç”¨æŒ‡ä»¤æ—¶ä¼šæœ‰æ‰€ä¸åŒã€‚</p>
<p><br></p>
<h5 id="steps-æ­¥éª¤"><a href="#steps-æ­¥éª¤" class="headerlink" title="steps - æ­¥éª¤"></a>steps - æ­¥éª¤</h5><p>æè¿°: è¯¥é˜¶æ®µåŒ…å«åœ¨ç»™å®šæŒ‡ä»¤ä¸­æ‰§è¡Œçš„ä¸€ç³»åˆ—ä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤ stage ä¹‹ä¸­</p>
<p>ä½ç½®&amp;å‚æ•°:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¿…é¡»: YES</span><br><span class="line">å‚æ•°ï¼šNone</span><br><span class="line">å…è®¸ï¼šæ¯ä¸ªStageå—ä¹‹ä¸­</span><br></pre></td></tr></table></figure></p>
<h6 id="script-è„šæœ¬"><a href="#script-è„šæœ¬" class="headerlink" title="script - è„šæœ¬"></a>script - è„šæœ¬</h6><p>æè¿°: å‰é¢æˆ‘ä»¬è¯´è¿‡æˆ‘ä»¬å¯åœ¨<code>Declarative Pipeline</code> ä¸­ é‡‡ç”¨scriptæŒ‡ä»¤æ¥æ‰§è¡Œ<code>Scripted Pipeline</code>ä¸­çš„ä¸€äº›è„šæœ¬;</p>
<p>ä¾‹å­.å•æ­¥å¼å£°æ˜å¼ &amp;&amp; Script Block in Declarative Pipeline<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">'Example'</span>) &#123;</span><br><span class="line">          <span class="comment">// æ­¥éª¤éƒ¨åˆ†å¿…é¡»åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤ã€‚</span></span><br><span class="line">          steps &#123; </span><br><span class="line">              echo <span class="string">'Hello World'</span></span><br><span class="line">              <span class="comment">// æ‰§è¡Œ Scripted Pipeline (å®é™…ä¸Šå°±æ˜¯ç›´æ¥æ‰§è¡Œå¹¶é‡‡ç”¨GroovyåŸç”Ÿè¯­æ³•)</span></span><br><span class="line">              script &#123;</span><br><span class="line">                <span class="keyword">def</span> browsers = [<span class="string">'chrome'</span>, <span class="string">'firefox'</span>]</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; browsers.size(); ++i) &#123;</span><br><span class="line">                    echo <span class="string">"Testing the $&#123;browsers[i]&#125; browser"</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h6 id="sh-å‘½ä»¤æ‰§è¡Œ"><a href="#sh-å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="sh - å‘½ä»¤æ‰§è¡Œ"></a>sh - å‘½ä»¤æ‰§è¡Œ</h6><p>æè¿°: pipelineä¸­è·å–shellå‘½ä»¤çš„è¾“å‡ºä»¥åŠçŠ¶æ€ï¼Œæ³¨æ„å…¶å¿…é¡»åœ¨steps å—ä»¥åŠ script å—ä¹‹ä¸­</p>
<ul>
<li><p>(0) æœ€ç®€å•çš„æ–¹å¼æœ€ç®€å•çš„æ–¹å¼</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh <span class="string">'&lt;shell command&gt;'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>(1) è·å–æ ‡å‡†è¾“å‡º</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¬¬ä¸€ç§</span></span><br><span class="line">result = sh <span class="string">returnStdout:</span> <span class="literal">true</span> ,<span class="string">script:</span> <span class="string">"&lt;shell command&gt;"</span></span><br><span class="line">result = result.trim()</span><br><span class="line"><span class="comment">//ç¬¬äºŒç§</span></span><br><span class="line">result = sh(<span class="string">script:</span> <span class="string">"&lt;shell command&gt;"</span>, <span class="string">returnStdout:</span> <span class="literal">true</span>).trim()</span><br><span class="line"><span class="comment">//ç¬¬ä¸‰ç§</span></span><br><span class="line">sh <span class="string">"&lt;shell command&gt; &gt; commandResult"</span></span><br><span class="line">result = readFile(<span class="string">'commandResult'</span>).trim()</span><br></pre></td></tr></table></figure>
</li>
<li><p>(2) è·å–æ‰§è¡ŒçŠ¶æ€</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¬¬ä¸€ç§</span></span><br><span class="line">result = sh <span class="string">returnStatus:</span> <span class="literal">true</span> ,<span class="string">script:</span> <span class="string">"&lt;shell command&gt;"</span></span><br><span class="line">result = result.trim()</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬äºŒç§</span></span><br><span class="line">result = sh(<span class="string">script:</span> <span class="string">"&lt;shell command&gt;"</span>, <span class="string">returnStatus:</span> <span class="literal">true</span>).trim()</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬ä¸‰ç§</span></span><br><span class="line">sh <span class="string">'&lt;shell command&gt;; echo $? &gt; status'</span></span><br><span class="line"><span class="keyword">def</span> r = readFile(<span class="string">'status'</span>).trim() <span class="comment">//å€¼å¾—å­¦ä¹ </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬å››ç§</span></span><br><span class="line">sh <span class="string">label:</span> <span class="string">'release'</span>, <span class="string">returnStdout:</span> <span class="literal">true</span>, <span class="string">script:</span><span class="string">"""</span></span><br><span class="line"><span class="string">sudo apk add jq &amp;&amp; \</span></span><br><span class="line"><span class="string">if ( \$(curl -s --header 'PRIVATE-TOKEN: $&#123;private_token&#125;' $&#123;GITLAB_REL&#125; | jq .[].tag_name | grep -c '$&#123;params.RELEASE_VERSION&#125;') != 0 );then echo -n 1 &gt; result.txt;else echo -n 0 &gt; result.txt;fi</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">def</span> r = readFile(<span class="string">'result.txt'</span>).trim() <span class="comment">//å€¼å¾—å­¦ä¹ </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„ä½¿ç”¨'ä½†å¼•å·ä¹Ÿå¯ä»¥è§£æå˜é‡</span></span><br><span class="line">sh(<span class="string">returnStatus:</span> <span class="literal">true</span>, <span class="string">script:</span> <span class="string">"sudo apk add jq &amp;&amp; curl -s --header 'PRIVATE-TOKEN: $&#123;private_token&#125;' $&#123;GITLAB_REL&#125; | jq .[].tag_name | grep -c '$&#123;params.RELEASE_VERSION&#125;'"</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>å®é™…æ¡ˆä¾‹:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// # (1) å‘½ä»¤æ‹¼æ¥</span></span><br><span class="line">sh <span class="string">' $SonarScannerHome/bin/sonar-scanner '</span> +</span><br><span class="line">    <span class="string">'-Dsonar.sources=src/main '</span> +</span><br><span class="line">    <span class="string">'-Dsonar.projectKey="test" '</span> +</span><br><span class="line">    <span class="string">'-Dsonar.projectName="test" '</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">// # (2) å€¼ä¼ é€’åˆ°å‚æ•°</span></span><br><span class="line">stage (<span class="string">"æµ‹è¯•"</span>) &#123;</span><br><span class="line">  steps &#123;</span><br><span class="line">    timeout(<span class="string">time:</span> <span class="number">1</span>, <span class="string">unit:</span> <span class="string">'MINUTES'</span>) &#123;</span><br><span class="line">        script &#123;</span><br><span class="line">          <span class="keyword">def</span> RELEASE=sh <span class="string">returnStdout:</span> <span class="literal">true</span>, <span class="string">script:</span> <span class="string">'git tag -l --column'</span>   <span class="comment">// # git show --oneline --ignore-all-space --text | head -n 1</span></span><br><span class="line">          env.DEPLOY_ENV = input <span class="string">message:</span> <span class="string">"é€‰æ‹©éƒ¨ç½²çš„ç¯å¢ƒçš„ç‰ˆæœ¬"</span>, <span class="string">ok:</span> <span class="string">'deploy'</span>,</span><br><span class="line"><span class="symbol">              parameters:</span> [string(<span class="string">name:</span> <span class="string">'DEPLOY_ENV'</span>,<span class="string">defaultValue:</span> <span class="string">"$&#123;RELEASE&#125;"</span>,<span class="string">description:</span> <span class="string">"å¯é€‰é¡¹é€‰æ‹©çš„ç‰ˆæœ¬ $&#123;RELEASE&#125;"</span>)]</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// # (3) å¤šè¡Œå‘½ä»¤æ‰§è¡Œ(å€¼å¾—æ³¨æ„åœ¨shä¸­å¾— $ç¬¦å· éœ€è¦é‡‡ç”¨ \$ è¿›è¡Œè½¬ä¹‰)</span></span><br><span class="line">stage (<span class="string">"æµ‹è¯•"</span>) &#123;</span><br><span class="line">  steps &#123;</span><br><span class="line">      timeout(<span class="string">time:</span> <span class="number">1</span>, <span class="string">unit:</span> <span class="string">'MINUTES'</span>) &#123;</span><br><span class="line">      script &#123;</span><br><span class="line">          <span class="keyword">def</span> RELEASE=sh <span class="string">returnStdout:</span> <span class="literal">true</span>, <span class="string">script:</span> <span class="string">'git tag -l --column'</span></span><br><span class="line">          <span class="keyword">def</span> RELE=sh <span class="string">returnStdout:</span> <span class="literal">true</span>, <span class="string">script:</span> <span class="string">"""\</span></span><br><span class="line"><span class="string">          git tag -l --column | tr -d ' '  &gt; tag ;</span></span><br><span class="line"><span class="string">          export a="\$(sed "s#v#,'v#g" tag)'";</span></span><br><span class="line"><span class="string">          echo [\$&#123;a#,*&#125;];</span></span><br><span class="line"><span class="string">          """</span></span><br><span class="line">          <span class="comment">// env.DEPLOY_ENV = input message: "é€‰æ‹©éƒ¨ç½²çš„ç¯å¢ƒçš„ç‰ˆæœ¬1", ok: 'deploy',</span></span><br><span class="line">          <span class="comment">//     parameters: [string(name: 'DEPLOY_ENV',defaultValue: "$&#123;RELEASE&#125;",description: "å¯é€‰é¡¹é€‰æ‹©çš„ç‰ˆæœ¬ $&#123;RELEASE&#125;")]</span></span><br><span class="line">          <span class="comment">// &#125;</span></span><br><span class="line">          println RELE <span class="comment">// ['v1.1,'v1.10,'v1.11,'v1.2,'v1.3,'v1.6,'v1.7,'v1.8,'v1.9']</span></span><br><span class="line">          <span class="comment">// é€‰æ‹©éƒ¨ç½²çš„ç¯å¢ƒçš„ç‰ˆæœ¬ ['v1.1,'v1.10,'v1.11,'v1.2,'v1.3,'v1.6,'v1.7,'v1.8,'v1.9']</span></span><br><span class="line">          env.DEPLOY_RELEASE = input <span class="string">message:</span> <span class="string">"é€‰æ‹©éƒ¨ç½²çš„ç¯å¢ƒçš„ç‰ˆæœ¬ $&#123;RELE&#125;"</span>, <span class="string">ok:</span> <span class="string">'deploy'</span>,   </span><br><span class="line"><span class="symbol">          parameters:</span> [choice(<span class="string">name:</span> <span class="string">'PREJECT_OPERATION'</span>, <span class="string">choices:</span> [<span class="string">"ss"</span>,<span class="string">"s"</span>], <span class="string">description:</span> <span class="string">'Message: é€‰æ‹©é¡¹ç›®ç‰ˆæœ¬? $&#123;RELE&#125;'</span>)]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=2.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineè¯­æ³•å…¥é—¨å­¦ä¹  href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210201153324.png" target="_blank" title="WeiyiGeek.scriptå—&shæŒ‡ä»¤è”åˆä½¿ç”¨" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210201153324.png" alt="WeiyiGeek.scriptå—&shæŒ‡ä»¤è”åˆä½¿ç”¨" title="" class=""></a>
                <p>WeiyiGeek.scriptå—&shæŒ‡ä»¤è”åˆä½¿ç”¨</p>
            </figure>
<p>Tips : æ³¨æ„ä¼ é€’å˜é‡å¾—ç”Ÿå­˜å‘¨æœŸä»¥åŠèŒƒå›´ï¼Œåœ¨pipelineå…¨å±€ä¸­åˆ™å…¨å±€æœ‰æ•ˆï¼Œè€Œstageå—ä¸­åˆ™è¯¥å—ä¸­æœ‰æ•ˆï¼Œå…¶ä»–stageå¼•ç”¨åˆ™æŠ¥<code>No such property: å˜é‡åç§° for class: groovy.lang.Binding</code>é”™è¯¯</p>
<p><br></p>
<h5 id="post-å‘å¸ƒ"><a href="#post-å‘å¸ƒ" class="headerlink" title="post - å‘å¸ƒ"></a>post - å‘å¸ƒ</h5><p>æè¿°: æœ¬postéƒ¨åˆ†å®šä¹‰äº†åœ¨ Pipelineæˆ–é˜¶æ®µçš„è¿è¡Œå®Œæˆåè¿è¡Œçš„ä¸€ä¸ªæˆ–å¤šä¸ªå…¶ä»–æ­¥éª¤ï¼ˆ<code>å–å†³äºè¯¥postéƒ¨åˆ†åœ¨ Pipelineä¸­çš„ä½ç½®</code>ï¼‰,å³å®šä¹‰Pipelineæˆ–stageè¿è¡Œç»“æŸæ—¶çš„æ“ä½œ, é€šå¸¸<code>å°†æ¸…ç†å·¥ä½œç©ºé—´ä»¥åŠæ„å»ºçŠ¶æ€çš„æ¶ˆæ¯é€šçŸ¥(Email/é’‰é’‰ã€ä¼ä¸šå¾®ä¿¡æˆ–è€…å…¶ä»–WebHook)</code>;<br>postå¯ä»¥æ”¯æŒä»»ä½•ä»¥ä¸‹çš„åç½®æ¡ä»¶å—ï¼š<code>alwaysï¼Œ changedï¼Œfixedï¼Œregressionï¼Œabortedï¼Œfailureï¼Œsuccessï¼Œ unstableï¼Œunsuccessfulï¼Œå’Œcleanup</code>, æ¡ä»¶å—å…è®¸æ ¹æ® Pipelineæˆ–é˜¶æ®µçš„å®ŒæˆçŠ¶æ€åœ¨æ¯ä¸ªæ¡ä»¶å†…æ‰§è¡Œæ­¥éª¤ã€‚</p>
<p><strong>ä½ç½®&amp;å‚æ•°:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">å¿…é¡»: NO</span><br><span class="line"></span><br><span class="line">å‚æ•°ï¼š`alwaysï¼Œchangedï¼Œfixedï¼Œregressionï¼Œabortedï¼Œfailureï¼Œsuccessï¼Œ unstableï¼Œunsuccessfulï¼Œå’Œcleanup`</span><br><span class="line">  - always ï¼špostä¸ç®¡ Pipelineè¿è¡Œæˆ–é˜¶æ®µè¿è¡Œçš„å®ŒæˆçŠ¶æ€å¦‚ä½•ï¼Œéƒ½è¿è¡Œæœ¬èŠ‚ä¸­çš„æ­¥éª¤ã€‚</span><br><span class="line">  - changed ï¼šä»…postå½“å½“å‰ Pipelineæˆ–é˜¶æ®µçš„è¿è¡Œä¸ä¹‹å‰çš„è¿è¡Œå…·æœ‰ä¸åŒçš„å®ŒæˆçŠ¶æ€æ—¶ï¼Œæ‰è¿è¡Œæ­¥éª¤ã€‚</span><br><span class="line">  - fixed ï¼šä»…poståœ¨å½“å‰ Pipelineæˆ–é˜¶æ®µçš„è¿è¡ŒæˆåŠŸå¹¶ä¸”å‰ä¸€è¿è¡Œå¤±è´¥æˆ–ä¸ç¨³å®šçš„æƒ…å†µä¸‹è¿è¡Œæ­¥éª¤ã€‚</span><br><span class="line">  - regression ï¼šä»…postå½“å½“å‰ Pipelineæˆ–é˜¶æ®µçš„è¿è¡ŒçŠ¶æ€ä¸ºå¤±è´¥ï¼Œä¸ç¨³å®šæˆ–ä¸­æ­¢å¹¶ä¸”ä¸Šä¸€æ¬¡è¿è¡ŒæˆåŠŸæ—¶ï¼Œæ‰è¿è¡Œæ­¥éª¤ã€‚</span><br><span class="line">  - aborted ï¼šä»…poståœ¨å½“å‰ Pipelineæˆ–é˜¶æ®µçš„è¿è¡ŒçŠ¶æ€ä¸ºâ€œä¸­æ­¢â€æ—¶æ‰è¿è¡Œæ­¥éª¤ï¼Œé€šå¸¸æ˜¯ç”±äºæ‰‹åŠ¨ä¸­æ­¢äº† Pipelineã€‚é€šå¸¸åœ¨ç½‘ç»œç”¨æˆ·ç•Œé¢ä¸­ç”¨ç°è‰²è¡¨ç¤ºã€‚</span><br><span class="line">  - failure ï¼šä»…postå½“å½“å‰ Pipelineæˆ–é˜¶æ®µçš„è¿è¡Œå…·æœ‰â€œå¤±è´¥â€çŠ¶æ€æ—¶æ‰è¿è¡Œè¿™äº›æ­¥éª¤ï¼Œé€šå¸¸åœ¨Web UIä¸­ç”¨çº¢è‰²è¡¨ç¤ºã€‚</span><br><span class="line">  - success ï¼šä»…postå½“å½“å‰ Pipelineæˆ–é˜¶æ®µçš„è¿è¡Œå…·æœ‰â€œæˆåŠŸâ€çŠ¶æ€æ—¶æ‰è¿è¡Œæ­¥éª¤ï¼Œé€šå¸¸åœ¨Web UIä¸­ç”¨è“è‰²æˆ–ç»¿è‰²è¡¨ç¤ºã€‚</span><br><span class="line">  - unstable ï¼šä»…poståœ¨å½“å‰ Pipelineæˆ–é˜¶æ®µçš„è¿è¡ŒçŠ¶æ€ä¸ºâ€œä¸ç¨³å®šâ€ï¼ˆé€šå¸¸ç”±æµ‹è¯•å¤±è´¥ï¼Œä»£ç å†²çªç­‰å¼•èµ·ï¼‰çš„æƒ…å†µä¸‹ï¼Œæ‰è¿è¡Œæ­¥éª¤ã€‚é€šå¸¸åœ¨Web UIä¸­ä»¥é»„è‰²è¡¨ç¤ºã€‚</span><br><span class="line">  - unsuccessful ï¼šä»…postå½“å½“å‰ Pipelineæˆ–é˜¶æ®µçš„è¿è¡ŒçŠ¶æ€ä¸æ˜¯â€œæˆåŠŸâ€æ—¶æ‰è¿è¡Œæ­¥éª¤ã€‚è¿™é€šå¸¸æ ¹æ®å‰é¢æåˆ°çš„çŠ¶æ€åœ¨Web UIä¸­è¡¨ç¤ºã€‚</span><br><span class="line">  - cleanup ï¼š åœ¨è¯„ä¼°postæ‰€æœ‰å…¶ä»–æ¡ä»¶ä¹‹åpostï¼Œæ— è®º Pipelineæˆ–é˜¶æ®µçš„çŠ¶æ€å¦‚ä½•ï¼Œéƒ½åœ¨æ­¤æ¡ä»¶ä¸‹è¿è¡Œæ­¥éª¤ã€‚</span><br><span class="line"></span><br><span class="line">å…è®¸ä½ç½®ï¼šåœ¨é¡¶å±‚pipelineå—å’Œæ¯ä¸ªstageå—ä¸­ã€‚</span><br></pre></td></tr></table></figure></p>
<p>ç¤ºä¾‹.Post éƒ¨åˆ†ç¤ºä¾‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(<span class="string">'Example'</span>) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">          <span class="built_in">echo</span> <span class="string">'Hello World'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  post &#123; </span><br><span class="line">    always &#123; </span><br><span class="line">      <span class="built_in">echo</span> <span class="string">'I will always say Hello again!'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<h4 id="2-2-Directives-æŒ‡ä»¤"><a href="#2-2-Directives-æŒ‡ä»¤" class="headerlink" title="2.2) Directives - æŒ‡ä»¤"></a>2.2) Directives - æŒ‡ä»¤</h4><p>æè¿°: æ˜¾ç„¶åŸºæœ¬ç»“æ„æ»¡è¶³ä¸äº†ç°å®å¤šå˜çš„éœ€æ±‚ã€‚æ‰€ä»¥Jenkins pipelineé€šè¿‡å„ç§æŒ‡ä»¤ï¼ˆdirectiveï¼‰æ¥ä¸°å¯Œè‡ªå·±ã€‚æŒ‡ä»¤å¯ä»¥è¢«ç†è§£ä¸ºå¯¹<code>Jenkins pipeline</code>åŸºæœ¬ç»“æ„çš„è¡¥å……ã€‚</p>
<p>Jenkins pipelineæ”¯æŒçš„æŒ‡ä»¤æœ‰ï¼š</p>
<ul>
<li>environmentï¼šç”¨äºè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå¯å®šä¹‰åœ¨stageæˆ–pipelineéƒ¨åˆ†ã€‚</li>
<li>toolsï¼šå¯å®šä¹‰åœ¨pipelineæˆ–stageéƒ¨åˆ†ã€‚å®ƒä¼šè‡ªåŠ¨ä¸‹è½½å¹¶å®‰è£…æˆ‘ä»¬æŒ‡å®šçš„å·¥å…·ï¼Œå¹¶å°†å…¶åŠ å…¥PATHå˜é‡ä¸­ã€‚</li>
<li>inputï¼šå®šä¹‰åœ¨stageéƒ¨åˆ†ï¼Œä¼šæš‚åœpipelineï¼Œæç¤ºä½ è¾“å…¥å†…å®¹ã€‚</li>
<li>optionsï¼šç”¨äºé…ç½®Jenkins pipelineæœ¬èº«çš„é€‰é¡¹ï¼Œæ¯”å¦‚options {retryï¼ˆ3ï¼‰}æŒ‡å½“pipelineå¤±è´¥æ—¶å†é‡è¯•2æ¬¡ã€‚optionsæŒ‡ä»¤å¯å®šä¹‰åœ¨stageæˆ–pipelineéƒ¨åˆ†ã€‚</li>
<li>parallelï¼šå¹¶è¡Œæ‰§è¡Œå¤šä¸ªstepã€‚åœ¨pipelineæ’ä»¶1.2ç‰ˆæœ¬åï¼Œparallelå¼€å§‹æ”¯æŒå¯¹å¤šä¸ªé˜¶æ®µè¿›è¡Œå¹¶è¡Œæ‰§è¡Œã€‚</li>
<li>parametersï¼šä¸inputä¸åŒï¼Œparametersæ˜¯æ‰§è¡Œpipelineå‰ä¼ å…¥çš„ä¸€äº›å‚æ•°ã€‚</li>
<li>triggersï¼šç”¨äºå®šä¹‰æ‰§è¡Œpipelineçš„è§¦å‘å™¨ã€‚</li>
<li>whenï¼šå½“æ»¡è¶³whenå®šä¹‰çš„æ¡ä»¶æ—¶ï¼Œé˜¶æ®µæ‰æ‰§è¡Œã€‚</li>
</ul>
<p>Tips: åœ¨ä½¿ç”¨æŒ‡ä»¤æ—¶éœ€è¦æ³¨æ„çš„æ˜¯æ¯ä¸ªæŒ‡ä»¤éƒ½æœ‰è‡ªå·±çš„â€œä½œç”¨åŸŸâ€ã€‚å¦‚æœæŒ‡ä»¤ä½¿ç”¨çš„ä½ç½®ä¸æ­£ç¡®Jenkinså°†ä¼šæŠ¥é”™ã€‚</p>
<p><br/></p>
<h5 id="environment-ç¯å¢ƒ"><a href="#environment-ç¯å¢ƒ" class="headerlink" title="environment - ç¯å¢ƒ"></a>environment - ç¯å¢ƒ</h5><p>æè¿°: è¯¥æŒ‡å®šäº†ä¸€ç³»åˆ—é”®å€¼å¯¹ï¼Œè¿™äº›é”®å€¼å¯¹å°†è¢«å®šä¹‰ä¸ºæ‰€æœ‰æ­¥éª¤æˆ–ç‰¹å®šäºé˜¶æ®µçš„æ­¥éª¤çš„ç¯å¢ƒå˜é‡ï¼Œå…·ä½“å–å†³äºè¯¥environmentæŒ‡ä»¤åœ¨ Pipelineä¸­çš„ä½ç½®ã€‚</p>
<p><strong>ä½ç½®&amp;å‚æ•°:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¿…é¡»: No</span><br><span class="line">å‚æ•°ï¼šYes</span><br><span class="line">å…è®¸ï¼šåœ¨pipelineå—å†…ï¼Œæˆ–åœ¨stageæŒ‡ä»¤å†…ã€‚</span><br></pre></td></tr></table></figure></p>
<p>Tips : <code>éå¸¸æ³¨æ„</code>è¯¥å—ä¸­çš„å˜é‡å°†å†™å…¥åˆ°Linuxç¯å¢ƒå˜é‡ä¹‹ä¸­ä½œä¸ºå…¨å±€å˜é‡ï¼Œåœ¨shellå¯é€šè¿‡å˜é‡åè®¿é—®ï¼Œè€Œåœ¨script pipelineè„šæœ¬ä¸­é€šè¿‡env.å˜é‡åç§°è®¿é—®.</p>
<p><strong>æ”¯æŒçš„å‡­è¯ç±»å‹ï¼šSupported Credentials Type</strong></p>
<ul>
<li>Secret Text ï¼šè®¾ç½®ä¸ºåŠ å¯†æ–‡æœ¬å­—ç¬¦ä¸²å†…å®¹</li>
<li>Secret File : è®¾ç½®ä¸ºä¸´æ—¶åˆ›å»ºçš„æ–‡ä»¶æ–‡ä»¶çš„ä½ç½®, å¹¶è‡ªåŠ¨å®šä¹‰å˜é‡å­˜å‚¨è¯¥æ–‡ä»¶å†…å®¹ã€‚</li>
<li>Username and password : å°†è®¾ç½®ä¸º<code>username:password</code>å¹¶ä¸”ä¸¤ä¸ªå…¶ä»–ç¯å¢ƒå˜é‡å°†è‡ªåŠ¨å®šä¹‰ä¸º<code>MYVARNAME_USR å’ŒMYVARNAME_PSW</code>ã€‚</li>
<li>SSH with Private Key : è®¾ç½®ä¸ºä¸´æ—¶åˆ›å»ºçš„SSHå¯†é’¥æ–‡ä»¶çš„ä½ç½®ï¼Œå¹¶ä¸”å¯èƒ½ä¼šè‡ªåŠ¨å®šä¹‰ä¸¤ä¸ªå…¶ä»–ç¯å¢ƒå˜é‡ï¼š<code>MYVARNAME_USR</code>å’Œ<code>MYVARNAME_PSW</code>ï¼ˆä¿ç•™å¯†ç ï¼‰ã€‚</li>
</ul>
<p><br/></p>
<p>ç¤ºä¾‹1:ç§˜å¯†æ–‡æœ¬å‡­è¯ï¼Œå£°æ˜æ€§ Pipeline<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line">  <span class="comment">// (1) ç”±äºåœ¨pipelineä¸‹ä¸€å±‚ï¼Œåˆ™ä½¿ç”¨çš„æŒ‡ä»¤å°†åº”ç”¨äº Pipelineä¸­çš„æ‰€æœ‰æ­¥éª¤ã€‚</span></span><br><span class="line">  environment &#123; </span><br><span class="line">    CC = <span class="string">'clang'</span></span><br><span class="line">  &#125;</span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(<span class="string">'Example'</span>) &#123;</span><br><span class="line">      <span class="comment">// (2) åœ¨ stage ä¸­å®šä¹‰çš„ environmentæŒ‡ä»¤åªä¼šå°†ç»™å®šçš„ç¯å¢ƒå˜é‡åº”ç”¨äºExampleå†…çš„æ­¥éª¤ã€‚</span></span><br><span class="line">        environment &#123; </span><br><span class="line">          <span class="comment">// åœ¨environmentå—ä¸­credentials('å‡­æ®åç§°')å®šä¹‰çš„å¸®åŠ©ç¨‹åºæ–¹æ³•é€šè¿‡å…¶åœ¨Jenkinsç¯å¢ƒä¸­çš„æ ‡è¯†ç¬¦æ¥è®¿é—®é¢„å®šä¹‰çš„å‡­æ®</span></span><br><span class="line">          AN_ACCESS_KEY = credentials(<span class="string">'my-predefined-secret-text'</span>) </span><br><span class="line">        &#125;</span><br><span class="line">        steps &#123;</span><br><span class="line">          sh <span class="string">'printenv'</span></span><br><span class="line">          echo <span class="string">"$&#123;env.AN_ACCESS_KEY&#125;"</span></span><br><span class="line">          echo <span class="string">"$&#123;env.CC&#125;"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>ç¤ºä¾‹2.ç”¨æˆ·åå’Œå¯†ç å‡­è¯<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(<span class="string">'Example Username/Password'</span>) &#123;</span><br><span class="line">      environment &#123;</span><br><span class="line">        <span class="comment">// å˜é‡ = å°†ç”¨æˆ·å¯†ç å‡­è¯èµ‹äºˆå˜é‡</span></span><br><span class="line">        SERVICE_CREDS = credentials(<span class="string">'my-predefined-username-password'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      steps &#123;</span><br><span class="line">        <span class="comment">// æ³¨æ„ç‚¹: defined: MYVARNAME_USR and MYVARNAME_PSW respectively.</span></span><br><span class="line">        sh <span class="string">'echo "Service user is $SERVICE_CREDS_USR"'</span></span><br><span class="line">        sh <span class="string">'echo "Service password is $SERVICE_CREDS_PSW"'</span></span><br><span class="line">        sh <span class="string">'curl -u $SERVICE_CREDS https://myservice.example.com'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(<span class="string">'Example SSH Username with private key'</span>) &#123;</span><br><span class="line">      environment &#123;</span><br><span class="line">        <span class="comment">// å˜é‡ = å°† `ssh private` å…¬å¯†é’¥è¿›è¡Œèµ‹äºˆå˜é‡</span></span><br><span class="line">        SSH_CREDS = credentials(<span class="string">'my-predefined-ssh-creds'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      steps &#123;</span><br><span class="line">        <span class="comment">// æ³¨æ„ç‚¹: defined: MYVARNAME_USR and MYVARNAME_PSW (holding the passphrase).</span></span><br><span class="line">        sh <span class="string">'echo "SSH private key is located at $SSH_CREDS"'</span></span><br><span class="line">        sh <span class="string">'echo "SSH user is $SSH_CREDS_USR"'</span></span><br><span class="line">        sh <span class="string">'echo "SSH passphrase is $SSH_CREDS_PSW"'</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// è°ƒç”¨å†…ç½®å˜é‡ (å¦‚æœå˜é‡ä¸å­˜åœ¨åˆ™è¾“å‡ºnull) - å€¼å¾—å­¦ä¹ æ³¨æ„ã€‚</span></span><br><span class="line">        echo <span class="string">"$&#123;JOB_NAME&#125;"</span></span><br><span class="line">        echo env.<span class="string">'JOB_NAME'</span></span><br><span class="line">        println(env.<span class="string">'JOB_NAME'</span>)  </span><br><span class="line"></span><br><span class="line">        <span class="comment">// è‡ªå®šä¹‰å…¨å±€å˜é‡æ–¹å¼(å†™å…¥æ–‡ä»¶ä¸­å†è¯»å–)</span></span><br><span class="line">        script &#123;</span><br><span class="line">          <span class="keyword">def</span> projectProduct = sh <span class="string">returnStdout:</span> <span class="literal">true</span>, <span class="string">script:</span> <span class="string">"find $&#123;APP_NAME&#125;"</span></span><br><span class="line">          <span class="keyword">if</span> ( projectProduct != <span class="string">''</span> )&#123;</span><br><span class="line">            echo <span class="string">"$&#123;projectProduct&#125;"</span></span><br><span class="line">            writeFile <span class="string">file:</span> <span class="string">'abc.sh'</span>, <span class="string">text:</span> <span class="string">"$&#123;projectProduct&#125;"</span></span><br><span class="line">            change_id = readFile <span class="string">'abc.sh'</span></span><br><span class="line">            print(change_id)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            error <span class="string">"[-Error] : projectProduct ä¸èƒ½ä¸ºç©º!"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Tips : è¯¥æŒ‡ä»¤æ”¯æŒç‰¹æ®Šçš„<code>å¸®åŠ©ç¨‹åºæ–¹æ³•credentials()</code>ï¼Œè¯¥æ–¹æ³•å¯ç”¨äºåœ¨Jenkinsç¯å¢ƒä¸­é€šè¿‡å…¶æ ‡è¯†ç¬¦è®¿é—®é¢„å®šä¹‰çš„å‡­æ®ã€‚</p>
<p>Tips : å¦‚æœ‰ä¸æ”¯æŒçš„å‡­æ®ç±»å‹å¯¼è‡´ Pipelineå¤±è´¥ï¼Œå¹¶æ˜¾ç¤ºä»¥ä¸‹æ¶ˆæ¯ï¼š<code>org.jenkinsci.plugins.credentialsbinding.impl.CredentialNotFoundException: No suitable binding handler could be found for type &lt;unsupportedType&gt;.</code></p>
<p><br></p>
<h5 id="options-é€‰é¡¹"><a href="#options-é€‰é¡¹" class="headerlink" title="options - é€‰é¡¹"></a>options - é€‰é¡¹</h5><p>æè¿°: options æŒ‡ä»¤ å…è®¸åœ¨ <code>Pipeline</code> æœ¬èº«å†…é…ç½® Pipeline ä¸“ç”¨é€‰é¡¹, ä¾‹å¦‚ buildDiscarder å®ƒä»¬ä¹Ÿå¯èƒ½ç”±æ’ä»¶æä¾›;</p>
<p><strong>ä½ç½®&amp;å‚æ•°:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¿…é¡»: No</span><br><span class="line">å‚æ•°ï¼šNone</span><br><span class="line">å…è®¸ï¼špipelineå—å†…åªæœ‰ä¸€æ¬¡ã€‚</span><br></pre></td></tr></table></figure></p>
<p><strong>å¯ç”¨é€‰é¡¹:</strong></p>
<ul>
<li><p>1.<code>buildDiscarder</code> ï¼š ä¿å­˜æœ€è¿‘å†å²æ„å»ºè®°å½•çš„æ•°é‡ã€‚è®¾ç½®æ­¤é€‰é¡¹åä¼šè‡ªåŠ¨æ¸…ç†pipeline çš„æ„å»ºå†å²ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options &#123; buildDiscarder(logRotator(numToKeepStr: <span class="string">'1'</span>)) &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.<code>disableConcurrentBuilds</code> : ç¦æ­¢å¹¶å‘æ‰§è¡Œ Pipeline å¯¹äºé˜²æ­¢åŒæ—¶è®¿é—®å…±äº«èµ„æºç­‰å¾ˆæœ‰ç”¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options &#123; disableConcurrentBuilds() &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>3.<code>checkoutToSubdirectory</code> : Jenkinsä»ç‰ˆæœ¬æ§åˆ¶åº“æ‹‰å–æºç æ—¶ï¼Œé»˜è®¤æ£€å‡ºåˆ°å·¥ä½œç©ºé—´çš„æ ¹ç›®å½•ä¸­ï¼Œæ­¤é€‰é¡¹å¯ä»¥æŒ‡å®šæ£€å‡ºåˆ°å·¥ä½œç©ºé—´çš„å­ç›®å½•ä¸­ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options &#123; checkoutToSubdirectory(<span class="string">'foo'</span>) &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>4.<code>newContainerPerStage</code> : å½“agentä¸ºdockeræˆ–dockerfileæ—¶ï¼ŒæŒ‡å®šåœ¨åŒä¸€ä¸ªJenkinsèŠ‚ç‚¹ä¸Šï¼Œæ¯ä¸ªstageéƒ½åˆ†åˆ«è¿è¡Œåœ¨ä¸€ä¸ªæ–°çš„å®¹å™¨ä¸­ï¼Œè€Œä¸æ˜¯æ‰€æœ‰stageéƒ½è¿è¡Œåœ¨åŒä¸€ä¸ªå®¹å™¨ä¸­ã€‚</p>
</li>
<li><p>5.<code>disableResume</code> : å¦‚æœæ§åˆ¶å™¨é‡æ–°å¯åŠ¨åˆ™ä¸å…è®¸ Pipelineæ¢å¤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options &#123; disableResume() &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>6.<code>overrideIndexTriggers</code> : å…è®¸é‡å†™åˆ†æ”¯ç´¢å¼•è§¦å‘å™¨çš„é»˜è®¤å¤„ç†,å¦‚æœåœ¨å¤šåˆ†æ”¯æˆ–ç»„ç»‡æ ‡ç­¾å¤„ç¦ç”¨äº†åˆ†æ”¯ç´¢å¼•è§¦å‘å™¨ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»…ä¸ºè¯¥ä½œä¸šå¯ç”¨åˆ†æ”¯ç´¢å¼•è§¦å‘å™¨</span></span><br><span class="line">options &#123; overrideIndexTriggers(<span class="literal">true</span>) &#125; </span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»…ä¸ºæ­¤ä½œä¸šç¦ç”¨åˆ†æ”¯ç´¢å¼•è§¦å‘å™¨</span></span><br><span class="line">options &#123; overrideIndexTriggers(<span class="literal">false</span>) &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>7.<code>preserveStashes</code>: ä¿ç•™å·²å®Œæˆæ„å»ºä¸­çš„éšè—é¡¹ï¼Œä»¥ç”¨äºé˜¶æ®µé‡æ–°å¯åŠ¨ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿å­˜æ„å»º</span></span><br><span class="line">options &#123; preserveStashes() &#125; </span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿å­˜æœ€è¿‘5æ¬¡æ„å»º</span></span><br><span class="line">options &#123; preserveStashes(buildCount: 5) &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>8.<code>quietPeriod</code>:è®¾ç½® Pipelineçš„é™é»˜æ—¶é—´æ®µï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ï¼Œä»¥è¦†ç›–å…¨å±€é»˜è®¤å€¼</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options &#123; quietPeriod(30) &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>9.<code>retry</code>ï¼šå¦‚æœå¤±è´¥é‡è¯•æ•´ä¸ª PipelineæŒ‡å®šæ¬¡æ•°ã€‚è¯¥æ¬¡æ•°æ˜¯æŒ‡æ€»æ¬¡æ•°åŒ…æ‹¬ç¬¬1æ¬¡å¤±è´¥ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options &#123; retry(3) &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>10.<code>skipDefaultCheckout</code> : é»˜è®¤è·³è¿‡æ¥è‡ªæºä»£ç æ§åˆ¶çš„ä»£ç ï¼ˆä»£ç†æŒ‡ä»¤ï¼‰ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options &#123; skipDefaultCheckout() &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>11.<code>skipStagesAfterUnstable</code> : ä¸€æ—¦æ„å»ºçŠ¶æ€å˜å¾—ä¸ç¨³å®šå°±è·³è¿‡å„ä¸ªé˜¶æ®µ;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options &#123; skipStagesAfterUnstable() &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>12.<code>timestamps</code> : é¢„å®šä¹‰ç”±Pipelineç”Ÿæˆçš„æ‰€æœ‰æ§åˆ¶å°è¾“å‡ºæ—¶é—´</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options &#123; timestamps() &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>13.<code>parallelsAlwaysFailFast</code> ï¼šå°† Pipelineä¸­æ‰€æœ‰åç»­å¹¶è¡Œé˜¶æ®µçš„failfastè®¾ç½®ä¸ºtrueã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options &#123; parallelsAlwaysFailFast() &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>14.<code>timeout</code>(<code>å¸¸ç”¨</code>) : è®¾ç½® Pipelineè¿è¡Œçš„è¶…æ—¶æ—¶é—´åœ¨æ­¤ä¹‹åJenkins åº”ä¸­æ­¢ Pipeline(è¿è¡Œçš„è¶…æ—¶æ—¶é—´)ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ“å®ˆæ—¶é—´ä¸€ä¸ªå°æ—¶(HOURS/Minute)</span></span><br><span class="line">options &#123; timeout(time: 1, unit: <span class="string">'HOURS'</span>) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Global Timeout, Declarative Pipeline</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    options &#123;</span><br><span class="line">      // å°†å…¨å±€æ‰§è¡Œè¶…æ—¶æŒ‡å®šä¸ºä¸€å°æ—¶ï¼Œç„¶åJenkinså°†ä¸­æ­¢ Pipelineè¿è¡Œã€‚</span><br><span class="line">      timeout(time: 1, unit: <span class="string">'HOURS'</span>) </span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">'Example'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                <span class="built_in">echo</span> <span class="string">'Hello World'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Tips: åœ¨ stage å—ä¸­æ”¯æŒçš„ options è¦å°‘äº pipeline å—ä¸­ï¼Œåªèƒ½é‡‡ç”¨<code>skipDefaultCheckoutï¼Œtimeoutï¼Œretryï¼Œtimestamps</code> ç­‰é€‰é¡¹;</p>
<p>ä¾‹å¦‚:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">'Example'</span>) &#123;</span><br><span class="line">            <span class="comment">// å…³é”®å•</span></span><br><span class="line">            options &#123;</span><br><span class="line">                timeout(<span class="string">time:</span> <span class="number">1</span>, <span class="string">unit:</span> <span class="string">'HOURS'</span>) </span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">'Hello World'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="parameters-å‚æ•°"><a href="#parameters-å‚æ•°" class="headerlink" title="parameters - å‚æ•°"></a>parameters - å‚æ•°</h5><p>æè¿°: è¯¥æŒ‡ä»¤æä¾›äº†ä¸€ä¸ªç”¨æˆ·åœ¨è§¦å‘ Pipelineæ—¶åº”è¯¥æä¾›çš„å‚æ•°åˆ—è¡¨ã€‚è¿™äº›ç”¨æˆ·æŒ‡å®šå‚æ•°çš„å€¼é€šè¿‡paramså¯¹è±¡æä¾›ç»™ Pipelineæ­¥éª¤ï¼Œè¯·å‚é˜…å‚æ•°ï¼Œå£°æ˜å¼ Pipelineçš„å…·ä½“ç”¨æ³•ã€‚</p>
<p>ç›®å‰å¯ç”¨å‚æ•°æœ‰<code>string , text, booleanParam, choice, password</code>ç­‰å‚æ•°ï¼Œå…¶ä»–é«˜çº§å‚æ•°åŒ–ç±»å‹è¿˜éœ€ç­‰å¾…ç¤¾åŒºæ”¯æŒã€‚</p>
<p><strong>ä½ç½®&amp;å‚æ•°:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¿…é¡»: No</span><br><span class="line">å‚æ•°: None</span><br><span class="line">å…è®¸: åœ¨`Pipeline`å—å†…ä»…ä¸€æ¬¡ã€‚</span><br></pre></td></tr></table></figure></p>
<p>Tips : <code>éå¸¸æ³¨æ„</code>å…¨å±€å‚æ•°, åœ¨shellå¯é€šè¿‡å˜é‡åè®¿é—®ï¼Œè€Œåœ¨script pipelineè„šæœ¬ä¸­é€šè¿‡params.å‚æ•°åç§°è®¿é—®.</p>
<p><br></p>
<p><strong>ç¤ºä¾‹: Parameters, Declarative Pipeline</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Parameters, Declarative Pipeline</span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Jenkins -&gt; åŸç”Ÿ Build With Parameters æ”¯æŒ</span></span><br><span class="line">    parameters &#123;</span><br><span class="line">      gitParameter <span class="string">name:</span> <span class="string">'RELEASE_VERSION'</span>, </span><br><span class="line"><span class="symbol">                      type:</span> <span class="string">'PT_BRANCH_TAG'</span>,</span><br><span class="line"><span class="symbol">                      branchFilter:</span> <span class="string">'origin/(.*)'</span>,</span><br><span class="line"><span class="symbol">                      defaultValue:</span> <span class="string">'master'</span>,</span><br><span class="line"><span class="symbol">                      selectedValue:</span> <span class="string">'DEFAULT'</span>,</span><br><span class="line"><span class="symbol">                      sortMode:</span> <span class="string">'DESCENDING_SMART'</span>,</span><br><span class="line"><span class="symbol">            description:</span> <span class="string">'Message: è¯·é€‰æ‹©éƒ¨ç½²çš„Tagsç‰ˆæœ¬?'</span></span><br><span class="line">      choice(<span class="string">name:</span> <span class="string">'SONARQUBE'</span>, <span class="string">choices:</span> [<span class="string">'False'</span>,<span class="string">'True'</span>], <span class="string">description:</span> <span class="string">'Message: æ˜¯å¦è¿›è¡Œä»£ç è´¨é‡æ£€æµ‹?'</span>)				 </span><br><span class="line"> </span><br><span class="line">      <span class="comment">//  Jenkins -&gt; åŸç”Ÿ Build With Parameters æ”¯æŒ å’Œ BlueOcean éƒ½æ”¯æŒ</span></span><br><span class="line">      string(<span class="string">name:</span> <span class="string">'PERSON'</span>, <span class="string">defaultValue:</span> <span class="string">'Mr Jenkins'</span>, <span class="string">description:</span> <span class="string">'Who should I say hello to?'</span>)</span><br><span class="line"></span><br><span class="line">      text(<span class="string">name:</span> <span class="string">'BIOGRAPHY'</span>, <span class="string">defaultValue:</span> <span class="string">''</span>, <span class="string">description:</span> <span class="string">'Enter some information about the person'</span>)</span><br><span class="line"></span><br><span class="line">      booleanParam(<span class="string">name:</span> <span class="string">'TOGGLE'</span>, <span class="string">defaultValue:</span> <span class="literal">true</span>, <span class="string">description:</span> <span class="string">'Toggle this value'</span>)</span><br><span class="line"></span><br><span class="line">      choice(<span class="string">name:</span> <span class="string">'CHOICE'</span>, <span class="string">choices:</span> [<span class="string">'One'</span>, <span class="string">'Two'</span>, <span class="string">'Three'</span>], <span class="string">description:</span> <span class="string">'Pick something'</span>)</span><br><span class="line"></span><br><span class="line">      password(<span class="string">name:</span> <span class="string">'PASSWORD'</span>, <span class="string">defaultValue:</span> <span class="string">'SECRET'</span>, <span class="string">description:</span> <span class="string">'Enter a password'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">'Example'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                <span class="comment">// è°ƒç”¨</span></span><br><span class="line">                echo <span class="string">"Hello $&#123;params.PERSON&#125;"</span></span><br><span class="line"></span><br><span class="line">                echo <span class="string">"Biography: $&#123;params.BIOGRAPHY&#125;"</span></span><br><span class="line"></span><br><span class="line">                echo <span class="string">"Toggle: $&#123;params.TOGGLE&#125;"</span></span><br><span class="line"></span><br><span class="line">                echo <span class="string">"Choice: $&#123;params.CHOICE&#125;"</span></span><br><span class="line"></span><br><span class="line">                echo <span class="string">"Password: $&#123;params.PASSWORD&#125;"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=2.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineè¯­æ³•å…¥é—¨å­¦ä¹  href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210201114915.png" target="_blank" title="WeiyiGeek.parameters" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210201114915.png" alt="WeiyiGeek.parameters" title="" class=""></a>
                <p>WeiyiGeek.parameters</p>
            </figure>
<p><br></p>
<h5 id="triggers-è§¦å‘å™¨"><a href="#triggers-è§¦å‘å™¨" class="headerlink" title="triggers - è§¦å‘å™¨"></a>triggers - è§¦å‘å™¨</h5><p>æè¿°: è¯¥æŒ‡ä»¤å®šä¹‰äº†Pipelineè‡ªåŠ¨åŒ–è§¦å‘çš„æ–¹å¼ï¼Œå¯¹äºä¸GitHubæˆ–BitBucketç­‰æºé›†æˆçš„ Pipelineå¯èƒ½ä¸éœ€è¦è§¦å‘å™¨ï¼Œå› ä¸ºåŸºäºwebhookçš„é›†æˆå¯èƒ½å·²ç»å­˜åœ¨äº†ã€‚</p>
<p><strong>ä½ç½®&amp;å‚æ•°:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¿…é¡»: No</span><br><span class="line">å‚æ•°: None</span><br><span class="line">å…è®¸: åœ¨Pipelineå—å†…</span><br></pre></td></tr></table></figure></p>
<p>Tips : å½“å‰å¯ç”¨çš„è§¦å‘å™¨æ˜¯<code>cronã€pollSCMå’Œupstream</code>ã€‚</p>
<ul>
<li><p>1.<code>cron</code> : ä»¥Linuxä¸­Croné£æ ¼çš„å­—ç¬¦ä¸²ï¼Œä»¥å®šä¹‰åº”è¯¥é‡æ–°è§¦å‘ Pipelineçš„å®šæœŸé—´éš”</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">triggers &#123; cron(<span class="string">'H */4 * * 1-5'</span>) &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.<code>pollSCM</code> : æ¥å—cronæ ·å¼çš„å­—ç¬¦ä¸²ä»¥å®šä¹‰Jenkinsåº”æ£€æŸ¥æ–°æºæ›´æ”¹çš„å®šæœŸé—´éš”ã€‚å¦‚æœå­˜åœ¨æ–°çš„æ›´æ”¹åˆ™å°†é‡æ–°è§¦å‘ Pipelineã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">triggers &#123; pollSCM(<span class="string">'H */4 * * 1-5'</span>) &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Tips : pollSCMè§¦å‘å™¨ä»…åœ¨Jenkins 2.22æˆ–æ›´é«˜ç‰ˆæœ¬ä¸­å¯ç”¨ã€‚</li>
</ul>
</li>
<li><p>3.<code>upstream</code> : æ¥å—ä»¥é€—å·åˆ†éš”çš„ä½œä¸šå­—ç¬¦ä¸²å’Œé˜ˆå€¼ã€‚å½“å­—ç¬¦ä¸²ä¸­çš„ä»»ä½•ä½œä¸šä»¥æœ€å°é˜ˆå€¼ç»“æŸæ—¶ Pipelineå°†è¢«é‡æ–°è§¦å‘</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">triggers &#123; upstream(<span class="string">upstreamProjects:</span> <span class="string">'job1,job2'</span>, <span class="string">threshold:</span> hudson.model.Result.SUCCESS) &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<p><strong>cronè¯­æ³•</strong><br>æè¿°: Jenkins cronè¯­æ³•éµå¾ªcronå®ç”¨ç¨‹åºçš„è¯­æ³•ï¼ˆç•¥æœ‰ä¸åŒï¼‰ã€‚å…·ä½“æ¥è¯´æ¯è¡ŒåŒ…å«5ä¸ªç”±TABæˆ–ç©ºæ ¼åˆ†éš”çš„å­—æ®µï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* * * * * </span><br><span class="line">MINUTE - Minutes within the hour (0â€“59)</span><br><span class="line"></span><br><span class="line">HOUR   - The hour of the day (0â€“23)</span><br><span class="line"></span><br><span class="line">DAY	   - The day of the month (1â€“31)</span><br><span class="line"></span><br><span class="line">MONTH  - The month (1â€“12)</span><br><span class="line"></span><br><span class="line">WEEK   - The day of the week (0â€“7) <span class="built_in">where</span> 0 and 7 are Sunday.</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœè¦ä¸ºä¸€ä¸ªå­—æ®µæŒ‡å®šå¤šä¸ªå€¼ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ“ä½œç¬¦ã€‚æŒ‰ç…§ä¼˜å…ˆé¡ºåºï¼Œ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">*   specifies all valid values  (æŒ‡å®šæ‰€æœ‰æœ‰æ•ˆå€¼)</span><br><span class="line"></span><br><span class="line">M-N specifies a range of values (æŒ‡å®šå€¼èŒƒå›´)</span><br><span class="line"></span><br><span class="line">M-N/X or */X steps by intervals of X through the specified range or whole valid range (åœ¨æŒ‡å®šèŒƒå›´æˆ–æ•´ä¸ªæœ‰æ•ˆèŒƒå›´å†…æŒ‰Xçš„é—´éš”æ­¥è¿›)</span><br><span class="line"></span><br><span class="line">A,B,â€¦â€‹,Z enumerates multiple values (æšä¸¾å¤šä¸ªå€¼)</span><br></pre></td></tr></table></figure></p>
<p>Tips : åœ¨ Cron ä¸­ä½¿ç”¨ H å­—ç¬¦ä¸ºäº†ä½¿å®šæœŸè®¡åˆ’çš„ä»»åŠ¡åœ¨ç³»ç»Ÿä¸Šäº§ç”Ÿå‡åŒ€çš„è´Ÿè½½ï¼ŒHç¬¦å·å¯ä»¥è¢«è®¤ä¸ºæ˜¯åœ¨ä¸€å®šèŒƒå›´å†…çš„éšæœºå€¼ã€‚<br>ä¾‹å¦‚<code>ä½¿ç”¨0 0 * * *ä¸€æ‰“æ—¥å¸¸å·¥ä½œå°†å¯¼è‡´åˆå¤œæ—¶åˆ†å¤§å¹…å¢åŠ </code>ã€‚ç›¸åä½¿ç”¨<code>H H * * *ä»ä¼šæ¯å¤©æ‰§è¡Œä¸€æ¬¡æ¯ä¸ªä½œä¸šï¼Œä½†ä¸æ˜¯åŒæ—¶æ‰§è¡Œæ‰€æœ‰ä½œä¸šï¼Œæ›´å¥½åœ°ä½¿ç”¨æœ‰é™çš„èµ„æº</code>ã€‚</p>
<p>Tips : æ­¤å¤–<code>@yearlyï¼Œ@annuallyï¼Œ@monthlyï¼Œ @weeklyï¼Œ@dailyï¼Œ@midnight</code>ï¼Œå¹¶ä¸”@hourlyä¹Ÿæ”¯æŒæ–¹ä¾¿çš„åˆ«åã€‚è¿™äº›ä½¿ç”¨å“ˆå¸Œç³»ç»Ÿè¿›è¡Œè‡ªåŠ¨å¹³è¡¡ã€‚<br>ä¾‹å¦‚ @hourlyä¸ç›¸åŒï¼ŒH <em> </em> <em> </em>å¹¶ä¸”å¯èƒ½è¡¨ç¤ºè¯¥å°æ—¶ä¸­çš„ä»»ä½•æ—¶é—´, @midnightå®é™…ä¸Šæ˜¯æŒ‡åœ¨12:00 AMå’Œ2:59 AMä¹‹é—´çš„æŸä¸ªæ—¶é—´ã€‚</p>
<p><br></p>
<p><strong>ç¤ºä¾‹.Triggers, Declarative Pipeline:</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// (1) Jenkins cronè¯­æ³•ç¤ºä¾‹</span></span><br><span class="line"><span class="comment">// æ¯åäº”åˆ†é’Ÿæ‰§è¡Œè§¦å‘</span></span><br><span class="line">triggers&#123; cron(<span class="string">'H/15 * * * *'</span>) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¯å°æ—¶ï¼ˆ1~30åˆ†é’Ÿï¼‰å†…æ¯ååˆ†é’Ÿä¸€æ¬¡</span></span><br><span class="line">triggers&#123; cron(<span class="string">'H(0-29)/10 * * * *'</span>) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¯éš”ä¸€ä¸ªå°æ—¶çš„45åˆ†é’Ÿï¼Œæ¯ä¸¤å°æ—¶ä¸€æ¬¡ï¼Œä»ä¸Šåˆ9:45å¼€å§‹ï¼Œåˆ°æ¯ä¸ªå·¥ä½œæ—¥çš„ä¸‹åˆ3:45ç»“æŸã€‚</span></span><br><span class="line">triggers&#123; cron(<span class="string">'45 9-16/2 * * 1-5'</span>) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¯ä¸ªå·¥ä½œæ—¥çš„ä¸Šåˆ9ç‚¹è‡³ä¸‹åˆ5ç‚¹ä¹‹é—´æ¯ä¸¤å°æ—¶ä¸€æ¬¡</span></span><br><span class="line">triggers&#123; cron(<span class="string">'H H(9-16)/2 * * 1-5'</span>) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¯æœˆ12æœˆ1æ—¥å’Œ15æ—¥æ¯å¤©ä¸€æ¬¡</span></span><br><span class="line">triggers&#123; cron(<span class="string">'H H 1,15 1-11 *'</span>) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//(2) Declarative Pipeline</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    triggers &#123;</span><br><span class="line">      cron(<span class="string">'H */4 * * 1-5'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">'Example'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">'Hello World'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="stage-å•é˜¶æ®µ"><a href="#stage-å•é˜¶æ®µ" class="headerlink" title="stage - å•é˜¶æ®µ"></a>stage - å•é˜¶æ®µ</h5><p>æè¿°: è¯¥ stage æŒ‡ä»¤ä½äºstagesä¸­å¹¶ä¸”åº”åŒ…å«<code>Step èŠ‚</code>ï¼Œå¯é€‰ <code>agent èŠ‚</code>æˆ–å…¶ä»–ç‰¹å®šäºé˜¶æ®µçš„æŒ‡ä»¤, å®é™…ä¸Šç®¡é“å®Œæˆçš„æ‰€æœ‰å®é™…å·¥ä½œéƒ½å°†åŒ…å«åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªstageæŒ‡ä»¤ä¸­ã€‚</p>
<p><strong>ä½ç½®&amp;å‚æ•°:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¿…é¡»: YES</span><br><span class="line">å‚æ•°: æ­¥éª¤åç§°(å­—ç¬¦ä¸²ã€å¿…å¡«)</span><br><span class="line">å…è®¸: åœ¨ Pipelineå— -&gt; stageséƒ¨åˆ† å†…</span><br></pre></td></tr></table></figure></p>
<p><strong>ç¤ºä¾‹.stage , Declarative Pipeline</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Declarative </span></span><br><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(<span class="string">'Example'</span>) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        echo <span class="string">'Hello World'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="Tools-å·¥å…·"><a href="#Tools-å·¥å…·" class="headerlink" title="Tools - å·¥å…·"></a>Tools - å·¥å…·</h5><p>æè¿°: å®šä¹‰è‡ªå®šä¹‰å®‰è£…çš„Toolså·¥å…·è·¯å¾„ï¼Œå¹¶æ”¾ç½®ç¯å¢ƒå˜é‡åˆ°PATHã€‚å¦‚æœagent none è¿™å°†è¢«å¿½ç•¥<br>Supported Tools(Global Tool Configuration) : maven / jdk / gradle / Sonarqube</p>
<p><strong>ä½ç½®&amp;å‚æ•°:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¿…é¡»: No</span><br><span class="line">å‚æ•°: None</span><br><span class="line">å…è®¸: åœ¨ Pipeline å— æˆ–è€… stage éƒ¨åˆ† å†…</span><br></pre></td></tr></table></figure></p>
<p><strong>ç¤ºä¾‹.Tools ï¼Œå£°æ˜æ€§ç®¡é“</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    tools &#123;</span><br><span class="line">      <span class="comment">// å·¥å…·åç§°å¿…é¡»åœ¨Jenkinsä¸­çš„ Manage Jenkins â†’ Global Tool Configuration ä¸‹é¢„å…ˆé…ç½®ã€‚</span></span><br><span class="line">      maven <span class="string">'apache-maven-3.0.1'</span> </span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">      stage(<span class="string">'Example'</span>) &#123;</span><br><span class="line">        steps &#123;</span><br><span class="line">          sh <span class="string">'mvn --version'</span></span><br><span class="line">          script &#123;</span><br><span class="line">            <span class="comment">// æ— æŒ‡å®šåç§°æ—¶å¯ç”¨é‡‡ç”¨toolæŒ‡å®šè®¾ç½®çš„å…¨å±€å·¥å…·åç§°ï¼Œè¿™é‡Œè¿™ä¸ªtoolæ˜¯ç›´æ¥æ ¹æ®åç§°ï¼Œè·å–è‡ªåŠ¨å®‰è£…çš„æ’ä»¶çš„è·¯å¾„</span></span><br><span class="line">            <span class="keyword">def</span> scannerHome = tool <span class="string">'sonarqubescanner'</span></span><br><span class="line">          &#125;</span><br><span class="line">          withSonarQubeEnv(<span class="string">'SonarQube'</span>) &#123;</span><br><span class="line">            sh <span class="string">"$&#123;scannerHome&#125;/bin/sonar-scanner -Dsonar.projectKey=YourProjectKey -Dsonar.sources=."</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="Input-è¾“å…¥"><a href="#Input-è¾“å…¥" class="headerlink" title="Input - è¾“å…¥"></a>Input - è¾“å…¥</h5><p>æè¿°: inputæŒ‡ä»¤å…è®¸æ‚¨ä½¿ç”¨è¾“å…¥æ­¥éª¤æç¤ºè¾“å…¥ã€‚åœ¨åº”ç”¨äº†ä»»ä½•é€‰é¡¹ä¹‹åï¼Œåœ¨è¿›å…¥è¯¥é˜¶æ®µçš„ä»£ç†å—æˆ–è¯„ä¼°è¯¥é˜¶æ®µçš„whenæ¡ä»¶ä¹‹å‰ï¼Œè¯¥é˜¶æ®µå°†æš‚åœã€‚å¦‚æœè¾“å…¥è¢«æ‰¹å‡†ï¼Œè¯¥é˜¶æ®µå°†ç»§ç»­ã€‚ä½œä¸ºè¾“å…¥æäº¤çš„ä¸€éƒ¨åˆ†æä¾›çš„ä»»ä½•å‚æ•°éƒ½å°†åœ¨è¯¥é˜¶æ®µçš„å…¶ä½™éƒ¨åˆ†çš„ç¯å¢ƒä¸­å¯ç”¨ã€‚</p>
<p><strong>ä½ç½®&amp;å‚æ•°:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¿…é¡»: No</span><br><span class="line">å‚æ•°: message ã€id ã€okã€submitterã€submitterParameterã€parameters</span><br><span class="line">å…è®¸: åœ¨ Pipelineå— -&gt; stages å—å†… ï¼ˆæ³¨æ„ä¸æ˜¯åœ¨stageä¸­ï¼‰</span><br></pre></td></tr></table></figure></p>
<p><strong>é…ç½®é€‰é¡¹</strong></p>
<ul>
<li>message : å¿…é¡»çš„å‰å°è¾“å…¥æ—¶æç¤ºç”¨æˆ·çš„ä¿¡æ¯;</li>
<li>id : æ­¤è¾“å…¥çš„å¯é€‰æ ‡è¯†ç¬¦ã€‚é»˜è®¤ä¸ºé˜¶æ®µåç§°ã€‚</li>
<li>ok : è¾“å…¥è¡¨å•ä¸Šâ€œç¡®å®šâ€æŒ‰é’®çš„å¯é€‰æ–‡æœ¬ã€‚</li>
<li>Parameter : æç¤ºæäº¤è€…æä¾›çš„å¯é€‰å‚æ•°åˆ—è¡¨ã€‚è¯·å‚é˜…<a href="https://www.jenkins.io/doc/book/pipeline/syntax/#parameters" target="_blank" rel="noopener">å‚æ•°</a>ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚</li>
<li>submitter : å¯é€‰çš„ç”¨é€—å·åˆ†éš”çš„ç”¨æˆ·æˆ–å…è®¸è¾“å…¥æ­¤è¾“å…¥çš„å¤–éƒ¨ç»„åçš„åˆ—è¡¨,é»˜è®¤ä¸ºå…è®¸ä»»ä½•ç”¨æˆ·ã€‚</li>
<li>submitterParameter : å¯ä»¥ä½¿ç”¨æäº¤è€…åç§°è®¾ç½®çš„ç¯å¢ƒå˜é‡çš„å¯é€‰åç§°ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚</li>
</ul>
<p>åŸºç¡€ç¤ºä¾‹:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(<span class="string">'Example'</span>) &#123;</span><br><span class="line">      <span class="comment">// æ–¹å¼1.æ­¤ç§æ–¹å¼åªèƒ½è¯¥å—æœ‰æ•ˆ</span></span><br><span class="line">      input &#123;</span><br><span class="line">        message <span class="string">"Title : ä¸ªäººä¿¡æ¯è¾“å…¥"</span></span><br><span class="line">        ok <span class="string">"å®Œæˆæäº¤"</span></span><br><span class="line">        submitter <span class="string">"alice,bob"</span></span><br><span class="line">        parameters &#123;</span><br><span class="line">          string(<span class="string">name:</span> <span class="string">'INPUT_PERSON'</span>, <span class="string">defaultValue:</span> <span class="string">'WeiyiGeek'</span>, <span class="string">description:</span> <span class="string">'Message: è¯·è¾“å…¥æ‚¨çš„å§“å?'</span>)</span><br><span class="line">          string(<span class="string">name:</span> <span class="string">'INPUT_AGE'</span>, <span class="string">defaultValue:</span> <span class="string">'WeiyiGeek'</span>, <span class="string">description:</span> <span class="string">'Message: è¯·è¾“å…¥æ‚¨çš„å¹´é¾„?'</span>)</span><br><span class="line">          choice(<span class="string">name:</span> <span class="string">'INPUT_SEX'</span>, <span class="string">choices:</span> [<span class="string">'Male'</span>,<span class="string">'Female'</span>], <span class="string">description:</span> <span class="string">'Message: è¯·é€‰æ‹©ä½ çš„æ€§åˆ«?'</span>)</span><br><span class="line">          booleanParam(<span class="string">name:</span> <span class="string">'INPUT_AGREE'</span>, <span class="string">defaultValue:</span> <span class="literal">true</span>, <span class="string">description:</span> <span class="string">'Message: æ˜¯å¦ç¡®å®šåè®®?'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      steps &#123;</span><br><span class="line">        <span class="comment">// æ–¹å¼2: æ³¨æ„scriptå¿…é¡»åŒ…å«åœ¨ steps å—ä¹‹ä¸­(æ­¤ç§æ–¹å¼å¯ä»¥å…¨å±€ä¼ é€’å‚æ•°)</span></span><br><span class="line">        script &#123;</span><br><span class="line">          env.git_version=input <span class="string">message:</span> <span class="string">'Titel: ç‰ˆæœ¬'</span>, <span class="string">ok:</span> <span class="string">'é€šè¿‡'</span>,<span class="string">parameters:</span> [string ( <span class="string">name:</span> <span class="string">'git_version'</span>, <span class="string">trim:</span> <span class="literal">true</span>, <span class="string">description:</span> <span class="string">'Message : è¯·é€‰æ‹©è¦æ“ä½œçš„åº”ç”¨ç‰ˆæœ¬?'</span>)];</span><br><span class="line"></span><br><span class="line">          env.deploy_option = input <span class="string">message:</span> <span class="string">'Titel: æ“ä½œ'</span>, <span class="string">ok:</span> <span class="string">'deploy'</span>, <span class="string">parameters:</span> [choice(<span class="string">name:</span> <span class="string">'deploy_option'</span>, <span class="string">choices:</span> [<span class="string">'deploy'</span>, <span class="string">'rollback'</span>, <span class="string">'redeploy'</span>], <span class="string">description:</span> <span class="string">'Message : è¯·é€‰æ‹©æ“ä½œæµç¨‹?'</span>)];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 12.input è¾“å‡ºç¤ºä¾‹</span></span><br><span class="line">        echo <span class="string">"å±€éƒ¨å¯ç”¨ è¾“å‡ºç¤ºä¾‹1: å§“åï¼š$&#123;INPUT_PERSON&#125;, å¹´é¾„ï¼š$&#123;INPUT_AGE&#125;, æ€§åˆ«ï¼š$&#123;INPUT_SEX&#125;, æ˜¯å¦åŒæ„åè®®: $&#123;INPUT_AGREE&#125;"</span></span><br><span class="line"></span><br><span class="line">        echo <span class="string">"å…¨å±€å¯ç”¨ è¾“å‡ºç¤ºä¾‹(script) -&gt; ç‰ˆæœ¬ : $&#123;env.git_version&#125;"</span></span><br><span class="line">        echo <span class="string">"å…¨å±€å¯ç”¨ è¾“å‡ºç¤ºä¾‹(script) -&gt; ç‰ˆæœ¬ : $&#123;env.deploy_option&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é‡‡ç”¨scriptå—ä¸­å®šä¹‰inputå¯ä»¥è°ƒç”¨ä¸åŒstageä¸­å¾—å‚æ•°å€¼</span></span><br><span class="line">  stage (<span class="string">'è°ƒç”¨'</span>) &#123;</span><br><span class="line">    steps &#123;</span><br><span class="line">      echo <span class="string">"è°ƒç”¨1 : $&#123;env.git_version&#125;"</span></span><br><span class="line">      echo <span class="string">"è°ƒç”¨2 : $&#123;env.deploy_option&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=2.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineè¯­æ³•å…¥é—¨å­¦ä¹  href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210131162014.png" target="_blank" title="WeiyiGeek.å®é™…æ¡ˆä¾‹" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210131162014.png" alt="WeiyiGeek.å®é™…æ¡ˆä¾‹" title="" class=""></a>
                <p>WeiyiGeek.å®é™…æ¡ˆä¾‹</p>
            </figure>
<p><br></p>
<h5 id="when-æ‰§è¡Œæ¡ä»¶"><a href="#when-æ‰§è¡Œæ¡ä»¶" class="headerlink" title="when - æ‰§è¡Œæ¡ä»¶"></a>when - æ‰§è¡Œæ¡ä»¶</h5><p>æè¿°: è¯¥æŒ‡ä»¤å…è®¸ç®¡é“æ ¹æ®ç»™å®šæ¡ä»¶ç¡®å®šæ˜¯å¦åº”æ‰§è¡Œè¯¥é˜¶æ®µï¼ŒwhenæŒ‡ä»¤å¿…é¡»è‡³å°‘åŒ…å«ä¸€ä¸ªæ¡ä»¶ï¼Œå¦‚æœwhenæŒ‡ä»¤åŒ…å«å¤šä¸ªæ¡ä»¶ï¼Œåˆ™<code>æ‰€æœ‰å­æ¡ä»¶å¿…é¡»è¿”å›trueæ‰èƒ½æ‰§è¡Œè¯¥é˜¶æ®µ</code>;</p>
<p>ä½¿ç”¨åµŒå¥—æ¡ä»¶æ„å»ºæ›´å¤æ‚çš„æ¡ä»¶ç»“æ„:<code>notï¼ŒallOfæˆ–anyOf</code>,åµŒå¥—æ¡ä»¶å¯ä»¥åµŒå¥—åˆ°ä»»æ„æ·±åº¦ã€‚</p>
<ul>
<li>1.å¦‚æœä½¿ç”¨allOfæ¡ä»¶ï¼Œåˆ™è¡¨ç¤ºæ‰€æœ‰æ¡ä»¶ä¸ºçœŸæ‰ç»§ç»­æ‰§è¡Œã€‚</li>
<li>2.å¦‚æœä½¿ç”¨anyOfæ¡ä»¶ï¼Œè¯·æ³¨æ„ä¸€æ—¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªâ€œçœŸâ€æ¡ä»¶ï¼Œè¯¥æ¡ä»¶å°†è·³è¿‡å…¶ä½™æµ‹è¯•ã€‚</li>
<li>3.ä½¿ç”¨ä½¿ç”¨notæ¡ä»¶æ˜¯ï¼Œåˆ™å½“æ¡ä»¶ä¸ºfalseæ˜¯ä¸ºçœŸæ‰è¿›è¡Œæ‰§è¡Œ</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.ä¸åŒ¹é…åˆ†æ”¯</span></span><br><span class="line">when &#123; not &#123; branch <span class="string">'master'</span> &#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.åˆ†åˆ«æ»¡è¶³åˆ†æ”¯ä¸ºmasterå¹¶ä¸”DEPLOY_TOç¯å¢ƒå˜é‡å€¼ä¸ºproductionæ˜¯ç»§ç»­æ‰§è¡Œ</span></span><br><span class="line">when &#123; allOf &#123; branch <span class="string">'master'</span>; environment <span class="string">name:</span> <span class="string">'DEPLOY_TO'</span>, <span class="string">value:</span> <span class="string">'production'</span> &#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.æ»¡è¶³åˆ†æ”¯ä¸ºmasteræˆ–è€…åˆ†æ”¯ä¸ºstagingéƒ½å¯ä»¥ç»§ç»­æ‰§è¡Œ.</span></span><br><span class="line">when &#123; anyOf &#123; branch <span class="string">'master'</span>; branch <span class="string">'staging'</span> &#125; &#125;</span><br></pre></td></tr></table></figure>
<p><strong>ä½ç½®&amp;å‚æ•°:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¿…é¡»: No</span><br><span class="line">å‚æ•°: Express</span><br><span class="line">å…è®¸: åœ¨ Pipelineå— -&gt; stage å—å†…</span><br></pre></td></tr></table></figure></p>
<p><strong>å†…ç½®æ¡ä»¶:</strong></p>
<ul>
<li><p>branch : å½“æ­£åœ¨æ„å»ºçš„åˆ†æ”¯ä¸ç»™å‡ºçš„åˆ†æ”¯æ¨¡å¼åŒ¹é…æ—¶æ‰§è¡Œ,è¯·æ³¨æ„è¿™ä»…é€‚ç”¨äºå¤šåˆ†æ”¯ç®¡é“;</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">when &#123; branch <span class="string">'master'</span> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>environment : å½“æŒ‡å®šçš„ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºç»™å®šå€¼æ—¶æ‰§è¡Œï¼Œ</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">when &#123; expression &#123; <span class="keyword">return</span> params.DEBUG_BUILD &#125; &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>equals : å½“æœŸæœ›å€¼ç­‰äºå®é™…å€¼æ—¶æ‰§è¡Œé˜¶æ®µï¼Œ</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">when &#123; equals <span class="string">expected:</span> <span class="number">2</span>, <span class="string">actual:</span> currentBuild.number &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>expression : åœ¨æŒ‡å®šçš„Groovyè¡¨è¾¾å¼è®¡ç®—ä¸ºtrueæ—¶æ‰§è¡Œé˜¶æ®µ, æ³¨æ„å½“ä»è¡¨è¾¾å¼è¿”å›å­—ç¬¦ä¸²æ—¶ï¼Œå®ƒä»¬å¿…é¡»è¢«è½¬æ¢ä¸ºå¸ƒå°”å€¼ï¼Œæˆ–è€…è¿”å›nullæ¥è®¡ç®—ä¸ºfalseã€‚<code>ç®€å•åœ°è¿”å›&quot;0&quot;æˆ–&quot;false&quot;ä»ç„¶ä¼šè®¡ç®—ä¸º&quot;true&quot;</code>ã€‚</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">when &#123; expression &#123; <span class="keyword">return</span> params.DEBUG_BUILD &#125; &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Tag : å¦‚æœTAG_NAMEå˜é‡åŒ¹é…ç»™å®šçš„æ¨¡å¼åˆ™æ‰§è¡Œè¯¥é˜¶æ®µ, æ³¨æ„å¦‚æœæä¾›äº†ä¸€ä¸ªç©ºæ¨¡å¼ï¼Œé‚£ä¹ˆé˜¶æ®µå°†åœ¨TAG_NAMEå˜é‡å­˜åœ¨æ—¶æ‰§è¡Œ(ä¸buildingTag()ç›¸åŒ)ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">when &#123; tag <span class="string">"release-*"</span> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>buildingTag : æ‰§è¡Œæ„å»ºæ„å»ºæ ‡ç­¾çš„é˜¶æ®µ.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">when &#123; buildingTag() &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>changelog : å¦‚æœæ„å»ºçš„SCMæ›´æ”¹æ—¥å¿—åŒ…å«ç»™å®šçš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼åˆ™æ‰§è¡Œé˜¶æ®µ;</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">when &#123; changelog <span class="string">'.*^\\[DEPENDENCY\\] .+$'</span> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>changeset : å¦‚æœæ„å»ºçš„SCMå˜æ›´é›†åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªä¸ç»™å®šæ¨¡å¼åŒ¹é…çš„æ–‡ä»¶ï¼Œåˆ™æ‰§è¡Œé˜¶æ®µã€‚</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">when &#123; changeset <span class="string">"**/*.js"</span> &#125;</span><br><span class="line">when &#123; changeset <span class="string">pattern:</span> <span class="string">".TEST\\.java"</span>, <span class="string">comparator:</span> <span class="string">"REGEXP"</span> &#125;  <span class="comment">// æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</span></span><br><span class="line">when &#123; changeset <span class="string">pattern:</span> <span class="string">"*/*TEST.java"</span>, <span class="string">caseSensitive:</span> <span class="literal">true</span> &#125;   <span class="comment">// åŒºåˆ†å¤§å°å†™ANTæ ·å¼è·¯å¾„</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>changeRequest : å¦‚æœå½“å‰æ„å»ºæ˜¯é’ˆå¯¹â€œå˜æ›´è¯·æ±‚â€çš„ï¼Œåˆ™æ‰§è¡Œé˜¶æ®µï¼ˆä¹Ÿç§°ä¸ºGitHubå’ŒBitbucketä¸Šçš„Pull Requestï¼ŒGitLabä¸Šçš„Merge Requestï¼ŒGerritå˜æ›´ç­‰ï¼‰ã€‚å¦‚æœæœªä¼ é€’ä»»ä½•å‚æ•°ï¼Œåˆ™é˜¶æ®µå°†åœ¨æ¯ä¸ªæ›´æ”¹è¯·æ±‚ä¸Šè¿è¡Œ</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">when &#123; changeRequest() &#125;.</span><br><span class="line"><span class="comment">// # Possible attributes are `id, target, branch, fork, url, title, author, authorDisplayName, and authorEmail`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¯ä¸€ä¸ªéƒ½å¯¹åº”ä¸€ä¸ªCHANGE_*ç¯å¢ƒå˜é‡ï¼Œ</span></span><br><span class="line">when &#123; changeRequest <span class="string">target:</span> <span class="string">'master'</span> &#125;.</span><br><span class="line"></span><br><span class="line"><span class="comment">// comparator å‚æ•°åæŒ‡å¯¼å±æ€§ï¼Œä»¥æŒ‡å®šåŒ¹é…æ—¶å¦‚ä½•è®¡ç®—ä»»ä½•æ¨¡å¼:</span></span><br><span class="line"><span class="comment">// * EQUALSç”¨äºç®€å•çš„å­—ç¬¦ä¸²æ¯”è¾ƒ(é»˜è®¤å€¼)ï¼Œ</span></span><br><span class="line"><span class="comment">// * GLOBç”¨äºANTé£æ ¼çš„è·¯å¾„GLOB(ä¸ä¾‹å¦‚changesetç›¸åŒ)ï¼Œ</span></span><br><span class="line"><span class="comment">// * REGEXPç”¨äºæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</span></span><br><span class="line">when &#123; changeRequest <span class="string">authorEmail:</span> <span class="string">"[\\w_-.]+@example.com"</span>, <span class="string">comparator:</span> <span class="string">'REGEXP'</span> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>triggeredBy : åœ¨ç»™å®šçš„å‚æ•°è§¦å‘å½“å‰æ„å»ºæ—¶æ‰§è¡Œè¯¥é˜¶æ®µã€‚</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">when &#123; triggeredBy <span class="string">'SCMTrigger'</span> &#125;</span><br><span class="line"></span><br><span class="line">when &#123; triggeredBy <span class="string">'TimerTrigger'</span> &#125;</span><br><span class="line"></span><br><span class="line">when &#123; triggeredBy <span class="string">'UpstreamCause'</span> &#125;</span><br><span class="line"></span><br><span class="line">when &#123; triggeredBy <span class="string">cause:</span> <span class="string">"UserIdCause"</span>, <span class="string">detail:</span> <span class="string">"vlinde"</span> &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>ä¼˜å…ˆçº§è¯´æ˜</strong></p>
<ul>
<li><p>1.whenåœ¨inputæŒ‡ä»¤å‰è¯„ä¼° : é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœå®šä¹‰äº†é˜¶æ®µåˆ™åœ¨è¾“å…¥ä¹‹å‰ä¸ä¼šè¯„ä¼°é˜¶æ®µçš„whenæ¡ä»¶ã€‚ä½†æ˜¯å¯ä»¥é€šè¿‡beforeInputåœ¨whenå—ä¸­æŒ‡å®šé€‰é¡¹æ¥æ›´æ”¹æ­¤è®¾ç½®ã€‚<code>å¦‚æœbeforeInputè®¾ç½®ä¸ºtrueï¼Œåˆ™å°†é¦–å…ˆè¯„ä¼°whenæ¡ä»¶å¹¶ä¸”ä»…å½“whenæ¡ä»¶è¯„ä¼°ä¸ºtrueæ—¶æ‰è¾“å…¥</code>ã€‚</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent none</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">'Example Build'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">'Hello World'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">'Example Deploy'</span>) &#123;</span><br><span class="line">            when &#123;</span><br><span class="line">                beforeInput <span class="literal">true</span>    <span class="comment">// å…³é”®ç‚¹</span></span><br><span class="line">                branch <span class="string">'production'</span></span><br><span class="line">            &#125;</span><br><span class="line">            input &#123;</span><br><span class="line">                message <span class="string">"Deploy to production?"</span></span><br><span class="line">                id <span class="string">"simple-input"</span></span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">'Deploying'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.whenåœ¨optionsæŒ‡ä»¤å‰è¯„ä¼° : é»˜è®¤æƒ…å†µä¸‹ï¼Œwhenä¸€ä¸ªæ¡ä»¶stageä¼šè¿›å…¥ä¹‹åè¿›è¡Œè¯„ä»·optionsä¸ºstageï¼Œå¦‚æœä»»ä½•é™å®šã€‚ä½†æ˜¯å¯ä»¥é€šè¿‡beforeOptionsåœ¨when å—ä¸­æŒ‡å®šé€‰é¡¹æ¥æ›´æ”¹æ­¤è®¾ç½®ã€‚<code>å¦‚æœbeforeOptionså°†è®¾ç½®ä¸ºtrueï¼Œwhenåˆ™å°†é¦–å…ˆè¯„ä¼°æ¡ä»¶ï¼Œå¹¶ä¸”optionsä»…åœ¨ when æ¡ä»¶è¯„ä¼°ä¸ºtrueæ—¶æ‰è¾“å…¥</code>ã€‚</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent none</span><br><span class="line">    stages &#123;</span><br><span class="line">      stage(<span class="string">'Example Build'</span>) &#123;</span><br><span class="line">          steps &#123;</span><br><span class="line">              echo <span class="string">'Hello World'</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      stage(<span class="string">'Example Deploy'</span>) &#123;</span><br><span class="line">          when &#123;</span><br><span class="line">              beforeOptions <span class="literal">true</span>   <span class="comment">// å…³é”®ç‚¹</span></span><br><span class="line">              branch <span class="string">'testing'</span></span><br><span class="line">          &#125;</span><br><span class="line">          options &#123;</span><br><span class="line">              lock <span class="string">label:</span> <span class="string">'testing-deploy-envs'</span>, <span class="string">quantity:</span> <span class="number">1</span>, <span class="string">variable:</span> <span class="string">'deployEnv'</span></span><br><span class="line">          &#125;</span><br><span class="line">          steps &#123;</span><br><span class="line">              echo <span class="string">"Deploying to $&#123;deployEnv&#125;"</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>3.whenåœ¨stageè¿›å…¥agentå‰è¯„ä¼° : é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœå®šä¹‰äº†ä¸€ä¸ªé˜¶æ®µçš„whenæ¡ä»¶ï¼Œé‚£ä¹ˆå°†åœ¨è¿›å…¥è¯¥é˜¶æ®µçš„ä»£ç†ä¹‹åè®¡ç®—ã€‚ä½†æ˜¯ï¼Œè¿™å¯ä»¥é€šè¿‡åœ¨whenå—ä¸­æŒ‡å®šbeforeAgenté€‰é¡¹æ¥æ›´æ”¹ã€‚<code>å¦‚æœbeforeAgentè¢«è®¾ç½®ä¸ºtrueï¼Œé‚£ä¹ˆå°†é¦–å…ˆè®¡ç®—whenæ¡ä»¶ï¼Œåªæœ‰å½“whenæ¡ä»¶è®¡ç®—ä¸ºtrueæ—¶æ‰ä¼šè¾“å…¥agent</code>ã€‚</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent none</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">'Example Build'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">'Hello World'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">'Example Deploy'</span>) &#123;</span><br><span class="line">            agent &#123;</span><br><span class="line">                label <span class="string">"some-label"</span></span><br><span class="line">            &#125;</span><br><span class="line">            when &#123;</span><br><span class="line">                beforeAgent <span class="literal">true</span></span><br><span class="line">                branch <span class="string">'production'</span></span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">'Deploying'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>ç¤ºä¾‹.Condition When</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent none  <span class="comment">// beforeAgent</span></span><br><span class="line">    stages &#123;</span><br><span class="line">      stage(<span class="string">'Example Build'</span>) &#123;</span><br><span class="line">        steps &#123;</span><br><span class="line">          echo <span class="string">'Hello World'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      stage(<span class="string">'Example Deploy'</span>) &#123;</span><br><span class="line">        <span class="comment">// Single Condition - å•ä¸€æ¡ä»¶</span></span><br><span class="line">        when &#123;</span><br><span class="line">          branch <span class="string">'production'</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Multiple Condition - å¤šé‡æ¡ä»¶</span></span><br><span class="line">        when &#123;</span><br><span class="line">          branch <span class="string">'production'</span></span><br><span class="line">          environment <span class="string">name:</span> <span class="string">'DEPLOY_TO'</span>, <span class="string">value:</span> <span class="string">'production'</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Nested condition - åµŒå¥—æ¡ä»¶</span></span><br><span class="line">        when &#123;</span><br><span class="line">          allOf &#123;</span><br><span class="line">            branch <span class="string">'production'</span></span><br><span class="line">            environment <span class="string">name:</span> <span class="string">'DEPLOY_TO'</span>, <span class="string">value:</span> <span class="string">'production'</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Multiple condition and nested condition - æ³¨æ„ç‚¹</span></span><br><span class="line">        when &#123;</span><br><span class="line">            branch <span class="string">'production'</span></span><br><span class="line">            anyOf &#123;</span><br><span class="line">                environment <span class="string">name:</span> <span class="string">'DEPLOY_TO'</span>, <span class="string">value:</span> <span class="string">'production'</span></span><br><span class="line">                environment <span class="string">name:</span> <span class="string">'DEPLOY_TO'</span>, <span class="string">value:</span> <span class="string">'staging'</span></span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Expression condition and nested condition  - è¡¨è¾¾å¼æ¡ä»¶å’ŒåµŒå¥—æ¡ä»¶</span></span><br><span class="line">        when &#123;</span><br><span class="line">          expression &#123; BRANCH_NAME ==~ <span class="regexp">/(production|staging)/</span> &#125;</span><br><span class="line">          anyOf &#123;</span><br><span class="line">              environment <span class="string">name:</span> <span class="string">'DEPLOY_TO'</span>, <span class="string">value:</span> <span class="string">'production'</span></span><br><span class="line">              environment <span class="string">name:</span> <span class="string">'DEPLOY_TO'</span>, <span class="string">value:</span> <span class="string">'staging'</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// triggeredBy</span></span><br><span class="line">        when &#123;</span><br><span class="line">          triggeredBy <span class="string">"TimerTrigger"</span>  <span class="comment">// å½“å‰Jobè®¾ç½®çš„è§¦å‘å™¨åç§°è¿›è¡Œç›‘æ§</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å½“å‰é¢çš„whenéƒ½æ»¡è¶³æ—¶é‡‡ç”¨æ‰§è¡Œè¯¥é˜¶æ®µæ­¥éª¤ï¼Œå¦åˆ™ä¸¢å¼ƒ</span></span><br><span class="line">        steps &#123;</span><br><span class="line">            echo <span class="string">'Deploying'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Tips : GLOBï¼ˆå¯¹äºé»˜è®¤ï¼‰å¯¹äºä¸åŒºåˆ†å¤§å°å†™çš„ANTæ ·å¼è·¯å¾„æ‰€ä»¥å¯ä»¥ä½¿ç”¨caseSensitiveå‚æ•°å°†å…¶å…³é—­ï¼›</p>
<p><br></p>
<h4 id="2-3-Sequential-Stages-é¡ºåºé˜¶æ®µ"><a href="#2-3-Sequential-Stages-é¡ºåºé˜¶æ®µ" class="headerlink" title="2.3) Sequential Stages - é¡ºåºé˜¶æ®µ"></a>2.3) Sequential Stages - é¡ºåºé˜¶æ®µ</h4><p>æè¿°: å£°æ˜å¼ç®¡é“ä¸­çš„é˜¶æ®µå¯èƒ½æœ‰ä¸€ä¸ªåŒ…å«è¦æŒ‰é¡ºåºè¿è¡Œçš„åµŒå¥—é˜¶æ®µåˆ—è¡¨çš„stageèŠ‚ã€‚æ³¨æ„ï¼Œä¸€ä¸ªé˜¶æ®µå¿…é¡»æœ‰ä¸”åªæœ‰ä¸€ä¸ª<code>æ­¥éª¤ã€é˜¶æ®µã€å¹¶è¡Œæˆ– Matrix</code>ã€‚å¦‚æœstageæŒ‡ä»¤åµŒå¥—åœ¨ä¸€ä¸ªå¹¶è¡Œå—æˆ– Matrix å—æœ¬èº«ä¸­ï¼Œ  <code>åˆ™ä¸å¯èƒ½åœ¨stageæŒ‡ä»¤ä¸­åµŒå¥—ä¸€ä¸ªå¹¶è¡Œå—æˆ– Matrix å—</code>ã€‚ç„¶è€Œä¸€ä¸ªå¹¶è¡Œæˆ– Matrix å—ä¸­çš„stageæŒ‡ä»¤å¯ä»¥ä½¿ç”¨stageçš„æ‰€æœ‰å…¶ä»–åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä»£ç†ã€å·¥å…·ã€whenç­‰ã€‚</p>
<p><strong>ç¤ºä¾‹:Sequential Stages, Declarative Pipeline</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent none</span><br><span class="line">    stages &#123;</span><br><span class="line">        <span class="comment">// éæ—¶åºçš„é˜¶æ®µ</span></span><br><span class="line">        stage(<span class="string">'Non-Sequential Stage'</span>) &#123;</span><br><span class="line">            agent &#123;</span><br><span class="line">                label <span class="string">'for-non-sequential'</span></span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">"On Non-Sequential Stage"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// é¡ºåºé˜¶æ®µ</span></span><br><span class="line">        stage(<span class="string">'Sequential Stage'</span>) &#123;</span><br><span class="line">            agent &#123;</span><br><span class="line">                label <span class="string">'for-sequential'</span></span><br><span class="line">            &#125;</span><br><span class="line">            environment &#123;</span><br><span class="line">                FOR_SEQUENTIAL = <span class="string">"some-value"</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ³¨æ„ç‚¹1:</span></span><br><span class="line">            stages &#123;</span><br><span class="line">                stage(<span class="string">'In Sequential 1'</span>) &#123;</span><br><span class="line">                    steps &#123;</span><br><span class="line">                        echo <span class="string">"In Sequential 1"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                stage(<span class="string">'In Sequential 2'</span>) &#123;</span><br><span class="line">                    steps &#123;</span><br><span class="line">                        echo <span class="string">"In Sequential 2"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// æ³¨æ„ç‚¹2:å¯ä»¥ä½¿ç”¨stageçš„æ‰€æœ‰å…¶ä»–åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä»£ç†ã€å·¥å…·ã€whenç­‰</span></span><br><span class="line">                stage(<span class="string">'Parallel In Sequential'</span>) &#123;</span><br><span class="line">                    <span class="comment">// å¹¶è¡Œæ‰§è¡Œä¸Šé¢å·²è®²è¿°</span></span><br><span class="line">                    parallel &#123;</span><br><span class="line">                        stage(<span class="string">'In Parallel 1'</span>) &#123;</span><br><span class="line">                            steps &#123;</span><br><span class="line">                                echo <span class="string">"In Parallel 1"</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        stage(<span class="string">'In Parallel 2'</span>) &#123;</span><br><span class="line">                            steps &#123;</span><br><span class="line">                                echo <span class="string">"In Parallel 2"</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="2-4-Parallel-å¹¶è¡Œ"><a href="#2-4-Parallel-å¹¶è¡Œ" class="headerlink" title="2.4) Parallel - å¹¶è¡Œ"></a>2.4) Parallel - å¹¶è¡Œ</h4><p>æè¿°:å£°æ˜å¼ç®¡é“ä¸­çš„é˜¶æ®µå¯èƒ½æœ‰ä¸€ä¸ªåŒ…å«è¦å¹¶è¡Œè¿è¡Œçš„åµŒå¥—é˜¶æ®µåˆ—è¡¨çš„å¹¶è¡Œéƒ¨åˆ†ã€‚æ³¨æ„ï¼Œä¸€ä¸ªé˜¶æ®µå¿…é¡»æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ­¥éª¤ã€é˜¶æ®µã€å¹¶è¡Œæˆ– Matrix ã€‚å¦‚æœstageæŒ‡ä»¤åµŒå¥—åœ¨ä¸€ä¸ªå¹¶è¡Œå—æˆ– Matrix å—æœ¬èº«ä¸­ï¼Œåˆ™ä¸å¯èƒ½åœ¨stageæŒ‡ä»¤ä¸­åµŒå¥—ä¸€ä¸ªå¹¶è¡Œå—æˆ– Matrix å—ã€‚ç„¶è€Œï¼Œä¸€ä¸ªå¹¶è¡Œæˆ– Matrix å—ä¸­çš„stageæŒ‡ä»¤å¯ä»¥ä½¿ç”¨stageçš„æ‰€æœ‰å…¶ä»–åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä»£ç†ã€å·¥å…·ã€whenç­‰ã€‚</p>
<p>Tips : æ­¤å¤–ï¼Œé€šè¿‡åœ¨åŒ…å«å¹¶è¡Œçš„é˜¶æ®µä¸­æ·»åŠ <code>failFast true</code>ï¼Œå¯ä»¥åœ¨ä»»ä½•ä¸€ä¸ªé˜¶æ®µå¤±è´¥æ—¶å¼ºåˆ¶ç»ˆæ­¢æ‰€æœ‰å¹¶è¡Œé˜¶æ®µã€‚æ·»åŠ <code>failfast</code> çš„å¦ä¸€ä¸ªé€‰é¡¹æ˜¯åœ¨ç®¡é“å®šä¹‰ä¸­<code>æ·»åŠ ä¸€ä¸ªoption{ parallelsAlwaysFailFast() }</code></p>
<p><strong>ç¤ºä¾‹:Parallel Stages, Declarative Pipeline</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    <span class="comment">//æ–¹å¼1.parallelsAlwaysFailFast</span></span><br><span class="line">    options &#123;</span><br><span class="line">        parallelsAlwaysFailFast()</span><br><span class="line">    &#125; </span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">'Non-Parallel Stage'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">'This stage will be executed first.'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">'Parallel Stage'</span>) &#123;</span><br><span class="line">            when &#123;</span><br><span class="line">                branch <span class="string">'master'</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ–¹å¼2.åœ¨ä»»ä½•ä¸€ä¸ªé˜¶æ®µå¤±è´¥æ—¶å¼ºåˆ¶ç»ˆæ­¢æ‰€æœ‰å¹¶è¡Œé˜¶æ®µ</span></span><br><span class="line">            failFast <span class="literal">true</span></span><br><span class="line">            <span class="comment">// å¹¶è¡Œæ„å»ºå€¼å¾—å­¦ä¹ </span></span><br><span class="line">            parallel &#123;</span><br><span class="line">                stage(<span class="string">'Branch A'</span>) &#123;</span><br><span class="line">                    agent &#123;</span><br><span class="line">                        label <span class="string">"for-branch-a"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    steps &#123;</span><br><span class="line">                        echo <span class="string">"On Branch A"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                stage(<span class="string">'Branch B'</span>) &#123;</span><br><span class="line">                    agent &#123;</span><br><span class="line">                        label <span class="string">"for-branch-b"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    steps &#123;</span><br><span class="line">                        echo <span class="string">"On Branch B"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                stage(<span class="string">'Branch C'</span>) &#123;</span><br><span class="line">                    agent &#123;</span><br><span class="line">                        label <span class="string">"for-branch-c"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    stages &#123;</span><br><span class="line">                        stage(<span class="string">'Nested 1'</span>) &#123;</span><br><span class="line">                            steps &#123;</span><br><span class="line">                                echo <span class="string">"In stage Nested 1 within Branch C"</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        stage(<span class="string">'Nested 2'</span>) &#123;</span><br><span class="line">                            steps &#123;</span><br><span class="line">                                echo <span class="string">"In stage Nested 2 within Branch C"</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h4 id="2-5-Matrix-æ¨¡å‹"><a href="#2-5-Matrix-æ¨¡å‹" class="headerlink" title="2.5) Matrix - æ¨¡å‹"></a>2.5) Matrix - æ¨¡å‹</h4><p>æè¿°: å£°æ˜å¼ç®¡é“(Declarative pipeline)ä¸­çš„é˜¶æ®µå¯èƒ½æœ‰ä¸€ä¸ª Matrix èŠ‚ï¼Œå®šä¹‰è¦å¹¶è¡Œè¿è¡Œçš„åç§°-å€¼ç»„åˆçš„å¤šç»´ Matrix ã€‚æˆ‘ä»¬å°†æŠŠè¿™äº›ç»„åˆç§°ä¸º Matrix ä¸­çš„â€œç»†èƒâ€ã€‚ Matrix ä¸­çš„æ¯ä¸ªå•å…ƒ<code>å¯ä»¥åŒ…æ‹¬ä¸€ä¸ªæˆ–å¤šä¸ªé˜¶æ®µï¼Œä½¿ç”¨è¯¥å•å…ƒçš„é…ç½®æŒ‰é¡ºåºè¿è¡Œ</code>ã€‚æ³¨æ„ä¸€ä¸ªé˜¶æ®µå¿…é¡»æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ­¥éª¤ã€é˜¶æ®µã€å¹¶è¡Œæˆ– Matrix ã€‚å¦‚æœstageæŒ‡ä»¤åµŒå¥—åœ¨ä¸€ä¸ªå¹¶è¡Œå—æˆ– Matrix å—æœ¬èº«ä¸­ï¼Œåˆ™ä¸å¯èƒ½åœ¨stageæŒ‡ä»¤ä¸­åµŒå¥—ä¸€ä¸ªå¹¶è¡Œå—æˆ– Matrix å—ã€‚ç„¶è€Œï¼Œä¸€ä¸ªå¹¶è¡Œæˆ– Matrix å—ä¸­çš„stageæŒ‡ä»¤å¯ä»¥ä½¿ç”¨stageçš„æ‰€æœ‰å…¶ä»–åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä»£ç†ã€å·¥å…·ã€whenç­‰ã€‚</p>
<p>æ­¤å¤–ï¼Œé€šè¿‡åœ¨åŒ…å« Matrix çš„é˜¶æ®µåŒæ ·ä¹Ÿå¯æ·»åŠ  <code>failFast true</code>ï¼Œæ‚¨å¯ä»¥å¼ºåˆ¶æ‚¨çš„ Matrix å•å…ƒåœ¨å…¶ä¸­ä»»ä½•ä¸€ä¸ªå¤±è´¥æ—¶å…¨éƒ¨ç»ˆæ­¢ã€‚æ·»åŠ failfastçš„å¦ä¸€ä¸ªé€‰é¡¹æ˜¯åœ¨ç®¡é“å®šä¹‰ä¸­æ·»åŠ ä¸€ä¸ª<code>option { parallelsAlwaysFailFast() }</code> Matrix éƒ¨åˆ†å¿…é¡»åŒ…æ‹¬ä¸€ä¸ªè½´éƒ¨åˆ†å’Œä¸€ä¸ªçº§éƒ¨åˆ†ã€‚</p>
<ul>
<li>axiséƒ¨åˆ†å®šä¹‰äº† Matrix ä¸­æ¯ä¸ªè½´çš„å€¼ã€‚</li>
<li>stageéƒ¨åˆ†å®šä¹‰äº†è¦åœ¨æ¯ä¸ªå•å…ƒæ ¼ä¸­æŒ‰é¡ºåºè¿è¡Œçš„é˜¶æ®µåˆ—è¡¨ã€‚</li>
</ul>
<p>Tips : åŒæ—¶Matrix å¯ä»¥æœ‰ä¸€ä¸ªexcludeèŠ‚æ¥<code>ç§»é™¤æ— æ•ˆçš„å•å…ƒæ ¼</code>, èˆå°ä¸Šå¯ç”¨çš„è®¸å¤šæŒ‡ä»¤ï¼ŒåŒ…æ‹¬ä»£ç†ã€å·¥å…·ã€ä½•æ—¶ç­‰ï¼Œä¹Ÿå¯ä»¥æ·»åŠ åˆ°matrixä¸­æ¥æ§åˆ¶æ¯ä¸ªå•å…ƒæ ¼çš„è¡Œä¸ºã€‚</p>
<p><br></p>
<p><strong>axis</strong><br>æè¿°: axes(è½´çº¿)éƒ¨åˆ†<code>æŒ‡å®šäº†ä¸€ä¸ªæˆ–å¤šä¸ªaxisæŒ‡ä»¤</code>ã€‚æ¯ä¸ªè½´ç”±ä¸€ä¸ªåç§°å’Œä¸€ä¸ªå€¼åˆ—è¡¨ç»„æˆã€‚æ¯ä¸ªè½´ä¸Šçš„æ‰€æœ‰å€¼éƒ½ä¸å…¶ä»–è½´ä¸Šçš„å€¼ç»„åˆèµ·æ¥ç”Ÿæˆå•å…ƒæ ¼ã€‚</p>
<p><br></p>
<p><strong>stages</strong><br>æè¿°: è¯¥é˜¶æ®µéƒ¨åˆ†æŒ‡å®šæ¯ä¸ªå•å…ƒä¸­è¦é¡ºåºæ‰§è¡Œçš„ä¸€ä¸ªæˆ–å¤šä¸ªé˜¶æ®µ, æ­¤éƒ¨åˆ†ä¸å‰é¢ä»»ä½•stagesæ˜¯ç›¸åŒçš„;</p>
<p>ç¤ºä¾‹: Matrix<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// One-axis with 3 cells, each cell runs three stages - "build", "test", and "deploy"</span></span><br><span class="line">matrix &#123;</span><br><span class="line">    axes &#123;</span><br><span class="line">      axis &#123;</span><br><span class="line">        name <span class="string">'PLATFORM'</span></span><br><span class="line">        values <span class="string">'linux'</span>, <span class="string">'mac'</span>, <span class="string">'windows'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">'build'</span>) &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">'test'</span>) &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">'deploy'</span>) &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Three-axis matrix with 24 cells (three by four by two)</span></span><br><span class="line"><span class="comment">// å³ 24 ç§ç»„åˆæ–¹å¼: ä¾‹å¦‚ linux -&gt; 32-bit -&gt; chrome , mac -&gt; 32-bit -&gt; chrome </span></span><br><span class="line">matrix &#123;</span><br><span class="line">  axes &#123;</span><br><span class="line">    axis &#123;</span><br><span class="line">        name <span class="string">'PLATFORM'</span></span><br><span class="line">        values <span class="string">'linux'</span>, <span class="string">'mac'</span>, <span class="string">'windows'</span></span><br><span class="line">    &#125;</span><br><span class="line">    axis &#123;</span><br><span class="line">        name <span class="string">'BROWSER'</span></span><br><span class="line">        values <span class="string">'chrome'</span>, <span class="string">'edge'</span>, <span class="string">'firefox'</span>, <span class="string">'safari'</span></span><br><span class="line">    &#125;</span><br><span class="line">    axis &#123;</span><br><span class="line">        name <span class="string">'ARCHITECTURE'</span></span><br><span class="line">        values <span class="string">'32-bit'</span>, <span class="string">'64-bit'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>excludes (optional) - æ’å‡º</strong><br>æè¿°: å¯é€‰çš„excludeéƒ¨åˆ†å…è®¸ä½œè€…æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªexclude filterè¡¨è¾¾å¼ï¼Œè¿™äº›è¡¨è¾¾å¼é€‰æ‹©è¦ä»æ‰©å±•çš„çŸ©é˜µå•å…ƒæ ¼é›†åˆä¸­æ’é™¤çš„å•å…ƒæ ¼(aka, sparsening)ã€‚è¿‡æ»¤å™¨æ˜¯ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªå¸¦æœ‰åç§°å’Œå€¼åˆ—è¡¨çš„æ’é™¤è½´æŒ‡ä»¤çš„åŸºæœ¬æŒ‡ä»¤ç»“æ„æ¥æ„é€ çš„ã€‚<br>excludeä¸­çš„axisæŒ‡ä»¤ç”Ÿæˆä¸€ç»„ç»„åˆ(ç±»ä¼¼äºç”ŸæˆçŸ©é˜µå•å…ƒæ ¼)ã€‚åŒ¹é…æ’é™¤ç»„åˆä¸­æ‰€æœ‰å€¼çš„çŸ©é˜µå•å…ƒæ ¼ä»çŸ©é˜µä¸­ç§»é™¤ã€‚å¦‚æœæä¾›äº†å¤šä¸ªexcludeæŒ‡ä»¤ï¼Œåˆ™æ¯ä¸ªæŒ‡ä»¤å°†åˆ†åˆ«è®¡ç®—ä»¥åˆ é™¤å•å…ƒæ ¼ã€‚</p>
<p>å½“å¤„ç†ä¸€é•¿ä¸²è¦æ’é™¤çš„å€¼æ—¶ exclude axisæŒ‡ä»¤å¯ä»¥ä½¿ç”¨ notValues ä»£æ›¿ values.è¿™å°†æ’é™¤ä¸ä¼ é€’ç»™notValuesçš„å€¼ä¹‹ä¸€ä¸åŒ¹é…çš„å•å…ƒæ ¼ã€‚</p>
<p>ç¤ºä¾‹.å…·æœ‰24ä¸ªå•å…ƒçš„ä¸‰è½´çŸ©é˜µï¼Œä¸åŒ…æ‹¬â€œ 32ä½ï¼Œmacâ€ï¼ˆä¸åŒ…æ‹¬4ä¸ªå•å…ƒï¼‰<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">matrix &#123;</span><br><span class="line">  axes &#123;</span><br><span class="line">      axis &#123;</span><br><span class="line">          name <span class="string">'PLATFORM'</span></span><br><span class="line">          values <span class="string">'linux'</span>, <span class="string">'mac'</span>, <span class="string">'windows'</span></span><br><span class="line">      &#125;</span><br><span class="line">      axis &#123;</span><br><span class="line">          name <span class="string">'BROWSER'</span></span><br><span class="line">          values <span class="string">'chrome'</span>, <span class="string">'edge'</span>, <span class="string">'firefox'</span>, <span class="string">'safari'</span></span><br><span class="line">      &#125;</span><br><span class="line">      axis &#123;</span><br><span class="line">          name <span class="string">'ARCHITECTURE'</span></span><br><span class="line">          values <span class="string">'32-bit'</span>, <span class="string">'64-bit'</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  excludes &#123;</span><br><span class="line">      exclude &#123;</span><br><span class="line">          axis &#123;</span><br><span class="line">              name <span class="string">'PLATFORM'</span></span><br><span class="line">              values <span class="string">'mac'</span></span><br><span class="line">          &#125;</span><br><span class="line">          axis &#123;</span><br><span class="line">              name <span class="string">'ARCHITECTURE'</span></span><br><span class="line">              values <span class="string">'32-bit'</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//æ’é™¤linuxå’Œsafariç»„åˆï¼Œå¹¶æ’é™¤ä½¿ç”¨edgeæµè§ˆå™¨çš„ä»»ä½•éwindowså¹³å°ã€‚</span></span><br><span class="line">       exclude &#123;</span><br><span class="line">          <span class="comment">// 2 cells</span></span><br><span class="line">          axis &#123;</span><br><span class="line">              name <span class="string">'PLATFORM'</span></span><br><span class="line">              values <span class="string">'linux'</span></span><br><span class="line">          &#125;</span><br><span class="line">          axis &#123;</span><br><span class="line">              name <span class="string">'BROWSER'</span></span><br><span class="line">              values <span class="string">'safari'</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        exclude &#123;</span><br><span class="line">          <span class="comment">// 3 more cells and '32-bit, mac' (already excluded)</span></span><br><span class="line">          axis &#123;</span><br><span class="line">              name <span class="string">'PLATFORM'</span></span><br><span class="line">              notValues <span class="string">'windows'</span> <span class="comment">// æ³¨æ„ç‚¹ norValues</span></span><br><span class="line">          &#125;</span><br><span class="line">          axis &#123;</span><br><span class="line">              name <span class="string">'BROWSER'</span></span><br><span class="line">              values <span class="string">'edge'</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="Matrix-å•å…ƒçº§æŒ‡ä»¤ï¼ˆå¯é€‰ï¼‰"><a href="#Matrix-å•å…ƒçº§æŒ‡ä»¤ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="Matrix å•å…ƒçº§æŒ‡ä»¤ï¼ˆå¯é€‰ï¼‰"></a>Matrix å•å…ƒçº§æŒ‡ä»¤ï¼ˆå¯é€‰ï¼‰</h5><p>æè¿°: é€šè¿‡åœ¨Matrixæœ¬èº«ä¸‹æ·»åŠ é˜¶æ®µçº§æŒ‡ä»¤ï¼Œç”¨æˆ·å¯ä»¥æœ‰æ•ˆåœ°ä¸ºæ¯ä¸ªå•å…ƒé…ç½®æ•´ä½“ç¯å¢ƒã€‚è¿™äº›æŒ‡ä»¤çš„è¡Œä¸ºä¸å®ƒä»¬åœ¨èˆå°ä¸Šçš„è¡Œä¸ºç›¸åŒï¼Œä½†å®ƒä»¬ä¹Ÿå¯ä»¥æ¥å—çŸ©é˜µä¸ºæ¯ä¸ªå•å…ƒæ ¼æä¾›çš„å€¼ã€‚</p>
<p>æ³¨æ„ axiså’ŒexcludeæŒ‡ä»¤å®šä¹‰äº†ç»„æˆçŸ©é˜µçš„é™æ€å•å…ƒæ ¼é›†, è¿™ç»„ç»„åˆæ˜¯åœ¨ç®¡é“è¿è¡Œå¼€å§‹ä¹‹å‰ç”Ÿæˆçš„ã€‚å¦ä¸€æ–¹é¢â€œper-cellâ€æŒ‡ä»¤åœ¨è¿è¡Œæ—¶è¿›è¡Œè®¡ç®—ã€‚</p>
<p><strong>directives include:</strong></p>
<ul>
<li>agent</li>
<li>environment</li>
<li>input</li>
<li>options</li>
<li>post</li>
<li>tools</li>
<li>when</li>
</ul>
<p><br></p>
<p><strong>Example.å®Œæ•´çš„çŸ©é˜µç¤ºä¾‹ï¼Œå£°æ˜æ€§ç®¡é“</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    <span class="comment">// å‚æ•°é€‰æ‹©</span></span><br><span class="line">    parameters &#123;</span><br><span class="line">        choice(<span class="string">name:</span> <span class="string">'PLATFORM_FILTER'</span>, <span class="string">choices:</span> [<span class="string">'all'</span>, <span class="string">'linux'</span>, <span class="string">'windows'</span>, <span class="string">'mac'</span>], <span class="string">description:</span> <span class="string">'Run on specific platform'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    agent none</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">'BuildAndTest'</span>) &#123;</span><br><span class="line">            matrix &#123;</span><br><span class="line">                agent &#123;</span><br><span class="line">                    label <span class="string">"$&#123;PLATFORM&#125;-agent"</span></span><br><span class="line">                &#125;</span><br><span class="line">                when &#123; anyOf &#123;</span><br><span class="line">                    <span class="comment">// å‚æ•°é€‰æ‹©ä¸ä¸ºç©ºæ—¶ç»§ç»­æ‰§è¡Œ</span></span><br><span class="line">                    expression &#123; params.PLATFORM_FILTER == <span class="string">'all'</span> &#125;</span><br><span class="line">                    expression &#123; params.PLATFORM_FILTER == env.PLATFORM &#125;</span><br><span class="line">                &#125; &#125;</span><br><span class="line">                <span class="comment">// 2 è½´ (3 x 4) åäºŒæ ¼ç»„åˆæ–¹å¼</span></span><br><span class="line">                axes &#123;</span><br><span class="line">                    axis &#123;</span><br><span class="line">                        name <span class="string">'PLATFORM'</span></span><br><span class="line">                        values <span class="string">'linux'</span>, <span class="string">'windows'</span>, <span class="string">'mac'</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    axis &#123;</span><br><span class="line">                        name <span class="string">'BROWSER'</span></span><br><span class="line">                        values <span class="string">'firefox'</span>, <span class="string">'chrome'</span>, <span class="string">'safari'</span>, <span class="string">'edge'</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// æ’é™¤æŒ‡å®šMatrixçŸ©é˜µä¸­çš„å€¼ (æ’é™¤linuxå’Œsafariç»„åˆï¼Œå¹¶æ’é™¤ä½¿ç”¨edgeæµè§ˆå™¨çš„ä»»ä½•éwindowså¹³å°ã€‚) </span></span><br><span class="line">                <span class="comment">// å³ æ’é™¤ (linux,safari) , (linux,edge) , (mac,edge) ä¸‰ç§æƒ…å†µ</span></span><br><span class="line">                excludes &#123;</span><br><span class="line">                    exclude &#123;</span><br><span class="line">                        axis &#123;</span><br><span class="line">                            name <span class="string">'PLATFORM'</span></span><br><span class="line">                            values <span class="string">'linux'</span></span><br><span class="line">                        &#125;</span><br><span class="line">                        axis &#123;</span><br><span class="line">                            name <span class="string">'BROWSER'</span></span><br><span class="line">                            values <span class="string">'safari'</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    exclude &#123;</span><br><span class="line">                        axis &#123;</span><br><span class="line">                            name <span class="string">'PLATFORM'</span></span><br><span class="line">                            notValues <span class="string">'windows'</span></span><br><span class="line">                        &#125;</span><br><span class="line">                        axis &#123;</span><br><span class="line">                            name <span class="string">'BROWSER'</span></span><br><span class="line">                            values <span class="string">'edge'</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                stages &#123;</span><br><span class="line">                    stage(<span class="string">'Build'</span>) &#123;</span><br><span class="line">                        steps &#123;</span><br><span class="line">                            echo <span class="string">"Do Build for $&#123;PLATFORM&#125; - $&#123;BROWSER&#125;"</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    stage(<span class="string">'Test'</span>) &#123;</span><br><span class="line">                        steps &#123;</span><br><span class="line">                            echo <span class="string">"Do Test for $&#123;PLATFORM&#125; - $&#123;BROWSER&#125;"</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=2.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineè¯­æ³•å…¥é—¨å­¦ä¹  href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210131135816.png" target="_blank" title="WeiyiGeek.Matrixç¤ºä¾‹" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210131135816.png" alt="WeiyiGeek.Matrixç¤ºä¾‹" title="" class=""></a>
                <p>WeiyiGeek.Matrixç¤ºä¾‹</p>
            </figure>
<p><br></p>
<h4 id="è¯­æ³•æ€»ç»“-1"><a href="#è¯­æ³•æ€»ç»“-1" class="headerlink" title="è¯­æ³•æ€»ç»“"></a>è¯­æ³•æ€»ç»“</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Declarative Pipeline Syntax Composite sample</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">  <span class="comment">// 1.ç”±äºæ­¤å¤„æ²¡æœ‰å…¶å®ƒjenkins slave åˆ†å¸ƒå¼æœºå™¨åˆ™é‡‡ç”¨anyè¿›è¡Œæ›¿ä»£</span></span><br><span class="line">  agent any</span><br><span class="line">  <span class="comment">// 7.å…¨å±€ç¯å¢ƒå˜é‡</span></span><br><span class="line">  environment &#123; </span><br><span class="line">    global_env = <span class="string">'Jenkins global environment'</span></span><br><span class="line">    global_when = <span class="string">'true'</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 8.å…¨å±€é€‰é¡¹</span></span><br><span class="line">  options &#123; </span><br><span class="line">    <span class="comment">// å¦‚æœå¤±è´¥é‡è¯•æ•´ä¸ª PipelineæŒ‡å®šæ¬¡æ•°</span></span><br><span class="line">    retry(<span class="number">3</span>)</span><br><span class="line">    <span class="comment">// åœ¨ä»»ä½•ä¸€ä¸ªé˜¶æ®µå¤±è´¥æ—¶å¼ºåˆ¶ç»ˆæ­¢æ‰€æœ‰å¹¶è¡Œé˜¶æ®µ</span></span><br><span class="line">    parallelsAlwaysFailFast()</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 9.å…¨å±€å‚æ•°</span></span><br><span class="line">  parameters &#123;</span><br><span class="line">    <span class="comment">// å‚æ•°å£°æ˜å®šä¹‰</span></span><br><span class="line">    string(<span class="string">name:</span> <span class="string">'PERSON'</span>, <span class="string">defaultValue:</span> <span class="string">'Mr Jenkins'</span>, <span class="string">description:</span> <span class="string">'Who should I say hello to?'</span>)</span><br><span class="line">    booleanParam(<span class="string">name:</span> <span class="string">'TOGGLE'</span>, <span class="string">defaultValue:</span> <span class="literal">true</span>, <span class="string">description:</span> <span class="string">'Toggle this value'</span>)</span><br><span class="line">    text(<span class="string">name:</span> <span class="string">'BIOGRAPHY'</span>, <span class="string">defaultValue:</span> <span class="string">''</span>, <span class="string">description:</span> <span class="string">'Enter some information about the person'</span>)</span><br><span class="line">    choice(<span class="string">name:</span> <span class="string">'CHOICE'</span>, <span class="string">choices:</span> [<span class="string">'One'</span>, <span class="string">'Two'</span>, <span class="string">'Three'</span>], <span class="string">description:</span> <span class="string">'Pick something'</span>)</span><br><span class="line">    password(<span class="string">name:</span> <span class="string">'PASSWORD'</span>, <span class="string">defaultValue:</span> <span class="string">'SECRET'</span>, <span class="string">description:</span> <span class="string">'Enter a password'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 11.è§¦å‘å™¨ (æ¯ä¸¤åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡)</span></span><br><span class="line">  triggers&#123; cron(<span class="string">'H/2 * * * *'</span>) &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 12.å·¥å…·è·¯å¾„å¹¶æ”¾ç½®ç¯å¢ƒå˜é‡åˆ°PATH</span></span><br><span class="line">  <span class="comment">// Dashboard -&gt; å…¨å±€å·¥å…·é…ç½®</span></span><br><span class="line">  tools &#123;</span><br><span class="line">    maven <span class="string">'maven_env'</span></span><br><span class="line">    jdk   <span class="string">'jdk_1.8.0_211'</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 2.å¤šé˜¶æ®µå”¯ä¸€å…¥å£</span></span><br><span class="line">  stages &#123;</span><br><span class="line">    <span class="comment">// 3.æŒ‡å®šçš„å•é˜¶æ®µï¼ˆinit-åˆå§‹åŒ–é˜¶æ®µï¼‰</span></span><br><span class="line">    stage (<span class="string">'init'</span>) &#123;</span><br><span class="line">      <span class="comment">// 4.å•é˜¶æ®µä¸­çš„åªæœ‰ä¸€ä¸ªæ­¥éª¤steps</span></span><br><span class="line">      steps &#123;</span><br><span class="line">        <span class="comment">// 5.å†…ç½®æŒ‡ä»¤ä¾‹å¦‚ echo ã€printlnè¿›è¡Œè¾“å‡º</span></span><br><span class="line">        echo <span class="string">"init - steps one - built-in functions echo"</span></span><br><span class="line">        println <span class="string">"init - steps one - built-in functions println "</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6.é‡‡ç”¨scriptæŒ‡ä»¤æ¥æ‰§è¡ŒScripted Pipelineä¸­çš„ä¸€äº›è„šæœ¬</span></span><br><span class="line">        script &#123;</span><br><span class="line">          <span class="keyword">def</span> browsers = [<span class="string">'chrome'</span>, <span class="string">'firefox'</span>, <span class="string">'edge'</span>]</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; browsers.size(); ++i) &#123;</span><br><span class="line">              echo <span class="string">"Testing the $&#123;browsers[i]&#125; browser"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   stage (<span class="string">'one-stage'</span>) &#123;</span><br><span class="line">      <span class="comment">// 7.å±€éƒ¨ç¯å¢ƒå˜é‡</span></span><br><span class="line">      environment &#123; </span><br><span class="line">        <span class="comment">// å˜é‡å®šä¹‰</span></span><br><span class="line">        local_env = <span class="string">"Jenkins local environment"</span></span><br><span class="line">        <span class="comment">// å°†åœ¨Jenkinsä¸­è®¾ç½®çš„ç”¨æˆ·å¯†ç å‡­è¯èµ‹äºˆlocal_credså˜é‡, æ³¨æ„æ‹¬å·ä¸­ä¸ºå‡­æ®åç§°</span></span><br><span class="line">        <span class="comment">// Dashboard -&gt; å‡­æ® -&gt; ç³»ç»Ÿ -&gt; å…¨å±€å‡­æ® (unrestricted) -&gt; æ·»åŠ å‡­æ®</span></span><br><span class="line">        <span class="comment">// Username with password	: 43287e62-ce5b-489a-9c11-cedf38e16e92	weiyigeek/****** (Pipeline æµ‹è¯• credentials è¯»å–)	Username with password	Pipeline æµ‹è¯• credentials è¯»å–</span></span><br><span class="line">        Local_userpass_creds = credentials(<span class="string">'43287e62-ce5b-489a-9c11-cedf38e16e92'</span>)</span><br><span class="line">        <span class="comment">// SSH Username with private key : b4c8b4e9-2777-44a1-a1ed-e9dc21d37f4f	weiyigeek (myself-gitlab-weiyigeek)	SSH Username with private key	myself-gitlab-weiyigeek</span></span><br><span class="line">        Local_ssh_creds = credentials(<span class="string">'b4c8b4e9-2777-44a1-a1ed-e9dc21d37f4f'</span>)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      steps &#123;</span><br><span class="line">        println <span class="string">"å…¨å±€å˜é‡: "</span> + global_env +<span class="string">", å±€éƒ¨å˜é‡: "</span> + local_env </span><br><span class="line">        <span class="comment">/* == å…¨å±€å˜é‡: Jenkins global environment, å±€éƒ¨å˜é‡: Jenkins local environment*/</span></span><br><span class="line">        <span class="comment">// æ³¨æ„ç‚¹: defined: MYVARNAME_USR and MYVARNAME_PSW respectively. (è¾“å‡ºçš„å­—ç¬¦ä¸²å·²ç»ç»è¿‡è½¬ä¹‰)</span></span><br><span class="line">        sh <span class="string">'echo "user is $Local_userpass_creds_USR"'</span>      <span class="comment">/* = user is **** */</span></span><br><span class="line">        sh <span class="string">'echo "password is $Local_userpass_creds_PSW"'</span>  <span class="comment">/* = password is **** */</span></span><br><span class="line">        <span class="comment">// æ³¨æ„ç‚¹: defined: MYVARNAME_USR and MYVARNAME_PSW (holding the passphrase).</span></span><br><span class="line">        sh <span class="string">'echo "SSH private key is located at $Local_ssh_creds"'</span></span><br><span class="line">        sh <span class="string">'echo "SSH user is $Local_ssh_creds_USR"'</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 12.é¢å¤–ç¬¬ä¸‰æ–¹å·¥å…·æ’ä»¶è·¯å¾„è°ƒç”¨æ–¹å¼</span></span><br><span class="line">        script &#123;</span><br><span class="line">          scannerHome = tool <span class="string">'sonarqubescanner'</span></span><br><span class="line">          <span class="comment">//è¿™é‡Œè¿™ä¸ªtoolæ˜¯ç›´æ¥æ ¹æ®åç§°ï¼Œè·å–è‡ªåŠ¨å®‰è£…çš„æ’ä»¶çš„è·¯å¾„</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// withSonarQubeEnv('SonarQube') &#123;</span></span><br><span class="line">        <span class="comment">//   sh "$&#123;scannerHome&#125;/bin/sonar-scanner -Dsonar.projectKey=YourProjectKey -Dsonar.sources=."</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">    stage (<span class="string">'two-stage'</span>) &#123;</span><br><span class="line">      <span class="comment">// 13.å½“ä»»ä¸€æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶æ‰§è¡Œ</span></span><br><span class="line">      when &#123;   </span><br><span class="line">        beforeInput <span class="literal">true</span> </span><br><span class="line">        anyOf &#123; branch <span class="string">'master'</span>; environment <span class="string">name:</span> <span class="string">'global_when'</span>, <span class="string">value:</span> <span class="string">'true'</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 8.å±€éƒ¨é€‰é¡¹</span></span><br><span class="line">      options &#123;</span><br><span class="line">        <span class="comment">// å¯è®¾ç½®å…¨å±€(å±€éƒ¨é˜¶æ®µ)æ‰§è¡Œè¶…æ—¶æŒ‡å®šä¸ºä¸€åˆ†é’Ÿï¼Œç„¶åJenkinså°†ä¸­æ­¢ Pipelineè¿è¡Œã€‚</span></span><br><span class="line">        timeout(<span class="string">time:</span> <span class="number">5</span>, <span class="string">unit:</span> <span class="string">'MINUTES'</span>) </span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 12.InputæŒ‡ä»¤è¾“å…¥å‚æ•°åˆ°å˜é‡ä¸­</span></span><br><span class="line">      <span class="comment">// æ–¹å¼1</span></span><br><span class="line">      input &#123;</span><br><span class="line">          message <span class="string">"Title : ä¸ªäººä¿¡æ¯è¾“å…¥"</span></span><br><span class="line">          ok <span class="string">"å®Œæˆæäº¤"</span></span><br><span class="line">          submitter <span class="string">"alice,bob"</span></span><br><span class="line">          parameters &#123;</span><br><span class="line">            string(<span class="string">name:</span> <span class="string">'INPUT_PERSON'</span>, <span class="string">defaultValue:</span> <span class="string">'WeiyiGeek'</span>, <span class="string">description:</span> <span class="string">'Message: è¯·è¾“å…¥æ‚¨çš„å§“å?'</span>)</span><br><span class="line">            text(<span class="string">name:</span> <span class="string">'INPUT_AGE'</span>, <span class="string">defaultValue:</span> <span class="string">'WeiyiGeek'</span>, <span class="string">description:</span> <span class="string">'Message: è¯·è¾“å…¥æ‚¨çš„å¹´é¾„?'</span>)</span><br><span class="line">            choice(<span class="string">name:</span> <span class="string">'INPUT_SEX'</span>, <span class="string">choices:</span> [<span class="string">'Male'</span>,<span class="string">'Female'</span>], <span class="string">description:</span> <span class="string">'Message: è¯·é€‰æ‹©ä½ çš„æ€§åˆ«?'</span>)</span><br><span class="line">            password(<span class="string">name:</span> <span class="string">'INPUT_PASSWORD'</span>, <span class="string">defaultValue:</span> <span class="string">'SECRET'</span>, <span class="string">description:</span> <span class="string">'Message: è¯·è¾“å…¥æ‚¨æ³¨å†Œå¯†ç ?'</span>)</span><br><span class="line">            booleanParam(<span class="string">name:</span> <span class="string">'INPUT_AGREE'</span>, <span class="string">defaultValue:</span> <span class="literal">true</span>, <span class="string">description:</span> <span class="string">'Message: æ˜¯å¦ç¡®å®šåè®®?'</span>)</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      steps &#123;</span><br><span class="line">          <span class="comment">// æ–¹å¼2ï¼šæ³¨æ„scriptå¿…é¡»åŒ…å«åœ¨ steps å—ä¹‹ä¸­</span></span><br><span class="line">          script &#123;</span><br><span class="line">            env.git_version=input <span class="string">message:</span> <span class="string">'Titel: ç‰ˆæœ¬'</span>, <span class="string">ok:</span> <span class="string">'é€šè¿‡'</span>,<span class="string">parameters:</span> [string ( <span class="string">name:</span> <span class="string">'git_version'</span>, <span class="string">trim:</span> <span class="literal">true</span>, <span class="string">description:</span> <span class="string">'Message : è¯·é€‰æ‹©è¦æ“ä½œçš„åº”ç”¨ç‰ˆæœ¬?'</span>)];</span><br><span class="line">            env.deploy_option = input <span class="string">message:</span> <span class="string">'Titel: æ“ä½œ'</span>, <span class="string">ok:</span> <span class="string">'deploy'</span>, <span class="string">parameters:</span> [choice(<span class="string">name:</span> <span class="string">'deploy_option'</span>, <span class="string">choices:</span> [<span class="string">'deploy'</span>, <span class="string">'rollback'</span>, <span class="string">'redeploy'</span>], <span class="string">description:</span> <span class="string">'Message : è¯·é€‰æ‹©æ“ä½œæµç¨‹?'</span>)];</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 10.Parameters å‚æ•°è°ƒç”¨</span></span><br><span class="line">        echo <span class="string">"å…¨å±€ - Hello $&#123;params.PERSON&#125;"</span></span><br><span class="line">        echo <span class="string">"å…¨å±€ - Toggle: $&#123;params.TOGGLE&#125;"</span></span><br><span class="line">        echo <span class="string">"å…¨å±€ - Choice: $&#123;params.CHOICE&#125;"</span></span><br><span class="line">        echo <span class="string">"å…¨å±€ - Password: $&#123;params.PASSWORD&#125;"</span></span><br><span class="line">        echo <span class="string">"å…¨å±€ - Biography: $&#123;params.BIOGRAPHY&#125;"</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 12.input è¾“å‡ºç¤ºä¾‹</span></span><br><span class="line">        echo <span class="string">"input è¾“å‡ºç¤ºä¾‹1: å§“åï¼š$&#123;INPUT_PERSON&#125;, å¹´é¾„ï¼š$&#123;INPUT_AGE&#125;, æ€§åˆ«ï¼š$&#123;INPUT_SEX&#125;, æ˜¯å¦åŒæ„åè®®: $&#123;INPUT_AGREE&#125;"</span></span><br><span class="line">        echo <span class="string">"input è¾“å‡ºç¤ºä¾‹(script) -&gt; ç‰ˆæœ¬ : $&#123;env.git_version&#125;"</span></span><br><span class="line">        echo <span class="string">"input è¾“å‡ºç¤ºä¾‹(script) -&gt; ç‰ˆæœ¬ : $&#123;env.deploy_option&#125;"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    stage (<span class="string">'three-stage'</span>) &#123;</span><br><span class="line">      <span class="comment">// 14.Parallel Stages å¹¶è¡Œæ‰§è¡Œ</span></span><br><span class="line">      <span class="comment">// æ–¹å¼2.failFast true åœ¨ä»»ä½•ä¸€ä¸ªé˜¶æ®µå¤±è´¥æ—¶å¼ºåˆ¶ç»ˆæ­¢æ‰€æœ‰å¹¶è¡Œé˜¶æ®µ</span></span><br><span class="line">      parallel &#123;</span><br><span class="line">        stage(<span class="string">'parallel-Branch A'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">"On Branch A"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">'parallel-Branch B'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">"On Branch B"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">'parallel-Branch C'</span>) &#123;</span><br><span class="line">          stages &#123;</span><br><span class="line">              stage(<span class="string">'åµŒå¥—Nested 1'</span>) &#123;</span><br><span class="line">                  steps &#123;</span><br><span class="line">                      echo <span class="string">"In stage Nested 1 within Branch C"</span></span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">              stage(<span class="string">'åµŒå¥—Nested 2'</span>) &#123;</span><br><span class="line">                  steps &#123;</span><br><span class="line">                      echo <span class="string">"In stage Nested 2 within Branch C"</span></span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 15.Matrix çŸ©é˜µæ¨¡å‹å®è·µ</span></span><br><span class="line">    stage (<span class="string">'four-stage'</span>) &#123;</span><br><span class="line">      input &#123;</span><br><span class="line">        message <span class="string">"Title : éƒ¨ç½²å¹³å°"</span></span><br><span class="line">        ok <span class="string">"å®Œæˆæäº¤"</span></span><br><span class="line">        submitter <span class="string">"alice,bob"</span></span><br><span class="line">        parameters &#123;</span><br><span class="line">          choice(<span class="string">name:</span> <span class="string">'PLATFORM_FILTER'</span>, <span class="string">choices:</span> [<span class="string">'all'</span>, <span class="string">'linux'</span>, <span class="string">'windows'</span>, <span class="string">'mac'</span>], <span class="string">description:</span> <span class="string">'Run on specific platform'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      matrix &#123; </span><br><span class="line">        when &#123; anyOf &#123;</span><br><span class="line">                <span class="comment">// å‚æ•°é€‰æ‹©ä¸ä¸ºç©ºæ—¶ç»§ç»­æ‰§è¡Œ</span></span><br><span class="line">                expression &#123; params.PLATFORM_FILTER == <span class="string">'all'</span> &#125;</span><br><span class="line">                expression &#123; params.PLATFORM_FILTER == env.PLATFORM &#125;</span><br><span class="line">              &#125; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 16.2 è½´ (3 x 2) 6ç§ç»„åˆæ–¹å¼çš„æ¨¡å‹</span></span><br><span class="line">        axes &#123;</span><br><span class="line">          axis &#123;</span><br><span class="line">            name <span class="string">'PLATFORM'</span></span><br><span class="line">            values <span class="string">'linux'</span>, <span class="string">'windows'</span>, <span class="string">'mac'</span></span><br><span class="line">          &#125;</span><br><span class="line">          axis &#123;</span><br><span class="line">            name <span class="string">'ARCHITECTURE'</span></span><br><span class="line">            values <span class="string">'32-bit'</span>,<span class="string">'64-bit'</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 17.æ’é™¤æŒ‡å®šæ¨¡å‹ä¾‹å¦‚é64-bitçš„åœ¨windowså¹³å°çš„å°†è¢«å‰”é™¤</span></span><br><span class="line">        excludes &#123;</span><br><span class="line">          exclude &#123;</span><br><span class="line">              axis &#123;</span><br><span class="line">                name <span class="string">'PLATFORM'</span></span><br><span class="line">                values <span class="string">'windows'</span></span><br><span class="line">              &#125;</span><br><span class="line">              axis &#123;</span><br><span class="line">                name <span class="string">'ARCHITECTURE'</span></span><br><span class="line">                notValues <span class="string">'64-bit'</span></span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 18.è¿˜æœ‰5ç§æƒ…å†µä¾æ¬¡è¿›è¡Œæ„å»º</span></span><br><span class="line">        stages &#123;</span><br><span class="line">          stage(<span class="string">'Build'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">              echo <span class="string">"matrix - Do Build for $&#123;PLATFORM&#125; - $&#123;BROWSER&#125;"</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 6.æ¶ˆæ¯é€šçŸ¥</span></span><br><span class="line">  post &#123; </span><br><span class="line">    <span class="comment">// # æ€»æ˜¯æ‰§è¡Œçš„æ­¥éª¤</span></span><br><span class="line">    always &#123; </span><br><span class="line">      echo <span class="string">'I will always say Hello again!'</span> <span class="comment">/* == I will always say Hello again!â€” Print Message */</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## init - stage</span></span><br><span class="line">maven_envâ€” Use a tool from a predefined Tool Installation  &lt;1s</span><br><span class="line"><span class="comment"># Fetches the environment variables for a given tool in a list of 'FOO=bar' strings suitable for the withEnv step.&lt;1s</span></span><br><span class="line">jdk_k1.8.0_211â€” Use a tool from a predefined Tool Installation  &lt;1s</span><br><span class="line"><span class="comment"># Fetches the environment variables for a given tool in a list of 'FOO=bar' strings suitable for the withEnv step.&lt;1s</span></span><br><span class="line">maven_envâ€” Use a tool from a predefined Tool Installation  &lt;1s</span><br><span class="line"><span class="comment"># Fetches the environment variables for a given tool in a list of 'FOO=bar' strings suitable for the withEnv step.&lt;1s</span></span><br><span class="line">jdk_k1.8.0_211â€” Use a tool from a predefined Tool Installation &lt;1s</span><br><span class="line"><span class="comment"># Fetches the environment variables for a given tool in a list of 'FOO=bar' strings suitable for the withEnv step.&lt;1s</span></span><br><span class="line">init - steps one - built-in <span class="built_in">functions</span> <span class="built_in">echo</span>â€” Print Message &lt;1s</span><br><span class="line">init - steps one - built-in <span class="built_in">functions</span> println â€” Print Message &lt;1s</span><br><span class="line">Testing the chrome browserâ€” Print Messag e&lt;1s</span><br><span class="line">Testing the firefox browserâ€” Print Message 1s</span><br><span class="line">Testing the edge browserâ€” Print Message &lt;1s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## one - stage</span></span><br><span class="line">å…¨å±€å˜é‡: Jenkins global environment, å±€éƒ¨å˜é‡: Jenkins <span class="built_in">local</span> environment</span><br><span class="line">+ <span class="built_in">echo</span> user is ****</span><br><span class="line">user is ****</span><br><span class="line">+ <span class="built_in">echo</span> **** is ****</span><br><span class="line">**** is ****</span><br><span class="line">+ <span class="built_in">echo</span> SSH private key is located at ****</span><br><span class="line">SSH private key is located at ****</span><br><span class="line">+ <span class="built_in">echo</span> SSH user is ****</span><br><span class="line">SSH user is ****</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## two-stage</span></span><br><span class="line">å…¨å±€ - Hello Mr Jenkinsâ€” Print Message&lt;1s</span><br><span class="line">å…¨å±€ - Toggle: <span class="literal">true</span>â€” Print Message&lt;1s</span><br><span class="line">å…¨å±€ - Choice: Oneâ€” Print Message&lt;1s</span><br><span class="line">å…¨å±€ - Password: SECRETâ€” Print Message&lt;1s</span><br><span class="line">å…¨å±€ - Biography: â€” Print Message&lt;1s</span><br><span class="line">input è¾“å‡ºç¤ºä¾‹1: å§“åï¼šWeiyiGeek, å¹´é¾„ï¼š185, æ€§åˆ«ï¼šMale, æ˜¯å¦åŒæ„åè®®: <span class="literal">true</span>â€” Print Message&lt;1s</span><br><span class="line">input è¾“å‡ºç¤ºä¾‹(script) -&gt; ç‰ˆæœ¬ : v1.2â€” Print Message&lt;1s</span><br><span class="line">input è¾“å‡ºç¤ºä¾‹(script) -&gt; ç‰ˆæœ¬ : deployâ€” Print Message</span><br><span class="line"></span><br><span class="line"><span class="comment">## three-stage</span></span><br><span class="line">On Branch Aâ€” Print Message</span><br><span class="line">On Branch Bâ€” Print Message</span><br><span class="line">In stage Nested 1 within Branch C</span><br><span class="line">In stage Nested 2 within Branch C</span><br><span class="line"></span><br><span class="line"><span class="comment">## four-stage</span></span><br><span class="line">I will always say Hello again!â€” Print Message&lt;1s</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=2.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineè¯­æ³•å…¥é—¨å­¦ä¹  href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210131171702.png" target="_blank" title="WeiyiGeek.ç»“æœä¸€è§ˆ" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210131171702.png" alt="WeiyiGeek.ç»“æœä¸€è§ˆ" title="" class=""></a>
                <p>WeiyiGeek.ç»“æœä¸€è§ˆ</p>
            </figure>
<hr>
<h2 id="0x03-pipeline-å†…ç½®æ”¯æŒ"><a href="#0x03-pipeline-å†…ç½®æ”¯æŒ" class="headerlink" title="0x03 pipeline å†…ç½®æ”¯æŒ"></a>0x03 pipeline å†…ç½®æ”¯æŒ</h2><h3 id="3-0-å­—ç¬¦ä¸²å’Œæ ‡å‡†è¾“å‡º"><a href="#3-0-å­—ç¬¦ä¸²å’Œæ ‡å‡†è¾“å‡º" class="headerlink" title="3.0) å­—ç¬¦ä¸²å’Œæ ‡å‡†è¾“å‡º"></a>3.0) å­—ç¬¦ä¸²å’Œæ ‡å‡†è¾“å‡º</h3><ul>
<li>echo: Print Message</li>
<li>println: Print Message<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"Hello"</span></span><br><span class="line">println <span class="string">"World!"</span></span><br></pre></td></tr></table></figure>
<br/></li>
</ul>
<p><strong>è„šæœ¬ä¸­æ“ä½œå­—ç¬¦ä¸²æ›¿æ¢å€¼</strong><br>æè¿°: åœ¨ä½¿ç”¨ Groovy è¯­æ³•å†™ Pipleline è„šæœ¬æ—¶å€™ï¼Œå¯èƒ½éœ€è¦æ›¿æ¢å…ˆå‰è®¾ç½®å¥½çš„ä¸€äº›æ–‡æœ¬çš„å€¼ï¼Œæ­¤å¤„æˆ‘ä»¬ç®€å•æ¼”ç¤ºä¸€ä¸‹:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">script &#123;</span><br><span class="line">  <span class="comment">// æµ‹è¯•çš„å­—ç¬¦ä¸²</span></span><br><span class="line">  sourceStr = <span class="string">"è¿™æ˜¯è¦æ›¿æ¢çš„å€¼ï¼š#value1, è¿™æ˜¯è¦æ›¿æ¢çš„å€¼ï¼š#value2"</span></span><br><span class="line">  <span class="comment">// æ›¿æ¢ #value1 ä¸ #value2 ä¸¤ä¸ªå€¼</span></span><br><span class="line">  afterStr = sourceStr.replaceAll(<span class="string">"#value1"</span>,<span class="string">"AAA"</span>).replaceAll(<span class="string">"#value2"</span>,<span class="string">"BBB"</span>)</span><br><span class="line">  <span class="comment">// è¾“å‡ºæ›¿æ¢åçš„å­—ç¬¦ä¸²</span></span><br><span class="line">  print <span class="string">"$&#123;afterStr&#125;"</span></span><br><span class="line">  <span class="comment">// è¿™æ˜¯è¦æ›¿æ¢çš„å€¼ï¼šAAAï¼Œè¿™æ˜¯è¦æ›¿æ¢çš„å€¼ï¼šBBB</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="3-1-æ–‡ä»¶ç›®å½•ç›¸å…³æ­¥éª¤"><a href="#3-1-æ–‡ä»¶ç›®å½•ç›¸å…³æ­¥éª¤" class="headerlink" title="3.1) æ–‡ä»¶ç›®å½•ç›¸å…³æ­¥éª¤"></a>3.1) æ–‡ä»¶ç›®å½•ç›¸å…³æ­¥éª¤</h3><ul>
<li>isUnixï¼š å¦‚æœå°é—­èŠ‚ç‚¹è¿è¡Œåœ¨ç±»unixç³»ç»Ÿ(å¦‚Linuxæˆ–Mac OS X)ä¸Šï¼Œåˆ™è¿”å›trueï¼Œå¦‚æœWindowsã€‚</li>
<li>pwdï¼šç¡®è®¤å½“å‰ç›®å½•</li>
<li>dir: é»˜è®¤pipelineå·¥ä½œåœ¨å·¥ä½œç©ºé—´ç›®å½•ä¸‹ï¼Œdiræ­¥éª¤å¯ä»¥è®©æˆ‘ä»¬åˆ‡æ¢åˆ°å…¶ä»–ç›®å½•ã€‚</li>
<li>deleteDirï¼šæ˜¯ä¸€ä¸ªæ— å‚æ­¥éª¤åˆ é™¤çš„æ˜¯å½“å‰å·¥ä½œç›®å½•ã€‚é€šå¸¸å®ƒä¸diræ­¥éª¤ä¸€èµ·ä½¿ç”¨ï¼Œç”¨äºåˆ é™¤æŒ‡å®šç›®å½•ä¸‹çš„å†…å®¹ã€‚<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dir(<span class="string">"./delete_dir"</span>)</span><br><span class="line">deleteDir()</span><br></pre></td></tr></table></figure></li>
<li><p>fileExistsï¼šæ£€æŸ¥ç»™å®šçš„æ–‡ä»¶(ä½œä¸ºå½“å‰ç›®å½•çš„ç›¸å¯¹è·¯å¾„)æ˜¯å¦å­˜åœ¨ã€‚å‚æ•°fileè¿”å› <code>true | false</code> ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å·¥ä½œç©ºé—´ä¸­æ–‡ä»¶çš„ç›¸å¯¹(/åˆ†éš”)è·¯å¾„ï¼Œä»¥éªŒè¯æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚</span></span><br><span class="line">fileExists file: <span class="string">"./pom.xml"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>writeFileï¼šå°†å†…å®¹å†™å…¥æŒ‡å®šæ–‡ä»¶ä¸­; å‚æ•°ä¸ºï¼š<code>file, text, encoding</code></p>
</li>
<li>readFileï¼šè¯»å–æ–‡ä»¶å†…å®¹; å‚æ•°ä¸ºï¼š<code>file, encoding</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">writeFile encoding: <span class="string">'utf-8'</span>, file: <span class="string">'file'</span>, text: <span class="string">'æµ‹è¯•å†™å…¥'</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<h3 id="3-2-åˆ¶å“ç›¸å…³æ­¥éª¤"><a href="#3-2-åˆ¶å“ç›¸å…³æ­¥éª¤" class="headerlink" title="3.2) åˆ¶å“ç›¸å…³æ­¥éª¤"></a>3.2) åˆ¶å“ç›¸å…³æ­¥éª¤</h3><ul>
<li><p>stash : æ­¥éª¤å¯ä»¥å°†ä¸€äº›æ–‡ä»¶ä¿å­˜èµ·æ¥ä»¥ä¾¿è¢«åŒä¸€æ¬¡æ„å»ºçš„å…¶ä»–æ­¥éª¤æˆ–é˜¶æ®µä½¿ç”¨ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">name</span><br><span class="line">Name of a stash. Should be a simple identifier akin to a job name.</span><br><span class="line">    Type: String</span><br><span class="line"></span><br><span class="line">allowEmpty (optional)</span><br><span class="line">    Type: boolean</span><br><span class="line"></span><br><span class="line">excludes (optional)</span><br><span class="line">Optional <span class="built_in">set</span> of Ant-style exclude patterns.</span><br><span class="line">Use a comma separated list to add more than one expression.</span><br><span class="line">If blank, no files will be excluded.</span><br><span class="line">    Type: String</span><br><span class="line"></span><br><span class="line">includes (optional)</span><br><span class="line">Optional <span class="built_in">set</span> of Ant-style include patterns.</span><br><span class="line">Use a comma separated list to add more than one expression.</span><br><span class="line">If blank, treated like **: all files.</span><br><span class="line">The current working directory is the base directory <span class="keyword">for</span> the saved files, <span class="built_in">which</span> will later be restored <span class="keyword">in</span> the same relative locations, so <span class="keyword">if</span> you want to use a subdirectory wrap this <span class="keyword">in</span> dir.</span><br><span class="line">    Type: String</span><br><span class="line"></span><br><span class="line">useDefaultExcludes (optional)</span><br><span class="line">If selected, use the default excludes from Ant - see here <span class="keyword">for</span> the list.</span><br><span class="line">    Type: boolean</span><br></pre></td></tr></table></figure>
</li>
<li><p>unstashï¼šæ¢å¤ä»¥å‰å­˜å‚¨åœ¨å½“å‰å·¥ä½œåŒºä¸­çš„ä¸€ç»„æ–‡ä»¶ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># name: ä»¥å‰ä¿å­˜çš„ä»“åº“çš„åç§°ã€‚</span></span><br><span class="line">unstash <span class="string">'repo'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>wrap: ä¸€èˆ¬æ„å»ºåŒ…è£…,å®ƒæ˜¯ç‰¹æ®Šçš„æ­¥éª¤å…è®¸è°ƒç”¨æ„å»ºåŒ…è£…å™¨(åœ¨freestyleæˆ–ç±»ä¼¼é¡¹ç›®ä¸­ä¹Ÿç§°ä¸ºâ€œç¯å¢ƒé…ç½®â€)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wrap([<span class="variable">$class</span>: <span class="string">'AnsiColorBuildWrapper'</span>]).</span><br></pre></td></tr></table></figure>
</li>
<li><p>archive: Archive artifacts-å½’æ¡£çš„å·¥ä»¶</p>
</li>
<li>unarchive: Copy archived artifacts into the workspace-å°†å­˜æ¡£å·¥ä»¶å¤åˆ¶åˆ°å·¥ä½œåŒºä¸­</li>
<li>archiveArtifacts: å­˜æ¡£æ„å»ºçš„æˆå“ (é‡ç‚¹)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‚æ•°: String includes, optional: excludes </span></span><br><span class="line">archive</span><br><span class="line"><span class="comment"># å‚æ•°: Type: java.util.Map&lt;java.lang.String, java.lang.String&gt; mapping </span></span><br><span class="line">unarchive</span><br><span class="line"><span class="comment"># å‚æ•°: </span></span><br><span class="line"><span class="comment"># artifacts: ç”¨äºå­˜æ¡£çš„æ–‡ä»¶(æ”¯æŒé€šé…ç¬¦)</span></span><br><span class="line"><span class="comment"># excludes: ä¸åŒ…å«çš„æ–‡ä»¶(æ”¯æŒé€šé…ç¬¦)</span></span><br><span class="line"><span class="comment"># allowEmptyArchive: å½’æ¡£ä¸ºç©ºæ—¶ä¸å¼•èµ·æ„å»ºå¤±è´¥</span></span><br><span class="line"><span class="comment"># onlyIfSuccessful: åªæœ‰æ„å»ºæˆåŠŸæ—¶å½’æ¡£</span></span><br><span class="line"><span class="comment"># fingerprint: è®°å½•æ‰€æœ‰å½’æ¡£æˆå“çš„æŒ‡çº¹</span></span><br><span class="line"><span class="comment"># Follow symbolic links: é€šè¿‡ç¦ç”¨æ­¤é€‰é¡¹ï¼Œå·¥ä½œç©ºé—´ä¸­æ‰¾åˆ°çš„æ‰€æœ‰ç¬¦å·é“¾æ¥éƒ½å°†è¢«å¿½ç•¥ã€‚</span></span><br><span class="line">archiveArtifacts artifacts: <span class="string">'./target/*.jar'</span>, excludes: <span class="string">'./target/test/*'</span>, fingerprint: <span class="literal">true</span>, onlyIfSuccessful: <span class="literal">true</span>, allowEmptyArchive: <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<h3 id="3-3-å‘½ä»¤ç›¸å…³æ­¥éª¤"><a href="#3-3-å‘½ä»¤ç›¸å…³æ­¥éª¤" class="headerlink" title="3.3) å‘½ä»¤ç›¸å…³æ­¥éª¤"></a>3.3) å‘½ä»¤ç›¸å…³æ­¥éª¤</h3><p>æè¿°: ä¸å‘½ä»¤ç›¸å…³çš„æ­¥éª¤å…¶å®æ˜¯ <code>Pipelineï¼šNodes and Processes</code> æ’ä»¶æä¾›çš„æ­¥éª¤ã€‚ç”±äºå®ƒæ˜¯ Pipeline æ’ä»¶çš„ä¸€ä¸ªç»„ä»¶ï¼Œæ‰€ä»¥åŸºæœ¬ä¸éœ€è¦å•ç‹¬å®‰è£…</p>
<p><strong>withEnv: è®¾ç½®ç¯å¢ƒå˜é‡</strong><br>æè¿°: åœ¨å—ä¸­è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªç¯å¢ƒå˜é‡, è¿™äº›å¯ç”¨äºè¯¥èŒƒå›´å†…ç”Ÿæˆçš„ä»»ä½•å¤–éƒ¨æµç¨‹ã€‚ä¾‹å¦‚:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">node &#123;</span><br><span class="line">  withEnv([<span class="string">'MYTOOL_HOME=/usr/local/mytool'</span>]) &#123;</span><br><span class="line">    sh <span class="string">'$MYTOOL_HOME/bin/start'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Tips: æ³¨æ„è¿™é‡Œæˆ‘ä»¬åœ¨Groovyä¸­ä½¿ç”¨äº†å•å¼•å·ï¼Œæ‰€ä»¥å˜é‡å±•å¼€æ˜¯<code>ç”±Bourne shellå®Œæˆçš„</code>è€Œä¸æ˜¯Jenkins;</p>
<p><br/></p>
<p><strong>shï¼šæ‰§è¡Œshellå‘½ä»¤</strong><br>è¯¥æ­¥éª¤æ”¯æŒçš„å‚æ•°æœ‰ï¼š</p>
<ul>
<li>scriptï¼šå°†è¦æ‰§è¡Œçš„shellè„šæœ¬ï¼Œé€šå¸¸åœ¨ç±»UNIXç³»ç»Ÿä¸Šå¯ä»¥æ˜¯å¤šè¡Œè„šæœ¬ã€‚</li>
<li>encodingï¼šè„šæœ¬æ‰§è¡Œåè¾“å‡ºæ—¥å¿—çš„ç¼–ç ï¼Œé»˜è®¤å€¼ä¸ºè„šæœ¬è¿è¡Œæ‰€åœ¨ç³»ç»Ÿçš„ç¼–ç ã€‚</li>
<li>returnStatusï¼šå¸ƒå°”ç±»å‹ï¼Œé»˜è®¤è„šæœ¬è¿”å›çš„æ˜¯çŠ¶æ€ç ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªéé›¶çš„çŠ¶æ€ç ï¼Œåˆ™ä¼šå¼•å‘pipelineæ‰§è¡Œå¤±è´¥ã€‚å¦‚æœ <code>returnStatus</code> å‚æ•°ä¸ºtrueï¼Œåˆ™ä¸è®ºçŠ¶æ€ç æ˜¯ä»€ä¹ˆï¼Œpipelineçš„æ‰§è¡Œéƒ½ä¸ä¼šå—å½±å“ã€‚</li>
<li>returnStdoutï¼šå¸ƒå°”ç±»å‹ï¼Œå¦‚æœä¸ºtrueï¼Œåˆ™ä»»åŠ¡çš„æ ‡å‡†è¾“å‡ºå°†ä½œä¸ºæ­¥éª¤çš„è¿”å›å€¼ï¼Œè€Œä¸æ˜¯æ‰“å°åˆ°æ„å»ºæ—¥å¿—ä¸­ï¼ˆå¦‚æœæœ‰é”™è¯¯ï¼Œåˆ™ä¾ç„¶ä¼šæ‰“å°åˆ°æ—¥å¿—ä¸­ï¼‰ã€‚é™¤äº†scriptå‚æ•°ï¼Œå…¶ä»–å‚æ•°éƒ½æ˜¯å¯é€‰çš„ã€‚</li>
</ul>
<p>Tips: returnStatusä¸returnStdoutå‚æ•°ä¸€èˆ¬ä¸ä¼šåŒæ—¶ä½¿ç”¨ï¼Œå› ä¸ºè¿”å›å€¼åªèƒ½æœ‰ä¸€ä¸ªã€‚å¦‚æœåŒæ—¶ä½¿ç”¨åˆ™åªæœ‰returnStatuså‚æ•°ç”Ÿæ•ˆã€‚</p>
<p>Tips : æ³¨æ„é‡‡ç”¨shæ‰§è¡Œ<code>echo 1 &gt; 1.txt</code>å‘½ä»¤æ—¶ç„¶åé‡‡ç”¨readFileè¯»å–æ—¶å¸¦æœ‰æ¢è¡Œç¬¦ï¼Œè§£å†³åŠæ³•:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹å¼1.é‡‡ç”¨ $? åˆ¤æ–­å‘½ä»¤æ‰§è¡ŒæˆåŠŸä¸å¦ã€‚</span></span><br><span class="line"><span class="comment"># æ–¹å¼2.é‡‡ç”¨echoå‘½ä»¤è¾“å‡ºåˆ°æ–‡ä»¶æ—¶åŠ ä¸Š -n é€‰é¡¹ã€‚</span></span><br></pre></td></tr></table></figure></p>
<p><strong>batã€powershellæ­¥éª¤</strong></p>
<ul>
<li>batæ­¥éª¤æ‰§è¡Œçš„æ˜¯Windowsçš„æ‰¹å¤„ç†å‘½ä»¤ã€‚</li>
<li>powershellæ­¥éª¤æ‰§è¡Œçš„æ˜¯PowerShellè„šæœ¬ï¼Œæ”¯æŒ3+ç‰ˆæœ¬ã€‚</li>
</ul>
<p>Tips: æ­¥éª¤æ”¯æŒçš„å‚æ•°ä¸shæ­¥éª¤çš„ä¸€æ ·å°±ä¸é‡å¤ä»‹ç»äº†ã€‚</p>
<p><br/></p>
<h3 id="3-4-å…¶ä»–æ­¥éª¤"><a href="#3-4-å…¶ä»–æ­¥éª¤" class="headerlink" title="3.4) å…¶ä»–æ­¥éª¤"></a>3.4) å…¶ä»–æ­¥éª¤</h3><p><strong>å¼‚å¸¸ç»ˆæ­¢</strong><br>try-catch-finally : å¼‚å¸¸æ•è·å’ŒæŠ›å‡º<br>errorï¼šä¸»åŠ¨æŠ¥é”™ä¸­æ­¢å½“å‰ pipeline å¹¶ä¸”é¿å…æ‰“å°å †æ ˆè·Ÿè¸ªä¿¡æ¯ã€‚<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç®€å•ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  sh <span class="string">'might fail &amp;&amp; whoami'</span></span><br><span class="line">  echo <span class="string">'Succeeded!'</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">  echo <span class="string">"Failed: $&#123;err&#125; - "</span> + err.toString() </span><br><span class="line">  error <span class="string">"[-Error] : é¡¹ç›®éƒ¨ç½²å¤±è´¥ \n[-Msg] : $&#123;err.getMessage()&#125; "</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  sh <span class="string">'./tear-down.sh'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>catchError: æ•è·é”™è¯¯å¹¶å°†æ„å»ºç»“æœè®¾ç½®ä¸ºå¤±è´¥<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">catchError &#123;</span><br><span class="line">  sh <span class="string">'might fail'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>unstable: è®¾ç½®é˜¶æ®µç»“æœä¸ºä¸ç¨³å®š, å°†ä¸€æ¡æ¶ˆæ¯æ‰“å°åˆ°æ—¥å¿—ä¸­å¹¶å°†æ•´ä¸ªæ„å»ºç»“æœå’Œé˜¶æ®µç»“æœè®¾ç½®ä¸ºä¸ç¨³å®šã€‚æ¶ˆæ¯è¿˜å°†ä¸é˜¶æ®µç»“æœç›¸å…³è”å¹¶å¯èƒ½ä»¥å¯è§†åŒ–æ–¹å¼æ˜¾ç¤ºã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">unstable <span class="string">'é˜¶æ®µç»“æœä¸ºä¸ç¨³å®š'</span></span><br><span class="line">unstable &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"é˜¶æ®µç»“æœä¸ºä¸ç¨³å®š"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>ç”µå­é‚®ä»¶</strong></p>
<ul>
<li>mail: Simple step for sending email.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">subject</span><br><span class="line">Email subject line.</span><br><span class="line">    Type: String</span><br><span class="line">body</span><br><span class="line">Email body.</span><br><span class="line">    Type: String</span><br><span class="line">bcc (optional)</span><br><span class="line">BCC email address list. Comma separated list of email addresses.</span><br><span class="line">    Type: String</span><br><span class="line">cc (optional)</span><br><span class="line">CC email address list. Comma separated list of email addresses.</span><br><span class="line">    Type: String</span><br><span class="line">charset (optional)</span><br><span class="line">Email body character encoding. Defaults to UTF-8</span><br><span class="line">    Type: String</span><br><span class="line">from (optional)</span><br><span class="line">From email address. Defaults to the admin address globally configured <span class="keyword">for</span> the Jenkins instance.</span><br><span class="line">    Type: String</span><br><span class="line">mimeType (optional)</span><br><span class="line">Email body MIME <span class="built_in">type</span>. Defaults to text/plain.</span><br><span class="line">    Type: String</span><br><span class="line">replyTo (optional)</span><br><span class="line">Reploy-To email address. Defaults to the admin address globally configured <span class="keyword">for</span> the Jenkins instance.</span><br><span class="line">    Type: String</span><br><span class="line">to (optional)</span><br><span class="line">To email address list. Comma separated list of email addresses. </span><br><span class="line">    Type: String</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<p><strong>é‡è¯•ä¼‘çœ å’Œè¶…æ—¶</strong></p>
<ul>
<li>retryï¼šé‡è¯•æ­£æ–‡æœ€å¤šNæ¬¡, å¦‚æœåœ¨å—ä½“æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿä»»ä½•å¼‚å¸¸ï¼Œè¯·é‡è¯•è¯¥å—(æœ€å¤šNæ¬¡)ã€‚å¦‚æœåœ¨æœ€åä¸€æ¬¡å°è¯•æ—¶å‘ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¹ˆå®ƒå°†å¯¼è‡´ä¸­æ­¢æ„å»º(é™¤éä»¥æŸç§æ–¹å¼æ•è·å¹¶å¤„ç†å®ƒ),ä¸ä¼šæ•è·ç”Ÿæˆçš„ç”¨æˆ·ä¸­æ­¢ã€‚</li>
<li>sleepï¼šè®©pipelineä¼‘çœ æŒ‡å®šçš„ä¸€æ®µæ—¶é—´ , åªéœ€æš‚åœç®¡é“æ„å»ºç›´åˆ°ç»™å®šçš„æ—¶é—´å·²ç»è¿‡æœŸ<code>ç›¸å½“äº(åœ¨Unixä¸Š)sh &#39;sleepâ€¦&#39;</code>ã€‚</li>
<li>timeoutï¼šä»¥ç¡®å®šçš„è¶…æ—¶é™åˆ¶æ‰§è¡Œå—å†…çš„ä»£ç ã€‚</li>
<li>waitUntilï¼šåå¤è¿è¡Œå®ƒçš„ä¸»ä½“ç›´è‡³æ¡ä»¶æ»¡è¶³ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‚æ•°: int count</span></span><br><span class="line">retry(count: 5)  <span class="comment"># é‡è¯•5æ¬¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‚æ•°: int time, optional unit ( Values: NANOSECONDS, MICROSECONDS, MILLISECONDS, SECONDS, MINUTES, HOURS, DAYS)</span></span><br><span class="line">sleep(time: 60,unit: SECONDS  <span class="comment"># ä¼‘çœ 60s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‚æ•°: int time, optional activity, optional unit </span></span><br><span class="line"><span class="comment"># Values: NANOSECONDS, MICROSECONDS, MILLISECONDS, SECONDS, MINUTES, HOURS, DAYS</span></span><br><span class="line">timeout(time: 10,unit: MINUTES) <span class="comment"># è¶…æ—¶10åˆ†é’Ÿ </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‚æ•°: optional initialRecurrencePeriod, optional quiet </span></span><br><span class="line"><span class="comment"># initialRecurrencePeriod: è®¾ç½®é‡è¯•ä¹‹é—´çš„åˆå§‹ç­‰å¾…å‘¨æœŸ(ä»¥æ¯«ç§’ä¸ºå•ä½)é»˜è®¤ä¸º250 msã€‚æ¯æ¬¡å¤±è´¥éƒ½å°†é™ä½å°è¯•ä¹‹é—´çš„å»¶è¿Ÿæœ€å¤šå¯è¾¾15ç§’ã€‚</span></span><br><span class="line"><span class="comment"># quiet: å¦‚æœä¸ºtrueï¼Œåˆ™è¯¥æ­¥éª¤ä¸ä¼šåœ¨æ¯æ¬¡æ£€æŸ¥æ¡ä»¶æ—¶è®°å½•æ¶ˆæ¯ã€‚é»˜è®¤å€¼ä¸ºfalseã€‚</span></span><br><span class="line">waitUntil(initialRecurrencePeriod: 250, quiet: <span class="literal">false</span>)&#123;</span><br><span class="line">  sh <span class="string">"./monitor.sh"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>toolï¼šä½¿ç”¨é¢„å®šä¹‰çš„å·¥å…·,åœ¨Global Tool Configurationï¼ˆå…¨å±€å·¥å…·é…ç½®ï¼‰ä¸­é…ç½®äº†å·¥å…·ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tool name: <span class="string">'Sonar-Scanner'</span>, <span class="built_in">type</span>: <span class="string">'hudson.plugins.sonar.SonarRunnerInstallation'</span></span><br><span class="line">tool name: <span class="string">'docker'</span>, <span class="built_in">type</span>: <span class="string">'dockerTool'</span></span><br></pre></td></tr></table></figure></p>
<p>getContext: ä»å†…éƒ¨apiè·å–ä¸Šä¸‹æ–‡å¯¹è±¡<br>withContext: åœ¨å—ä¸­ä½¿ç”¨å†…éƒ¨apiä¸­çš„ä¸Šä¸‹æ–‡å¯¹è±¡<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‚æ•°: ç”¨äºå—ä¿¡ä»»çš„ä»£ç ï¼Œå¦‚å…¨å±€åº“ï¼Œå®ƒå¯ä»¥æ“ä½œå†…éƒ¨Jenkins apiã€‚</span></span><br><span class="line"><span class="comment"># Type: java.lang.Class&lt;?&gt;</span></span><br><span class="line"><span class="comment"># ä¾‹å­:æ¥å—å•ä¸ªç±»å‹å‚æ•°</span></span><br><span class="line">getContext hudson.FilePath</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¾‹å­:æ¥å—ä¸€ä¸ªcontextå‚æ•°å’Œä¸€ä¸ªblockã€‚</span></span><br><span class="line"><span class="comment"># åœ¨ConsoleLogFilterã€LauncherDecoratorå’ŒEnvironmentExpanderçš„æƒ…å†µä¸‹ï¼Œè‡ªåŠ¨å°†å…¶å‚æ•°ä¸ä¸Šä¸‹æ–‡å¯¹è±¡åˆå¹¶ã€‚</span></span><br><span class="line">withContext(new MyConsoleLogFilter()) &#123;</span><br><span class="line">  sh <span class="string">'process'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>Tips : ä¸è¦è¯•å›¾ä¼ é€’åœ¨Groovyä¸­å®šä¹‰çš„å¯¹è±¡;åªæ”¯æŒjavaå®šä¹‰çš„å¯¹è±¡ã€‚å®é™…ä¸Šä½ åº”è¯¥é¿å…ä½¿ç”¨thiså’ŒgetContextè€Œåªæ˜¯åœ¨æ’ä»¶ä¸­å®šä¹‰ä¸€ä¸ªæ­¥éª¤ã€‚</p>
<p>å‚è€ƒåœ°å€: <a href="https://www.jenkins.io/doc/pipeline/steps/workflow-basic-steps/" target="_blank" rel="noopener">https://www.jenkins.io/doc/pipeline/steps/workflow-basic-steps/</a></p>
<hr>
<h2 id="0x04-Pipeline-ç‰‡æ®µç¤ºä¾‹"><a href="#0x04-Pipeline-ç‰‡æ®µç¤ºä¾‹" class="headerlink" title="0x04 Pipeline ç‰‡æ®µç¤ºä¾‹"></a>0x04 Pipeline ç‰‡æ®µç¤ºä¾‹</h2><p><strong>(1) è¶…æ—¶è®¾ç½®ä¸éƒ¨ç½²å‚æ•°switchè¯­å¥é€‰æ‹©</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">timeout(<span class="string">time:</span> <span class="number">1</span>, <span class="string">unit:</span> <span class="string">'MINUTES'</span>) &#123;</span><br><span class="line">  script &#123;</span><br><span class="line">    env.deploy_option = input <span class="string">message:</span> <span class="string">'é€‰æ‹©æ“ä½œ'</span>, <span class="string">ok:</span> <span class="string">'deploy'</span>,</span><br><span class="line"><span class="symbol">    parameters:</span> [choice(<span class="string">name:</span> <span class="string">'deploy_option'</span>, <span class="string">choices:</span> [<span class="string">'deploy'</span>, <span class="string">'rollback'</span>, <span class="string">'redeploy'</span>], <span class="string">description:</span> <span class="string">'é€‰æ‹©éƒ¨ç½²ç¯å¢ƒ'</span>)]</span><br><span class="line">    <span class="keyword">switch</span>(<span class="string">"$&#123;env.deploy_option&#125;"</span>)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'deploy'</span>:</span><br><span class="line">            println(<span class="string">'1.deploy prd env'</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'rollback'</span>:</span><br><span class="line">            println(<span class="string">'2.rollback env'</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'redeploy'</span>:</span><br><span class="line">            println(<span class="string">'3.redeploy env'</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"><span class="symbol">        default:</span></span><br><span class="line">            println(<span class="string">'error env'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>ï¼ˆ1ï¼‰ä»£ç ä»“åº“æ‹‰å–ä¹‹checkout SCM</strong></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">checkout([<span class="string">$class:</span> <span class="string">'GitSCM'</span>, <span class="string">branches:</span> [[<span class="string">name:</span> <span class="string">'*/master'</span>]], <span class="string">doGenerateSubmoduleConfigurations:</span> <span class="literal">false</span>, <span class="string">extensions:</span> [], <span class="string">submoduleCfg:</span> [], <span class="string">userRemoteConfigs:</span> [[<span class="string">credentialsId:</span> <span class="string">'b4c8b4e9-2777-44a1-a1ed-e9dc21d37f4f'</span>, <span class="string">url:</span> <span class="string">'git@gitlab.weiyigeek.top:ci-cd/java-maven.git'</span>]]])</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=2.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineè¯­æ³•å…¥é—¨å­¦ä¹  href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210114134413.png" target="_blank" title="WeiyiGeek.æµæ°´çº¿ä¹‹ä»£ç æ‹‰å–" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210114134413.png" alt="WeiyiGeek.æµæ°´çº¿ä¹‹ä»£ç æ‹‰å–" title="" class=""></a>
                <p>WeiyiGeek.æµæ°´çº¿ä¹‹ä»£ç æ‹‰å–</p>
            </figure>
<p><br/></p>
<p><strong>(2) ä»£ç è´¨é‡æ£€æµ‹ä¹‹shell Script</strong></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>sonar-scanner -Dsonar.projectName=$&#123;JOB_NAME&#125; -Dsonar.projectKey=Hello-World -Dsonar.sources=.</span><br><span class="line"></span><br><span class="line"><span class="comment">// # ç”Ÿæˆçš„æµæ°´çº¿</span></span><br><span class="line">sh <span class="string">label:</span> <span class="string">'sonar'</span>, <span class="string">returnStatus:</span> <span class="literal">true</span>, <span class="string">script:</span> <span class="string">'''/usr/local/bin/sonar-scanner -Dsonar.projectName=$&#123;JOB_NAME&#125; -Dsonar.projectKey=Hello-World -Dsonar.sources=.'''</span></span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=2.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineè¯­æ³•å…¥é—¨å­¦ä¹  href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210114135242.png" target="_blank" title="WeiyiGeek.æµæ°´çº¿ä¹‹ä»£ç è´¨é‡æ£€æµ‹" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210114135242.png" alt="WeiyiGeek.æµæ°´çº¿ä¹‹ä»£ç è´¨é‡æ£€æµ‹" title="" class=""></a>
                <p>WeiyiGeek.æµæ°´çº¿ä¹‹ä»£ç è´¨é‡æ£€æµ‹</p>
            </figure>
<p><br/></p>
<p><strong>(3) Kubernetes åŠ¨æ€èŠ‚ç‚¹ Pod æ¨¡æ¿çš„é€‰æ‹©</strong></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// # Scripted Pipeline</span></span><br><span class="line">podTemplate(<span class="string">label:</span> <span class="string">'jenkins-jnlp-slave'</span>, <span class="string">cloud:</span> <span class="string">'k8s_115'</span>) &#123;</span><br><span class="line">  node (<span class="string">'jenkins-jnlp-slave'</span>) &#123;</span><br><span class="line">    stage (<span class="string">'dynamic-checkout'</span>) &#123;</span><br><span class="line">      checkout([<span class="string">$class:</span> <span class="string">'GitSCM'</span>, <span class="string">branches:</span> [[<span class="string">name:</span> <span class="string">'*/master'</span>]], <span class="string">userRemoteConfigs:</span> [[<span class="string">credentialsId:</span> <span class="string">'69c0dbf0-f786-4aa0-975a-76528f10de8b'</span>, <span class="string">url:</span> <span class="string">'http://127.0.0.1/xxx/devops_test.git'</span>]]])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        </div>
        
  <hr>
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>

  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>

  <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ï¼Œè½¬ä¸ªå‘ã€‘(äººé—´äº”å¤§æƒ…)</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œè°¢è°¢ï¼ã€‚</p>

  <div>
    <img src="https://www.weiyigeek.top/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul>

  <div>
    <img src="https://www.weiyigeek.top/img/wechat-search.png" class="img-responsive" alt="æ‰«æfollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·"  width="328" height="149">
  </div>

  <hr>
  


  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-05-17T08:35:46.737Z" itemprop="dateUpdated">2022-05-17 16:35:46</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/CI-CD/Jenkins/2.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineè¯­æ³•å…¥é—¨å­¦ä¹ .md" target="_blank" rel="noopener noreferrer">_posts/ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/CI-CD/Jenkins/2.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineè¯­æ³•å…¥é—¨å­¦ä¹ .md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2020/12-29-519.html" target="_blank" rel="external">https://blog.weiyigeek.top/2020/12-29-519.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">ğŸ‘ é’Ÿæ„ä½œè€…</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/12-29-519.html&title=ã€Š2.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineè¯­æ³•å…¥é—¨å­¦ä¹ ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/12-29-519.html&title=ã€Š2.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineè¯­æ³•å…¥é—¨å­¦ä¹ ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/12-29-519.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š2.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineè¯­æ³•å…¥é—¨å­¦ä¹ ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/12-29-519.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/12-29-519.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2020/12-30-531.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">4.Jenkinsè¿›é˜¶ä¹‹åˆ†å¸ƒå¼æ¶æ„ç¯å¢ƒé…ç½®</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2020/12-28-515.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">SonarQubeåŸºç¡€ä»‹ç»ä¸åœ¨ä»£ç æ£€æµ‹ä¸­çš„åº”ç”¨</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-å‰è¨€ç®€è¿°"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 å‰è¨€ç®€è¿°</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Pipeline-ä»‹ç»"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">Pipeline ä»‹ç»</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Pipeline-åŸºç¡€çŸ¥è¯†"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">Pipeline åŸºç¡€çŸ¥è¯†</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Pipeline-æ‰©å±•å…±äº«åº“"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">Pipeline æ‰©å±•å…±äº«åº“</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#BlueOcean-ä»‹ç»"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">BlueOcean ä»‹ç»</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-Pipeline-Syntax"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 Pipeline Syntax</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#0-Groovy-Basic-Syntax"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">(0) Groovy Basic Syntax</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-Scripted-Pipeline-Syntax"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">(1) Scripted Pipeline Syntax</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Hello-World-å®è·µ"><span class="post-toc-number">2.2.1.</span> <span class="post-toc-text">Hello-World å®è·µ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#å˜é‡å-Identifiers"><span class="post-toc-number">2.2.2.</span> <span class="post-toc-text">å˜é‡å-Identifiers</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#å­—ç¬¦ä¸²-String"><span class="post-toc-number">2.2.3.</span> <span class="post-toc-text">å­—ç¬¦ä¸²-String</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#æ•°å­—-Numbers"><span class="post-toc-number">2.2.4.</span> <span class="post-toc-text">æ•°å­— - Numbers</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#åˆ—è¡¨-List"><span class="post-toc-number">2.2.5.</span> <span class="post-toc-text">åˆ—è¡¨-List</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#å­—å…¸-Maps"><span class="post-toc-number">2.2.6.</span> <span class="post-toc-text">å­—å…¸ - Maps</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#æ¡ä»¶è¯­å¥-Condition"><span class="post-toc-number">2.2.7.</span> <span class="post-toc-text">æ¡ä»¶è¯­å¥ - Condition</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#å¼‚å¸¸-Exception"><span class="post-toc-number">2.2.8.</span> <span class="post-toc-text">å¼‚å¸¸ - Exception</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#å‡½æ•°-Functions"><span class="post-toc-number">2.2.9.</span> <span class="post-toc-text">å‡½æ•° - Functions</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ç±»å’Œå¯¹è±¡"><span class="post-toc-number">2.2.10.</span> <span class="post-toc-text">ç±»å’Œå¯¹è±¡</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#å­—ç¬¦ä¸²å¤„ç†"><span class="post-toc-number">2.2.11.</span> <span class="post-toc-text">å­—ç¬¦ä¸²å¤„ç†</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#è¯­æ³•æ€»ç»“"><span class="post-toc-number">2.2.12.</span> <span class="post-toc-text">è¯­æ³•æ€»ç»“</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-Declarative-Pipeline-Syntax"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">(2) Declarative Pipeline Syntax</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-1-Sections-ç« èŠ‚"><span class="post-toc-number">2.3.1.</span> <span class="post-toc-text">2.1) Sections - ç« èŠ‚</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-2-Directives-æŒ‡ä»¤"><span class="post-toc-number">2.3.2.</span> <span class="post-toc-text">2.2) Directives - æŒ‡ä»¤</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-3-Sequential-Stages-é¡ºåºé˜¶æ®µ"><span class="post-toc-number">2.3.3.</span> <span class="post-toc-text">2.3) Sequential Stages - é¡ºåºé˜¶æ®µ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-4-Parallel-å¹¶è¡Œ"><span class="post-toc-number">2.3.4.</span> <span class="post-toc-text">2.4) Parallel - å¹¶è¡Œ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-5-Matrix-æ¨¡å‹"><span class="post-toc-number">2.3.5.</span> <span class="post-toc-text">2.5) Matrix - æ¨¡å‹</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#è¯­æ³•æ€»ç»“-1"><span class="post-toc-number">2.3.6.</span> <span class="post-toc-text">è¯­æ³•æ€»ç»“</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x03-pipeline-å†…ç½®æ”¯æŒ"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x03 pipeline å†…ç½®æ”¯æŒ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-0-å­—ç¬¦ä¸²å’Œæ ‡å‡†è¾“å‡º"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">3.0) å­—ç¬¦ä¸²å’Œæ ‡å‡†è¾“å‡º</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-1-æ–‡ä»¶ç›®å½•ç›¸å…³æ­¥éª¤"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">3.1) æ–‡ä»¶ç›®å½•ç›¸å…³æ­¥éª¤</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-2-åˆ¶å“ç›¸å…³æ­¥éª¤"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">3.2) åˆ¶å“ç›¸å…³æ­¥éª¤</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-3-å‘½ä»¤ç›¸å…³æ­¥éª¤"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">3.3) å‘½ä»¤ç›¸å…³æ­¥éª¤</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-4-å…¶ä»–æ­¥éª¤"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">3.4) å…¶ä»–æ­¥éª¤</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x04-Pipeline-ç‰‡æ®µç¤ºä¾‹"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x04 Pipeline ç‰‡æ®µç¤ºä¾‹</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

  <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        äººé—´è‡ªæœ‰äº”å¤§æƒ…ã€ç‚¹èµã€æŠ•å¸(èµèµ)ã€æ”¶è—ã€å…³æ³¨ï¼Œè½¬å‘ã€‘, è°¢è°¢çœ‹å‹æ”¯æŒ!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="228" height="228" alt="æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="228" height="228" alt="æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

  
 <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->

  <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½æœ‹å‹,å¯ä»¥å…³ä¸ªæ³¨å—? â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>


</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">ä¸ªäººGithub</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">ä¸ªäººGitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">ä¸ªäººçŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘+äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved. ITå”¯ä¸€æå®¢ ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener"><img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto"></a>
        </div>
      </p>
    </div>
</footer>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/12-29-519.html&title=ã€Š2.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineè¯­æ³•å…¥é—¨å­¦ä¹ ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/12-29-519.html&title=ã€Š2.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineè¯­æ³•å…¥é—¨å­¦ä¹ ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/12-29-519.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š2.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineè¯­æ³•å…¥é—¨å­¦ä¹ ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/12-29-519.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/12-29-519.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACKUlEQVR42u3aQXKDMAwFUO5/6XSm2w7wJUFbzPMqk6TGLwtVsrRt8fp8r+P3Pz9W8p29td2xMDAwHstItts7SrJPskOPjYGB8TZGEkzzoNkL5ce8kzNjYGBg3LD2no6BgYFxR8A9PlD+nT/+v4GBgfHvGcl2SfI3Ca+/VItjYGA8kNErNX/n9Y39DQwMjIcwripEq2H32iIZAwNjbcZxSzI5YrWsrSILgRgDA2NRRnVsoldeJu8cP/0kYcXAwHgN46rULQHk1/3RNzEwMF7P2MNUr8mSv80/LQdcDAyMxzIml/V3dCGqoxij3gUGBsZjGQkyCYvVRDNPQHdDMAYGxqKMSSqWtwfyoydBf7cTi4GBsTQjOe5Vpel8FOPkug0DA2NRRg6oHvGqH+skcGNgYLyGUah6xwNe+YBFRMXAwFiaESVe8ahWr3BNDhqFYwwMjNcwqoNZeWiej1ycBHEMDIxFGdUANwm1kz2bPVgMDIwlGL3r+7yg7bUZqqfCwMB4DyNP7/KytoqsjpqVfwMMDIwlGFdd+lf3rLYldlNDDAyMRRnzx1fHL64K2VFvFgMD4+GMT3FtxdVrXpaTSAwMjKUZ1QNNAuXkWRgYGBh52le9vk8C6FUjaBgYGG9gzMcd8qGuXjg+4WFgYGAcBtDk014LoZDbYmBgYLSu76upXhKsmz0NDAyMJRi99mQvpUv2bw5YYGBgLMqYXNb3LtcmP9mosYqBgfE8xhfHy/Au8SIoMgAAAABJRU5ErkJggg==" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 



  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 
     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
</body>
</html>
