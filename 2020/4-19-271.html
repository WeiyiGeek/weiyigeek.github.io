<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ 1.åŸºäºGitLabä»£ç ä»“åº“çš„æŒç»­é›†æˆåŸºç¡€é…ç½®å’Œä½¿ç”¨|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="gitlab">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>1.åŸºäºGitLabä»£ç ä»“åº“çš„æŒç»­é›†æˆåŸºç¡€é…ç½®å’Œä½¿ç”¨</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">1.åŸºäºGitLabä»£ç ä»“åº“çš„æŒç»­é›†æˆåŸºç¡€é…ç½®å’Œä½¿ç”¨</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-04-19T12:35:30.000Z" itemprop="datePublished" class="page-time">
  2020-04-19
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E4%B8%8E%E4%BA%A4%E4%BA%92/">æŒç»­é›†æˆä¸äº¤äº’</a></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/CI-CD/GitLab-CI/1.åŸºäºGitLabä»£ç ä»“åº“çš„æŒç»­é›†æˆåŸºç¡€é…ç½®å’Œä½¿ç”¨"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">1.åŸºäºGitLabä»£ç ä»“åº“çš„æŒç»­é›†æˆåŸºç¡€é…ç½®å’Œä½¿ç”¨</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-04-19 20:35:30" datetime="2020-04-19T12:35:30.000Z"  itemprop="datePublished">2020-04-19</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E4%B8%8E%E4%BA%A4%E4%BA%92/">æŒç»­é›†æˆä¸äº¤äº’</a></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h2 id="0x00-å‰è¨€ç®€è¿°"><a href="#0x00-å‰è¨€ç®€è¿°" class="headerlink" title="0x00 å‰è¨€ç®€è¿°"></a>0x00 å‰è¨€ç®€è¿°</h2><h3 id="CI-CDä»‹ç»"><a href="#CI-CDä»‹ç»" class="headerlink" title="CI/CDä»‹ç»"></a>CI/CDä»‹ç»</h3><p><strong>Qï¼šæˆ‘ä»¬å¸¸è¯´çš„CI/CDæ˜¯ä»€ä¹ˆ?</strong></p>
<ul>
<li>CI ä¸º Continuous Integration çš„ç¼©å†™æŒç»­é›†æˆï¼Œå¯ä»¥ç†è§£ä¸ºä»£ç å˜åŠ¨æäº¤åï¼Œè‡ªåŠ¨æ‰§è¡Œä»£ç ç¼–è¯‘ã€ä»£ç æ‰“åŒ…ã€ä»£ç æµ‹è¯•çš„è¿™ä¹ˆä¸€ä¸ªæµç¨‹ã€‚</li>
<li>CD å¯¹åº”å¤šä¸ªè‹±æ–‡åç§°ï¼š<code>Continuous Deploymentï¼ˆæŒç»­éƒ¨ç½²ï¼‰</code> å’Œ <code>Continuous Deliveryï¼ˆæŒç»­äº¤ä»˜ï¼‰</code>ã€‚å¯ä»¥ç†è§£ä¸ºé€šè¿‡ä¸Šä¸€æ­¥çš„æ“ä½œå°†ç”Ÿæˆéƒ¨ç½²åŒ…æŒ‰ç…§é…ç½®æ–‡ä»¶æµç¨‹è¿›è¡Œéƒ¨ç½²å¯åŠ¨;</li>
</ul>
<p><strong>Q: ä»€ä¹ˆæ˜¯æŒç»­éƒ¨ç½²ã€äº¤ä»˜?ä»–æœ‰ä½•ä½œç”¨?</strong><br>ç­”: å…ˆè¯´è¯´æŒç»­éƒ¨ç½²å¯¹äºä¸€ä¸ªæˆç†Ÿçš„ CI/CD çš„æµç¨‹è€Œè¨€ï¼Œä»£ç å˜æ›´ç»è¿‡ç¼–è¯‘ã€æ‰“åŒ…ã€æµ‹è¯•ä¹‹åçš„ä¸‹ä¸€æ­¥å°±æ˜¯éƒ¨ç½²ç¯èŠ‚ã€‚è€ŒæŒç»­äº¤ä»˜ä¸€èˆ¬æ˜¯æŒ‡ï¼Œç ”å‘å°½å¿«åœ°å‘å®¢æˆ·äº¤ä»˜ï¼Œæ¯”å¦‚å°½å¿«å®ç°åŠŸèƒ½ä¸Šçº¿ï¼Œé€šè¿‡è®¾è®¡å®Œå–„çš„ CI/CD æµç¨‹ï¼Œä¸€èˆ¬å¯ä»¥å®ç°æŒç»­äº¤ä»˜çš„ç›®æ ‡ã€‚</p>
<p>PSï¼šæŒç»­é›†æˆå¯ä»¥é€šè¿‡è‡ªåŠ¨è¿è¡Œæµ‹è¯•æ¥å¸®åŠ©æ£€æµ‹ä»£ç ç¼ºé™·ï¼Œè€ŒæŒç»­éƒ¨ç½²å¯ä»¥å¸®åŠ©æ‚¨å‘ç”Ÿäº§ç¯å¢ƒäº¤ä»˜ä»£ç , å¯¹äºå‰é¢æåˆ°çš„ã€ŒæŒç»­ã€ï¼Œå¯ä»¥ç†è§£ä¸ºæ¯å®Œæˆä¸€ä¸ªå®Œæ•´çš„éƒ¨åˆ†ï¼Œå°±å‘ä¸‹ä¸€ä¸ªç¯èŠ‚äº¤ä»˜ã€‚</p>
<p><br></p>
<p><strong>å‚è€ƒæ¥æº</strong><br>å®˜æ–¹æ–‡æ¡£: <a href="https://docs.gitlab.com/" target="_blank" rel="noopener">https://docs.gitlab.com/</a></p>
<hr>
<h2 id="0x01-GitLab-CI-æŒç»­é›†æˆ"><a href="#0x01-GitLab-CI-æŒç»­é›†æˆ" class="headerlink" title="0x01 GitLab-CI æŒç»­é›†æˆ"></a>0x01 GitLab-CI æŒç»­é›†æˆ</h2><h4 id="1-1-åŸºç¡€ä»‹ç»"><a href="#1-1-åŸºç¡€ä»‹ç»" class="headerlink" title="1.1 åŸºç¡€ä»‹ç»"></a>1.1 åŸºç¡€ä»‹ç»</h4><p><strong>Q:ä»€ä¹ˆæ˜¯GitLab-CI?</strong></p>
<blockquote>
<p>A: GitLab-CIæ˜¯Gitlabå®˜æ–¹æä¾›çš„æŒç»­é›†æˆæœåŠ¡(<code>GitLab8.0ä»¥åçš„ç‰ˆæœ¬æ˜¯é»˜è®¤é›†æˆäº†GitLab-CIå¹¶é»˜è®¤å¯ç”¨çš„</code>)ï¼Œå®ƒéœ€è¦gitlabä¸­é…ç½®æ³¨å†Œrunnerï¼Œç„¶ååœ¨ä»“åº“çš„æ ¹ç›®å½•ä¸‹æ–°å»º.gitlab-ci.ymlæ–‡ä»¶ç¼–å†™å‘½ä»¤ï¼Œå¹¶ä¸”åœ¨ä»“åº“çš„æ¯æ¬¡æäº¤åˆå¹¶ä¸­å°†ä¼šè§¦å‘æ„å»ºï¼›PS:å½“ç„¶è¿˜æœ‰å…¶å®ƒçš„æŒç»­é›†æˆç³»ç»ŸåŒæ ·å¯ä»¥é…åˆGitLabä½¿ç”¨æ¯”å¦‚Jenkinsä¸»è¦é’ˆå¯¹äºJavaç¯å¢ƒçš„é¡¹ç›®,è¿™é‡Œå°±ä¸å¤šè¯´äº†;</p>
</blockquote>
<p><br/></p>
<p><strong>Q:ä»€ä¹ˆæ˜¯GitLab-Runner?</strong></p>
<blockquote>
<p>A: Runneræ˜¯ä¸€ä¸ªæ‰§è¡Œä»»åŠ¡çš„è¿›ç¨‹ã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€è¦é…ç½®ä»»æ„æ•°é‡çš„Runner, å®ƒå¯ä»¥æ”¾åœ¨ä¸åŒçš„ç”¨æˆ·ã€æœåŠ¡å™¨ï¼Œç”šè‡³æœ¬åœ°æœºå™¨ä¸Šã€‚<br>ç®€å•çš„è¯´ GitLab-Runner å°±æ˜¯ä¸€ä¸ªç”¨æ¥æ‰§è¡Œè½¯ä»¶é›†æˆè„šæœ¬çš„, ä¸€èˆ¬åœ°GitLab-Runneræ˜¯é…åˆGitLab-CIè¿›è¡Œä½¿ç”¨çš„,GitLabé‡Œé¢çš„æ¯ä¸€ä¸ªå·¥ç¨‹éƒ½ä¼šå®šä¹‰ä¸€ä¸ªå±äºè¿™ä¸ªå·¥ç¨‹çš„è½¯ä»¶é›†æˆè„šæœ¬ï¼Œç”¨æ¥è‡ªåŠ¨åŒ–åœ°å®Œæˆä¸€äº›è½¯ä»¶é›†æˆå·¥ä½œã€‚<code>å½“è¿™ä¸ªå·¥ç¨‹çš„ä»“åº“ä»£ç å‘ç”Ÿå˜åŠ¨æ—¶ï¼Œæ¯”å¦‚æœ‰äººpushäº†ä»£ç GitLabå°±ä¼šå°†è¿™ä¸ªå˜åŠ¨é€šçŸ¥GitLab-CI</code>,æ­¤æ—¶GitLab-CIä¼šæ‰¾å‡ºä¸è¿™ä¸ªå·¥ç¨‹ç›¸å…³è”çš„Runnerï¼Œå¹¶é€šçŸ¥è¿™äº›RunneræŠŠä»£ç æ›´æ–°åˆ°æœ¬åœ°å¹¶æ‰§è¡Œé¢„å®šä¹‰å¥½çš„æ‰§è¡Œè„šæœ¬ã€‚</p>
</blockquote>
<p><br/></p>
<p>ç¤ºä¾‹: Runnerå°±åƒä¸€ä¸ªä¸ªçš„å·¥äººï¼Œè€ŒGitLab-CIå°±æ˜¯è¿™äº›å·¥äººçš„ä¸€ä¸ªç®¡ç†ä¸­å¿ƒï¼Œæ‰€æœ‰å·¥äººéƒ½è¦åœ¨GitLab-CIé‡Œé¢ç™»è®°æ³¨å†Œï¼Œå¹¶ä¸”è¡¨æ˜è‡ªå·±æ˜¯ä¸ºå“ªä¸ªå·¥ç¨‹æœåŠ¡çš„ã€‚<code>æ‰€ä»¥å½“ç›¸åº”çš„å·¥ç¨‹å‘ç”Ÿå˜åŒ–æ—¶ GitLab-CIå°±ä¼šé€šçŸ¥ç›¸åº”çš„å·¥äººæ‰§è¡Œè½¯ä»¶é›†æˆè„šæœ¬çš„åŠ¨ä½œ</code>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure class="image-box">
                <a rel=1.åŸºäºGitLabä»£ç ä»“åº“çš„æŒç»­é›†æˆåŸºç¡€é…ç½®å’Œä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200416171549.png" target="_blank" title="WeiyiGeek.GitLab-CIä¸Runnerå…³ç³»å›¾" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200416171549.png" alt="WeiyiGeek.GitLab-CIä¸Runnerå…³ç³»å›¾" title="" class=""></a>
                <p>WeiyiGeek.GitLab-CIä¸Runnerå…³ç³»å›¾</p>
            </figure>
<p><strong>Q:GitLab-Runneråˆ†ç±»ä¸¤ç§ç±»å‹è¯´æ˜?</strong></p>
<blockquote>
<p>ä¸¤ç§ç±»å‹æŒ‡çš„æ˜¯<code>Shared Runnerï¼ˆå…±äº«å‹ï¼‰å’ŒSpecific Runnerï¼ˆæŒ‡å®šå‹ï¼‰</code>ã€‚</p>
<ul>
<li>Shared Runnerï¼šæ˜¯æ‰€æœ‰å·¥ç¨‹éƒ½èƒ½å¤Ÿç”¨çš„å¹¶ä¸”åªæœ‰ç³»ç»Ÿç®¡ç†å‘˜èƒ½å¤Ÿåˆ›å»ºShared Runnerã€‚</li>
<li>Specific Runnerï¼šè¿™åªèƒ½ä¸ºæŒ‡å®šçš„å·¥ç¨‹æœåŠ¡ã€‚æ‹¥æœ‰è¯¥å·¥ç¨‹è®¿é—®æƒé™çš„äººéƒ½èƒ½å¤Ÿä¸ºè¯¥å·¥ç¨‹åˆ›å»ºShared Runnerã€‚</li>
</ul>
</blockquote>
<p><br/></p>
<p><strong>Q:GitLab-Runnerçš„å‡ ç§çŠ¶æ€è¯´æ˜?</strong></p>
<ul>
<li>shared - Runner å°†è¿è¡Œæ‰€æœ‰æœªæŒ‡å®šçš„é¡¹ç›®çš„ä½œä¸š</li>
<li>group - Runner å°†è¿è¡Œç¾¤ç»„ä¸­æ‰€æœ‰æœªæŒ‡å®šé¡¹ç›®çš„ä½œä¸š</li>
<li>specific - Runner å°†è¿è¡ŒæŒ‡å®šé¡¹ç›®çš„ä½œä¸š (å¸¸ç”¨)</li>
<li>locked - æ— æ³•å°† Runner åˆ†é…ç»™å…¶ä»–é¡¹ç›®</li>
<li>paused - Runner ä¸ä¼šæ¥å—æ–°çš„ä½œä¸š</li>
</ul>
<p><br></p>
<h4 id="1-2-å®‰è£…é…ç½®"><a href="#1-2-å®‰è£…é…ç½®" class="headerlink" title="1.2 å®‰è£…é…ç½®"></a>1.2 å®‰è£…é…ç½®</h4><p>æè¿°: GitLab-Runnerå®‰è£…é…ç½®æ­¤å¤„æœ‰ä¸¤ç§ä¸‹è½½å®‰è£…æ–¹å¼(å®¿ä¸»æœºæˆ–è€…å®¹å™¨ä¸­å®‰è£…)ï¼Œè¿™æ˜¯ç”±äºè€ƒè™‘åˆ°å›½å†…çš„ç½‘ç»œè®¿é—®å›½å¤–åœ°å€ç¡®å®å¤ªæ…¢è€Œä¸”å®¹æ˜“ä¸‹è½½å¤±è´¥ï¼Œæ‰€ä»¥é€šå¸¸æˆ‘ä»¬éƒ½æ˜¯åœ¨å›½å†…çš„ä¸€äº›é•œåƒæºå‚å•†å¤„è¿›è¡Œä¸‹è½½ä»¥åŠè®¾ç½®æ“ä½œç³»ç»Ÿçš„æ›´æ–°æº;</p>
<p>å®‰è£…å‚è€ƒ: <a href="https://docs.gitlab.com/runner/install/" target="_blank" rel="noopener">https://docs.gitlab.com/runner/install/</a></p>
<p><strong>ç¯å¢ƒè¯´æ˜:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GitLab æœåŠ¡å™¨: 192.168.1.250 = gitlab.weiyigeek.top</span><br><span class="line">Gitlab-Runner æœåŠ¡å™¨: 192.168.1.3</span><br></pre></td></tr></table></figure></p>
<p><strong>Runner å®‰è£…é…ç½®æµç¨‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ–¹å¼1: GitLabå®˜æ–¹å®‰è£…è„šæœ¬</span></span><br><span class="line">curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-ci-multi-runner/script.rpm.sh | sudo bash</span><br><span class="line">yum install -y gitlab-ci-multi-runner</span><br><span class="line">gitlab-ci-multi-runner register</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ–¹å¼2:æ¸…åå¤§å­¦é•œåƒç«™æºè¿›è¡Œå®‰è£…Gitlab-Runner</span></span><br><span class="line">cat &gt; /etc/yum.repos.d/gitlab-runner.repo &lt;&lt;END</span><br><span class="line">[gitlab-runner]</span><br><span class="line">name=gitlab-runner</span><br><span class="line">baseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-runner/yum/el7</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://packages.gitlab.com/gpg.key</span><br><span class="line">END</span><br><span class="line">sudo yum makecache</span><br><span class="line">sudo yum list gitlab-runner --showduplicates <span class="comment">#æŸ¥çœ‹å¯å®‰è£…ç‰ˆæœ¬</span></span><br><span class="line">sudo yum install gitlab-runner -y</span><br><span class="line"><span class="comment"># æ­¤å¤„æ‚¨å¯ä»¥å®‰è£…æŒ‡å®šç‰ˆæœ¬ å…¶ä¸­ 12.3.5 å³ä¸ºæŒ‡å®šçš„ç‰ˆæœ¬å·</span></span><br><span class="line"><span class="comment"># yum install gitlab-runner-12.3.5-1.x86_64 -y</span></span><br></pre></td></tr></table></figure></p>
<p><strong>å‘GitLab-CIæ³¨å†ŒRunneræµç¨‹å¦‚ä¸‹:</strong></p>
<ul>
<li>Step1.ç”±äºå‘GitLab-CIæ³¨å†Œä¸€ä¸ªRunneréœ€è¦ä¸¤æ ·ä¸œè¥¿<code>GitLab-CIçš„urlå’Œæ³¨å†Œtoken</code>æ‰€ä»¥æˆ‘ä»¬é¦–å…ˆéœ€è¦åœ¨GitLabå¹³å°ä¸Šå¾—åˆ°è¯¥å±æ€§(<code>ç®¡ç†ä¸­å¿ƒ-&gt;æ¦‚è§ˆ-&gt;Runner-&gt;æ‰‹åŠ¨è®¾ç½®SharedRunner</code>);</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.å®‰è£…GitLab Runner</span><br><span class="line">2.åœ¨ Runner è®¾ç½®æ—¶æŒ‡å®šä»¥ä¸‹ URLï¼š http://gitlab.weiyigeek.top/</span><br><span class="line">3.åœ¨å®‰è£…è¿‡ç¨‹ä¸­ä½¿ç”¨ä»¥ä¸‹æ³¨å†Œä»¤ç‰Œï¼š qupxfdPtuzCckymoSCUu</span><br><span class="line">4.å¯åŠ¨ Runner!</span><br></pre></td></tr></table></figure>
<ul>
<li>Step2.åœ¨Gitlab-Runner æœåŠ¡å™¨ä¸­è¿›è¡Œæ‰§è¡Œ;</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@Gitlab-Runner ~]<span class="variable">$gitlab</span>-runner register</span><br><span class="line">Runtime platform    arch=amd64 os=linux pid=20709 revision=4c96e5ad version=12.9.0</span><br><span class="line">Running <span class="keyword">in</span> system-mode.</span><br><span class="line">Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/):</span><br><span class="line">http://gitlab.weiyigeek.top/   <span class="comment">#Gitlabåœ°å€</span></span><br><span class="line">Please enter the gitlab-ci token <span class="keyword">for</span> this runner:</span><br><span class="line">qupxfdPtuzCckymoSCUu           <span class="comment">#gitlab-ciä»¤ç‰Œ</span></span><br><span class="line">Please enter the gitlab-ci description <span class="keyword">for</span> this runner:</span><br><span class="line">[initiator]: TestRunner       <span class="comment">#Runner æè¿°</span></span><br><span class="line">Please enter the gitlab-ci tags <span class="keyword">for</span> this runner (comma separated):</span><br><span class="line">TestRunner   <span class="comment">#Runner æ ‡ç­¾</span></span><br><span class="line">Registering runner... succeeded  runner=qupxfdPt <span class="comment">#è¡¨ç¤ºæ³¨å†ŒæˆåŠŸ</span></span><br><span class="line">Please enter the executor: parallels, custom, docker, docker-ssh, docker+machine, docker-ssh+machine, kubernetes, shell, ssh, virtualbox:</span><br><span class="line">shell <span class="comment">#æ‰§è¡Œæ–¹å¼</span></span><br><span class="line">Runner registered successfully. Feel free to start it, but <span class="keyword">if</span> it<span class="string">'s running already the config should be automatically reloaded!</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Step3.æ³¨å†Œå®Œæˆä¹‹åGitLab-CIå°±ä¼šå¤šå‡ºä¸€æ¡Runnerè®°å½•ï¼Œæ³¨æ„Typeå€¼æœ‰ä¸¤ç§:<code>shared æ‰€æœ‰ä»“åº“éƒ½å¯ä»¥ä½¿ç”¨ / specific åªæœ‰æŒ‡å®šçš„ä»“åº“å¯ä»¥ä½¿ç”¨</code> , è€Œtypeçš„ç±»å‹ç”±æ‰§è¡Œgitlab-runner registerå‘½ä»¤å¡«å…¥çš„tokenå†³å®šï¼›</li>
</ul>
<figure class="image-box">
                <a rel=1.åŸºäºGitLabä»£ç ä»“åº“çš„æŒç»­é›†æˆåŸºç¡€é…ç½®å’Œä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200416173843.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200416173843.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure>
<p>è¡¥å……:ä¸é”™å½“ç„¶æ‚¨ä¹Ÿå¯ä»¥åœ¨ <code>/etc/gitlab-runner/config.toml</code> æ¥æ³¨å†Œç›¸åº”ç±»å‹çš„ Runner<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$nano</span> /etc/gitlab-runner/config.toml</span><br><span class="line"></span><br><span class="line"><span class="comment"># é™åˆ¶äº†æ•´ä¸ªGitLab Runnerèƒ½å¹¶å‘å¤„ç†jobçš„æ•°é‡</span></span><br><span class="line">concurrent = 1</span><br><span class="line">check_interval = 0</span><br><span class="line"></span><br><span class="line">[session_server]</span><br><span class="line">  session_timeout = 1800</span><br><span class="line"></span><br><span class="line">[[runners]]</span><br><span class="line">  name = <span class="string">"TestRunner"</span></span><br><span class="line">  url = <span class="string">"http://gitlab.weiyigeek.top/"</span></span><br><span class="line">  <span class="comment">#æ³¨å†Œç”Ÿæˆçš„Runner ä»¤ç‰Œ</span></span><br><span class="line">  token = <span class="string">"5UmJ5uECw5k6H_phzeiW"</span></span><br><span class="line">  executor = <span class="string">"shell"</span></span><br><span class="line">  [runners.custom_build_dir]</span><br><span class="line">  [runners.cache]</span><br><span class="line">    [runners.cache.s3]</span><br><span class="line">    [runners.cache.gcs]</span><br><span class="line"></span><br><span class="line">[[runners]]</span><br><span class="line">  name = <span class="string">"DockerRunner"</span></span><br><span class="line">  url = <span class="string">"http://gitlab.weiyigeek.top/"</span></span><br><span class="line">  token = <span class="string">"HrpstQA6eezWv5-9m5-d"</span></span><br><span class="line">  executor = <span class="string">"docker"</span></span><br><span class="line">  [runners.custom_build_dir]</span><br><span class="line">  [runners.cache]</span><br><span class="line">    [runners.cache.s3]</span><br><span class="line">    [runners.cache.gcs]</span><br><span class="line">  [runners.docker]</span><br><span class="line">    <span class="comment"># åœ¨è¿™é‡Œéœ€è¦æ·»åŠ ä¸Š harbor çš„åœ°å€ï¼Œæ‰èƒ½å…è®¸ pull ç§æœ‰ registry çš„é•œåƒ</span></span><br><span class="line">    allowed_images = [<span class="string">"192.168.1.1/*:*"</span>]</span><br><span class="line">    tls_verify = <span class="literal">false</span></span><br><span class="line">    image = <span class="string">"alpine-node:latest"</span></span><br><span class="line">    privileged = <span class="literal">false</span></span><br><span class="line">    disable_entrypoint_overwrite = <span class="literal">false</span></span><br><span class="line">    oom_kill_disable = <span class="literal">false</span></span><br><span class="line">    disable_cache = <span class="literal">false</span></span><br><span class="line">    volumes = [<span class="string">"/cache"</span>]</span><br><span class="line">    shm_size = 0</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>æ³¨æ„äº‹é¡¹:</strong></p>
<ul>
<li>ç‰¹åˆ«æ³¨æ„<code>concurrent</code>ä¸<strong>worker</strong>æ•°é‡æ— ä»»ä½•å…³ç³»ï¼Œæ‰€æœ‰<strong>worker</strong>çš„å·¥ä½œæ˜¯å—GitLab Runneræ§åˆ¶çš„ï¼Œå¦‚æœ<code>concurrent</code>å€¼ä¸º1å¹¶ä¸”æœ‰ä¸€ä¸ªworkerå·²ç»åœ¨å·¥ä½œäº†ï¼Œé‚£ä¹ˆå³ä½¿å…¶ä»–workerè¾¾åˆ°äº†å¯ä»¥å·¥ä½œçš„æ¡ä»¶ä¹Ÿåªèƒ½â€œpendingâ€ã€‚</li>
</ul>
<p><br></p>
<h4 id="1-3-å‘½ä»¤å‚æ•°"><a href="#1-3-å‘½ä»¤å‚æ•°" class="headerlink" title="1.3 å‘½ä»¤å‚æ•°"></a>1.3 å‘½ä»¤å‚æ•°</h4><p>æè¿°: å®‰è£… Gitlab Runner åæœ‰ä¸¤ä¸ªå‘½ä»¤gitlab-ci-multi-runnerå’Œgitlab-runnerï¼Œå‰è€…ç”¨äºæ³¨å†Œå¤šä¸ªRunnerè€Œåè€…æ„å»ºä¸€ä¸ªå•å®ä¾‹runnerï¼›</p>
<p>gitlab-runner å‘½ä»¤å‚æ•°:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 1.æ³¨å†Œrunner ä¼šä»¥å¼•å¯¼çš„æ–¹å¼è¯¢é—®ç›¸å…³å‚æ•°çš„è®¾ç½®-äº¤äº’å¼</span></span><br><span class="line">$ gitlab-runner register</span><br><span class="line"></span><br><span class="line"><span class="comment">## 2.æŸ¥çœ‹å·²ç»æ³¨å†Œçš„runner</span></span><br><span class="line">$ gitlab-runner list</span><br><span class="line">Runtime platform            arch=amd64 os=linux pid=81864 revision=4c96e5ad version=12.9.0</span><br><span class="line">Listing configured runners    ConfigFile=/home/gitlab-runner/.gitlab-runner/config.toml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.åˆ é™¤gitlab-runnerç›¸å…³é…ç½®</span></span><br><span class="line">sudo gitlab-runner uninstall</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.å®‰è£…å¹¶è®¾ç½®--user(ä¾‹å¦‚è®¾ç½®ä¸ºroot)</span></span><br><span class="line">sudo gitlab-runner install --working-directory /home/gitlab-runner --user root </span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.ä¸´æ—¶é‡‡ç”¨rootæƒé™è¿è¡Œrunner(å‘å¤šï¼Œåœ¨Gitlab-CIä¸­ç”±äºé‡‡ç”¨çš„gitlab-runnerç”¨æˆ·å¸¸å¸¸æ“ä½œæ–‡ä»¶æ—¶å€™æé†’æƒé™ä¸è¶³)</span></span><br><span class="line">sudo gitlab-runner run</span><br><span class="line"></span><br><span class="line"><span class="comment">#6.å°†GitLab Runnerå®‰è£…ä¸ºç³»ç»ŸæœåŠ¡ï¼š</span></span><br><span class="line">sudo gitlab-runner install -n <span class="string">"&lt;service-name&gt;"</span> -u &lt;user-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#7.å¯åŠ¨æœåŠ¡</span></span><br><span class="line">sudo gitlab-runner start -n <span class="string">"&lt;service-name&gt;"</span></span><br></pre></td></tr></table></figure></p>
<p>GitLab Runner Commands å‘½ä»¤ä½¿ç”¨å‚è€ƒ:<a href="https://docs.gitlab.com/runner/commands/README.html" target="_blank" rel="noopener">https://docs.gitlab.com/runner/commands/README.html</a></p>
<p><br></p>
<h4 id="1-4-åŸºç¡€ä½¿ç”¨"><a href="#1-4-åŸºç¡€ä½¿ç”¨" class="headerlink" title="1.4 åŸºç¡€ä½¿ç”¨"></a>1.4 åŸºç¡€ä½¿ç”¨</h4><p>æè¿°:å‡è®¾æˆ‘ä»¬åœ¨SecOpsDevé¡¹ç›®ä¸­è¿›è¡Œä½¿ç”¨Gitlab-CI/CDï¼Œå¹¶ä¸”å·²ç»æ³¨å†Œäº†Runnerï¼Œ<code>ç®¡ç†ä¸­å¿ƒ-&gt;Runner-&gt;æŸ¥çœ‹Runneræ ‡ç­¾</code>:æ­¤å¤„ä¸ºTestRunnerï¼Œç„¶åç‚¹å‡»ç¼–è¾‘è¿›è¡ŒæŒ‡æ´¾SecOpsDevé¡¹ç›®;</p>
<figure class="image-box">
                <a rel=1.åŸºäºGitLabä»£ç ä»“åº“çš„æŒç»­é›†æˆåŸºç¡€é…ç½®å’Œä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200418115631.png" target="_blank" title="WeiyiGeek.runnertags" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200418115631.png" alt="WeiyiGeek.runnertags" title="" class=""></a>
                <p>WeiyiGeek.runnertags</p>
            </figure>
<p>ï¼ˆ1ï¼‰æ­¤æ—¶æˆ‘ä»¬å†åœ¨æˆ‘ä»¬çš„SecOpsDevé¡¹ç›®ä¸­å»ºç«‹ä¸€ä¸ª.gitlab-ci.yamlæ–‡ä»¶ï¼Œå¹¶ä¸”ç¼–å†™å¥½åå»ºè®®å¯¹å…¶è¿›è¡Œæ£€æµ‹æµ‹è¯•<code>NewProject -&gt; SecOpsDev -&gt; CI Lint</code>ï¼Œç¤ºä¾‹å¦‚ä¸‹:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Path: secopsdev/.gitlab-ci.yml</span></span><br><span class="line"><span class="comment">#ä½¿ç”¨.gitlab-ci.ymlé…ç½®ä½ çš„é¡¹ç›®,æ³¨æ„ä¸‹é¢Tagsæ˜¯å¿…é¡»è¦æŒ‡å®šçš„å¦åˆ™CIæŠ¥é”™æ‰¾ä¸åˆ°Runner;</span></span><br><span class="line"><span class="attr">stages:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">test</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">build</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">deploy</span></span><br><span class="line"><span class="comment">#æ¯æ¬¡</span></span><br><span class="line"><span class="attr">before_script:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">echo</span> <span class="string">"#Before script section"</span> <span class="string">&gt;&gt;</span> <span class="string">WeiyiGeek.txt</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">echo</span> <span class="string">"For example you might run an update here or install a build dependency"</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">echo</span> <span class="string">"Or perhaps you might print out some debugging details"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">after_script:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">echo</span> <span class="string">"#After script section"</span> <span class="string">&gt;&gt;</span> <span class="string">WeiyiGeek.txt</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">echo</span> <span class="string">"For example you might do some cleanup here"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">test1:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"(1) Do a test here - æ­£åœ¨è¿›è¡Œä»£ç æµ‹è¯• é˜¶æ®µ1 "</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"For example run a test suite"</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">TestRunner</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">test2:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"(2) Do another parallel test here - æ­£åœ¨è¿›è¡Œä»£ç æµ‹è¯• é˜¶æ®µ2 å¹¶è¡Œæµ‹è¯• "</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"For example run a lint test"</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">TestRunner</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">build:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">build</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"(3) Building the app - æ­£åœ¨å¯¹é¡¹ç›®è¿›è¡Œç¼–è¯‘ "</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">TestRunner</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"(4) Deploy to staging server :"</span> <span class="string">$url</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"(4) Deploy to staging server :"</span> <span class="string">$(env)</span></span><br><span class="line"><span class="attr">  environment:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">staging</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">https://staging.weiyigeek.top</span></span><br><span class="line"><span class="attr">  only:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">master</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">TestRunner</span></span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=1.åŸºäºGitLabä»£ç ä»“åº“çš„æŒç»­é›†æˆåŸºç¡€é…ç½®å’Œä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200418121148.png" target="_blank" title="WeiyiGeek.gitlab-ci.yaml" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200418121148.png" alt="WeiyiGeek.gitlab-ci.yaml" title="" class=""></a>
                <p>WeiyiGeek.gitlab-ci.yaml</p>
            </figure>
<p>ï¼ˆ2ï¼‰ä¹‹åæˆ‘ä»¬ä¼šåœ¨é¡¹ç›®ä¸­çš„ <code>CI-CD -&gt; æµæ°´çº¿ | ä½œä¸š</code> è¿›è¡ŒæŸ¥çœ‹æ‰§è¡Œç»“æœ;</p>
<figure class="image-box">
                <a rel=1.åŸºäºGitLabä»£ç ä»“åº“çš„æŒç»­é›†æˆåŸºç¡€é…ç½®å’Œä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200418122704.png" target="_blank" title="WeiyiGeek.æµæ°´çº¿" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200418122704.png" alt="WeiyiGeek.æµæ°´çº¿" title="" class=""></a>
                <p>WeiyiGeek.æµæ°´çº¿</p>
            </figure>
<p>ï¼ˆ3ï¼‰Gitlab-CIæ‰§è¡Œè¯¦æƒ…ç»“æœ:</p>
<figure class="image-box">
                <a rel=1.åŸºäºGitLabä»£ç ä»“åº“çš„æŒç»­é›†æˆåŸºç¡€é…ç½®å’Œä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200418122734.png" target="_blank" title="WeiyiGeek.ä½œä¸šè¯¦æƒ…" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200418122734.png" alt="WeiyiGeek.ä½œä¸šè¯¦æƒ…" title="" class=""></a>
                <p>WeiyiGeek.ä½œä¸šè¯¦æƒ…</p>
            </figure>
<p>ï¼ˆ4ï¼‰é™¤æ­¤ä¹‹å¤–æˆ‘ä»¬è¿˜å¯å¯¹CI/CDç¯å¢ƒå˜é‡è¿›è¡Œè®¾ç½®ï¼Œå¹¶ä¸”è¿è¡Œåˆ°Runnerç¯å¢ƒä¸­,è®¾ç½®è·¯å¾„å¦‚ä¸‹: <code>NewProject -&gt; SecOpsDev -&gt; CI/CD è®¾ç½® -&gt; Expand (å±•å¼€)</code>ï¼Œç„¶åé‡æ–°æ‰§è¡Œdeployé˜¶æ®µåœ¨ä½œä¸šè¿›è¡ŒæŸ¥çœ‹æ˜¾ç¤ºå¦‚ä¸‹å›¾æ‰€ç¤º;</p>
<figure class="image-box">
                <a rel=1.åŸºäºGitLabä»£ç ä»“åº“çš„æŒç»­é›†æˆåŸºç¡€é…ç½®å’Œä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200418124128.png" target="_blank" title="WeiyiGeek.ç¯å¢ƒå˜é‡" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200418124128.png" alt="WeiyiGeek.ç¯å¢ƒå˜é‡" title="" class=""></a>
                <p>WeiyiGeek.ç¯å¢ƒå˜é‡</p>
            </figure>
<p>ï¼ˆ5ï¼‰æ‹‰å–çš„codeä¼šåœ¨Gitlab-Runnerä¸»æœºä¸­,å®‰è£…ä»¥ä¸‹è·¯å¾„è¿›è¡Œå­˜æ”¾<code>/home/gitlab-runner/builds/5UmJ5uEC/0/newproject/secopsdev/.git/</code></p>
<p>è¡¥å……è¯´æ˜:</p>
<ul>
<li>GitLab CIæœ‰ä¸‰ä¸ªé»˜è®¤é˜¶æ®µï¼š<code>1æ„å»º(build)ã€2æµ‹è¯•(test)ã€3éƒ¨ç½²(deploy)</code>ï¼Œæˆ‘ä»¬å°†æœ‰ä¸€ç¯‡æ–‡ç« è¿›è¡Œè¯¦ç»†è®²è§£ã€‚</li>
<li>Runnerå¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒçš„ä¸»æœºä¸Šï¼ŒåŒä¸€ä¸ªä¸»æœºä¸Šä¹Ÿå¯ä»¥æœ‰å¤šä¸ªRunnerã€‚</li>
</ul>
<p><br></p>
<h4 id="1-5-Executor"><a href="#1-5-Executor" class="headerlink" title="1.5 Executor"></a>1.5 Executor</h4><p>ä¸‹é¢æˆ‘ä»¬æ¥è°ˆè°ˆä¸€ä¸ªéå¸¸é‡è¦çš„è¯é¢˜<code>Executor</code>,ä¸Šé¢æˆ‘ä»¬åœ¨å‘gitlab-ciæ³¨å†Œrunneréœ€è¦æˆ‘ä»¬è¾“å…¥Executor;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Please enter the executor: parallels, custom, docker, docker-ssh, docker+machine, docker-ssh+machine, kubernetes, shell, ssh, virtualbox:</span><br></pre></td></tr></table></figure></p>
<p><strong>Shell Executor</strong><br>æè¿°:ä»¥å®¿ä¸»æœºï¼ˆæ­¤å¤„ä¸ºCentos7ç³»ç»Ÿï¼‰ä½œä¸ºRunner(ç‰ˆæœ¬:12.9.0)çš„æ‰€æœ‰jobsçš„æ‰§è¡Œå™¨ã€‚<br>Runnerå°†ä¼šä»è¿œç¨‹ä»“åº“pullä½ çš„å·¥ç¨‹ï¼Œå·¥ç¨‹çš„ç›®å½•ä¸ºï¼š<code>&lt;working-directory&gt;/builds/&lt;short-token&gt;/&lt;concurrent-id&gt;/&lt;namespace&gt;/&lt;project-name&gt;</code>,å¦‚æœä½ ä½¿ç”¨äº†cacheï¼Œé‚£ä¹ˆcacheå°†ä¼šå­˜åœ¨<code>&lt;working-directory&gt;/cache/&lt;namespace&gt;/&lt;project-name&gt;</code>ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Repo</span></span><br><span class="line">/home/gitlab-runner/builds/5UmJ5uEC/0/WeiyiGeek/blog</span><br><span class="line"></span><br><span class="line"><span class="comment">#Cache</span></span><br><span class="line">/home/gitlab-runner/cache/WeiyiGeek/blog</span><br></pre></td></tr></table></figure></p>
<p>å‚è€ƒ:<a href="https://docs.gitlab.com/runner/executors/shell.html" target="_blank" rel="noopener">https://docs.gitlab.com/runner/executors/shell.html</a></p>
<p><br/></p>
<p><strong>Docker Executor</strong><br>æè¿°:æ‰€æœ‰jobsçš„æ‰§è¡Œç¯å¢ƒä¸ºæŒ‡å®šçš„docker imageæ‰€ç”Ÿæˆçš„containerï¼Œæ¯ä¸ªjobéƒ½ä¼šç”Ÿæˆä¸€ä¸ªcontainerå¹¶ä¸”åœ¨jobç»“æŸåç«‹å³é”€æ¯ã€‚</p>
<ul>
<li><p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fdocs.gitlab.com%2Frunner%2Fexecutors%2Fdocker.html%23the-builds-and-cache-storage" target="_blank" rel="noopener">- buildå’Œcacheçš„å­˜å‚¨</a></p>
<p>Docker executoré»˜è®¤å°†æ‰€æœ‰çš„buildså­˜å‚¨åœ¨<code>/builds//</code>ï¼ˆè¿™é‡Œçš„è·¯å¾„æ˜¯containeré‡Œçš„è·¯å¾„ï¼ŒRunneré…ç½®æ–‡ä»¶<code>config.toml</code>é‡Œçš„<code>build_dir</code>å­—æ®µå¯ä»¥é‡æ–°æŒ‡æ˜buildçš„ç›®å½•ï¼Œé»˜è®¤å¯¹åº”äºå®¿ä¸»æœºçš„ç›®å½•æ˜¯åœ¨å®¿ä¸»æœºçš„docker volumeä¸‹ï¼š<code>/var/lib/docker/volumes//_data/</code>ï¼‰ï¼Œé»˜è®¤å°†æ‰€æœ‰çš„cacheså­˜å‚¨åœ¨containeré‡Œçš„<code>/cache</code>ç›®å½•ï¼ˆ<code>config.toml</code>é‡Œçš„<code>cache_dir</code>å­—æ®µå¯ä»¥é‡æ–°æŒ‡æ˜cacheçš„ç›®å½•ï¼‰ï¼Œæ³¨æ„<code>build_dir</code>å’Œ<code>cache_dir</code>æŒ‡å‘çš„å‡æ˜¯containeré‡Œçš„ç›®å½•ï¼Œè¦æƒ³å°†containeré‡Œçš„æ•°æ®æŒä¹…åŒ–ï¼Œéœ€è¦ç”¨åˆ°<code>volumes</code>å­—æ®µï¼Œè¿™ä¸ªå­—æ®µçš„ä½¿ç”¨å’Œdocker volumeçš„ä½¿ç”¨æ˜¯ç±»ä¼¼çš„ï¼Œåªéœ€åœ¨<code>config.toml</code>çš„<code>[runner.docker]</code>éƒ¨åˆ†æ·»åŠ <code>volumes = [&quot;/cache&quot;, &quot;:rw&quot;]</code>å³å¯å®ç°containeré‡Œ<code>/cache</code>ç›®å½•æ•°æ®çš„æ°¸ä¹…ä¿å­˜ä»¥åŠå°†hostç›®å½•æŒ‚è½½åˆ°ç›¸åº”çš„containerç›®å½•å¹¶å…·æœ‰è¯»å†™çš„åŠŸèƒ½ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[runners.custom_build_dir]</span></span><br><span class="line">  <span class="string">[runners.cache]</span></span><br><span class="line">    <span class="string">[runners.cache.s3]</span></span><br><span class="line">    <span class="string">[runners.cache.gcs]</span></span><br><span class="line">  <span class="string">[runners.docker]</span></span><br><span class="line">    <span class="comment"># åœ¨è¿™é‡Œéœ€è¦æ·»åŠ ä¸Š harbor çš„åœ°å€ï¼Œæ‰èƒ½å…è®¸ pull ç§æœ‰ registry çš„é•œåƒ</span></span><br><span class="line">    <span class="string">allowed_images</span> <span class="string">=</span> <span class="string">["192.168.1.1/*:*"]</span></span><br><span class="line">    <span class="string">tls_verify</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="string">image</span> <span class="string">=</span> <span class="string">"alpine-node:latest"</span></span><br><span class="line">    <span class="string">privileged</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="string">disable_entrypoint_overwrite</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="string">oom_kill_disable</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="string">disable_cache</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="string">volumes</span> <span class="string">=</span> <span class="string">["/cache"]</span></span><br><span class="line">    <span class="string">shm_size</span> <span class="string">=</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fdocs.gitlab.com%2Frunner%2Fexecutors%2Fdocker.html%23how-pull-policies-work" target="_blank" rel="noopener">Pull policies</a></p>
<p>å½“ä½ ä½¿ç”¨<code>docker</code> æˆ– <code>docker+machine</code> executorsæ—¶ï¼Œä½ å¯ä»¥é€šè¿‡è®¾ç½®<code>pull_policy</code>æ¥å†³å®šRunnerå¦‚ä½•pull docker imageã€‚<code>pull_policy</code>æœ‰ä¸‰ç§å€¼ï¼š<br> <code>always</code> â€”â€” Runnerå§‹ç»ˆä»è¿œç¨‹pull docker imageã€‚<br> <code>if-not-present</code> â€”â€” Runnerä¼šé¦–å…ˆæ£€æŸ¥æœ¬åœ°æ˜¯å¦æœ‰è¯¥imageï¼Œå¦‚æœæœ‰åˆ™ç”¨æœ¬åœ°çš„ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä»è¿œç¨‹æ‹‰å–ã€‚<br> <code>never</code> â€”â€” Runnerå§‹ç»ˆä½¿ç”¨æœ¬åœ°çš„imageã€‚</p>
</li>
</ul>
<ul>
<li><p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fdocs.gitlab.com%2Frunner%2Fconfiguration%2Fadvanced-configuration.html%23helper-image" target="_blank" rel="noopener">Helper image</a></p>
<p>  å½“ä½ ä½¿ç”¨<code>docker</code>, <code>docker+machine</code> æˆ– <code>kubernetes</code>ä½œä¸ºexecutoræ—¶ï¼ŒGitLab Runnerå°†ä¼šä½¿ç”¨ç‰¹å®šçš„containeræ¥å¤„ç†Gitã€artifacts å’Œcache æ“ä½œã€‚é€šè¿‡åœ¨å®¿ä¸»æœºä¸­é”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker images</span><br><span class="line">REPOSITORY                          TAG</span><br><span class="line">gitlab&#x2F;gitlab-runner-helper     x86_64-3afdaba6</span><br><span class="line">gitlab&#x2F;gitlab-runner-helper     x86_64-cf91d5e1</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®<code>config.toml</code>é‡Œçš„<code>helper_image</code>å­—æ®µæ¥è®©Runnerä½¿ç”¨ä½ è‡ªå·±å®šåˆ¶åŒ–çš„helper imageã€‚</p>
</li>
</ul>
<p><em>Qï¼šå¦‚ä½•åœ¨jobæ‰€å¯¹åº”çš„containeré‡Œä½¿ç”¨git cloneå‘½ä»¤ï¼Ÿ</em></p>
<p>ç­”: å¦‚æœä½ æƒ³åœ¨jobè¿è¡ŒæœŸé—´cloneæŸäº›ä»£ç ï¼ˆå¦‚shellæˆ–pythonçš„è„šæœ¬ï¼‰ï¼Œé¦–å…ˆè¦ç¡®ä¿ä½ çš„å®¿ä¸»æœºæœ‰æƒé™cloneä»£ç ï¼Œç„¶åä½ å°±å¯ä»¥å°†ä½ çš„secretæŒ‚è½½åˆ°containeré‡Œ</p>
<p>ä¾‹å¦‚ï¼Œä½ æ˜¯é€šè¿‡sshçš„æ–¹å¼å…‹éš†ä»£ç ï¼Œå¹¶ä¸”ä½ çš„sshç›®å½•ä¸º<code>home//.ssh</code>ï¼Œä½ å°±å¯ä»¥åœ¨<code>config.toml</code>æ–‡ä»¶é‡Œæ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volumes &#x3D; [&quot;&#x2F;home&#x2F;x1twbm&#x2F;.ssh:&#x2F;root&#x2F;.ssh:ro&quot;]</span><br></pre></td></tr></table></figure>
<p><br></p>
<h4 id="1-6-ç¼“å­˜ä½¿ç”¨"><a href="#1-6-ç¼“å­˜ä½¿ç”¨" class="headerlink" title="1.6 ç¼“å­˜ä½¿ç”¨"></a>1.6 ç¼“å­˜ä½¿ç”¨</h4><p>è¯¥ç« èŠ‚ä¸»è¦é’ˆå¯¹äºGitlab CI/CD ä¸­çš„ Cache ä¸¤ç§æœºåˆ¶è¿›è¡Œå­¦ä¹ å’Œè¯´æ˜ï¼›</p>
<ul>
<li>cache</li>
<li>artifacts</li>
</ul>
<p><em>Qï¼šä¸ºä½•è¦ä½¿ç”¨ Cacheï¼Ÿå®ƒæœ‰ä»€ä¹ˆç›®çš„?</em><br>A:åœ¨GitLab CI/CD ä¸­åœ¨ pipeline ä¸­çš„ä¸€äº› job å¯èƒ½ä¼šäº§ç”Ÿä¸€äº›ç»“æœæ–‡ä»¶ï¼Œ<code>Cache æœºåˆ¶çš„å¼•å…¥å°±æ˜¯ä¸ºäº†åŠ å¿« job æ‰§è¡Œçš„æ—¶é—´</code>ã€‚Cache åœ¨ä½¿ç”¨æ—¶åˆ¶å®šä¸€ç³»åˆ—çš„æ–‡ä»¶æˆ–è€…æ–‡ä»¶ç›®å½•ï¼Œä½¿å¾—å…¶åœ¨ä¸åŒçš„ job ä¹‹é—´è¢«ç¼“å­˜ä¸‹æ¥ã€‚è¿™æ ·å½“æŸä¸€ä¸ª job éœ€è¦ä¾èµ–äºä¹‹å‰æ­¥éª¤äº§ç”Ÿçš„ä¸€äº›æ–‡ä»¶ç»“æœï¼ŒCache å°±å¸®åŠ©æˆ‘ä»¬åœ¨ä¸Šä¸€ä¸ª job å°†äº§ç”Ÿçš„ç»“æœç¼“å­˜ä¸‹æ¥å¹¶ä¸”åœ¨å½“å‰çš„ job è¿›è¡Œä½¿ç”¨ã€‚</p>
<p><br></p>
<p><strong>ï¼ˆ1ï¼‰Cache</strong><br>æè¿°ï¼šé¦–å…ˆ cache çš„å®šä¹‰èŒƒå›´å¯ä»¥å…¨å±€å®šä¹‰å³<code>æ‰€æœ‰çš„ job éƒ½ä¼šé‡‡ç”¨è¿™ä¸ªå…¨å±€å®šä¹‰çš„ cache è®¾ç½®</code>, å½“ç„¶æ¯ä¸ª <code>job å†…ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±ç‰¹æœ‰çš„ cache æ¥è¦†ç›–å…¨å±€çš„é…ç½®</code>ã€‚<br>Cache åœ¨ä½¿ç”¨ä¸Šä¸»è¦çš„é…ç½®æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>paths: æŒ‡å®šéœ€è¦è¢«ç¼“å­˜çš„æ–‡ä»¶è·¯å¾„(é¡¹ç›®ç›¸å¯¹è·¯å¾„)</li>
<li>key: åœ¨cacheä¸­ä¸åŒ job å®šä¹‰äº†ä¸åŒçš„ key æ—¶ï¼Œ æ¯ä¸ª job éƒ½ä¼šæœ‰ä¸€ä¸ªç‹¬ç«‹çš„ cacheï¼Œä¸åŒçš„ key ä¸‹çš„ç¼“å­˜ä¹Ÿä¸ä¼šç›¸äº’å½±å“,å½“ cache:key ç»“åˆ GitLab CI/CD ä¸­é¢„å®šä¹‰çš„å‚æ•°å¯ä»¥æœ‰ä¸åŒçš„æ•ˆæœ,å½“ key æ²¡æœ‰è¢«ç‰¹åˆ«å®šä¹‰çš„æ—¶å€™ï¼Œé»˜è®¤ä¸º defaultï¼Œæ‰€æœ‰æ²¡å®šä¹‰ key çš„ cache ä½¿ç”¨çš„æ˜¯åŒä¸€ä»½ cacheï¼Œä¼šéšç€ job çš„æ‰§è¡Œä¸€ç›´è¢«è¦†ç›–ï¼›</li>
<li>policy: å¦‚æœæœ‰ cache çš„é…ç½®æ­¤æ—¶æ¯ä¸ª job ä¼šåœ¨å¼€å§‹æ‰§è¡Œå‰å°†å¯¹åº”è·¯å¾„çš„æ–‡ä»¶ä¸‹è½½ä¸‹æ¥ï¼Œå¹¶åœ¨ä»»åŠ¡ç»“æŸå‰é‡æ–°ä¸Šä¼ ï¼Œä¸ç®¡æ–‡ä»¶æ˜¯å¦æœ‰å˜åŒ–éƒ½ä¼šå¦‚æ­¤æ“ä½œ(<code>é»˜è®¤çš„é…ç½® cache:policyä¸º pull-push ç­–ç•¥</code>)ï¼›ä½†æ˜¯å¦‚æœæˆ‘ä»¬å·²ç»çŸ¥é“æŸä¸ª job åªæ˜¯ä½¿ç”¨çš„å…¶ä»– job æ”¹å˜çš„æ–‡ä»¶ï¼Œè‡ªèº«å¹¶æ— æ”¹å˜å¯¹åº”è·¯å¾„çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦è¿›è¡Œæ–‡ä»¶ä¸Šä¼ æ“ä½œé‡‡ç”¨pull ç­–ç•¥å³å¯ï¼Œè¿™æ ·åšçš„å¥½å¤„<code>å‡å°‘äº†ä¸å¿…è¦çš„æ“ä½œï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸ŠèŠ‚çº¦äº†æ—¶é—´</code>ã€‚</li>
</ul>
<p><em>Q:å¦‚ä½•è¿›è¡Œ cache ç»§æ‰¿ï¼Ÿ</em><br>ç­”:å¦‚æœåœ¨ä½¿ç”¨ä¸­æœ‰ job å¤§éƒ¨åˆ†é…ç½®è·Ÿå…¨å±€é…ç½®æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯éƒ¨åˆ†ä¸åŒï¼Œå°±å¯ä»¥é‡‡ç”¨ç»§æ‰¿çš„æ–¹å¼ï¼Œè€Œä¸å¿…å…¨éƒ¨é‡å†™å®é™…ä¸Šç±»ä¼¼äºåˆ«åä¸€æ ·è¿›è¡Œå‡½æ•°è°ƒç”¨ä¸€æ ·ï¼Œé¦–å…ˆéœ€åœ¨caheå…¨å±€ç¼“å­˜ä¸­è®¾ç½®<code>&amp;global_cache</code>,ç„¶åå†jobä¸­è¿›è¡Œè°ƒç”¨å‡»å³å¯<code>&lt;&lt;: *global_cache</code>;</p>
<p>Q:å¦‚ä½•ç¦ç”¨æŸä¸ªJobçš„Cacheæ“ä½œï¼Ÿ<br>ç­”:å¦‚æœæ•´ä¸ª pipeline é…ç½®å…¨å±€çš„ cacheï¼Œæ„å‘³ç€æ¯ä¸ª job åœ¨æ²¡æœ‰ç‰¹æ®Šé…ç½®çš„æƒ…å†µä¸‹ä¼šä½¿ç”¨å…¨å±€çš„é…ç½®ã€‚ä½†æ˜¯å¦‚æœæŸæŸä¸ª job å¹¶ä¸ä½¿ç”¨åˆ° cacheï¼ŒåŒ…æ‹¬ç¼“å­˜æ–‡ä»¶çš„ä¸Šä¼ å’Œä¸‹è½½ï¼Œé‚£ä¹ˆå¯ä»¥è¿›è¡Œå¦‚ä¸‹é…ç½®å¯¹æ•´ä¸ª job çš„ cache ç¦ç”¨,å†jobä¸­é…ç½®<code>cache: {}</code>å³ä¸ä¼šæ”¶åˆ°å…¨å±€ç¼“å­˜çš„å½±å“ï¼š</p>
<p>Cacheåœ¨runnerä¸­ç¼“å­˜çš„ç‰©ç†è·¯å¾„:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/home/gitlab-runner/cache/gitlabç”¨æˆ·/é¡¹ç›®åç§°/cache.zip</span><br><span class="line">/home/gitlab-runner/cache/WeiyiGeek/blog/cache.zip</span><br></pre></td></tr></table></figure></p>
<p><em>å‚æ•°è¯´æ˜:</em><br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å…¨å±€ç¼“å­˜ global_cache</span></span><br><span class="line"><span class="attr">cache:</span> <span class="meta">&amp;global_cache</span></span><br><span class="line"><span class="attr">  key:</span> <span class="string">$&#123;CI_JOB_NAME&#125;</span> <span class="comment">#ç»“åˆ GitLab CI/CD ä¸­é¢„å®šä¹‰çš„å‚æ•°æœ‰ä¸åŒçš„æ•ˆæœ</span></span><br><span class="line">  <span class="comment"># ç¼“å­˜ node_modules/ç›®å½• ä¸‹æ¬¡æ„å»ºä¸ä¼šåˆ é™¤</span></span><br><span class="line"><span class="attr">  paths:</span>  </span><br><span class="line"><span class="bullet">    -</span> <span class="string">node_modules/</span></span><br><span class="line"><span class="attr">  policy:</span> <span class="string">pull-push</span> <span class="comment">#é»˜è®¤å¯¹ç¼“å­˜æ–‡ä»¶è¿›è¡Œæ‹‰å–ä¸æ›´æ–°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å±€éƒ¨ç¼“å­˜ local_cache</span></span><br><span class="line"><span class="attr">local_cache:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">build</span></span><br><span class="line"><span class="attr">  cache:</span>   <span class="comment">#å¦‚æœåœ¨ job å†…éƒ¨ä¹Ÿå®šä¹‰äº† cache é…ç½®ï¼Œå…¨å±€çš„é…ç½®å°±ä¼šè¢«è¦†ç›–</span></span><br><span class="line"><span class="attr">    key:</span> <span class="string">$&#123;CI_JOB_NAME&#125;</span></span><br><span class="line"><span class="attr">    policy:</span> <span class="string">pull</span>  <span class="comment">#ä½¿ç”¨äº†pull ç­–ç•¥ä¸ä¼šåœ¨ job ç»“æŸåè¿›è¡Œæ–‡ä»¶çš„ä¸Šä¼ æ“ä½œ</span></span><br><span class="line"><span class="attr">    paths:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">node_modules/</span> </span><br><span class="line"><span class="bullet">      -</span> <span class="string">binaries/*.apk</span>  <span class="comment">#åœ¨binaries ç›®å½•ä¸‹ä»¥ .apk ç»“å°¾çš„æ‰€æœ‰æ–‡ä»¶ä»¥åŠ .config æ–‡ä»¶ä¼šè¢«ç¼“å­˜ä¸‹æ¥ã€‚</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#Cache çš„ç»§æ‰¿</span></span><br><span class="line"><span class="attr">inherit_cache:</span></span><br><span class="line"><span class="attr"> cache:</span></span><br><span class="line">    <span class="comment"># ç»§æ‰¿å…¨å±€é…ç½®</span></span><br><span class="line">    <span class="string">&lt;&lt;:</span> <span class="meta">*global_cache</span></span><br><span class="line">    <span class="comment"># ä»…è¦†ç›– cache:policy çš„é…ç½®</span></span><br><span class="line"><span class="attr">    policy:</span> <span class="string">pull</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Cache çš„ç¦ç”¨</span></span><br><span class="line"><span class="string">disable_cache</span></span><br><span class="line"><span class="attr">  cache:</span> <span class="string">&#123;&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>åˆ†å¸ƒå¼ Cache åœ¨ GitLab CI/CD ä¸­ï¼Œæˆ‘ä»¬æ‰€ä½¿ç”¨çš„ runner æ˜¯ä»¥ docker çš„å½¢å¼è¿è¡Œä¸åŒçš„ä»»åŠ¡ã€‚æ™®é€šçš„ cache æœºåˆ¶ï¼Œå…¶ cache å‡å­˜å‚¨åœ¨æœ¬åœ°ï¼Œæ‰€æœ‰å¦‚æœä¸¤ä¸ª job å®é™…è¿è¡Œçš„ä½ç½®æ˜¯åœ¨ä¸ç”¨å®¿ä¸»æœºä¸Šï¼Œå…¶ç›¸äº’ä¹‹é—´çš„ç¼“å­˜æ˜¯æ— æ³•å…±äº«çš„ã€‚</p>
<p>ä¸ºäº†å®ç°åˆ†å¸ƒå¼ Cacheï¼Œéœ€è¦åœ¨é…ç½® GitLab Runner çš„ config.toml çš„ <code>[runners.cache]</code>è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[[runners]]</span></span><br><span class="line">  <span class="string">limit</span> <span class="string">=</span> <span class="number">10</span></span><br><span class="line">  <span class="string">executor</span> <span class="string">=</span> <span class="string">"docker"</span></span><br><span class="line">  <span class="string">[runners.cache]</span></span><br><span class="line">    <span class="string">Type</span> <span class="string">=</span> <span class="string">"s3"</span></span><br><span class="line">    <span class="string">Path</span> <span class="string">=</span> <span class="string">"path/to/prefix"</span></span><br><span class="line">    <span class="string">Shared</span> <span class="string">=</span> <span class="literal">true</span></span><br><span class="line">    <span class="string">[runners.cache.s3]</span></span><br><span class="line">      <span class="string">ServerAddress</span> <span class="string">=</span> <span class="string">"s3.example.com"</span></span><br><span class="line">      <span class="string">AccessKey</span> <span class="string">=</span> <span class="string">"access-key"</span></span><br><span class="line">      <span class="string">SecretKey</span> <span class="string">=</span> <span class="string">"secret-key"</span></span><br><span class="line">      <span class="string">BucketName</span> <span class="string">=</span> <span class="string">"runner"</span></span><br><span class="line">      <span class="string">Insecure</span> <span class="string">=</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><br>åœ¨ä»¥ä¸Šçš„é…ç½®ä¸­ï¼Œå¯¹åº”çš„ cache çš„å­˜å‚¨è·¯å¾„å¦‚ä¸‹ï¼š<code>http(s)://&lt;ServerAddress&gt;/&lt;BucketName&gt;/&lt;Path&gt;/project/&lt;id&gt;/&lt;cache-key&gt;</code>,åœ¨é…ç½®ï¼Œå¯¹åº”çš„å­˜å‚¨ cache æœåŠ¡å™¨éœ€è¦æ»¡è¶³ s3 åè®®ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥<a href="https://docs.gitlab.com/runner/install/registry_and_cache_servers.html#install-your-own-cache-server" target="_blank" rel="noopener">è‡ªå»º cache æœåŠ¡å™¨</a></p>
<p>Cache å°å®è·µï¼š<br>(1).gitlab-ci.yml é…ç½®ä»¥ä¸‹é…ç½®ä¸­ <code>job1 å’Œ job3 ä½¿ç”¨äº†å…¨å±€çš„ cache é…ç½®ï¼Œjob2 ç‹¬ç«‹å®šä¹‰äº† cache é…ç½®ä½¿ç”¨äº† pull ç­–ç•¥</code>ã€‚<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line"><span class="bullet">   -</span> <span class="string">test1</span></span><br><span class="line"><span class="bullet">   -</span> <span class="string">test2</span></span><br><span class="line"><span class="bullet">   -</span> <span class="string">test3</span></span><br><span class="line"></span><br><span class="line"><span class="attr">cache:</span></span><br><span class="line"><span class="attr">   key:</span> <span class="string">"$CI_COMMIT_REF_SLUG"</span></span><br><span class="line"><span class="attr">   paths:</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">Test.txt</span></span><br><span class="line"></span><br><span class="line"><span class="attr">job1:</span></span><br><span class="line"><span class="attr">   stage:</span> <span class="string">test1</span></span><br><span class="line"><span class="attr">   script:</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">cat</span> <span class="string">Test.txt</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">echo</span> <span class="string">"aaaaaaaaaa"</span> <span class="string">&gt; Test.txt</span></span><br><span class="line"><span class="string">     - cat Test.txt</span></span><br><span class="line"><span class="string"></span><span class="attr">   tags:</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">base-runner</span></span><br><span class="line"></span><br><span class="line"><span class="attr">job2:</span></span><br><span class="line"><span class="attr">   stage:</span> <span class="string">test2</span></span><br><span class="line"><span class="attr">   cache:</span></span><br><span class="line"><span class="attr">     key:</span> <span class="string">"$CI_COMMIT_REF_SLUG"</span></span><br><span class="line"><span class="attr">     paths:</span></span><br><span class="line"><span class="bullet">       -</span> <span class="string">Test.txt</span></span><br><span class="line"><span class="attr">     policy:</span> <span class="string">pull</span>  <span class="comment">#å…³æ³¨ç‚¹</span></span><br><span class="line"><span class="attr">   script:</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">cat</span> <span class="string">Test.txt</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">echo</span> <span class="string">"bbbbbbbbbbb"</span> <span class="string">&gt;&gt;</span> <span class="string">Test.txt</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">cat</span> <span class="string">Test.txt</span></span><br><span class="line"><span class="attr">   tags:</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">base-runner</span></span><br><span class="line"></span><br><span class="line"><span class="attr">job3:</span></span><br><span class="line"><span class="attr">   stage:</span> <span class="string">test3</span></span><br><span class="line"><span class="attr">   script:</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">ls</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">cat</span> <span class="string">Test.txt</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">echo</span> <span class="string">"cccccccc"</span> <span class="string">&gt;&gt;</span> <span class="string">Test.txt</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">cat</span> <span class="string">Test.txt</span></span><br><span class="line"><span class="attr">   tags:</span></span><br><span class="line"><span class="bullet">     -</span> <span class="string">base-runner</span></span><br></pre></td></tr></table></figure></p>
<p>(2) æ‰§è¡Œç»“æœ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#job1 ç»“æœ</span></span><br><span class="line">Checking cache <span class="keyword">for</span> <span class="built_in">test</span>-wer-1...</span><br><span class="line"><span class="comment">#é¦–æ¬¡æ£€æŸ¥ç¼“å­˜æœªå­˜åœ¨è¿›è¡Œåˆ›å»ºç¼“å­˜</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"aaaaaaaaaa"</span> &gt; Test.txt</span><br><span class="line">$ cat Test.txt</span><br><span class="line">aaaaaaaaaa</span><br><span class="line">Creating cache <span class="built_in">test</span>-wer-1...</span><br><span class="line">Test.txt: found 1 matching files                                  </span><br><span class="line">Uploading cache.zip to http://192.168.12.139:9000/runner/cache-path/project/1242/<span class="built_in">test</span>-wer-1   <span class="comment">#ä¸Šä¼  cache è·¯å¾„</span></span><br><span class="line">Created cache</span><br><span class="line">Job succeeded</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#job2 ç»“æœ</span></span><br><span class="line">Checking cache <span class="keyword">for</span> <span class="built_in">test</span>-wer-1...</span><br><span class="line">cache.zip is up to date  <span class="comment">#ç¼“å­˜è¿›è¡Œäº†ä¸‹è½½              </span></span><br><span class="line">Successfully extracted cache</span><br><span class="line">$ cat Test.txt</span><br><span class="line">aaaaaaaaaa</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"bbbbbbbbbb"</span> &gt;&gt; Test.txt</span><br><span class="line">$ cat Test.txt</span><br><span class="line">aaaaaaaaaa</span><br><span class="line">bbb</span><br><span class="line">Not uploading cache <span class="built_in">test</span>-wer-1 due to policy <span class="comment"># pullç­–ç•¥ä¸ä¸Šä¼ ç¼“å­˜</span></span><br><span class="line">Job succeeded</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#job3 ç»“æœ</span></span><br><span class="line">Checking cache <span class="keyword">for</span> <span class="built_in">test</span>-wer-1...</span><br><span class="line">cache.zip is up to date                            </span><br><span class="line">Successfully extracted cache</span><br><span class="line">$ cat Test.txt</span><br><span class="line">aaaaaaaaaa</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"ccccccccc"</span> &gt;&gt; Test.txt</span><br><span class="line">$ cat Test.txt</span><br><span class="line">aaaaaaaaaa</span><br><span class="line">ccccccccc</span><br><span class="line">Creating cache <span class="built_in">test</span>-wer-1...</span><br><span class="line">Test.txt: found 1 matching files                </span><br><span class="line">22.txt: found 1 matching files                     </span><br><span class="line">Uploading cache.zip to http://192.168.12.139:9000/runner/cache-path/project/1242/<span class="built_in">test</span>-wer-1  <span class="comment">#ä¸Šä¼  cache è·¯å¾„</span></span><br><span class="line">Created cache</span><br><span class="line">Job succeeded</span><br></pre></td></tr></table></figure><br>æ€»ç»“:</p>
<ul>
<li>job2 è·å–åˆ°ç¼“å­˜æ–‡ä»¶ Test.txt çš„æ–‡ä»¶å†…å®¹æ˜¯ job1 æ‰§è¡Œåçš„ç»“æœï¼Œè¯´æ˜ job1 å’Œ job2 ä¹‹é—´å®ç°äº†ç¼“å­˜å…±äº«</li>
<li>job3 è·å–åˆ°ç¼“å­˜æ–‡ä»¶ Test.txt çš„æ–‡ä»¶ä¸ job1 æ‰§è¡Œåå†…å®¹ä¸€è‡´è€Œé job2ï¼Œè¿™æ˜¯å› ä¸º job2 æ‰§è¡Œåçš„ç»“æœæ²¡æœ‰è¿›è¡Œä¸Šä¼ </li>
<li>ç‰¹åˆ«æ³¨æ„çš„æ˜¯ job1 åœ¨æ‰§è¡Œä»»åŠ¡å‰è·å–åˆ°çš„ Test.txt çš„æ–‡ä»¶ä¸ job3 æ‰§è¡Œå®Œçš„ç»“æœä¸€è‡´ï¼Œè¿™æ˜¯å› ä¸ºè¿™ä¸ª pipeline æˆ‘è¿è¡Œäº†å¤šæ¬¡ï¼Œjob1 è·å–çš„ç¼“å­˜æ˜¯ä¸Šä¸€æ¬¡ pipeline ä¸­ job3 çš„æ‰§è¡Œåçš„ç¼“å­˜ç»“æœã€‚è¯´æ˜ cache åœ¨ä¸åŒæ¬¡ pipeline ä¹‹é—´ä¹Ÿå®ç°äº†å…±äº«</li>
</ul>
<hr>
<h2 id="0x02-GitLab-Runner-è¡¥å……"><a href="#0x02-GitLab-Runner-è¡¥å……" class="headerlink" title="0x02 GitLab Runner è¡¥å……"></a>0x02 GitLab Runner è¡¥å……</h2><h3 id="1-Kubernetes-ç¯å¢ƒä¸­å®‰è£…-Runner"><a href="#1-Kubernetes-ç¯å¢ƒä¸­å®‰è£…-Runner" class="headerlink" title="1.Kubernetes ç¯å¢ƒä¸­å®‰è£… Runner"></a>1.Kubernetes ç¯å¢ƒä¸­å®‰è£… Runner</h3><p>æè¿°: é™¤å¼€åœ¨å®¿ä¸»æœºä»¥åŠDockerä¸­è¿è¡ŒRunneræˆ‘ä»¬è¿˜å¯ä»¥å°†å…¶è¿è¡Œåœ¨Kubernetesé›†ç¾¤ä¹‹ä¸­ï¼Œä¸‹é¢å°†ä½¿ç”¨ Helm å›¾è¡¨æ–¹å¼å°†GitLab Runner å®ä¾‹éƒ¨ç½²åˆ° Kubernetes é›†ç¾¤ã€‚</p>
<p><strong>ç¯å¢ƒè¦æ±‚</strong></p>
<ul>
<li>Kubernetes ç¯å¢ƒ (V1.23.x)</li>
<li>kubectl å®¢æˆ·ç«¯å·¥å…·</li>
<li>Helm å®¢æˆ·ç«¯å·¥å…· (æ­¤å¤„ä¸ºHelm 3.xç‰ˆæœ¬)</li>
</ul>
<p><strong>ä½¿ç”¨ Helm Chart å¿«é€Ÿå®‰è£… GitLab Runner</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.æ·»åŠ  GitLab Helm å­˜å‚¨åº“å¹¶æ›´æ–°ç´¢å¼•</span></span><br><span class="line">helm repo add gitlab https://charts.gitlab.io</span><br><span class="line">helm repo update</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æŸ¥çœ‹ gitlab-runner ç‰ˆæœ¬ä»¥åŠå…¶ Helm values</span></span><br><span class="line">helm search repo gitlab-runner           <span class="comment"># æœ€æ–°ç‰ˆæœ¬</span></span><br><span class="line">helm search repo -l gitlab/gitlab-runner <span class="comment"># æ‰€æœ‰ç‰ˆæœ¬</span></span><br><span class="line">  <span class="comment"># NAME                    CHART VERSION   APP VERSION     DESCRIPTION</span></span><br><span class="line">  <span class="comment"># gitlab/gitlab-runner    0.41.0          15.0.0          GitLab Runner</span></span><br><span class="line">helm show values gitlab/gitlab-runner --version 0.41.0 &gt; gitlab-runner.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æŒ‰ç…§éœ€è¦ä¿®æ”¹è¯¥å›¾è¡¨çš„é…ç½®</span></span><br><span class="line"><span class="comment"># https://docs.gitlab.com/runner/install/kubernetes.html#configuring-gitlab-runner-using-the-helm-chart</span></span><br><span class="line">$ egrep -v <span class="string">"^$|^#|^[[:space:]]+#"</span> gitlab-runner.yaml</span><br><span class="line">imagePullPolicy: IfNotPresent</span><br><span class="line"><span class="comment"># å…³é”®ç‚¹.ç§æœ‰ä»“åº“è®¤è¯ç¥¨æ®</span></span><br><span class="line">imagePullSecrets:</span><br><span class="line">- name: <span class="string">"harbor-cloud-secret"</span></span><br><span class="line"><span class="comment"># å…³é”®ç‚¹.ç§æœ‰ä»“åº“åœ°å€</span></span><br><span class="line">gitlabUrl: http://gitlab.weiyigeek.top</span><br><span class="line"><span class="comment"># å…³é”®ç‚¹.ç§æœ‰ä»“åº“runneræ³¨å†ŒToken</span></span><br><span class="line">runnerRegistrationToken: <span class="string">"gu8nqhPNZXJ8xZxotTPr"</span></span><br><span class="line">terminationGracePeriodSeconds: 3600</span><br><span class="line">concurrent: 10</span><br><span class="line">checkInterval: 30</span><br><span class="line">logLevel: error</span><br><span class="line">sessionServer:</span><br><span class="line">  enabled: <span class="literal">false</span></span><br><span class="line">rbac:</span><br><span class="line">  <span class="comment"># å…³é”®ç‚¹.å»ºè®®è®¾ç½®ä¸ºtrueå¯ç”¨rbac</span></span><br><span class="line">  create: <span class="literal">true</span></span><br><span class="line">  rules: []</span><br><span class="line">  clusterWideAccess: <span class="literal">false</span></span><br><span class="line">  podSecurityPolicy:</span><br><span class="line">    enabled: <span class="literal">false</span></span><br><span class="line">    resourceNames:</span><br><span class="line">    - gitlab-runner</span><br><span class="line">metrics:</span><br><span class="line">  enabled: <span class="literal">false</span></span><br><span class="line">  portName: metrics</span><br><span class="line">  port: 9252</span><br><span class="line">  serviceMonitor:</span><br><span class="line">    enabled: <span class="literal">false</span></span><br><span class="line">service:</span><br><span class="line">  enabled: <span class="literal">false</span></span><br><span class="line">  <span class="built_in">type</span>: ClusterIP</span><br><span class="line">runners:</span><br><span class="line">  config: |</span><br><span class="line">    [[runners]]</span><br><span class="line">      [runners.kubernetes]</span><br><span class="line">        namespace = <span class="string">"&#123;&#123;.Release.Namespace&#125;&#125;"</span></span><br><span class="line">        image = <span class="string">"ubuntu:20.04"</span></span><br><span class="line">  cache: &#123;&#125;</span><br><span class="line">  builds: &#123;&#125;</span><br><span class="line">  services: &#123;&#125;</span><br><span class="line">  helpers: &#123;&#125;</span><br><span class="line">  nodeSelector: &#123;&#125;</span><br><span class="line">securityContext:</span><br><span class="line">  runAsUser: 100</span><br><span class="line">  fsGroup: 65533</span><br><span class="line">resources: &#123;&#125;</span><br><span class="line">affinity: &#123;&#125;</span><br><span class="line"><span class="comment"># ä¿®æ”¹ç‚¹.æ­¤å¤„æŒ‡å®šèŠ‚ç‚¹è¿è¡Œ</span></span><br><span class="line">nodeSelector:</span><br><span class="line">  kubernetes.io/hostname: weiyigeek-226</span><br><span class="line">tolerations: []</span><br><span class="line">hostAliases: []</span><br><span class="line">podAnnotations: &#123;&#125;</span><br><span class="line">podLabels: &#123;&#125;</span><br><span class="line">secrets: []</span><br><span class="line">configMaps: &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.å¦‚æœæ˜¯éœ€è¦é’±ç§æœ‰ä»“åº“ä¸­çš„é•œåƒï¼Œéœ€è¦é¦–å…ˆåˆ›å»ºä¸€ä¸ª docker-registry ç±»å‹çš„ Secret ã€‚</span></span><br><span class="line">kubectl create secret docker-registry harbor-cloud-secret \</span><br><span class="line">--docker-server=harbor-cloud \</span><br><span class="line">--docker-username=weiyigeek \</span><br><span class="line">--docker-password=WWW.weiyigeek.top \</span><br><span class="line">--namespace=devops</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.å®‰è£… GitLab Runner åˆ°K8Sé›†ç¾¤</span></span><br><span class="line"><span class="comment"># For Helm 3</span></span><br><span class="line"><span class="comment"># $ helm install --namespace &lt;NAMESPACE&gt; gitlab-runner -f &lt;CONFIG_VALUES_FILE&gt; gitlab/gitlab-runner</span></span><br><span class="line">  <span class="comment"># * &lt;NAMESPACE&gt; æ˜¯è¦åœ¨å…¶ä¸­å®‰è£… GitLab Runner çš„ Kubernetes å‘½åç©ºé—´ã€‚</span></span><br><span class="line">  <span class="comment"># * &lt;CONFIG_VALUES_FILE&gt; æ˜¯åŒ…å«è‡ªå®šä¹‰é…ç½®çš„å€¼æ–‡ä»¶çš„è·¯å¾„ã€‚</span></span><br><span class="line">$ helm install --namespace devops gitlab-runner --version 0.41.0  -f ./gitlab-runner.yaml gitlab/gitlab-runner</span><br><span class="line">  <span class="comment"># NAME: gitlab-runner</span></span><br><span class="line">  <span class="comment"># LAST DEPLOYED: Mon Jun  6 16:01:00 2022</span></span><br><span class="line">  <span class="comment"># NAMESPACE: devops</span></span><br><span class="line">  <span class="comment"># STATUS: deployed</span></span><br><span class="line">  <span class="comment"># REVISION: 1</span></span><br><span class="line">  <span class="comment"># TEST SUITE: None</span></span><br><span class="line">  <span class="comment"># NOTES:</span></span><br><span class="line">  <span class="comment"># Your GitLab Runner should now be registered against the GitLab instance reachable at: "http://gitlab.weiyigeek.top"</span></span><br><span class="line">  <span class="comment"># Runner namespace "devops" was found in runners.config template.</span></span><br><span class="line"></span><br><span class="line">$ helm upgrade --namespace devops gitlab-runner --version 0.41.0  -f ./gitlab-runner.yaml gitlab/gitlab-runner</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.éªŒè¯å®‰è£…çŠ¶æ€</span></span><br><span class="line">kubectl get pod -n devops -l app=gitlab-runner</span><br><span class="line">  <span class="comment"># NAME                             READY   STATUS    RESTARTS   AGE</span></span><br><span class="line">  <span class="comment"># gitlab-runner-6685dc55bd-86l2h   1/1     Running   0          15m</span></span><br></pre></td></tr></table></figure></p>
<p>åœ¨å®Œæˆä¸Šè¿°æ“ä½œä¹‹åæˆ‘ä»¬ä¾¿å¯åœ¨<code>ç®¡ç†ä¸­å¿ƒ-&gt;Runner</code>ä¸­æŸ¥çœ‹åˆ°æ³¨å†Œçš„<code>gitlab-runner-6685dc55bd-86l2h</code>äº†, å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br><figure class="image-box">
                <a rel=1.åŸºäºGitLabä»£ç ä»“åº“çš„æŒç»­é›†æˆåŸºç¡€é…ç½®å’Œä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220606161747.png" target="_blank" title="WeiyiGeek.gitlab-runneræ³¨å†ŒæˆåŠŸ" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220606161747.png" alt="WeiyiGeek.gitlab-runneræ³¨å†ŒæˆåŠŸ" title="" class=""></a>
                <p>WeiyiGeek.gitlab-runneræ³¨å†ŒæˆåŠŸ</p>
            </figure></p>
<p>æ­¤æ—¶ä½ ä¼šå‘ç°å…¶å¤„äºä¸é€‚ç”¨çŠ¶æ€ï¼Œå³Gité¡¹ç›®ä¸­çš„æµæ°´çº¿æ— æ³•ä½¿ç”¨è¯¥æ³¨å†ŒRunnerï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è¿›è¡ŒæŒ‡å®šGité¡¹ç›®è¿›è¡Œè°ƒç”¨è¯¥Runnerï¼ˆå³Runnerå°†è¿è¡ŒæŒ‡å®šé¡¹ç›®çš„ä½œä¸šï¼‰ï¼Œå¹¶ä¸”ä¸ºå…¶è®¾ç½®devtestæ ‡ç­¾ã€‚</p>
<figure class="image-box">
                <a rel=1.åŸºäºGitLabä»£ç ä»“åº“çš„æŒç»­é›†æˆåŸºç¡€é…ç½®å’Œä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220606163104.png" target="_blank" title="WeiyiGeek.Runnerè¿è¡ŒæŒ‡å®šé¡¹ç›®çš„ä½œä¸š" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220606163104.png" alt="WeiyiGeek.Runnerè¿è¡ŒæŒ‡å®šé¡¹ç›®çš„ä½œä¸š" title="" class=""></a>
                <p>WeiyiGeek.Runnerè¿è¡ŒæŒ‡å®šé¡¹ç›®çš„ä½œä¸š</p>
            </figure>
<p><br/></p>
<p>æœ€åéªŒè¯è¯¥runneræ˜¯å¦èƒ½è¿è¡ŒæŒ‡å®šæµæ°´çº¿çš„ä½œä¸š, æ¸©é¦¨æç¤ºä¸ºäº†èƒ½åœ¨runneræµæ°´çº¿ä¸­æ‹‰å–è¯¥é¡¹ç›®ä»£ç , ä½ éœ€è¦å°†æäº¤ç”¨æˆ·åŠ å…¥åˆ°é¡¹ç›®æˆå‘˜ä¸­(<code>æ­¤å¤„æ¼”ç¤ºé¡¹ç›®ä¸ºrootç”¨æˆ·å…¶æƒé™ä¸ºGuest</code>)ï¼Œå¦åˆ™ä¼šæŠ¥æ²¡æœ‰æƒé™æ‹‰å–é¡¹ç›®çš„é”™è¯¯ã€‚</p>
<p>æ­¥éª¤01.é¦–å…ˆåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­åˆ›å»º<code>.gitlab-ci.yml</code>æ–‡ä»¶,å‡è®¾å…¶å†…å®¹å¦‚ä¸‹:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .gitlab-ci.yml</span></span><br><span class="line"><span class="attr">stages:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">test</span></span><br><span class="line"></span><br><span class="line"><span class="attr">default:</span></span><br><span class="line"><span class="attr">  image:</span> <span class="attr">alpine:3.16</span></span><br><span class="line"><span class="attr">  before_script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">uname</span> <span class="bullet">-a</span> <span class="string">&amp;&amp;</span> <span class="string">id</span> </span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"WeiyiGeek"</span> <span class="string">&gt; user.logs &amp;&amp; date -R &gt;&gt; user.logs</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string"></span><span class="attr">Test:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="bullet">-e</span> <span class="string">"# Test Stage"</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"https://www.weiyigeek.top"</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">cat</span> <span class="string">user.logs</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">devtest</span></span><br></pre></td></tr></table></figure></p>
<p>æ¸©é¦¨æç¤º: æ³¨æ„æµæ°´çº¿è„šæœ¬ä¸­çš„tagså€¼éœ€è¦ä¸runneræ ‡ç­¾å€¼è¿›è¡Œå¯¹åº”, è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥åœ¨ä¸åŒçš„runnerç¯å¢ƒä¸­æ‰§è¡ŒæŒ‡å®šé˜¶æ®µçš„æµæ°´çº¿è„šæœ¬ã€‚</p>
<p><br/></p>
<p>æ­¥éª¤ 02.é»˜è®¤æäº¤åå°†ä¼šè§¦å‘CICD, æ­¤æ—¶æˆ‘ä»¬å¯è¿”å›K8S Masterçš„shellç»ˆç«¯è¿›è¡ŒæŸ¥çœ‹æµæ°´çº¿æ˜¯å¦æ­£å¸¸è¿è¡Œ, å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡é¡¹ç›®æµæ°´çº¿è¿›è¡ŒæŸ¥çœ‹ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Runnerä¸ºæµæ°´çº¿ä½œä¸šç”Ÿæˆçš„ runner-ijlvfrnc-project-75-concurrent-0rl7cg å·¥ä½œPod</span></span><br><span class="line">~$ kubectl get pod -n devops -o wide</span><br><span class="line">NAME                                           READY   STATUS            RESTARTS         AGE     IP              NODE       NOMINATED NODE   READINESS GATES</span><br><span class="line">gitlab-runner-85bbdc5954-zmddx                 1/1     Running           0                20h     10.66.182.214   </span><br><span class="line">runner-ijlvfrnc-project-75-concurrent-0rl7cg   0/2     PodInitializing   0                3s      10.66.182.235</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=1.åŸºäºGitLabä»£ç ä»“åº“çš„æŒç»­é›†æˆåŸºç¡€é…ç½®å’Œä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220607135645.png" target="_blank" title="WeiyiGeek.æµ‹è¯•Runnerè¿›è¡Œæµæ°´çº¿å·¥ä½œç»“æœ" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220607135645.png" alt="WeiyiGeek.æµ‹è¯•Runnerè¿›è¡Œæµæ°´çº¿å·¥ä½œç»“æœ" title="" class=""></a>
                <p>WeiyiGeek.æµ‹è¯•Runnerè¿›è¡Œæµæ°´çº¿å·¥ä½œç»“æœ</p>
            </figure>
<p>æ¸©é¦¨æç¤º: å¦‚æœæœªåœ¨ä¸Šè¿°<code>gitlab-runner.yaml</code>å›¾è¡¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®<code>image: gitlab/gitlab-runner</code>å°†é»˜è®¤é‡‡ç”¨æŒ‡å®šç‰ˆæœ¬å¯¹åº”çš„<code>gitlab-runner</code>é•œåƒ,æ‰€ä»¥æ­¤å¤„é•œåƒä¸º<code>image: gitlab/gitlab-runner:alpine-v15.0.0</code>ã€‚</p>
<hr>
<h2 id="0x0n-å…¥å‘å‡ºå‘"><a href="#0x0n-å…¥å‘å‡ºå‘" class="headerlink" title="0x0n å…¥å‘å‡ºå‘"></a>0x0n å…¥å‘å‡ºå‘</h2><p><strong>é—®é¢˜1.å‘Gitlab-CIè¿›è¡Œæ³¨å†ŒRunneræ—¶å€™æç¤º<code>Failed to register this runner. Perhaps you are having network problems</code></strong><br>é—®é¢˜å…³é”®å­—:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ERROR: Registering runner... failed runner=qRGh2M86 status=500 Internal Server Error</span><br><span class="line">PANIC: Failed to register this runner. Perhaps you are having network problems</span><br></pre></td></tr></table></figure><br>åŸå› :å› ä¸º Gitlab é»˜è®¤ç¦æ­¢äº†ç§æœ‰ç½‘æ®µ IP é‡Œçš„ API è¯·æ±‚ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯æ‰è¡Œã€‚<br>è§£å†³åŠæ³•: ä¿®æ”¹ gitlab é»˜è®¤ç½‘ç»œè®¾ç½® æˆ–è€… ç™½åå•ä»¥å…è®¸æ¥è‡ªé’©å­å’ŒæœåŠ¡çš„å¯¹æœ¬åœ°ç½‘ç»œçš„è¯·æ±‚(<code>çº¿ä¸Šç¯å¢ƒæ¨è</code>)ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ­¤å¤„ä»¥ç¬¬ä¸€ç§æ–¹å¼ä¸ºåˆ—</span></span><br><span class="line">ä½¿ç”¨ root ç”¨æˆ·ä» web ç«¯ç™»å½•åˆ° gitlab ç®¡ç†ä¸­å¿ƒ http://<span class="variable">$&#123;ip&#125;</span>/admin ã€‚ç®¡ç†ä¸­å¿ƒ --&gt; è®¾ç½® --&gt; ç½‘ç»œ â€“&gt; å¤–å‘è¯·æ±‚</span><br><span class="line"><span class="comment">#è®¾ç½®å¦‚ä¸‹</span></span><br><span class="line">* å‹¾é€‰ å…è®¸Webhookå’ŒæœåŠ¡å¯¹æœ¬åœ°ç½‘ç»œçš„è¯·æ±‚</span><br><span class="line">* å‹¾é€‰ å…è®¸ç³»ç»Ÿé’©å­å‘æœ¬åœ°ç½‘ç»œå‘é€çš„è¯·æ±‚</span><br></pre></td></tr></table></figure></p>
<ul>
<li>è¡¥å…… <code>[2020å¹´4æœˆ17æ—¥ 22:53:44]</code> æ—¶é—´:<blockquote>
<p>å¦‚æœç‚¹å‡» <code>ä¿å­˜ä¿®æ”¹</code> ä¹‹åå°±è·³è½¬åˆ° Gitlab 500 é”™è¯¯çš„é¡µé¢ã€‚<br>å°è¯•åœ¨ç®¡ç†ä¸­å¿ƒä¿®æ”¹å…¶ä»–è®¾ç½®ä¿å­˜æ—¶ï¼Œä¹Ÿä¼šå‡ºç° 500 çš„æƒ…å†µã€‚<br>åœ¨å®‰è£… gitlab çš„æœºå™¨ä¸ŠæŸ¥çœ‹ä¸€ä¸‹æ—¥å¿—ã€‚è¿è¡Œ gitlab-ctl tail æŸ¥çœ‹å®æ—¶çš„æ—¥å¿—ã€‚<br>æ­¤æ—¶ç­‰åˆ°æ—¥å¿—è¾“å‡ºå‡æ…¢çš„æ—¶å€™æˆ‘ä»¬å¤šæŒ‰å‡ ä¸‹å›è½¦ï¼Œç„¶åå°±ç«‹å³å»ç‚¹å‡» ä¿å­˜ä¿®æ”¹ æŒ‰é’®ï¼Œè¿™æ ·å°±èƒ½æ•æ‰åˆ°æ­¤åˆ»çš„é”™è¯¯æ—¥å¿—ã€‚</p>
</blockquote>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">==&gt; /var/<span class="built_in">log</span>/gitlab/gitlab-rails/production.log &lt;==</span><br><span class="line">Started PATCH <span class="string">"/admin/application_settings/network"</span> <span class="keyword">for</span> 10.0.30.2 at 2020-03-10 11:08:20 +0000</span><br><span class="line">Processing by Admin::ApplicationSettingsController<span class="comment">#network as HTML</span></span><br><span class="line">Parameters: &#123;<span class="string">"utf8"</span>=&gt;<span class="string">"âœ“"</span>, <span class="string">"authenticity_token"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"application_setting"</span>=&gt;</span><br><span class="line">&#123;<span class="string">"allow_local_requests_from_web_hooks_and_services"</span>=&gt;<span class="string">"[FILTERED]"</span>,</span><br><span class="line"><span class="string">"allow_local_requests_from_system_hooks"</span>=&gt;<span class="string">"[FILTERED]"</span>, <span class="string">"outbound_local_requests_whitelist_raw"</span>=&gt;<span class="string">""</span>,</span><br><span class="line"><span class="string">"dns_rebinding_protection_enabled"</span>=&gt;<span class="string">"1"</span>&#125;&#125;</span><br><span class="line">Completed 500 Internal Server Error <span class="keyword">in</span> 40ms (ActiveRecord: 14.5ms | Elasticsearch: 0.0ms)</span><br><span class="line">OpenSSL::Cipher::CipherError ():</span><br><span class="line">lib/gitlab/crypto_helper.rb:27:<span class="keyword">in</span> `aes256_gcm_decrypt<span class="string">'</span></span><br><span class="line"><span class="string">==&gt; /var/log/gitlab/gitlab-rails/production_json.log &lt;==</span></span><br><span class="line"><span class="string">&#123;"method":"PATCH","path":"/admin/application_settings/network","format":"html","controller":"Admin::</span></span><br><span class="line"><span class="string">ApplicationSettingsController","action":"network","status":500,"error":"OpenSSL::Cipher::CipherError</span></span><br><span class="line"><span class="string">: ","duration":40.08,"view":0.0,"db":14.47,"time":"2020-03-10T11:08:20.061Z","params":</span></span><br><span class="line"><span class="string">[&#123;"key":"utf8","value":"âœ“"&#125;,&#123;"key":"_method","value":"patch"&#125;,&#123;"key":"authenticity_token","value":"</span></span><br><span class="line"><span class="string">[FILTERED]"&#125;,&#123;"key":"application_setting","value":</span></span><br><span class="line"><span class="string">&#123;"allow_local_requests_from_web_hooks_and_services":"</span></span><br><span class="line"><span class="string">[FILTERED]","allow_local_requests_from_system_hooks":"</span></span><br><span class="line"><span class="string">[FILTERED]","outbound_local_requests_whitelist_raw":"","dns_rebinding_protection_enabled":"1"&#125;&#125;],"re</span></span><br><span class="line"><span class="string">mote_ip":"10.0.30.2","user_id":1,"username":"root","ua":"Mozilla/5.0 (Windows NT 10.0; Win64; x64)</span></span><br><span class="line"><span class="string">AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.87</span></span><br><span class="line"><span class="string">Safari/537.36","queue_duration":2.55,"correlation_id":"9rvflpksdj2"&#125;</span></span><br></pre></td></tr></table></figure>
<p>é”™è¯¯å…³é”®ä¿¡æ¯: <code>OpenSSL::Cipher::CipherError ():</code><br>é”™è¯¯åŸå› : åº”è¯¥æ˜¯é‡æ–°å®‰è£… Gitlab ä¹‹åçš„åŠ å¯†ä¿¡æ¯ä¸å¯¹æ‰€è‡´ æˆ–è€… ç”±äºè¿ç§»å¯¼å…¥é¡¹ç›®åï¼Œæ²¡æœ‰å¯¼å…¥åŸæ¥çš„åŠ å¯†ä¿¡æ¯ /etc/gitlab/gitlab-secrets.json ï¼Œ ä½†æ˜¯åŸæ¥çš„åŠ å¯†ä¿¡æ¯æ–‡ä»¶æˆ‘å·²ç»æ‰¾ä¸åˆ°äº†ï¼Œåé¢å‘ç°å¯ä»¥ç›´æ¥é‡ç½®å°±è¡Œäº†;<br>è§£å†³åŠæ³•:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å‘½ä»¤è¡Œè¾“å…¥ gitlab-rails console ï¼Œç„¶åè¾“å…¥ApplicationSetting.current reset_runners_registration_token! å³å¯ï¼Œè¿™æ ·åœ¨ä¿å­˜ä¿®æ”¹çš„æ—¶å€™å°±ä¸ä¼šå†æŠ¥ 500çš„é—®é¢˜äº†ã€‚</span></span><br><span class="line">â•­â”€root@gitlab ~</span><br><span class="line">â•°â”€<span class="comment"># gitlab-rails console</span></span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">GitLab: 12.3.5 (2417d5becc7)</span><br><span class="line">GitLab Shell: 10.0.0</span><br><span class="line">PostgreSQL: 10.9</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Loading production environment (Rails 5.2.3)</span><br><span class="line">irb(main):001:0&gt; ApplicationSetting.current.reset_runners_registration_token!</span><br><span class="line">=&gt; <span class="literal">true</span></span><br><span class="line">irb(main):002:0&gt; <span class="built_in">exit</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<ul>
<li>è¡¥å…… <code>[2020å¹´3æœˆ14æ—¥ 21:31:04]</code> æ—¶é—´:<br>æŠ¥é”™ä¿¡æ¯ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR: Registering runner... failed runner=xxxxxxx status=couldn<span class="string">'t execute POST against https://x.x.x.x/api/v4/runners: Post https://x.x.x.x/api/v4/runners: x509: cannot validate certificate for x.x.x.x because it doesn'</span>t contain any IP SANs</span><br></pre></td></tr></table></figure>
åŸå› ï¼šgitlabä½¿ç”¨è‡ªç­¾åè¯ä¹¦æ—¶ï¼Œæ³¨å†Œæ—¶éœ€è¦ä½¿ç”¨å¯¹åº”çš„caæ ¹è¯ä¹¦éªŒè¯ã€‚<br>è§£å†³æ–¹æ¡ˆï¼šæ³¨å†Œæ—¶ä¹Ÿéœ€è¦ä½¿ç”¨<code>&quot;--tls-ca-file&quot;</code>å‚æ•°ï¼ŒæŒ‡å®šè‡ªç­¾åçš„caæ ¹è¯ä¹¦ã€‚</li>
</ul>
<p><br></p>
<p><strong>é—®é¢˜2.é¡¹ç›®è¿›è¡Œè¿è¡ŒGitlab-CIæµæ°´çº¿ä¸Šçš„æ—¶å€™æŠ¥é”™:æ­¤ä½œä¸šè¢«å¡ä½ï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½•è¯¥é¡¹ç›®æŒ‡å®šæ ‡ç­¾çš„ runner åœ¨çº¿`</strong><br>åŸå› :ç”±äºæˆ‘ä»¬å†å†™ç”¨.gitlab-ci.ymlé…ç½®æ—¶å€™æœªåœ¨å„ä¸ªé˜¶æ®µä¸‹åŠ å…¥æŒ‡å®šçš„Runneræ ‡ç­¾;<br>è§£å†³åŠæ³•1:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">build:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">build</span></span><br><span class="line"><span class="attr">  script:</span> <span class="string">echo</span> <span class="string">"Building the app"</span></span><br><span class="line">  <span class="comment">#å‘Šè¯‰ Runner æˆ‘ä»¬åº”ç”¨å“ªä¸ªæ ‡ç­¾</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">TestRunner</span></span><br></pre></td></tr></table></figure><br>è§£å†³æ–¹æ³•2ï¼šè¿è¡Œæœªæ ‡è®°çš„ä½œä¸šè¿›è¡Œ<code>å‹¾é€‰</code>æŒ‡ç¤ºæ­¤runneræ˜¯å¦å¯ä»¥é€‰æ‹©æ— æ ‡è®°çš„ä½œä¸šï¼Œæ­¤æ—¶gitlab-ci.yamlå°†å¯ä»¥ä¸ç”¨è®¾ç½®tagsæ ‡ç­¾;</p>
<ul>
<li>è¡¥å…… <code>[2020å¹´3æœˆ14æ—¥ 21:31:04]</code> æ—¶é—´:<br>æŠ¥é”™ä¿¡æ¯ï¼š<code>Post https://x.x.x.x/api/v4/runners: x509: certificate signed by unknown authority</code><br>åŸå› ï¼šæ³¨å†Œrunneræ—¶ï¼Œå¦‚æœè®¾ç½®äº†â€â€“tag-listâ€ï¼Œåˆ™â€â€“run-untaggedâ€é»˜è®¤ä¸ºâ€falseâ€ï¼ŒåŒæ—¶é—´.gitlab-ci.ymlä¸­çš„jobæœªæŒ‡å®štagè§¦å‘æ­¤æŠ¥é”™ã€‚<br>è§£å†³æ–¹æ¡ˆï¼šæ³¨å†Œæ—¶ï¼Œâ€â€“run-untaggedâ€å‚æ•°è®¾ç½®ä¸ºâ€trueâ€ï¼›æˆ–è€…åœ¨å·²æ³¨å†Œçš„runnerä¸­ä¿®æ”¹å‹¾é€‰<code>&quot; Indicates whether this runner can pick jobs without tags&quot;</code>æˆ–è€….gitlab-ci.ymlä¸­çš„jobæŒ‡å®štagã€‚</li>
</ul>
<p><br></p>
<p><strong>é—®é¢˜3.Runneré‡‡ç”¨dockerä½œä¸ºexecutoræ—¶ï¼Œæ— æ³•build docker image æç¤ºdial unix /var/run/docker.sock: connect: permission denied</strong><br>åŸå› ï¼šgitlab-runnerè´¦å·æƒé™ä¸è¶³ï¼Œä¸èƒ½è®¿é—®/var/run/docker.sockã€‚<br>è§£å†³æ–¹æ¡ˆï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.å°†gitlab-runnerç”¨æˆ·åŠ å…¥dockerç»„</span></span><br><span class="line"><span class="variable">$usermod</span> -aG docker gitlab-runner</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.gitlab-runneråŠ å…¥çš„ç»„å‡ºç°dockerå³æ²¡é—®é¢˜</span></span><br><span class="line"><span class="variable">$groups</span> gitlab-runner</span><br><span class="line">gitlab-runner : gitlab-runner docker</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>é—®é¢˜4.Peerâ€™s Certificate issuer is not recognized.</strong><br>æŠ¥é”™ä¿¡æ¯ï¼š<code>fatal: unable to access &#39;https://gitlab-ci-token:xxxxxxxxxxxxxxxxxxxx@gitlab.x.com/root/cmop.git/&#39;: Peer&#39;s Certificate issuer is not recognized.</code><br>åŸå› ï¼šgitlab-runneræ‹‰å–ä»£ç æ—¶ï¼Œä½¿ç”¨httpsåè®®è®¿é—®gitlabï¼Œéœ€è¦éªŒè¯ã€‚<br>è§£å†³æ–¹æ¡ˆï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å› runnerè¿è¡Œæ—¶çš„æ‰§è¡Œè€…æ˜¯gitlab-runnerè´¦æˆ·ï¼Œéœ€è¦åœ¨gitlab-runnerè´¦å·ä¸‹è®¾ç½®è®¿é—®httpsç±»ç½‘ç«™æ—¶ï¼Œå…éªŒè¯</span></span><br><span class="line">[root@gitlab-runner ~]<span class="comment"># su - gitlab-runner</span></span><br><span class="line">[gitlab-runner@gitlab-runner ~]$ git config --global http.<span class="string">"sslVerify"</span> <span class="literal">false</span></span><br><span class="line"><span class="comment">#æŸ¥çœ‹</span></span><br><span class="line">[gitlab-runner@gitlab-runner ~]$ cat /home/gitlab-runner/.gitconfig </span><br><span class="line">[http]</span><br><span class="line">  sslVerify = <span class="literal">false</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>é—®é¢˜5. Couldnâ€™t resolve host â€˜gitlab.x.comâ€™, å‡ºç°Runneræ— æ³•è¿æ¥ç½‘ç»œçš„é—®é¢˜</strong><br>æŠ¥é”™ä¿¡æ¯ï¼š<code>fatal: unable to access &#39;https://gitlab-ci-token:xxxxxxxxxxxxxxxxxxxx@gitlab.cmop.chinamcloud.com/root/cmop.git/&#39;: Couldn&#39;t resolve host &#39;gitlab.x.com&#39;</code><br>åŸå› ï¼šexecutor = â€œdockerâ€æ—¶ï¼Œæ‰§è¡Œç¯å¢ƒæ˜¯1ä¸ªå®¹å™¨ï¼Œç”±äºéªŒè¯ç”¨çš„gitlabåŸŸåä¸èƒ½è¢«dnsè§£æï¼Œå¯¼è‡´æ— æ³•è¿æ¥ã€‚<br>è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>åœ¨æ³¨å†Œæ—¶ä½¿ç”¨â€â€“docker-volumes /etc/hosts:/etc/hostsâ€ï¼Œå°†è¿è¡Œgitlab-runneræœåŠ¡ä¸»æœºçš„hostsæ–‡ä»¶æ˜ å°„åˆ°æ‰§è¡Œå®¹å™¨å†…ï¼›</li>
<li>æ³¨å†Œæ—¶è¿˜å¯ä½¿ç”¨å‚æ•°â€â€“clone-url <a href="https://x.x.x.x&quot;ï¼Œipåœ°å€è¦†ç›–åŸŸåï¼Œæ‰§è¡Œå®¹å™¨ä½¿ç”¨ipåœ°å€ç›´æ¥è®¿é—®gitlabã€‚å‚è€ƒï¼šhttps://docs.gitlab.com/runner/configuration/advanced-configuration.html#how-clone_url-works">https://x.x.x.x&quot;ï¼Œipåœ°å€è¦†ç›–åŸŸåï¼Œæ‰§è¡Œå®¹å™¨ä½¿ç”¨ipåœ°å€ç›´æ¥è®¿é—®gitlabã€‚å‚è€ƒï¼šhttps://docs.gitlab.com/runner/configuration/advanced-configuration.html#how-clone_url-works</a></li>
<li>å¦‚æœæ˜¯åœ¨docker executor runnerå‡ºç°åˆ™éœ€è¦åœ¨Runnerçš„é…ç½®æ–‡ä»¶<code>config.toml</code>é‡Œå¢åŠ <code>dns = [&quot;***.***.***.***&quot;]</code>ï¼Œdnsçš„å€¼ä½ å¯ä»¥é€šè¿‡åœ¨å®¿ä¸»æœºä¸Šè¿è¡Œ<code>nmcli dev show</code>æ¥è·å¾—</li>
<li>PSï¼šä½¿ç”¨ipè¦†ç›–åŸŸåæ—¶ï¼Œå¯èƒ½ä¼šå¸¦æ¥å…¶ä»–é—®é¢˜ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯è‡ªç­¾åçš„è¯ä¹¦ï¼Œéœ€è¦æ˜ç¡®ipåœ°å€æ˜¯å¦ä¹Ÿè¢«è‡ªç­¾åçš„caæœºæ„è®¤è¯ã€‚</li>
</ul>
<p><br/></p>
<p><strong>é—®é¢˜6.å½“æˆ‘çš„Runneré‡‡ç”¨dockerä½œä¸ºexecutoræ—¶ï¼Œæ— æ³•build docker image</strong></p>
<ul>
<li>ä¿¡æ¯é”™è¯¯ï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Cannot connect to the Docker daemon at unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock. Is the docker daemon running?</span><br><span class="line">time&#x3D;&quot;2020-04-17T11:12:33Z&quot; level&#x3D;error msg&#x3D;&quot;failed to dial gRPC: cannot connect to the Docker daemon. Is &#39;docker daemon&#39; running on this host?: dial unix</span><br></pre></td></tr></table></figure>
<p>è§£å†³åŠæ³•: è¿™æ˜¯ä¸ª<code>dind(docker in docker)</code>é—®é¢˜ä½ å¯ä»¥å°†æœ¬åœ°çš„docker socketç»‘å®šåˆ°containeré‡Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå…·ä½“æ–¹æ³•æ˜¯å°†<code>volumes = [&quot;/var/run/docker.sock:/var/run/docker.sock&quot;]</code>é…ç½®åˆ°<code>config.toml</code>æ–‡ä»¶é‡Œã€‚</p>
<p><br/></p>
<p><strong>é—®é¢˜7.Gitlab-Runner è¿è¡Œæµæ°´çº¿æ—¶æŠ¥<code>ERROR: Job failed (system failure): prepare environment: setting up scripts configMap: generating scripts config map: configmaps is forbidden: User</code>é”™è¯¯</strong></p>
<ul>
<li>é—®é¢˜æ¶ˆæ¯:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Running with gitlab-runner 15.0.0 (febb2a09)</span><br><span class="line">  on gitlab-runner-6685dc55bd-86l2h H9xf-29K</span><br><span class="line">Preparing the <span class="string">"kubernetes"</span> executor</span><br><span class="line">00:00</span><br><span class="line">Using Kubernetes namespace: devops</span><br><span class="line">Using Kubernetes executor with image alpine:3.16 ...</span><br><span class="line">Using attach strategy to execute scripts...</span><br><span class="line">Preparing environment</span><br><span class="line">00:00</span><br><span class="line">ERROR: Error cleaning up configmap: resource name may not be empty</span><br><span class="line">ERROR: Job failed (system failure): prepare environment: setting up scripts configMap: generating scripts config map: configmaps is forbidden: User <span class="string">"system:serviceaccount:devops:default"</span> cannot create resource <span class="string">"configmaps"</span> <span class="keyword">in</span> API group <span class="string">""</span> <span class="keyword">in</span> the namespace <span class="string">"devops"</span>. Check https://docs.gitlab.com/runner/shells/index.html<span class="comment">#shell-profile-loading for more information</span></span><br></pre></td></tr></table></figure>
<ul>
<li>è§£å†³åŠæ³•: æŒ‡å®šæ‹¥æœ‰ç›¸åº”æƒé™çš„serviceaccountç”¨æˆ·, æˆ–è€…åœ¨helmæ­å»ºgitlab-runneræ—¶æŒ‡å®šå¯åŠ¨rbac.createä¸ºtureã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## æ–¹å¼1 ##</span></span><br><span class="line"><span class="comment"># æ›´æ”¹gitlab-runnerå›¾è¡¨é…ç½®æ–‡ä»¶æŒ‡å®šå¯ç”¨rbacæ”¯æŒã€‚</span></span><br><span class="line"><span class="comment">## For RBAC support:</span></span><br><span class="line">rbac:</span><br><span class="line">  create: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## æ–¹å¼2 ##</span></span><br><span class="line"><span class="comment"># 1.åœ¨devopsåç§°ç©ºé—´ä¸­åˆ›å»ºä¸€ä¸ªserviceaccountåä¸ºgitlab-runnerå¹¶ä¸ºè¯¥æœåŠ¡ç”¨æˆ·ç»‘å®šadminè§’è‰²(ç”Ÿäº§ç¯å¢ƒä¸­å»ºè®®æŒ‡å®šæœ€å°èµ„æºæ“ä½œæƒé™)</span></span><br><span class="line">kubectl create serviceaccount gitlab-runner --namespace devops</span><br><span class="line">kubectl create clusterrolebinding gitlab-runner --clusterrole=admin --serviceaccount=devops:gitlab-runner</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æ›´æ”¹å›¾è¡¨é…ç½®æ–‡ä»¶æŒ‡å®šserviceAccountNameä¸ºgitlab-runner</span></span><br><span class="line"><span class="comment">## For RBAC support:</span></span><br><span class="line">rbac:</span><br><span class="line">  create: <span class="literal">false</span></span><br><span class="line">  serviceAccountName: gitlab-runner</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æ›´æ–°éƒ¨ç½² gitlab-runner </span></span><br><span class="line">helm upgrade --namespace devops gitlab-runner --version 0.41.0  -f ./gitlab-runner.yaml gitlab/gitlab-runner</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><strong>é—®é¢˜8.ä½¿ç”¨Gitlab-runneræ‰§è¡Œdevopsé¡¹ç›®çš„CICDæµæ°´çº¿ä½œä¸šæ—¶æŠ¥<code>fatal: unable to access &#39;[Gitlabé¡¹ç›®çš„gitåœ°å€]&#39;: The requested URL returned error: 403</code>é”™è¯¯è§£å†³</strong></p>
<ul>
<li>é”™è¯¯ä¿¡æ¯: </li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Getting <span class="built_in">source</span> from Git repository</span><br><span class="line">00:01</span><br><span class="line">Fetching changes with git depth <span class="built_in">set</span> to 50...</span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> /builds/WeiyiGeek/devops/.git/</span><br><span class="line">Created fresh repository.</span><br><span class="line">remote: You are not allowed to download code from this project.</span><br><span class="line">fatal: unable to access <span class="string">'http://gitlab.weiyigeek.top/WeiyiGeek/devops.git/'</span>: The requested URL returned error: 403</span><br><span class="line">ERROR: Job failed: <span class="built_in">command</span> terminated with <span class="built_in">exit</span> code 1</span><br></pre></td></tr></table></figure>
<ul>
<li><p>é—®é¢˜åŸå› : ç”±äºé¡¹ç›®æ˜¯ç§æœ‰æƒé™è€Œépublicæƒé™, è€Œæœ‰åŠ ä¹‹æ‰§è¡Œæ›´æ”¹çš„é¡¹ç›®çš„ç”¨æˆ·ä¸ºrootå¹¶ä¸ºåŠ å…¥åˆ°devopsé¡¹ç›®æˆå‘˜ä¸­ã€‚</p>
</li>
<li><p>è§£å†³åŠæ³•: ä¸€æ˜¯å°†è¯¥é¡¹ç›®æ”¹ä¸ºpublicå…¬å…±é¡¹ç›®(é’ˆå¯¹ä¸€äº›éç§å¯†çš„é¡¹ç›®), äºŒæ˜¯åœ¨ç§æœ‰é¡¹ç›®æ·»åŠ æŒ‡å®šè§¦å‘æˆå‘˜(æ­¤ç§æ–¹å¼å¸¸ç”¨)ï¼Œä¾‹å¦‚æ­¤å¤„æˆ‘ä»¬å°†devopsç”¨æˆ·åŠ å…¥åˆ°devopsé¡¹ç›®ä¸­å¹¶èµ‹äºˆæœ€å°çš„Guestæƒé™å³å¯ï¼Œç„¶ååœ¨è¿è¡Œæµæ°´çº¿ä½œä¸šå³å¯ã€‚</p>
</li>
</ul>

        </div>
        
  <hr>
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>

  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>

  <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ï¼Œè½¬ä¸ªå‘ã€‘(äººé—´äº”å¤§æƒ…)</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œè°¢è°¢ï¼ã€‚</p>

  <div>
    <img src="https://www.weiyigeek.top/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul>

  <div>
    <img src="/img/wechat-search.png" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·"  width="328" height="149">
    <img src="/img/wechat-app.png" class="img-responsive" alt="æ‰«æVisit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº"  width="328" height="149">
  </div>


  <hr>
  


  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-07-11T01:17:02.661Z" itemprop="dateUpdated">2022-07-11 09:17:02</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/CI-CD/GitLab-CI/1.åŸºäºGitLabä»£ç ä»“åº“çš„æŒç»­é›†æˆåŸºç¡€é…ç½®å’Œä½¿ç”¨.md" target="_blank" rel="noopener noreferrer">_posts/ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/CI-CD/GitLab-CI/1.åŸºäºGitLabä»£ç ä»“åº“çš„æŒç»­é›†æˆåŸºç¡€é…ç½®å’Œä½¿ç”¨.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2020/4-19-271.html" target="_blank" rel="external">https://blog.weiyigeek.top/2020/4-19-271.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">ğŸ‘ é’Ÿæ„ä½œè€…</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gitlab/" rel="tag">gitlab</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/4-19-271.html&title=ã€Š1.åŸºäºGitLabä»£ç ä»“åº“çš„æŒç»­é›†æˆåŸºç¡€é…ç½®å’Œä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/4-19-271.html&title=ã€Š1.åŸºäºGitLabä»£ç ä»“åº“çš„æŒç»­é›†æˆåŸºç¡€é…ç½®å’Œä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/4-19-271.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š1.åŸºäºGitLabä»£ç ä»“åº“çš„æŒç»­é›†æˆåŸºç¡€é…ç½®å’Œä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/4-19-271.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/4-19-271.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2020/4-22-468.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">1-Kuberneteså…¥é—¨ä½“ç³»æ¶æ„å­¦ä¹ </h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2020/4-11-41.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">LDAPå®¢æˆ·ç«¯è®¤è¯é…ç½®ä¸åº”ç”¨æ¥å…¥</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-å‰è¨€ç®€è¿°"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 å‰è¨€ç®€è¿°</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#CI-CDä»‹ç»"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">CI&#x2F;CDä»‹ç»</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-GitLab-CI-æŒç»­é›†æˆ"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 GitLab-CI æŒç»­é›†æˆ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-1-åŸºç¡€ä»‹ç»"><span class="post-toc-number">2.0.1.</span> <span class="post-toc-text">1.1 åŸºç¡€ä»‹ç»</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-2-å®‰è£…é…ç½®"><span class="post-toc-number">2.0.2.</span> <span class="post-toc-text">1.2 å®‰è£…é…ç½®</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-3-å‘½ä»¤å‚æ•°"><span class="post-toc-number">2.0.3.</span> <span class="post-toc-text">1.3 å‘½ä»¤å‚æ•°</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-4-åŸºç¡€ä½¿ç”¨"><span class="post-toc-number">2.0.4.</span> <span class="post-toc-text">1.4 åŸºç¡€ä½¿ç”¨</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-5-Executor"><span class="post-toc-number">2.0.5.</span> <span class="post-toc-text">1.5 Executor</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-6-ç¼“å­˜ä½¿ç”¨"><span class="post-toc-number">2.0.6.</span> <span class="post-toc-text">1.6 ç¼“å­˜ä½¿ç”¨</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x02-GitLab-Runner-è¡¥å……"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 GitLab Runner è¡¥å……</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-Kubernetes-ç¯å¢ƒä¸­å®‰è£…-Runner"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">1.Kubernetes ç¯å¢ƒä¸­å®‰è£… Runner</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x0n-å…¥å‘å‡ºå‘"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x0n å…¥å‘å‡ºå‘</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

  <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        äººé—´è‡ªæœ‰äº”å¤§æƒ…ã€ç‚¹èµã€æŠ•å¸(èµèµ)ã€æ”¶è—ã€å…³æ³¨ï¼Œè½¬å‘ã€‘, è°¢è°¢çœ‹å‹æ”¯æŒ!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="228" height="228" alt="æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="228" height="228" alt="æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

  
 <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->

  <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½æœ‹å‹,å¯ä»¥å…³ä¸ªæ³¨å—? â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>


</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">ä¸ªäººGithub</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">ä¸ªäººGitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">ä¸ªäººçŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘+äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved. ITå”¯ä¸€æå®¢ ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener"><img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto"></a>
        </div>
      </p>
    </div>
</footer>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/4-19-271.html&title=ã€Š1.åŸºäºGitLabä»£ç ä»“åº“çš„æŒç»­é›†æˆåŸºç¡€é…ç½®å’Œä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/4-19-271.html&title=ã€Š1.åŸºäºGitLabä»£ç ä»“åº“çš„æŒç»­é›†æˆåŸºç¡€é…ç½®å’Œä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/4-19-271.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š1.åŸºäºGitLabä»£ç ä»“åº“çš„æŒç»­é›†æˆåŸºç¡€é…ç½®å’Œä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/4-19-271.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/4-19-271.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACKElEQVR42u3aQW7DMAxE0dz/0u62QCD3D+k0kPi1KhLH1vNiKop6vfC43sbqW3L972vu7/PwkCFDxraM63ak01r9ajX198/vn7ucgwwZMgYw0lunQXx/TYctQ4YMGeQaEtN8ojJkyJDxVODycLwvUL/8f0OGDBlbMUh01paDabn78VpchgwZGzL4rvv///2R/oYMGTK2YlzhSO/DG5NXY8iQIeNsBg84slisTRoVqOQOMmTIOJTRL0RrE+UbcOgTGTJkDGDUmoscwyO7eL0MGTKOZnRit9M26Lw4GTJkTGPwVmJcGTcWmvHrkyFDxtEMvinPH0YCNG1eoganDBkyDmV0jjikrcp+M2D5KxkyZAxg8PK1FqCEmr6CVgtThgwZWzFqa0neeiQL0Af2C2XIkDGMUQvctBjmrYLOwlGGDBlnMNLDDeTgRbCVD/BotjJkyBjD6DQUa4VrsY/B9+pkyJBxECNtKKbsNNZ57MqQIWMC46mqkIdy2mYgc5AhQ8YEBrfWlpKdNmdwREOGDBljGGm81oKVl6/Blp8MGTJGMjqHLdKQTdurwWkOGTJkbM64wsGDlUw0jfVl+MqQIeNoRuegWB/GS+LHIluGDBnbMmobZP2t/7QY/mN5KkOGjAGM9JAWPwaRLhPT6JchQ4aMNGQJNY1d9EQZMmTIAG2AWuySChsdIJMhQ8YARrqh1v9VDSlDhoyZjM5JjU7x2VlQFhuZMmTI2I/xA0LkQc9KupL7AAAAAElFTkSuQmCC" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 



  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 
     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
</body>
</html>
