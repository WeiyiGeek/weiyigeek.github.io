<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ n2.Dockerå®¶æ–‡ä»¶ç›®å½•ä»‹ç»å’Œé…ç½®æ–‡ä»¶ä¸å®ˆæŠ¤è¿›ç¨‹å‘½ä»¤å‚æ•°ä¸€è§ˆ|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="docker">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
        
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/2018/1-1-1.html"  >
                <i class="icon icon-lg icon-mortar-board"></i>
                å­¦ä¹ ä¹‹è·¯
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>n2.Dockerå®¶æ–‡ä»¶ç›®å½•ä»‹ç»å’Œé…ç½®æ–‡ä»¶ä¸å®ˆæŠ¤è¿›ç¨‹å‘½ä»¤å‚æ•°ä¸€è§ˆ</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">n2.Dockerå®¶æ–‡ä»¶ç›®å½•ä»‹ç»å’Œé…ç½®æ–‡ä»¶ä¸å®ˆæŠ¤è¿›ç¨‹å‘½ä»¤å‚æ•°ä¸€è§ˆ</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-05-06T07:36:30.000Z" itemprop="datePublished" class="page-time">
  2019-05-06
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/OperationTools/">OperationTools</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap" style="display: none;">
  <article id="post-è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Docker/n2.Dockeré…ç½®æ–‡ä»¶ä¸å®ˆæŠ¤è¿›ç¨‹å‚æ•°ä¸€è§ˆ"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">n2.Dockerå®¶æ–‡ä»¶ç›®å½•ä»‹ç»å’Œé…ç½®æ–‡ä»¶ä¸å®ˆæŠ¤è¿›ç¨‹å‘½ä»¤å‚æ•°ä¸€è§ˆ</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-05-06 15:36:30" datetime="2019-05-06T07:36:30.000Z"  itemprop="datePublished">2019-05-06</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/OperationTools/">OperationTools</a></li></ul></li></ul>



            

            


            
        </div>
        <span class="post-href" style="display: none;">|</span>
        <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
        
          <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½çœ‹å‹,æ¬¢è¿å…³æ³¨åšä¸»å¾®ä¿¡å…¬ä¼—å·å“Ÿ! â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘å³å¯å…³é—­ç»§ç»­æµè§ˆæ–‡ç« .<br>  <b style="color:red;"> æ¸©é¦¨æç¤º: æœªè§£é”çš„ç”¨æˆ·ä¸èƒ½ç²˜è´´å¤åˆ¶æ–‡ç« å†…å®¹å“Ÿ!</b> <br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
            
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h4 id="0x00-Dockeråº”ç”¨è·¯å¾„"><a href="#0x00-Dockeråº”ç”¨è·¯å¾„" class="headerlink" title="0x00 Dockeråº”ç”¨è·¯å¾„"></a>0x00 Dockeråº”ç”¨è·¯å¾„</h4><h5 id="1-ç»„ç»‡ç»“æ„"><a href="#1-ç»„ç»‡ç»“æ„" class="headerlink" title="1.ç»„ç»‡ç»“æ„"></a>1.ç»„ç»‡ç»“æ„</h5><p><strong>/var/lib/docker - docker æ ¹(å®¶)ç›®å½•</strong><br>æè¿°:å®ƒæ˜¯Dockerä¸­é•œåƒã€å®¹å™¨ã€å®¹å™¨é…ç½®çš„æœ¬åœ°å­˜å‚¨ç›®å½•;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ls -lah </span><br><span class="line">drwx------.  2 root root   24 3æœˆ  22 13:39 builder</span><br><span class="line">drwx--x--x.  4 root root   92 3æœˆ  22 13:39 buildkit</span><br><span class="line">drwx------.  8 root root 4.0K 7æœˆ   5 21:28 containers  <span class="comment">#å®¹å™¨ç›¸å…³ä¿¡æ¯(è¿è¡Œæ—¶å®¹å™¨å†…éƒ¨çš„ä¸€äº›é…ç½®)</span></span><br><span class="line">drwx------.  3 root root   22 3æœˆ  22 13:39 image       <span class="comment">#é•œåƒå…ƒæ•°æ®ç›¸å…³ä¿¡æ¯</span></span><br><span class="line">drwxr-x---.  3 root root   19 3æœˆ  22 13:39 network     <span class="comment">#ç½‘ç»œæ¨¡å¼ç›¸å…³ä¿¡æ¯</span></span><br><span class="line">drwx------. 49 root root 8.0K 7æœˆ   5 21:41 overlay2    <span class="comment">#å®¹å™¨Layeræ•°æ®å­˜å‚¨ç›®å½•ï¼Œ</span></span><br><span class="line">drwx------.  4 root root   32 3æœˆ  22 13:39 plugins     <span class="comment">#æ’ä»¶ä¿¡æ¯</span></span><br><span class="line">drwx------.  2 root root    6 7æœˆ   2 11:21 runtimes</span><br><span class="line">drwx------.  2 root root    6 3æœˆ  22 13:39 swarm       <span class="comment">#é›†ç¾¤ç›¸å…³ä¿¡æ¯</span></span><br><span class="line">drwx------.  2 root root    6 7æœˆ   5 21:42 tmp         <span class="comment">#ä¸´æ—¶ç›®å½•(åœ¨æ‹‰å»é•œåƒæ—¶å€™ä¼šäº§ç”Ÿä¸´æ—¶æ–‡ä»¶ä¾‹å¦‚: GetImageBlob285307443)</span></span><br><span class="line">drwx------.  2 root root    6 3æœˆ  22 13:39 trust       <span class="comment">#éªŒè¯ç›¸å…³ä¿¡æ¯</span></span><br><span class="line">drwx------.  7 root root 4.0K 6æœˆ  30 22:48 volumes     <span class="comment">#æ•°æ®å·ç›¸å…³ä¿¡æ¯(å®¹å™¨æŒä¹…åŒ–çš„ç›¸å…³ä¿¡æ¯åœ¨å…¶ä¸­)</span></span><br></pre></td></tr></table></figure></p>
<p>è¡¥å……è¯´æ˜:</p>
<ul>
<li>1) ç›®å‰æœ€æ–°ç‰ˆæœ¬çš„ docker é»˜è®¤ä¼˜å…ˆé‡‡ç”¨ overlay2 ä½œä¸ºå­˜å‚¨é©±åŠ¨ï¼Œå¯¹äºå·²æ”¯æŒè¯¥é©±åŠ¨çš„ Linux å‘è¡Œç‰ˆï¼Œä¸éœ€è¦ä»»ä½•è¿›è¡Œä»»ä½•é¢å¤–çš„é…ç½®ï¼Œå¯ä½¿ç”¨ <code>lsmod | grep &quot;overlay&quot;</code> å‘½ä»¤æŸ¥çœ‹å½“å‰ç³»ç»Ÿå†…æ ¸æ˜¯å¦æ”¯æŒ overlay2,å€¼å¾—ä¸€æçš„æ˜¯ <code>devicemapper</code> å­˜å‚¨é©±åŠ¨(æœ¬äººå¸¸å¸¸è¢«å…¶æ‘§æ®‹)å·²ç»åœ¨ docker 18.09 ç‰ˆæœ¬ä¸­è¢«åºŸå¼ƒï¼Œæ‰€ä»¥åœ¨é«˜äºæ­¤ç‰ˆæœ¬çš„Dockerå‹¿å¬ç™¾åº¦çš„å«æ‚¨å»å®‰è£…<code>device-mapper-persistent-data</code>å› ä¸ºå®Œå…¨æ²¡å¿…è¦;</li>
</ul>
<p><br></p>
<p><strong>/var/lib/docker/image - é•œåƒå…ƒæ•°æ®ä¿¡æ¯</strong><br>æè¿°: è¯¥ç›®å½•å­˜å‚¨docker pullæ‰€ä¸‹è½½çš„é•œåƒçš„ç›¸å…³ä¿¡æ¯ï¼Œå¹¶ä¸”åœ¨æ¯æ¬¡Docker pull é•œåƒæ—¶å€™éƒ½ä¼šæ£€æŸ¥repositories.jsonæ–‡ä»¶ä¸­ç´¢å¼•æœ¬åœ°æ˜¯å¦å­˜åœ¨è¯¥æ‹‰å–é•œåƒ(<code>image id / diff_ids</code>)ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æ‹‰å»ä¸‹è½½ï¼Œåœ¨Dockerå®¶ç›®å½•ä¸­ä¼šçœ‹è§sha256ç¼–ç çš„ç›®å½•åç§°å®ƒä»¬å®é™…æ˜¯digestä¿¡æ¯æ‘˜è¦;</p>
<p>Q:ä¸ºä»€ä¹ˆè¦æœ‰digest?</p>
<blockquote>
<p>ç­”:å¦‚æœä¸€ä¸ªé•œåƒçš„é•œåƒåå’Œtagæ²¡æœ‰å˜ï¼Œä½†æ˜¯é•œåƒçš„å†…å®¹å˜äº†ï¼ˆlayerå˜äº†ï¼‰ï¼Œä¼šé€ æˆç›¸åŒçš„é•œåƒå+tagå¾—åˆ°äº†ä¸åŒçš„é•œåƒã€‚digestæ˜¯å¯¹manifestæ–‡ä»¶çš„sha256ï¼Œå½“é•œåƒçš„å†…å®¹å˜åŒ–ï¼Œå³layerå˜åŒ–ï¼Œç›¸åº”çš„layerçš„sha256å˜åŒ–ï¼Œä»¥è‡³manifestå˜åŒ–ï¼Œä»è€Œä¿è¯äº†ä¸€ä¸ªdigestï¼ˆä¸æ˜¯é•œåƒå+tagï¼‰å¯¹åº”ä¸€ä¸ªé•œåƒã€‚<br>ä¸€å¥è¯ç†è§£: <code>ä¸€ä¸ªdigest å¯¹åº”ä¸€ä¸ªimage Id</code></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">$ tree -f 1 /var/lib/docker/image/overlay2</span><br><span class="line"><span class="comment"># å½“å‰ Docker ä¸­å­˜å‚¨ä¸¤ä¸ªimagesé•œåƒ</span></span><br><span class="line">image</span><br><span class="line">â””â”€â”€ overlay2  <span class="comment"># é•œåƒå’Œå®¹å™¨çš„å±‚ä¿¡æ¯(å…¶ä¹Ÿä»£è¡¨æœ¬ä½¿ç”¨çš„overlay2å­˜å‚¨é©±åŠ¨)</span></span><br><span class="line">    â”œâ”€â”€ distribution </span><br><span class="line">    â”‚   â”œâ”€â”€ diffid-by-digest    <span class="comment">#[é€šè¿‡digestå¾—åˆ°diffid] å¯ä»¥é€šè¿‡Layerçš„diff idæ‰¾åˆ°å¯¹åº”çš„digestï¼Œå¹¶ä¸”åŒ…å«äº†ç”Ÿæˆè¯¥digestçš„æºä»“åº“</span></span><br><span class="line">    â”‚   â”‚   â””â”€â”€ sha256</span><br><span class="line">    â”‚   â”‚       â”œâ”€â”€ 039b991354af4dcbc534338f687e27643c717bb57e11b87c2e81d50bdd0b2376</span><br><span class="line">    â”‚   â”‚       â”œâ”€â”€ 09a4142c5c9dde2fbf35e7a6e6475eba75a8c28540c375c80be7eade4b7cb438</span><br><span class="line">    â”‚   â””â”€â”€ v2metadata-by-diffid <span class="comment">#[é€šè¿‡diffidå¾—åˆ°digest] diffid-by-digestç›®å½•åˆ™ä¸v2metadata-by-diffidç›¸å</span></span><br><span class="line">    â”‚       â””â”€â”€ sha256</span><br><span class="line">    â”‚           â”œâ”€â”€ 0683de2821778aa9546bf3d3e6944df779daba1582631b7ea3517bb36f9e4007</span><br><span class="line">    â”‚           â”œâ”€â”€ 0f7493e3a35bab1679e587b41b353b041dca1e7043be230670969703f28a1d83</span><br><span class="line">    â”œâ”€â”€ imagedb  <span class="comment"># å­˜å‚¨é•œåƒå…ƒç›¸å…³ä¿¡æ¯</span></span><br><span class="line">    â”‚   â”œâ”€â”€ content <span class="comment"># è¯¥ç›®å½•ä¸‹å­˜å‚¨äº†é•œåƒçš„JSONæ ¼å¼æè¿°ä¿¡æ¯</span></span><br><span class="line">    â”‚   â”‚   â””â”€â”€ sha256</span><br><span class="line">    â”‚   â”‚       â”œâ”€â”€ 708bc6af7e5e539bdb59707bbf1053cc2166622f5e1b17666f0ba5829ca6aaea</span><br><span class="line">    â”‚   â”‚       â””â”€â”€ f70734b6a266dcb5f44c383274821207885b549b75c8e119404917a61335981a</span><br><span class="line">    â”‚   â””â”€â”€ metadata <span class="comment"># è¯¥ç›®å½•ä¿å­˜æ¯ä¸ªé•œåƒçš„parenté•œåƒID</span></span><br><span class="line">    â”‚       â””â”€â”€ sha256</span><br><span class="line">    â”œâ”€â”€ layerdb <span class="comment"># å±‚å…ƒæ•°æ®</span></span><br><span class="line">    â”‚   â”œâ”€â”€ mounts         <span class="comment"># å®¹å™¨è¿è¡Œæ—¶æŒ‚è½½çš„layerç›®å½• lowerdirã€upperdir</span></span><br><span class="line">    â”‚   â”œâ”€â”€ sha256</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ b9835d6a62886d4e85b65abb120c0ea44ff1b3d116d7a707620785d4664d8c1a <span class="comment"># å”¯ä¸€å±‚ID</span></span><br><span class="line">    â”‚   â”‚   â”‚   â”œâ”€â”€ cache-id <span class="comment">#å†…å®¹ä¸ºä¸€ä¸ªuuidï¼ŒæŒ‡å‘Layeræœ¬åœ°çš„çœŸæ­£å­˜å‚¨ä½ç½®</span></span><br><span class="line">    â”‚   â”‚   â”‚   â”œâ”€â”€ diff     <span class="comment">#è¯¥Layerå±‚çš„å·®å¼‚ id</span></span><br><span class="line">    â”‚   â”‚   â”‚   â”œâ”€â”€ parent   <span class="comment">#å­˜å‚¨äº†å½“å‰Layerå±‚çš„çˆ¶å±‚chain_id</span></span><br><span class="line">    â”‚   â”‚   â”‚   â”œâ”€â”€ size     <span class="comment">#è¯¥å±‚çš„å¤§å°</span></span><br><span class="line">    â”‚   â”‚   â”‚   â””â”€â”€ tar-split.json.gz  <span class="comment"># tar-split.json.gzï¼Œlayerå‹ç¼©åŒ…çš„splitæ–‡ä»¶ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶å¯ä»¥è¿˜åŸlayerçš„taråŒ…ï¼Œhttps://github.com/vbatts/tar-split</span></span><br><span class="line">    â”‚   â”‚   â””â”€â”€ d9b567b77bcdb9d8944d3654ea9bb5f6f4f7c4d07a264b2e40b1bb09af171dd3</span><br><span class="line">    â”‚   â”‚       â”œâ”€â”€ cache-id</span><br><span class="line">    â”‚   â”‚       â”œâ”€â”€ diff</span><br><span class="line">    â”‚   â”‚       â”œâ”€â”€ parent</span><br><span class="line">    â”‚   â”‚       â”œâ”€â”€ size</span><br><span class="line">    â”‚   â”‚       â””â”€â”€ tar-split.json.gz</span><br><span class="line">    â”‚   â””â”€â”€ tmp</span><br><span class="line">    â””â”€â”€ repositories.json  <span class="comment">#è¯¥æ–‡ä»¶å­˜å‚¨äº†æœ¬åœ°çš„æ‰€æœ‰imagesåˆ—è¡¨(é•œåƒå…ƒæ•°æ®ä¿¡æ¯)ï¼Œå¯ä»¥é€šè¿‡`docker images --digests`æ‰¾åˆ°å¯¹åº”çš„é•œåƒåç§°</span></span><br><span class="line">21 directories, 119 files</span><br><span class="line"></span><br><span class="line"><span class="comment"># digest å’Œ image id çš„å¯¹åº”</span></span><br><span class="line"><span class="variable">$jq</span> <span class="string">"."</span> /var/lib/docker/overlay2/image/repositories.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"Repositories"</span>: &#123;</span><br><span class="line">    <span class="string">"alpine"</span>: &#123;</span><br><span class="line">      <span class="string">"alpine:latest"</span>: <span class="string">"sha256:a24bb4013296f61e89ba57005a7b3e52274d8edd3ae2077d04395f806b63d83e"</span>,</span><br><span class="line">      <span class="string">"alpine@sha256:185518070891758909c9f839cf4ca393ee977ac378609f700f60a771a2dfe321"</span>: <span class="string">"sha256:a24bb4013296f61e89ba57005a7b3e52274d8edd3ae2077d04395f806b63d83e"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>è¡¥å……çŸ¥è¯†:</em></p>
<ul>
<li><p>(1) é€šè¿‡ overlayfs è”åˆæŒ‚è½½çš„æŠ€æœ¯å°†é•œåƒçš„å¤šå±‚ layer æŒ‚è½½ä¸ºä¸€å±‚, ä¸‹é¢ä» docker å®˜æ–¹æ–‡æ¡£ <code>Use the OverlayFS storage driver</code> é‡Œå·æ¥çš„ä¸€å¼ å›¾ç‰‡åˆ†åˆ«ä»‹ç»å„ Dir çš„ä½œç”¨:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®¹å™¨ID</span></span><br><span class="line">docker run -ti -d docker-search.4pd.io/ubuntu:18.04 top</span><br><span class="line">c70488b4ca7dfc882664272f5e3c6fe7dd6de1ce36c692b6c52f8002d76ca5ee</span><br><span class="line"></span><br><span class="line"><span class="variable">$pwd</span></span><br><span class="line">/var/lib/docker/image/overlay2/layerdb/mounts</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿåˆ†ä¸ºä¸‰å±‚:</span></span><br><span class="line">* initå±‚ï¼šå¯åŠ¨å®¹å™¨æ—¶çš„å‚æ•°</span><br><span class="line">* r/oå±‚ï¼šä¹Ÿå°±æ˜¯é•œåƒå±‚</span><br><span class="line">* r/wå±‚ï¼šå¯è¯»å†™å±‚</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿è¡Œä¸€ä¸ªå®¹å™¨ä¼šè¿”å›ä¸€ä¸ªå®¹å™¨id. é€šè¿‡è¿™ä¸ªidæˆ‘ä»¬èƒ½åœ¨*/var/lib/docker/image/overlay2/layerdb/mounts*ç›®å½•ä¸‹æ‰¾åˆ°è¯¥å®¹å™¨çš„ä¿¡æ¯ï¼š</span></span><br><span class="line"><span class="variable">$tree</span></span><br><span class="line">â”œâ”€â”€ c70488b4ca7dfc882664272f5e3c6fe7dd6de1ce36c692b6c52f8002d76ca5ee</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ init-id   <span class="comment"># å†…å®¹:a66b1fa59d833d7d217ed3c2325079077c69822a21b739bd338f9c0dad227c03-init</span></span><br><span class="line">â”‚Â Â  â”œâ”€â”€ mount-id  <span class="comment"># å†…å®¹:a66b1fa59d833d7d217ed3c2325079077c69822a21b739bd338f9c0dad227c03</span></span><br><span class="line">â”‚Â Â  â””â”€â”€ parent    <span class="comment"># å†…å®¹:36a83751a1193f6edf65d21f62fe7988394d562d71904ee20cb4aa72f14148bd</span></span><br><span class="line">â””â”€â”€ e35b0d4511220a727e89d90a957a25460349ad143072e6b4efdde9a82c039807</span><br><span class="line">    â”œâ”€â”€ init-id   <span class="comment"># initå±‚çš„id</span></span><br><span class="line">    â”œâ”€â”€ mount-id  <span class="comment"># r/wå±‚çš„id</span></span><br><span class="line">    â””â”€â”€ parent    <span class="comment"># åŸºäºå“ªä¸ªlayerå±‚å­˜æ”¾çš„æ˜¯Digestæ‘˜è¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># docker å¦‚ä½•ä½¿ç”¨çš„overlayFS?æˆ‘ä»¬å¯ä»¥é€šè¿‡mount -l æŸ¥çœ‹ä¸€ä¸‹ï¼Œå­˜å‚¨é©±åŠ¨æ˜¯æ€ä¹ˆæŒ‚è½½çš„ç›®å½•ï¼›</span></span><br><span class="line"><span class="variable">$mount</span> -l</span><br><span class="line">overlay on /var/lib/docker/overlay2/a66b1fa59d833d7d217ed3c2325079077c69822a21b739bd338f9c0dad227c03/merged <span class="built_in">type</span> overla y </span><br><span class="line">(rw,relatime,seclabel,</span><br><span class="line">lowerdir=/var/lib/docker/overlay2/l/C7RLSUT3FAOYOZQ44X5MLUFGXS:/var/lib/docker/overlay2/l/WFV3HGS7BXAK6C2VIPHHGMGRVC:/var/lib/docker/overlay2/l/UO6DNPRKCHHWTV6TWJEFQLAE74:/var/lib/docker/overlay2/l/OUYDRT4WTUXB4J27RBSO72TM6E:/var/lib/docker/overlay2/l/XSKIKL3ZDUGHFLHXAQJEEQLRCV:/var/lib/docker/overlay2/l/NXRKPTSOTIHHPL7YH7YUYZKOCE,</span><br><span class="line">upperdir=/var/lib/docker/overlay2/a66b1fa59d833d7d217ed3c2325079077c69822a21b739bd338f9c0dad227c03/diff,</span><br><span class="line">workdir=/var/lib/docker/overlay2/a66b1fa59d833d7d217ed3c2325079077c69822a21b739bd338f9c0dad227c03/work</span><br><span class="line">)</span><br><span class="line"><span class="comment"># å…¶ä¸­lowerdirå°±æ˜¯image layerçš„å››å±‚åŠ ä¸Šinitå±‚ï¼Œupperdirå±‚æ˜¯r/wå±‚æ˜¯diffç›®å½•ä¹Ÿå°±æ˜¯æŒ‚è½½ç‚¹ï¼Œworkdiræ˜¯æŒ‚è½½ä¹‹åçš„å·¥ä½œç›®å½•ã€‚</span></span><br><span class="line"><span class="comment"># æ­¤æ—¶æ‚¨å¯èƒ½ä¼šå›°æƒ‘WFV3HGS7BXAK6C2VIPHHGMGRVCè¿™äº›æœ‰æ˜¯å•¥ï¼Œè¿™äº›æ˜¯ä¸ºäº†é¿å…mountå‘½ä»¤å¤ªé•¿è€Œå¯¼è‡´çš„é”™è¯¯ï¼Œæ‰€æœ‰æ•…æ„æçŸ­ä¸€ç‚¹ï¼Œ</span></span><br><span class="line"><span class="comment"># å®é™…ä¸Šæ‚¨çœ‹ä¸€å“ˆ`/var/lib/docker/overlay2/l/`ä¹Ÿå³æ˜¯linkçš„ç¼©å†™è¿™é‡Œé¢å°±æ˜¯ä¸€å¨æŒ‡å‘çœŸæ­£å±‚æ•°æ®çš„è½¯é“¾ã€‚</span></span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=n2.Dockerå®¶æ–‡ä»¶ç›®å½•ä»‹ç»å’Œé…ç½®æ–‡ä»¶ä¸å®ˆæŠ¤è¿›ç¨‹å‘½ä»¤å‚æ•°ä¸€è§ˆ href="https://img.weiyigeek.top/2020/1/20200803161619.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://img.weiyigeek.top/2020/1/20200803161619.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure>
</li>
<li><p>(2) æ–‡ä»¶ repositories.json å­˜å‚¨é•œåƒä¿¡æ¯<code>ä¸»è¦æ˜¯nameå’Œimage idçš„å¯¹åº”</code>ï¼Œ<code>digestå’Œimage idçš„å¯¹åº”</code>è€Œé•œåƒimageidåˆåŒ…å«äº†image config ä»¥åŠå„å±‚çš„Digest;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat image/overlay2/repositories.json  | python -m json.tool</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"Repositories"</span>: &#123;</span><br><span class="line">        <span class="string">"docker.io/ubuntu"</span>: &#123;</span><br><span class="line">            <span class="string">"docker.io/ubuntu:18.04"</span>: <span class="string">"sha256:775349758637aff77bf85e2ff0597e86e3e859183ef0baba8b3e8fc8d3cba51c"</span>,</span><br><span class="line">            <span class="string">"docker.io/ubuntu@sha256:6e9f67fa63b0323e9a1e587fd71c561ba48a034504fb804fd26fd8800039835d"</span>: <span class="string">"sha256:775349758637aff77bf85e2ff0597e86e3e859183ef0baba8b3e8fc8d3cba51c"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># image idå’Œdigestçš„è”ç³»digestæ˜¯manifestçš„sha256.</span></span><br><span class="line"><span class="variable">$docker</span> images --digests</span><br><span class="line">REPOSITORY                    TAG                 DIGEST                                                                    IMAGE ID            CREATED             SIZE</span><br><span class="line">docker-search.4pd.io/ubuntu   18.04               sha256:134c7fe821b9d359490cd009ce7ca322453f4f2d018623f849e580a89a685e5d   775349758637        5 weeks ago         64.2 MB</span><br><span class="line"></span><br><span class="line"><span class="comment"># å› ä¸ºmanifeståœ¨æœ¬åœ°æ²¡æœ‰ï¼Œæ‰€æœ‰æˆ‘ä»¬å¯ä»¥é€šè¿‡registryçš„ç»“æœå»è·å–ç»è¿‡sha256sumç®—æ³•ç”Ÿæˆæ‘˜è¦ä¸docker images --digestsä¸­çš„DIGESTè¿›è¡Œå¯¹æ¯”</span></span><br><span class="line"><span class="variable">$curl</span> -H <span class="string">"Accept:application/vnd.docker.distribution.manifest.v2+json"</span> https://docker-search.4pd.io/v2/ubuntu/manifests/18.04 | sha256sum</span><br><span class="line">134c7fe821b9d359490cd009ce7ca322453f4f2d018623f849e580a89a685e5d  -</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡sha256 image configå°±èƒ½å¾—åˆ°imageidï¼š</span></span><br><span class="line"><span class="variable">$sha256sum</span> image/overlay2/imagedb/content/sha256/775349758637aff77bf85e2ff0597e86e3e859183ef0baba8b3e8fc8d3cba51c</span><br><span class="line">775349758637aff77bf85e2ff0597e86e3e859183ef0baba8b3e8fc8d3cba51c  image/overlay2/imagedb/content/sha256/775349758637aff77bf85e2ff0597e86e3e859183ef0baba8b3e8fc8d3cba51c</span><br></pre></td></tr></table></figure></li>
<li>(3) åœ¨pullé•œåƒçš„æ—¶å€™æ˜¾ç¤ºçš„æ˜¯<code>å„ä¸ªlayerçš„digestä¿¡æ¯è€Œåœ¨image configå­˜çš„æ˜¯diffid</code>ï¼Œæ‰€ä»¥æ³¨æ„åŒºåˆ†manifestçš„layerçš„è¡¨è¾¾å’Œimage configçš„layerçš„è¡¨è¾¾ä¸­ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿;<ul>
<li>åœ¨Registryä¸Šæ‹‰å–Layerçš„æ—¶å€™éœ€è¦åœ¨è¯·æ±‚å¤´åŠ å…¥media typeæ¥ç¡®å®šæ‹‰å–ä»€ä¹ˆæ ¼å¼, ä¸ºäº†åœ¨ç½‘ç»œä¸Šä¼ è¾“çš„æ›´åŠ å¿«å‘¢æ‰€æœ‰media typeä¸€èˆ¬ä¼šæŒ‡å®šå‹ç¼©æ ¼å¼çš„æ¯”å¦‚gzipçš„ï¼Œå…·ä½“æœ‰å“ªäº›æ ¼å¼ï¼Œè§<a href="https://docs.docker.com/registry/spec/manifest-v2-2/#media-types" target="_blank" rel="noopener">media type</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Media Types</span></span><br><span class="line">application/vnd.docker.distribution.manifest.v1+json: <span class="comment"># schema1 (existing manifest format)</span></span><br><span class="line">application/vnd.docker.distribution.manifest.v2+json: <span class="comment"># New image manifest format (schemaVersion = 2)</span></span><br><span class="line">application/vnd.docker.distribution.manifest.list.v2+json: <span class="comment"># Manifest list, aka â€œfat manifestâ€</span></span><br><span class="line">application/vnd.docker.container.image.v1+json: <span class="comment"># Container config JSON</span></span><br><span class="line">application/vnd.docker.image.rootfs.diff.tar.gzip: <span class="comment"># â€œLayerâ€, as a gzipped tar</span></span><br><span class="line">application/vnd.docker.image.rootfs.foreign.diff.tar.gzip: <span class="comment">#  â€œLayerâ€, as a gzipped tar that should never be pushed</span></span><br><span class="line">application/vnd.docker.plugin.v1+json: <span class="comment"># Plugin config JSON</span></span><br></pre></td></tr></table></figure></li>
<li>å½“dockerå‘ç°æœ¬åœ°ä¸å­˜åœ¨æŸä¸ªlayerçš„æ—¶å€™ï¼Œå°±ä¼šé€šè¿‡manifesté‡Œé¢çš„<code>digest + mediaType</code>ï¼ˆä¸€èˆ¬æ˜¯â€application/vnd.docker.image.rootfs.diff.tar.gzipâ€ï¼‰å»registryæ‹‰å¯¹åº”çš„leyer, ç„¶ååœ¨image idå­˜çš„å¯¹åº”çš„diff idå°±æ˜¯ä¸Šé¢æ‹¿åˆ°çš„tar.gzåŒ…è§£å‹ä¸ºtaråŒ…çš„idã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># curl -H "Accept:application/vnd.docker.image.rootfs.diff.tar.gzip" https://docker-search.4pd.io/v2/ubuntu/blobs/sha256:7ddbc47eeb70dc7f08e410a667948b87ff3883024eb41478b44ef9a81bf400c -o layer1.tar.gz</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sha256sum layer1.tar.gz</span></span><br><span class="line">7ddbc47eeb70dc7f08e410a6667948b87ff3883024eb41478b44ef9a81bf400c  layer1.tar.gz</span><br><span class="line"><span class="comment"># sha256sum layer1.tar</span></span><br><span class="line">cc967c529ced563b7746b663d98248bc571afdb3c012019d7f54d6c092793b8b  layer1.tar</span><br></pre></td></tr></table></figure></li>
<li><code>/var/lib/docker/image/overlay2/distribution</code> ä¸Šé¢layer digestå’Œdiff idçš„äº’ç›¸å¯¹åº”å…³ç³»</li>
</ul>
</li>
</ul>
<p><br></p>
<p><strong>/var/lib/docker/overlay2 - é•œåƒLayerå†…å®¹å­˜æ”¾ç›®å½•</strong><br>æè¿°:é•œåƒ layer çš„å†…å®¹éƒ½å­˜æ”¾åœ¨ä¸€ä¸ª diff çš„æ–‡ä»¶å¤¹ä¸‹(<code>å®ƒæ˜¯Layeræœ¬åœ°çœŸæ­£çš„å­˜å‚¨ä½ç½®</code>)ï¼Œdiff çš„ä¸Šçº§ç›®å½•å°±æ˜¯ä»¥é•œåƒ layer çš„ digest ä¸ºåçš„ç›®å½•;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$docker</span> images --digests --format <span class="string">"table &#123;&#123;.ID&#125;&#125;"</span> | grep -v <span class="string">"none"</span></span><br><span class="line">IMAGE ID            DIGEST</span><br><span class="line">1e4467b07108        sha256:5d1d5407f353843ecf8b16524bc5565aa332e9e6a1297c73a92d3e754b8a636d</span><br><span class="line">21f378ba43ec        sha256:72b62ec9d0e542f8656d3b9fdb9d11a8c375d9d3396575f999648c50bcd650e7</span><br><span class="line"></span><br><span class="line"><span class="variable">$ls</span> /var/lib/docker/overlay2 | egrep <span class="string">"14f7|75013"</span></span><br><span class="line">14f71bfdc22c04347ee318693557642f9af04cc1035cd11d92692ec138a086ae</span><br><span class="line">75013da532e8e1fca06ac64cc1c6cc61e3e67b7198eee411c70fab3322bc6df0</span><br><span class="line">75013da532e8e1fca06ac64cc1c6cc61e3e67b7198eee411c70fab3322bc6df0-init</span><br></pre></td></tr></table></figure></p>
<p>å…¶ä¸­è¿˜æœ‰ä¸ª l æ–‡ä»¶å¤¹(link çš„ç¼©å†™)ï¼Œä¸‹é¢æœ‰ä¸€å¨å¨çš„ç¡¬é“¾æ¥æ–‡ä»¶æŒ‡å‘ä¸Šçº§ç›®å½•çš„ layer ç›®å½•ï¼Œl ä¸‹çš„æ–‡ä»¶éƒ½æ˜¯ä¸€äº›æ¯” digest æ–‡ä»¶å¤¹åçŸ­ä¸€äº›çš„ï¼Œæ–¹é¢ä¸è‡³äº mount çš„å‚æ•°è¿‡é•¿ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$tree</span> /var/lib/docker/overlay2/l</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ 2R3OHCF7E7AQNZSMWJ7REQGQXF -&gt; ../14f71bfdc22c04347ee318693557642f9af04cc1035cd11d92692ec138a086ae/diff</span><br><span class="line">â”œâ”€â”€ QYJMESMUPSLVLW2WLVFOXGGJFB -&gt; ../75013da532e8e1fca06ac64cc1c6cc61e3e67b7198eee411c70fab3322bc6df0-init/diff</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>/var/lib/docker/containers/å®¹å™¨ID - è¿è¡Œæˆ–è€…æš‚åœçš„å®¹å™¨æ—¶ç›¸å…³ä¿¡æ¯</strong><br>æè¿°:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ls</span> -lah /var/lib/docker/containers/4a1a157c5e701af224f3a4c5fb04c47d5b6e90dedc7d2124e21ec9ac33f87991/</span><br><span class="line">-rw-r-----. 1 root root 647K 7æœˆ   2 09:11 4a1a157c5e701af224f3a4c5fb04c47d5b6e90dedc7d2124e21ec9ac33f87991-json.log <span class="comment">#æ ‡å‡†è¾“å…¥çš„æ—¥å¿—è®°å½•</span></span><br><span class="line">drwx------. 2 root root    6 4æœˆ   8 11:35 checkpoints  <span class="comment">#å®¹å™¨æ£€æŸ¥ä¿¡æ¯</span></span><br><span class="line">-rw-------. 1 root root 3.7K 7æœˆ   2 11:21 config.v2.json <span class="comment">#å®¹å™¨è®¾ç½®ä¿¡æ¯</span></span><br><span class="line">-rw-r--r--. 1 root root 1.7K 7æœˆ   2 11:21 hostconfig.json <span class="comment">#å®¹å™¨ä¸»æœºè®¾ç½®ä¿¡æ¯</span></span><br><span class="line">-rw-r--r--. 1 root root   13 6æœˆ  29 22:23 hostname  <span class="comment"># ä¸»æœºåç§°</span></span><br><span class="line">-rw-r--r--. 1 root root  171 7æœˆ   2 09:11 hosts  <span class="comment"># ä¸»æœºåŸŸåç»‘å®š</span></span><br><span class="line">drwx------. 3 root root   17 4æœˆ   8 11:35 mounts   <span class="comment"># æŒ‚è½½çš„æ•°æ®å·ä¿¡æ¯</span></span><br><span class="line">-rw-r--r--. 1 root root   38 6æœˆ  29 22:23 resolv.conf <span class="comment">#DNS åŸŸè®¾ç½®</span></span><br><span class="line">-rw-r--r--. 1 root root   71 6æœˆ  29 22:23 resolv.conf.hash</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>/var/lib/registry - é•œåƒä»“åº“ç›®å½•(éé»˜è®¤å¯è‡ªå®šä¹‰)</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Registry Container Create</span></span><br><span class="line"><span class="variable">$docker</span> run -d --name registry -p 5000:5000 -v /var/lib/registry:/var/lib/registry registry</span><br></pre></td></tr></table></figure></p>
<p>ç›®å½•ç»“æ„:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$tree</span> -h registry/</span><br><span class="line">registry/</span><br><span class="line">â””â”€â”€ [  22]  docker</span><br><span class="line">    â””â”€â”€ [  16]  registry</span><br><span class="line">        â””â”€â”€ [  39]  v2 <span class="comment">#ç‰ˆæœ¬åè®®</span></span><br><span class="line">            â”œâ”€â”€ [  20]  blobs <span class="comment">#å­˜å‚¨é•œåƒçš„Layer ä»¥åŠ Manifest å’Œ Image Config</span></span><br><span class="line">            â”‚Â Â  â””â”€â”€ [  36]  sha256</span><br><span class="line">            â”‚Â Â      â”œâ”€â”€ [  78]  53</span><br><span class="line">            â”‚Â Â      â”‚Â Â  â””â”€â”€ [  18]  5395625ce01dee311e2f7c879b0b148ac7525de7aad5080a518d7f7e5a99d368</span><br><span class="line">            â”‚Â Â      â”‚Â Â      â””â”€â”€ [1.1M]  data <span class="comment"># å­˜å‚¨é•œåƒçš„Layer </span></span><br><span class="line">            â”‚Â Â      â”œâ”€â”€ [  78]  8d</span><br><span class="line">            â”‚Â Â      â”‚Â Â  â””â”€â”€ [  18]  8dabce532312b587329fe225ef501051c60f81ffdb2c801a5da6348b9cab132e</span><br><span class="line">            â”‚Â Â      â”‚Â Â      â””â”€â”€ [ 528]  data <span class="comment"># Manifest æ˜¯é’ˆå¯¹registryæœåŠ¡ç«¯çš„é…ç½®ä¿¡æ¯ </span></span><br><span class="line">            â”‚Â Â      â””â”€â”€ [  78]  cb</span><br><span class="line">            â”‚Â Â          â””â”€â”€ [  18]  cb05b87d001253772ae9a212200de5eb8304ab9691c61589332a2f57e7059209</span><br><span class="line">            â”‚Â Â              â””â”€â”€ [1.4K]  data <span class="comment">#Image Configæ˜¯é’ˆå¯¹æœ¬åœ°é•œåƒçš„æè¿°</span></span><br><span class="line">            â””â”€â”€ [  22]  repositories <span class="comment"># å­˜å‚¨é•œåƒåœ¨ä»“åº“ç›¸å…³çš„ä¿¡æ¯ï¼Œæ–¹ä¾¿pullæ—¶å€™ä¸blobs å­˜å‚¨çš„é•œåƒä¿¡æ¯å¯¹åº”</span></span><br><span class="line">                â””â”€â”€ [  55]  go-hello</span><br><span class="line">                    â”œâ”€â”€ [  20]  _layers</span><br><span class="line">                    â”‚Â Â  â””â”€â”€ [ 150]  sha256</span><br><span class="line">                    â”‚Â Â      â”œâ”€â”€ [  18]  5395625ce01dee311e2f7c879b0b148ac7525de7aad5080a518d7f7e5a99d368</span><br><span class="line">                    â”‚Â Â      â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">                    â”‚Â Â      â””â”€â”€ [  18]  cb05b87d001253772ae9a212200de5eb8304ab9691c61589332a2f57e7059209</span><br><span class="line">                    â”‚Â Â          â””â”€â”€ [  71]  link</span><br><span class="line">                    â”œâ”€â”€ [  35]  _manifests</span><br><span class="line">                    â”‚Â Â  â”œâ”€â”€ [  20]  revisions</span><br><span class="line">                    â”‚Â Â  â”‚Â Â  â””â”€â”€ [  78]  sha256</span><br><span class="line">                    â”‚Â Â  â”‚Â Â      â””â”€â”€ [  18]  8dabce532312b587329fe225ef501051c60f81ffdb2c801a5da6348b9cab132e</span><br><span class="line">                    â”‚Â Â  â”‚Â Â          â””â”€â”€ [  71]  link</span><br><span class="line">                    â”‚Â Â  â””â”€â”€ [  21]  tags</span><br><span class="line">                    â”‚Â Â      â””â”€â”€ [  34]  scratch</span><br><span class="line">                    â”‚Â Â          â”œâ”€â”€ [  18]  current</span><br><span class="line">                    â”‚Â Â          â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">                    â”‚Â Â          â””â”€â”€ [  20]  index</span><br><span class="line">                    â”‚Â Â              â””â”€â”€ [  78]  sha256</span><br><span class="line">                    â”‚Â Â                  â””â”€â”€ [  18]  8dabce532312b587329fe225ef501051c60f81ffdb2c801a5da6348b9cab132e</span><br><span class="line">                    â”‚Â Â                      â””â”€â”€ [  71]  link</span><br><span class="line">                    â”œâ”€â”€[   6]  _uploads  <span class="comment"># æ–‡ä»¶å¤¹æ˜¯ä¸ªä¸´æ—¶çš„æ–‡ä»¶å¤¹ï¼Œä¸»è¦ç”¨æ¥å­˜æ”¾ push é•œåƒè¿‡ç¨‹ä¸­çš„æ–‡ä»¶æ•°æ®ä¸Šä¼ å®Œæˆåæ–‡ä»¶å¤¹å°†ä¼šè¢«æ¸…ç©º;</span></span><br><span class="line">                    â””â”€â”€ _manifests/  <span class="comment"># ç”±äºå¤ªå¤šæˆªå–ä¸€éƒ¨åˆ†</span></span><br><span class="line">                      â”œâ”€â”€ [  20]  revisions  <span class="comment"># _revisions ç›®å½•é‡Œå­˜æ”¾äº†è¯¥ repository å†å²ä¸Šä¸Šä¼ ç‰ˆæœ¬çš„æ‰€æœ‰ sha256 ç¼–ç ä¿¡æ¯ã€‚</span></span><br><span class="line">                      â”‚Â Â  â””â”€â”€ [ 150]  sha256</span><br><span class="line">                      â”‚Â Â      â”œâ”€â”€ [  18]  8dabce532312b587329fe225ef501051c60f81ffdb2c801a5da6348b9cab132e</span><br><span class="line">                      â”‚Â Â      â”‚Â Â  â””â”€â”€ [  71]  link  <span class="comment"># é“¾æ¥åˆ°å¯¹åº”çš„blobsç›®å½•ä¸­</span></span><br><span class="line">                      â”‚Â Â      â””â”€â”€ [  18]  b96f0ada640f7d628a4f22766f5432cbb1a4dfa208b03dc6444f8c699da9533c</span><br><span class="line">                      â”‚Â Â          â””â”€â”€ [  71]  link</span><br><span class="line">                      â””â”€â”€ [  34]  tags   <span class="comment">#é•œåƒæ ‡è®°ä¸­å­˜æœ‰ current ç›®å½•å’Œ index ç›®å½•</span></span><br><span class="line">                          â”œâ”€â”€ [  34]  scratch</span><br><span class="line">                          â”‚Â Â  â”œâ”€â”€ [  18]  current  <span class="comment"># current ç›®å½•ä¸‹çš„ link æ–‡ä»¶ä¿å­˜äº†è¯¥ tag ç›®å‰çš„ manifest æ–‡ä»¶çš„ sha256 ç¼–ç ï¼Œå¯¹åº”åœ¨ blobs ä¸­çš„ sha256 ç›®å½•ä¸‹çš„ data æ–‡ä»¶</span></span><br><span class="line">                          â”‚Â Â  â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">                          â”‚Â Â  â””â”€â”€ [  20]  index  <span class="comment"># index ç›®å½•åˆ™åˆ—å‡ºäº†è¯¥ tag å†å²ä¸Šä¼ çš„æ‰€æœ‰ç‰ˆæœ¬çš„ sha256 ç¼–ç ä¿¡æ¯</span></span><br><span class="line">                          â”‚Â Â      â””â”€â”€ [  78]  sha256</span><br><span class="line">                          â”‚Â Â          â””â”€â”€ [  18]  8dabce532312b587329fe225ef501051c60f81ffdb2c801a5da6348b9cab132e</span><br><span class="line">                          â”‚Â Â              â””â”€â”€ [  71]  link</span><br><span class="line">                          â””â”€â”€ [  34]  stage</span><br><span class="line">                              â”œâ”€â”€ [  18]  current</span><br><span class="line">                              â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">                              â””â”€â”€ [  20]  index</span><br><span class="line">                                  â””â”€â”€ [  78]  sha256</span><br><span class="line">                                      â””â”€â”€ [  18]  b96f0ada640f7d628a4f22766f5432cbb1a4dfa208b03dc6444f8c699da9533c</span><br><span class="line">                                          â””â”€â”€ [  71]  link</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>è¡¥å……è¯´æ˜:</p>
<ul>
<li>(1)åœ¨<code>/var/lib/registry/docker/registry/v2/blobs/sha256/53/{Digest}</code>ç›®å½•ä¸‹çš„dataæ–‡ä»¶å®é™…æ˜¯ä¸€ä¸ªå‹ç¼©æ–‡ä»¶å…¶æ–‡ä»¶æ ¼å¼<code>vnd.docker.image.rootfs.diff.tar.gzip</code>,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>tar</code>å‘½ä»¤å°†å…¶è§£å‹ï¼›<ul>
<li>åœ¨Dockeræ‹‰å–é•œåƒæ—¶å€™ä¼šä¸‹è½½è¯¥dataæ–‡ä»¶ï¼Œç­‰å¾…å®Œæˆådocker-untarè¿›ç¨‹å°†ä¼šæŠŠdataæ–‡ä»¶è§£å‹åˆ°<code>/var/lib/docker/overlay2/${digest}/diff</code>ç›®å½•ä¸‹<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$pwd</span></span><br><span class="line">/var/lib/registry/docker/registry/v2/blobs/sha256/53/5395625ce01dee311e2f7c879b0b148ac7525de7aad5080a518d7f7e5a99d368</span><br><span class="line"><span class="variable">$mkdir</span> layer</span><br><span class="line"><span class="variable">$tar</span> -xf data -C <span class="variable">$_</span></span><br><span class="line"><span class="variable">$ls</span> layer/</span><br><span class="line">hello     <span class="comment"># é•œåƒä¸­è¯¥Layeræ‰€å­˜å‚¨æ–‡ä»¶</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>(2) åœ¨<code>/var/lib/registry/docker/registry/v2/blobs/sha256/8d/{Digest}</code>ç›®å½•ä¸‹æ–‡dataæ–‡ä»¶å®é™…æ˜¯Manifestè®°å½•äº†ä¸€ä¸ªé•œåƒæ‰€åŒ…å«çš„ layer ä¿¡æ¯ï¼Œå½“æˆ‘ä»¬ pull é•œåƒçš„æ—¶å€™ä¼šä½¿ç”¨åˆ°è¿™ä¸ªæ–‡ä»¶;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$pwd</span></span><br><span class="line">/var/lib/registry/docker/registry/v2/blobs/sha256/8d/8dabce532312b587329fe225ef501051c60f81ffdb2c801a5da6348b9cab132e</span><br><span class="line"><span class="variable">$cat</span> data</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">"schemaVersion"</span>: 2,</span><br><span class="line">   <span class="comment"># é•œåƒ Image Config</span></span><br><span class="line">   <span class="string">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">   <span class="string">"config"</span>: &#123;</span><br><span class="line">      <span class="string">"mediaType"</span>: <span class="string">"application/vnd.docker.container.image.v1+json"</span>,</span><br><span class="line">      <span class="string">"size"</span>: 1472,</span><br><span class="line">      <span class="string">"digest"</span>: <span class="string">"sha256:cb05b87d001253772ae9a212200de5eb8304ab9691c61589332a2f57e7059209"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="comment"># é•œåƒå±‚Digest</span></span><br><span class="line">   <span class="string">"layers"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">         <span class="string">"size"</span>: 1106793,</span><br><span class="line">         <span class="string">"digest"</span>: <span class="string">"sha256:5395625ce01dee311e2f7c879b0b148ac7525de7aad5080a518d7f7e5a99d368"</span></span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>(3) åœ¨<code>/var/lib/registry/docker/registry/v2/blobs/sha256/cb/{digest}</code>ç›®å½•ä¸‹çš„dateæ–‡ä»¶å®é™…å­˜æ”¾çš„æ˜¯<code>Image config</code>æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"architecture"</span>: <span class="string">"amd64"</span>,</span><br><span class="line">  <span class="comment"># æœªæ¥æ ¹æ®è¿™ä¸ªimageå¯åŠ¨containeræ—¶ï¼Œconfigé‡Œé¢çš„é…ç½®å°±æ˜¯è¿è¡Œcontaineræ—¶çš„é»˜è®¤å‚æ•°ã€‚</span></span><br><span class="line">  <span class="string">"config"</span>: &#123;</span><br><span class="line">    <span class="string">"Hostname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"User"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"Env"</span>: [</span><br><span class="line">      <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"Cmd"</span>: [</span><br><span class="line">      <span class="string">"./hello"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"Image"</span>: <span class="string">"sha256:52e976b8f1f3a361b88de03eb6cd8f114a9ce3bece123d31e8d04f116cb4d862"</span>,</span><br><span class="line">    <span class="string">"Volumes"</span>: null,</span><br><span class="line">    <span class="string">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"Entrypoint"</span>: null,</span><br><span class="line">    <span class="string">"OnBuild"</span>: null,</span><br><span class="line">    <span class="string">"Labels"</span>: null</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment"># è¯¥é•œåƒæ—¶ä¸´æ—¶å®¹å™¨çš„ID</span></span><br><span class="line">  <span class="string">"container"</span>: <span class="string">"2247a541f3c65b40fe0b1af8d2bf8ac9d9d9d399e46b2f721a1e203484ad2de4"</span>,</span><br><span class="line">  <span class="comment"># å¯¹æ¯”containner_configä¸configçš„å†…å®¹ï¼Œå­—æ®µå®Œå…¨ä¸€è‡´éªŒè¯äº†configçš„ä½œç”¨ã€‚</span></span><br><span class="line">  <span class="string">"container_config"</span>: &#123;</span><br><span class="line">    <span class="string">"Hostname"</span>: <span class="string">"2247a541f3c6"</span>,</span><br><span class="line">    <span class="string">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"User"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"Env"</span>: [</span><br><span class="line">      <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"Cmd"</span>: [</span><br><span class="line">      <span class="string">"/bin/sh"</span>,</span><br><span class="line">      <span class="string">"-c"</span>,</span><br><span class="line">      <span class="string">"#(nop) "</span>,</span><br><span class="line">      <span class="string">"CMD [\"./hello\"]"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"Image"</span>: <span class="string">"sha256:52e976b8f1f3a361b88de03eb6cd8f114a9ce3bece123d31e8d04f116cb4d862"</span>,</span><br><span class="line">    <span class="string">"Volumes"</span>: null,</span><br><span class="line">    <span class="string">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"Entrypoint"</span>: null,</span><br><span class="line">    <span class="string">"OnBuild"</span>: null,</span><br><span class="line">    <span class="string">"Labels"</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"created"</span>: <span class="string">"2020-07-27T14:50:40.305884817Z"</span>,</span><br><span class="line">  <span class="string">"docker_version"</span>: <span class="string">"19.03.9"</span>,</span><br><span class="line">  <span class="comment"># æ„å»ºè¯¥é•œåƒçš„æ‰€æœ‰å†å²å‘½ä»¤</span></span><br><span class="line">  <span class="string">"history"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"created"</span>: <span class="string">"2020-07-27T14:50:40.251387904Z"</span>,</span><br><span class="line">      <span class="string">"created_by"</span>: <span class="string">"/bin/sh -c #(nop) COPY file:25386fc86439ade6abebd01bfc3fa9b402ce30141c2dd5a5539d00c3f623b541 in . "</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"created"</span>: <span class="string">"2020-07-27T14:50:40.305884817Z"</span>,</span><br><span class="line">      <span class="string">"created_by"</span>: <span class="string">"/bin/sh -c #(nop)  CMD [\"./hello\"]"</span>,</span><br><span class="line">      <span class="string">"empty_layer"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"os"</span>: <span class="string">"linux"</span>,</span><br><span class="line">  <span class="comment"># è¯¥é•œåƒåŒ…å«çš„layerå±‚çš„diff id</span></span><br><span class="line">  <span class="string">"rootfs"</span>: &#123;</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"layers"</span>,</span><br><span class="line">    <span class="string">"diff_ids"</span>: [</span><br><span class="line">      <span class="string">"sha256:a3586d8823611b4ebdec8742bedc72e50aecc5da2ff04c3f40c5f955591d7637"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>(4) åœ¨<code>/var/lib/registry/docker/registry/v2/repositories/{é•œåƒåç§°}/_uploads/</code>ç›®å½•å­˜æ”¾åœ¨pushé•œåƒè¿‡ç¨‹ä¸­çš„æ–‡ä»¶æ•°æ®ï¼Œå½“é•œåƒLayerä¸Šä¼ å®Œæ¯•åä¼šæ¸…ç©ºè¯¥æ–‡ä»¶å¤¹ï¼›å…¶ä¸­çš„ data æ–‡ä»¶ä¸Šä¼ å®Œæ¯•åä¼šç§»åŠ¨åˆ° blobs ç›®å½•ä¸‹ï¼Œå¹¶æ ¹æ®è¯¥æ–‡ä»¶çš„ sha256 å€¼æ¥è¿›è¡Œæ•£åˆ—å­˜å‚¨åˆ°ç›¸åº”çš„ç›®å½•ä¸‹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸Šä¼ è¿‡ç¨‹ä¸­çš„ç›®å½•ç»“æ„ï¼š</span></span><br><span class="line">_uploads</span><br><span class="line">â”œâ”€â”€ [  53]  0d6c996e-638f-4436-b2b6-54fa7ad430d2</span><br><span class="line">â”‚   â”œâ”€â”€ [198M]  data</span><br><span class="line">â”‚   â”œâ”€â”€ [  20]  hashstates</span><br><span class="line">â”‚   â”‚   â””â”€â”€ [  15]  sha256</span><br><span class="line">â”‚   â”‚       â””â”€â”€ [ 108]  0</span><br><span class="line">â”‚   â””â”€â”€ [  20]  startedat</span><br><span class="line">â””â”€â”€ [  53]  ba31818e-4217-47ef-ae46-2784c9222614</span><br><span class="line">    â”œâ”€â”€ [571M]  data</span><br><span class="line">    â”œâ”€â”€ [  20]  hashstates</span><br><span class="line">    â”‚   â””â”€â”€ [  15]  sha256</span><br><span class="line">    â”‚       â””â”€â”€ [ 108]  0</span><br><span class="line">    â””â”€â”€ [  20]  startedat</span><br><span class="line">6 directories, 6 files</span><br><span class="line"></span><br><span class="line">Tips:ä¸Šä¼ å®Œé•œåƒä¹‹å_uploads æ–‡ä»¶å¤¹å°±ä¼šè¢«æ¸…ç©ºï¼Œæ­£å¸¸æƒ…å†µä¸‹è¿™ä¸ªæ–‡ä»¶å¤¹æ˜¯ç©ºçš„; ä½†ä¹Ÿæœ‰å¼‚å¸¸çš„æ—¶å€™æ¯”å¦‚ç½‘ç»œæŠ–åŠ¨å¯¼è‡´ä¸Šä¼ æ„å¤–ä¸­æ–­ï¼Œè¯¥æ–‡ä»¶å¤¹å°±å¯èƒ½ä¸ä¸ºç©ºã€‚</span><br></pre></td></tr></table></figure>
</li>
<li><p>(5) åœ¨<code>/var/lib/registry/docker/registry/v2/repositories/{é•œåƒåç§°}/_mainfest/</code>ç›®å½•ä¸‹æ˜¯é•œåƒä¸Šä¼ å®Œæˆä¹‹åç”±Registryæ¥ç”Ÿæˆçš„ï¼Œå¹¶ä¸”è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªåä¸ºLinkçš„æ–‡æœ¬æ–‡ä»¶ï¼Œå…¶å€¼æŒ‡å‘blobsç›®å½•ä¸‹ä¸ä¹‹å¯¹åº”çš„ç›®å½•; åœ¨è¯¥ç›®å½•ä¸­åŒ…å«é•œåƒçš„tags å’Œ revisions ä¿¡æ¯ï¼Œæ¯ä¸€ä¸ªé•œåƒçš„æ¯ä¸€ä¸ªTagå¯¹åº”ç€äºtagåç§°ç›¸åŒçš„ç›®å½•;</p>
<ul>
<li>æ³¨æ„ç‚¹: é•œåƒçš„ tag å¹¶ä¸å­˜å‚¨åœ¨ image config ä¸­è€Œæ˜¯ä»¥ç›®å½•çš„å½¢å¼æ¥å½¢æˆé•œåƒçš„ tagï¼Œè¿™ä¸€ç‚¹æ¯”è¾ƒå¥‡å¦™è¿™å’Œæˆ‘ä»¬ Dockerfile ä¸­å¹¶ä¸åŒ…å«é•œåƒåå’Œ tag ä¸€ä¸ªé“ç†ï¼Ÿ<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$tree</span> -h 1 _manifests/</span><br><span class="line">_manifests/</span><br><span class="line">â”œâ”€â”€ [  20]  revisions</span><br><span class="line">â”‚Â Â  â””â”€â”€ [ 150]  sha256</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ [  18]  8dabce532312b587329fe225ef501051c60f81ffdb2c801a5da6348b9cab132e</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">â”‚Â Â      â””â”€â”€ [  18]  b96f0ada640f7d628a4f22766f5432cbb1a4dfa208b03dc6444f8c699da9533c</span><br><span class="line">â”‚Â Â          â””â”€â”€ [  71]  link</span><br><span class="line">â””â”€â”€ [  34]  tags</span><br><span class="line">    â”œâ”€â”€ [  34]  scratch</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ [  18]  current</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">    â”‚Â Â  â””â”€â”€ [  20]  index</span><br><span class="line">    â”‚Â Â      â””â”€â”€ [  78]  sha256</span><br><span class="line">    â”‚Â Â          â””â”€â”€ [  18]  8dabce532312b587329fe225ef501051c60f81ffdb2c801a5da6348b9cab132e</span><br><span class="line">    â”‚Â Â              â””â”€â”€ [  71]  link</span><br><span class="line">    â””â”€â”€ [  34]  stage</span><br><span class="line">        â”œâ”€â”€ [  18]  current</span><br><span class="line">        â”‚Â Â  â””â”€â”€ [  71]  link</span><br><span class="line">        â””â”€â”€ [  20]  index</span><br><span class="line">            â””â”€â”€ [  78]  sha256</span><br><span class="line">                â””â”€â”€ [  18]  b96f0ada640f7d628a4f22766f5432cbb1a4dfa208b03dc6444f8c699da9533c</span><br><span class="line">                    â””â”€â”€ [  71]  link</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¡¥å……è¯´æ˜</span></span><br><span class="line">- _revisions ç›®å½•é‡Œå­˜æ”¾äº†è¯¥ repository å†å²ä¸Šä¸Šä¼ ç‰ˆæœ¬çš„æ‰€æœ‰ sha256 ç¼–ç ä¿¡æ¯ã€‚</span><br><span class="line">- tags/index ç›®å½•åˆ™åˆ—å‡ºäº†è¯¥ tag å†å²ä¸Šä¼ çš„æ‰€æœ‰ç‰ˆæœ¬çš„ sha256 ç¼–ç æ¯      </span><br><span class="line">- tags/current ç›®å½•ä¸‹çš„ link æ–‡ä»¶ä¿å­˜äº†è¯¥ tag ç›®å‰çš„ manifest æ–‡ä»¶çš„ sha256 ç¼–ç å¯¹åº”åœ¨ blobs ä¸­çš„ sha256 ç›®å½•ä¸‹çš„ data æ–‡ä»¶ï¼Œåœ¨`æ‹‰å–é•œåƒæ—¶å€™ä¼šé¦–å…ˆæ‰¾åˆ°è¯¥ç›®å½•ä¸‹çš„linksæ–‡ä»¶ä¸­çš„sha256å€¼å¯¹åº”ç›®å½•çš„manifestè¿”å›ç»™å®¢æˆ·ç«¯`;</span><br><span class="line"><span class="variable">$cat</span> /var/lib/registry/docker/registry/v2/repositories/go-hello/_manifests/tags/scratch/current/link</span><br><span class="line">sha256:8dabce532312b587329fe225ef501051c60f81ffdb2c801a5da6348b9cab132e</span><br><span class="line"><span class="variable">$ls</span> -lah /var/lib/registry/docker/registry/v2/blobs/sha256/8d/8dabce532312b587329fe225ef501051c60f81ffdb2c801a5da6348b9cab132e/</span><br><span class="line">æ€»ç”¨é‡ 4.0K</span><br><span class="line">drwxr-xr-x. 2 root root  18 8æœˆ   2 09:58 .</span><br><span class="line">drwxr-xr-x. 3 root root  78 8æœˆ   2 09:58 ..</span><br><span class="line">-rw-r--r--. 1 root root 528 8æœˆ   2 09:58 data</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p><br></p>
<h5 id="2-åŸºç¡€å®ä¾‹"><a href="#2-åŸºç¡€å®ä¾‹" class="headerlink" title="2.åŸºç¡€å®ä¾‹"></a>2.åŸºç¡€å®ä¾‹</h5><p>æè¿°:ä¸ºäº†æ›´å¥½çš„äº†è§£ç›®å½•åŠå…¶æ–‡ä»¶ä½œç”¨ï¼Œæˆ‘ä»¬æ„å»ºä¸€ä¸ªé•œåƒæ¥å­˜å‚¨åˆ°æœ¬åœ°;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; Dockerfile &lt;&lt;END</span><br><span class="line">FROM alpine</span><br><span class="line">LABEL name=<span class="string">"test-image"</span></span><br><span class="line">RUN <span class="built_in">echo</span> <span class="string">"http://mirrors.ustc.edu.cn/alpine/v3.10/main"</span> &gt; /etc/apk/repositories; \</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"http://mirrors.ustc.edu.cn/alpine/v3.10/community"</span>&gt;&gt; /etc/apk/repositories; \</span><br><span class="line">apk -v add --no-cache bash; \</span><br><span class="line">apk -v add --no-cache curl</span><br><span class="line">COPY ./startService.sh /</span><br><span class="line">CMD [<span class="string">"/bin/bash"</span>, <span class="string">"/startService.sh"</span>]</span><br><span class="line">END</span><br></pre></td></tr></table></figure><br>æ„å»ºè¿‡ç¨‹è¾“å‡ºå¦‚ä¸‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$docker</span> build -t <span class="built_in">test</span>-image .</span><br><span class="line">Sending build context to Docker daemon  3.072kB</span><br><span class="line">Step 1/6 : FROM alpine</span><br><span class="line">  ---&gt; 3f53bb00af94              <span class="comment"># é•œåƒid</span></span><br><span class="line">Step 2/6 : LABEL name=<span class="string">"test-image"</span></span><br><span class="line"><span class="comment">#  ---&gt; Running in 3bd6320fc291  # è¿è¡Œçš„å®¹å™¨ id</span></span><br><span class="line"><span class="comment"># Removing intermediate container 3bd6320fc291  # å¯¹è¿è¡Œçš„å®¹å™¨è¿›è¡Œå†™åå¹¶ç§»é™¤è¯¥å®¹å™¨</span></span><br><span class="line"> ---&gt; bb97dd1fb1a1               <span class="comment"># é•œåƒid</span></span><br><span class="line">Step 3/6 : RUN apk -v add --no-cache bash</span><br><span class="line"><span class="comment">#  ---&gt; Running in f9987ff57ad7  # è¿è¡Œçš„å®¹å™¨ id</span></span><br><span class="line">fetch http://mirrors.ustc.edu.cn/alpine/v3.8/main/x86_64/APKINDEX.tar.gz</span><br><span class="line">fetch http://mirrors.ustc.edu.cn/alpine/v3.8/community/x86_64/APKINDEX.tar.gz</span><br><span class="line">(1/5) Installing ncurses-terminfo-base (6.1_p20180818-r1)</span><br><span class="line">(2/5) Installing ncurses-terminfo (6.1_p20180818-r1)</span><br><span class="line">(3/5) Installing ncurses-libs (6.1_p20180818-r1)</span><br><span class="line">(4/5) Installing readline (7.0.003-r0)</span><br><span class="line">(5/5) Installing bash (4.4.19-r1)</span><br><span class="line">Executing bash-4.4.19-r1.post-install</span><br><span class="line">Executing busybox-1.28.4-r2.trigger</span><br><span class="line">OK: 18 packages, 136 <span class="built_in">dirs</span>, 2877 files, 13 MiB</span><br><span class="line"><span class="comment"># Removing intermediate container f9987ff57ad7</span></span><br><span class="line"> ---&gt; a5635f1b1d00               <span class="comment"># é•œåƒid</span></span><br><span class="line">Step 4/6 : RUN apk -v add --no-cache curl</span><br><span class="line"><span class="comment">#  ---&gt; Running in c49fb2e4b311  # è¿è¡Œçš„å®¹å™¨ id  </span></span><br><span class="line">fetch http://mirrors.ustc.edu.cn/alpine/v3.8/main/x86_64/APKINDEX.tar.gz</span><br><span class="line">fetch http://mirrors.ustc.edu.cn/alpine/v3.8/community/x86_64/APKINDEX.tar.gz</span><br><span class="line">(1/5) Installing ca-certificates (20171114-r3)</span><br><span class="line">(2/5) Installing nghttp2-libs (1.32.0-r0)</span><br><span class="line">(3/5) Installing libssh2 (1.8.0-r3)</span><br><span class="line">(4/5) Installing libcurl (7.61.1-r1)</span><br><span class="line">(5/5) Installing curl (7.61.1-r1)</span><br><span class="line">Executing busybox-1.28.4-r2.trigger</span><br><span class="line">Executing ca-certificates-20171114-r3.trigger</span><br><span class="line">OK: 23 packages, 141 <span class="built_in">dirs</span>, 3040 files, 15 MiB</span><br><span class="line"><span class="comment"># Removing intermediate container c49fb2e4b311</span></span><br><span class="line"> ---&gt; 9156d1521a2f           <span class="comment"># é•œåƒid</span></span><br><span class="line">Step 5/6 : COPY ./startService.sh /  <span class="comment"># none</span></span><br><span class="line"> ---&gt; 704626646baf           <span class="comment"># é•œåƒid</span></span><br><span class="line">Step 6/6 : CMD [<span class="string">"/bin/bash"</span>, <span class="string">"/startService.sh"</span>]</span><br><span class="line"><span class="comment">#  ---&gt; Running in 1c5e6e861264    # è¿è¡Œçš„å®¹å™¨ id</span></span><br><span class="line"><span class="comment"># Removing intermediate container 1c5e6e861264</span></span><br><span class="line"> ---&gt; 6cd0a66e83f1           <span class="comment"># é•œåƒid</span></span><br><span class="line">Successfully built 6cd0a66e83f1  <span class="comment"># æœ€ç»ˆç”Ÿæˆçš„test-imageé•œåƒIDä¸º 6cd0a66e83f1 </span></span><br><span class="line">Successfully tagged <span class="built_in">test</span>-image:latest</span><br></pre></td></tr></table></figure></p>
<p>æ„å»ºè¿‡ç¨‹å¦‚å›¾æ‰€ç¤º:<br><figure class="image-box">
                <a rel=n2.Dockerå®¶æ–‡ä»¶ç›®å½•ä»‹ç»å’Œé…ç½®æ–‡ä»¶ä¸å®ˆæŠ¤è¿›ç¨‹å‘½ä»¤å‚æ•°ä¸€è§ˆ href="https://img.weiyigeek.top/2020/1/20200805172819.png" target="_blank" title="WeiyiGeek.docker" data-fancybox="images"><img src="https://img.weiyigeek.top/2020/1/20200805172819.png" alt="WeiyiGeek.docker" title="" class=""></a>
                <p>WeiyiGeek.docker</p>
            </figure></p>
<p>é¦–å…ˆæŸ¥çœ‹é•œåƒçš„åŸºæœ¬ä¿¡æ¯ç„¶åè¿›è¡Œåˆ†ææœ¬åœ°ç›®å½•:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker images --digests <span class="built_in">test</span>-image</span><br><span class="line">REPOSITORY          TAG                 DIGEST              IMAGE ID            CREATED             SIZE</span><br><span class="line"><span class="built_in">test</span>-image          latest              &lt;none&gt;              6cd0a66e83f1        About an hour ago </span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚å‰é¢æ‰€è¿°digestæ˜¯æœ‰docker repositoryç”Ÿæˆï¼Œå› ä¸ºæœ¬åœ°æ„å»ºå®Œä¹‹åå¹¶æ²¡æœ‰æ¨é€è‡³è¿œç¨‹ä»“åº“ï¼Œæ‰€ä»¥ä¸ºNoneã€‚</span></span><br></pre></td></tr></table></figure></p>
<p>æ­¤æ—¶<code>/var/lib/docker/image</code>ç›®å½•å‘é€å¦‚ä¸‹å˜åŒ–<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">image/</span><br><span class="line">â””â”€â”€ overlay2</span><br><span class="line">    â”œâ”€â”€ distribution</span><br><span class="line">    â”‚   â”œâ”€â”€ diffid-by-digest</span><br><span class="line">    â”‚   â”‚   â””â”€â”€ sha256</span><br><span class="line">    â”‚   â”‚       â””â”€â”€ cd784148e3483c2c86c50a48e535302ab0288bebd587accf40b714fffd0646b3</span><br><span class="line">    â”‚   â””â”€â”€ v2metadata-by-diffid <span class="comment"># å…ƒæ•°æ®ç”±diff id</span></span><br><span class="line">    â”‚       â””â”€â”€ sha256</span><br><span class="line">    â”‚           â””â”€â”€ 7bff100f35cb359a368537bb07829b055fe8e0b1cb01085a3a628ae9c187c7b8</span><br><span class="line">    â”œâ”€â”€ imagedb   <span class="comment"># é•œåƒæ•°æ®åº“</span></span><br><span class="line">    â”‚   â”œâ”€â”€ content </span><br><span class="line">    â”‚   â”‚   â””â”€â”€ sha256 <span class="comment"># æ„å»ºé•œåƒæ—¶å„Layerå±‚çš„é•œåƒID</span></span><br><span class="line">    â”‚   â”‚       â”œâ”€â”€ 3f53bb00af943dfdf815650be70c0fa7b426e56a66f5e3362b47a129d57d5991 <span class="comment"># Alpine</span></span><br><span class="line">    â”‚   â”‚       â”œâ”€â”€ 6cd0a66e83f133a2bad37103ed03f6480330fa3c469368eb5871320996d3b924 <span class="comment"># test-Images</span></span><br><span class="line">    â”‚   â”‚       â”œâ”€â”€ 704626646baf8bdea82da237819cded076a0852eb97dba2fc731569dd85ae836</span><br><span class="line">    â”‚   â”‚       â”œâ”€â”€ 9156d1521a2fd50d972e1e1abc30d37df7c8e8f7825ca5955170f3b5441b3341</span><br><span class="line">    â”‚   â”‚       â”œâ”€â”€ a5635f1b1d0078cd926f21ef3ed77b357aa899ac0c8bf80cae51c37129167e3a</span><br><span class="line">    â”‚   â”‚       â””â”€â”€ bb97dd1fb1a10b717655594950efb4605ff0d3f2f631feafc4558836c2b34c3c</span><br><span class="line">    â”‚   â””â”€â”€ metadata <span class="comment"># å…ƒæ•°æ® (åœ¨æ„å»ºtest-imageä¹‹å‰ï¼Œmetadataç›®å½•ä¸ºç©ºï¼Œå› ä¸ºalpineæ²¡æœ‰parent) åœ¨buildä¹‹åæ–°å¢äº†5ä¸ªç›®å½•ï¼Œåˆ†åˆ«å¯¹åº”docker build test-imageæ‰€äº§ç”Ÿçš„5ä¸ªé•œåƒï¼Œæ¯ä¸€å±‚ä»¥ä¸Šä¸€å±‚ä¸ºparentï¼Œå³parentæ–‡ä»¶ä¸­å­˜å‚¨äº†ä¸Šä¸€å±‚image idã€‚</span></span><br><span class="line">    â”‚       â””â”€â”€ sha256</span><br><span class="line">    â”‚           â”œâ”€â”€ 6cd0a66e83f133a2bad37103ed03f6480330fa3c469368eb5871320996d3b924</span><br><span class="line">    â”‚           â”‚   â”œâ”€â”€ lastUpdated</span><br><span class="line">    â”‚           â”‚   â””â”€â”€ parent  <span class="comment"># æº(çˆ¶)é•œåƒid</span></span><br><span class="line">    â”‚           â”œâ”€â”€ 704626646baf8bdea82da237819cded076a0852eb97dba2fc731569dd85ae836</span><br><span class="line">    â”‚           â”‚   â””â”€â”€ parent</span><br><span class="line">    â”‚           â”œâ”€â”€ 9156d1521a2fd50d972e1e1abc30d37df7c8e8f7825ca5955170f3b5441b3341</span><br><span class="line">    â”‚           â”‚   â””â”€â”€ parent</span><br><span class="line">    â”‚           â”œâ”€â”€ a5635f1b1d0078cd926f21ef3ed77b357aa899ac0c8bf80cae51c37129167e3a</span><br><span class="line">    â”‚           â”‚   â””â”€â”€ parent</span><br><span class="line">    â”‚           â””â”€â”€ bb97dd1fb1a10b717655594950efb4605ff0d3f2f631feafc4558836c2b34c3c</span><br><span class="line">    â”‚               â””â”€â”€ parent</span><br><span class="line">    â”œâ”€â”€ layerdb <span class="comment"># å±‚æ•°æ®åº“</span></span><br><span class="line">    â”‚   â”œâ”€â”€ mounts <span class="comment"># å½“ç”±é•œåƒç”Ÿæˆå®¹å™¨æ—¶ï¼Œè¯¥ç›®å½•ä¸‹ä¼šç”Ÿæˆå®¹å™¨çš„å¯è¯»å¯å†™ä¸¤ä¸ªlayerï¼Œå¯è¯»å³ä¸ºç”±é•œåƒç”Ÿæˆï¼Œè€Œå¯å†™å°±æ˜¯æœªæ¥å¯¹å®¹å™¨çš„ä¿®æ”¹éƒ½ä¼šæ”¾åœ¨</span></span><br><span class="line">    â”‚   â”œâ”€â”€ sha256 <span class="comment"># é•œåƒ Layerçš„diff idï¼ˆä½†æ˜¯å®é™…åªæœ‰å››å±‚ï¼‰</span></span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ 0e88764cdf90e8a5d6597b2d8e65b8f70e7b62982b0aee934195b54600320d47</span><br><span class="line">    â”‚   â”‚   â”‚   â”œâ”€â”€ cache-id</span><br><span class="line">    â”‚   â”‚   â”‚   â”œâ”€â”€ diff</span><br><span class="line">    â”‚   â”‚   â”‚   â”œâ”€â”€ parent</span><br><span class="line">    â”‚   â”‚   â”‚   â”œâ”€â”€ size</span><br><span class="line">    â”‚   â”‚   â”‚   â””â”€â”€ tar-split.json.gz</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ 7bff100f35cb359a368537bb07829b055fe8e0b1cb01085a3a628ae9c187c7b8</span><br><span class="line">    â”‚   â”‚   â”‚   â”œâ”€â”€ cache-id</span><br><span class="line">    â”‚   â”‚   â”‚   â”œâ”€â”€ diff</span><br><span class="line">    â”‚   â”‚   â”‚   â”œâ”€â”€ size</span><br><span class="line">    â”‚   â”‚   â”‚   â””â”€â”€ tar-split.json.gz</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ 80fe1abae43103e3be54ac2813114d1dea6fc91454a3369104b8dd6e2b1363f5</span><br><span class="line">    â”‚   â”‚   â”‚   â”œâ”€â”€ cache-id</span><br><span class="line">    â”‚   â”‚   â”‚   â”œâ”€â”€ diff</span><br><span class="line">    â”‚   â”‚   â”‚   â”œâ”€â”€ parent</span><br><span class="line">    â”‚   â”‚   â”‚   â”œâ”€â”€ size</span><br><span class="line">    â”‚   â”‚   â”‚   â””â”€â”€ tar-split.json.gz</span><br><span class="line">    â”‚   â”‚   â””â”€â”€ db7c15c2f03f63a658285a55edc0a0012ccd0033f4695d4b428b1b464637e655</span><br><span class="line">    â”‚   â”‚       â”œâ”€â”€ cache-id</span><br><span class="line">    â”‚   â”‚       â”œâ”€â”€ diff</span><br><span class="line">    â”‚   â”‚       â”œâ”€â”€ parent</span><br><span class="line">    â”‚   â”‚       â”œâ”€â”€ size</span><br><span class="line">    â”‚   â”‚       â””â”€â”€ tar-split.json.gz</span><br><span class="line">    â”‚   â””â”€â”€ tmp</span><br><span class="line">    â””â”€â”€ repositories.json</span><br></pre></td></tr></table></figure><br>åœ¨imagedbçš„<code>content</code>å’Œ<code>metadata</code>ä¸‹å¢åŠ äº†buildè¿‡ç¨‹ä¸­äº§ç”Ÿçš„é•œåƒï¼ˆé•œåƒIDèƒ½å¤Ÿä¸€ä¸€å¯¹åº”ï¼‰ï¼Œåœ¨layerdbä¸‹å¢åŠ äº†ä¸‰ä¸ªLayerï¼Œç›®å‰è¿˜çœ‹ä¸å‡ºæ¥å…³è”å…³ç³»ï¼Œåç»­åˆ†æã€‚</p>
<ul>
<li><p>Step1.å…ˆä»<code>repositories.json</code>æ–‡ä»¶çœ‹èµ·</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$cat</span> image/overlay2/repositories.json | python -m json.tool</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"Repositories"</span>: &#123;</span><br><span class="line">        <span class="string">"alpine"</span>: &#123;</span><br><span class="line">            <span class="string">"alpine:latest"</span>: <span class="string">"sha256:3f53bb00af943dfdf815650be70c0fa7b426e56a66f5e3362b47a129d57d5991"</span>,</span><br><span class="line">            <span class="string">"alpine@sha256:46e71df1e5191ab8b8034c5189e325258ec44ea739bba1e5645cff83c9048ff1"</span>: <span class="string">"sha256:3f53bb00af943dfdf815650be70c0fa7b426e56a66f5e3362b47a129d57d5991"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment"># é•œåƒID : å¢åŠ äº†test-imageè¯¥é¡¹åŒ…å«å…¶tagå’Œidã€‚</span></span><br><span class="line">        <span class="string">"test-image"</span>: &#123;</span><br><span class="line">            <span class="string">"test-image:latest"</span>: <span class="string">"sha256:6cd0a66e83f133a2bad37103ed03f6480330fa3c469368eb5871320996d3b924"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Step2.ä»¥test-imageä¸ºä¾‹ï¼ˆç›®å‰çš„æœ€åº•å±‚é•œåƒï¼‰ï¼ŒæŸ¥çœ‹å…¶æè¿°ä¿¡æ¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"architecture"</span>: <span class="string">"amd64"</span>,</span><br><span class="line">    <span class="string">"config"</span>: &#123;</span><br><span class="line">        <span class="string">"ArgsEscaped"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"Cmd"</span>: [</span><br><span class="line">            <span class="string">"/bin/bash"</span>,</span><br><span class="line">            <span class="string">"/startService.sh"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"Entrypoint"</span>: null,</span><br><span class="line">        <span class="string">"Env"</span>: [</span><br><span class="line">            <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"Hostname"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"Image"</span>: <span class="string">"sha256:704626646baf8bdea82da237819cded076a0852eb97dba2fc731569dd85ae836"</span>,</span><br><span class="line">        <span class="string">"Labels"</span>: &#123;</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"test-image"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"OnBuild"</span>: null,</span><br><span class="line">        <span class="string">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"User"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"Volumes"</span>: null,</span><br><span class="line">        <span class="string">"WorkingDir"</span>: <span class="string">""</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment"># å®¹å™¨IDå¯ä»¥ä¸å›¾XXä¸­ç”Ÿæˆè¯¥imageçš„å®¹å™¨IDå¯¹åº”ä¸Šå³æœ€åä¸€æ¬¡æ„å»ºé•œåƒæ—¶çš„å®¹å™¨ID;</span></span><br><span class="line">    <span class="string">"container"</span>: <span class="string">"1c5e6e861264654f79a190eba5157dd4dedce59ab3de098a3625fb4e5b6f1d98"</span>,</span><br><span class="line">    <span class="comment"># å®¹å™¨é…ç½®çŠ¶æ€å®é™…æ˜¯æ‰§è¡Œå®Œdockerfileä¸­å‘½ä»¤ä¹‹åçš„å®¹å™¨çŠ¶æ€;</span></span><br><span class="line">    <span class="string">"container_config"</span>: &#123;</span><br><span class="line">        <span class="string">"ArgsEscaped"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"Cmd"</span>: [</span><br><span class="line">            <span class="string">"/bin/sh"</span>,</span><br><span class="line">            <span class="string">"-c"</span>,</span><br><span class="line">            <span class="string">"#(nop) "</span>,</span><br><span class="line">            <span class="string">"CMD [\"/bin/bash\" \"/startService.sh\"]"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"Entrypoint"</span>: null,</span><br><span class="line">        <span class="string">"Env"</span>: [</span><br><span class="line">            <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"Hostname"</span>: <span class="string">"1c5e6e861264"</span>,</span><br><span class="line">        <span class="string">"Image"</span>: <span class="string">"sha256:704626646baf8bdea82da237819cded076a0852eb97dba2fc731569dd85ae836"</span>,</span><br><span class="line">        <span class="string">"Labels"</span>: &#123;</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"test-image"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"OnBuild"</span>: null,</span><br><span class="line">        <span class="string">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"User"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"Volumes"</span>: null,</span><br><span class="line">        <span class="string">"WorkingDir"</span>: <span class="string">""</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"created"</span>: <span class="string">"2019-01-01T02:29:19.701494089Z"</span>,</span><br><span class="line">    <span class="string">"docker_version"</span>: <span class="string">"18.09.0"</span>,</span><br><span class="line">    <span class="string">"history"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"created"</span>: <span class="string">"2018-12-21T00:21:29.97055571Z"</span>,</span><br><span class="line">            <span class="string">"created_by"</span>: <span class="string">"/bin/sh -c #(nop) ADD file:2ff00caea4e83dfade726ca47e3c795a1e9acb8ac24e392785c474ecf9a621f2 in / "</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"created"</span>: <span class="string">"2018-12-21T00:21:30.122610396Z"</span>,</span><br><span class="line">            <span class="string">"created_by"</span>: <span class="string">"/bin/sh -c #(nop)  CMD [\"/bin/sh\"]"</span>,</span><br><span class="line">            <span class="string">"empty_layer"</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"created"</span>: <span class="string">"2019-01-01T02:29:06.530296297Z"</span>,</span><br><span class="line">            <span class="string">"created_by"</span>: <span class="string">"/bin/sh -c #(nop)  LABEL name=test-image"</span>,</span><br><span class="line">            <span class="string">"empty_layer"</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"created"</span>: <span class="string">"2019-01-01T02:29:14.182236016Z"</span>,</span><br><span class="line">            <span class="string">"created_by"</span>: <span class="string">"/bin/sh -c apk -v add --no-cache bash"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"created"</span>: <span class="string">"2019-01-01T02:29:19.327280058Z"</span>,</span><br><span class="line">            <span class="string">"created_by"</span>: <span class="string">"/bin/sh -c apk -v add --no-cache curl"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"created"</span>: <span class="string">"2019-01-01T02:29:19.549474383Z"</span>,</span><br><span class="line">            <span class="string">"created_by"</span>: <span class="string">"/bin/sh -c #(nop) COPY file:fff66db7f2d773b25215edcc9d5697d84813835e3b731e5a6afe9a9b9647ecec in / "</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"created"</span>: <span class="string">"2019-01-01T02:29:19.701494089Z"</span>,</span><br><span class="line">            <span class="string">"created_by"</span>: <span class="string">"/bin/sh -c #(nop)  CMD [\"/bin/bash\" \"/startService.sh\"]"</span>,</span><br><span class="line">            <span class="string">"empty_layer"</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"os"</span>: <span class="string">"linux"</span>,</span><br><span class="line">    <span class="comment"># test-imageé•œåƒåŒ…å«çš„Layerçš„diff id (å››å±‚)</span></span><br><span class="line">    <span class="comment"># åœ¨ LABEL name="test-image"å’ŒCMD ["/bin/bash", "/startService.sh"] è¿™ä¸¤è¡Œå¹¶æœªäº§ç”Ÿæ–°çš„Layerç”±äºå…¶å¹¶æœªæ”¹å˜æ–‡ä»¶ç³»ç»Ÿä¸­ä»»ä½•æ–‡ä»¶åªæ˜¯å†™åœ¨äº†Image-Configä¸­;</span></span><br><span class="line">    <span class="string">"rootfs"</span>: &#123;</span><br><span class="line">        <span class="string">"diff_ids"</span>: [</span><br><span class="line">            <span class="string">"sha256:7bff100f35cb359a368537bb07829b055fe8e0b1cb01085a3a628ae9c187c7b8"</span>,</span><br><span class="line">            <span class="string">"sha256:b1ddbff022577cd249a074285a1a7eb76d7c9139132ba5aa4272fc115dfa9e36"</span>,</span><br><span class="line">            <span class="string">"sha256:9edc93f4dcf640f272ed73f933863dbefae6719745093d09c6c6908f402b1c34"</span>,</span><br><span class="line">            <span class="string">"sha256:a6c8828ba4b58628284f783d3c918ac379ae2aba0830f4c926a330842361ffb6"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"type"</span>: <span class="string">"layers"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>äº‹å®ä¸Šå¦‚æœæˆ‘ä»¬è®¤ä¸ºé•œåƒæ˜¯ä¸€ä¸ªæ‰“åŒ…çš„é™æ€OSï¼Œé‚£ä¹ˆLayerå¯ä»¥è®¤ä¸ºæ˜¯æè¿°è¯¥OSçš„fså˜åŒ–ï¼Œ<code>å³æ–‡ä»¶ç³»ç»Ÿä¸­æ–‡ä»¶æˆ–è€…ç›®å½•å‘ç”Ÿçš„æ”¹å˜</code>ï¼Œå¾ˆæ˜æ˜¾ä¸Šè¿°ä¸¤è¡Œå‘½ä»¤å¹¶ä¸ä¼šå¼•èµ·fsçš„å˜åŒ–åªæ˜¯ä¼šå†™å…¥è¯¥é•œåƒçš„configä¸­ï¼Œ<code>åœ¨ç”Ÿæˆå®¹å™¨æ—¶è¯»å–å³å¯è‡ªç„¶ä¹Ÿå°±ä¸å­˜åœ¨diff id</code>ã€‚<br><figure class="image-box">
                <a rel=n2.Dockerå®¶æ–‡ä»¶ç›®å½•ä»‹ç»å’Œé…ç½®æ–‡ä»¶ä¸å®ˆæŠ¤è¿›ç¨‹å‘½ä»¤å‚æ•°ä¸€è§ˆ href="https://img.weiyigeek.top/2020/1/20200806094310.png" target="_blank" title="WeiyiGeek.diff-id" data-fancybox="images"><img src="https://img.weiyigeek.top/2020/1/20200806094310.png" alt="WeiyiGeek.diff-id" title="" class=""></a>
                <p>WeiyiGeek.diff-id</p>
            </figure></p>
<ul>
<li>Step3.å…¶æ¬¡ç›®å‰Layerå·²ç»å¢åŠ è‡³4ä¸ªï¼Œè¿™ä¸æˆ‘ä»¬ä¸Šä¸€èŠ‚ä¸­çœ‹åˆ°çš„test-imageçš„rootfsé…ç½®ä¸­æœ‰4ä¸ªlayer diif idèƒ½å¤Ÿå¯¹åº”ä¸Šï¼Œç„¶åå¾ˆæ˜¾ç„¶é™¤äº†ç¬¬ä¸€å±‚çš„â€7bff100f35cbâ€èƒ½å¯¹åº”ä¸Šå…¶ä»–ä¸‰ä¸ªå®Œå…¨ä¸åŒï¼›<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ChainID(A) = DiffID(A) = sha256:7bff100f35cb359a368537bb07829b055fe8e0b1cb01085a3a628ae9c187c7b8</span><br></pre></td></tr></table></figure>
è¿›ä¸€æ­¥ç ”ç©¶æ‰çŸ¥é“è¿™é‡Œç›®å½•åå…¶å®æ˜¯layerçš„chain idï¼Œè€Œédiff idï¼Œå…³äºè¿™ä¸¤è¿™ä¸ªçš„åŒºåˆ«ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸º<code>diff idç”¨æ¥æè¿°å•ä¸ªå˜åŒ–</code> è€Œ <code>chain idç”¨æ¥ä¾¿äºä¸€äº›åˆ—çš„å˜åŒ–</code>ï¼Œ</li>
</ul>
<p>é‡ç‚¹:<code>diff idå’Œchain id</code>ä¹‹é—´çš„è®¡ç®—å…¬å¼å¯ä»¥åœ¨image-specä¸­çœ‹åˆ°ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ChainID(A) = DiffID(A)</span><br><span class="line">ChainID(A|B) = Digest(ChainID(A) + <span class="string">" "</span> + DiffID(B))</span><br><span class="line">ChainID(A|B|C) = Digest(ChainID(A|B) + <span class="string">" "</span> + DiffID(C))</span><br></pre></td></tr></table></figure><br>æ­¤å¤„ä»¥test-imageçš„rootfséªŒè¯åˆ†æä»–ä»¬æ˜¯å¦‚ä½•å…³è”çš„:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"rootfs"</span>: &#123;</span><br><span class="line">    <span class="comment"># æ–‡ä»¶ç³»ç»Ÿå·®å¼‚æ ‡è¯†</span></span><br><span class="line">    <span class="string">"diff_ids"</span>: [</span><br><span class="line">        <span class="string">"sha256:7bff100f35cb359a368537bb07829b055fe8e0b1cb01085a3a628ae9c187c7b8"</span>,  <span class="comment"># è¯¥å±‚å¯ä»¥å¯¹åº”ä¸Šdir</span></span><br><span class="line">        <span class="string">"sha256:b1ddbff022577cd249a074285a1a7eb76d7c9139132ba5aa4272fc115dfa9e36"</span>,  <span class="comment"># é€šè¿‡åŸºç¡€å±‚ + diff_ids è·å¾—Layerå±‚æ‘˜è¦</span></span><br><span class="line">        <span class="string">"sha256:9edc93f4dcf640f272ed73f933863dbefae6719745093d09c6c6908f402b1c34"</span>,</span><br><span class="line">        <span class="string">"sha256:a6c8828ba4b58628284f783d3c918ac379ae2aba0830f4c926a330842361ffb6"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"layers"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é“¾IDè®¡ç®—å…¬å¼:å› ä¸ºchainidçš„ä¸€å±‚æ˜¯ä¾èµ–ä¸Šä¸€å±‚çš„æ‰€ä»¥æœ€åç®—å‡ºæ¥çš„rootfsæ˜¯ç»Ÿä¸€çš„;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…¬å¼ </span></span><br><span class="line">Chaninid(1) = diffid(1) chainid(n) = sha256(chain(n-1) diffid(n) )</span><br><span class="line">ChainID(A|B) = Digest(ChainID(A) + <span class="string">" "</span> + DiffID(B))</span><br><span class="line"></span><br><span class="line"><span class="comment"># é“¾ID ä¸ å·®å¼‚ID</span></span><br><span class="line">ChainID(A) = sha256:7bff100f35cb359a368537bb07829b055fe8e0b1cb01085a3a628ae9c187c7b8</span><br><span class="line">DiffID(B) = sha256:b1ddbff022577cd249a074285a1a7eb76d7c9139132ba5aa4272fc115dfa9e36</span><br><span class="line">DiffID(C) = sha256:9edc93f4dcf640f272ed73f933863dbefae6719745093d09c6c6908f402b1c34</span><br><span class="line">DiffID(D) = sha256:a6c8828ba4b58628284f783d3c918ac379ae2aba0830f4c926a330842361ffb6</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»“æœï¼š</span></span><br><span class="line"><span class="comment"># ChainID(A|B) = sha256:db7c15c2f03f63a658285a55edc0a0012ccd0033f4695d4b428b1b464637e655</span></span><br><span class="line"><span class="variable">$echo</span> -n <span class="string">"sha256:7bff100f35cb359a368537bb07829b055fe8e0b1cb01085a3a628ae9c187c7b8 sha256:b1ddbff022577cd249a074285a1a7eb76d7c9139132ba5aa4272fc115dfa9e36"</span> | sha256sum -</span><br><span class="line">db7c15c2f03f63a658285a55edc0a0012ccd0033f4695d4b428b1b464637e655  -  <span class="comment"># sha256ä¸‹é¢å¼•ç”¨ </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#chainID(A|B|C) = sha256:0e88764cdf90e8a5d6597b2d8e65b8f70e7b62982b0aee934195b54600320d47</span></span><br><span class="line"><span class="variable">$echo</span> -n <span class="string">"sha256:db7c15c2f03f63a658285a55edc0a0012ccd0033f4695d4b428b1b464637e655 sha256:9edc93f4dcf640f272ed73f933863dbefae6719745093d09c6c6908f402b1c34"</span> | sha256sum -</span><br><span class="line">0e88764cdf90e8a5d6597b2d8e65b8f70e7b62982b0aee934195b54600320d47  -</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—æµç¨‹å¦‚ä¸Š</span></span><br><span class="line"><span class="comment"># chainID(A|B|C|D) = sha256:80fe1abae43103e3be54ac2813114d1dea6fc91454a3369104b8dd6e2b1363f5</span></span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=n2.Dockerå®¶æ–‡ä»¶ç›®å½•ä»‹ç»å’Œé…ç½®æ–‡ä»¶ä¸å®ˆæŠ¤è¿›ç¨‹å‘½ä»¤å‚æ•°ä¸€è§ˆ href="https://img.weiyigeek.top/2020/1/20200808224518.png" target="_blank" title="WeiyiGeek.ChainID" data-fancybox="images"><img src="https://img.weiyigeek.top/2020/1/20200808224518.png" alt="WeiyiGeek.ChainID" title="" class=""></a>
                <p>WeiyiGeek.ChainID</p>
            </figure>
<ul>
<li>Step4.åœ¨ <code>imagedb/overlay2/destribution</code> ç›®å½•ä¸­åˆå§‹æ–‡ä»¶å¦‚ä¸‹:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-learn overlay2]<span class="variable">$tree</span> distribution/</span><br><span class="line">distribution/</span><br><span class="line">â”œâ”€â”€ diffid-by-digest</span><br><span class="line">â”‚   â””â”€â”€ sha256</span><br><span class="line">â”‚       â””â”€â”€ cd784148e3483c2c86c50a48e535302ab0288bebd587accf40b714fffd0646b3</span><br><span class="line">â””â”€â”€ v2metadata-by-diffid</span><br><span class="line">    â””â”€â”€ sha256</span><br><span class="line">        â””â”€â”€ 7bff100f35cb359a368537bb07829b055fe8e0b1cb01085a3a628ae9c187c7b8</span><br><span class="line">4 directories, 2 files</span><br></pre></td></tr></table></figure>
<ul>
<li>ç›®å‰æ¥çœ‹ï¼Œdestributionç›®å½•å’Œåªæœ‰alpineé•œåƒæ—¶å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œè¿™æ˜¯å› ä¸ºdigestæ˜¯ç”±é•œåƒä»“åº“ç”Ÿæˆï¼Œæœ¬åœ°æ„å»ºçš„é•œåƒåœ¨æ²¡æœ‰pushåˆ°ä»“åº“ä¹‹å‰ï¼Œè‡ªç„¶ä¹Ÿå°±æ²¡æœ‰digestã€‚<br>ä½¿ç”¨docker pushå‘½ä»¤å°†test-imageæ¨é€è‡³dockerhubã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-learn distribution]<span class="comment"># docker push backbp/test-image:lasted</span></span><br><span class="line">The push refers to repository [docker.io/backbp/<span class="built_in">test</span>-image]  <span class="comment"># ä»ä¸Šå±‚ä¾æ¬¡ä¼ è¾“åˆ°ä¸‹å±‚</span></span><br><span class="line">a6c8828ba4b5: Pushed </span><br><span class="line">9edc93f4dcf6: Pushed </span><br><span class="line">b1ddbff02257: Pushed </span><br><span class="line">7bff100f35cb: Mounted from library/alpine </span><br><span class="line">lasted: digest: sha256:3dc66a43c28ea3e994e4abf6a2d04c7027a9330e8eeab5c609e4971a8c58f0b0 size: 1156</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶ distribution/ æ–‡ä»¶å¦‚ä¸‹:</span></span><br><span class="line">distribution/</span><br><span class="line">â”œâ”€â”€ diffid-by-digest</span><br><span class="line">â”‚   â””â”€â”€ sha256</span><br><span class="line">â”‚       â”œâ”€â”€ 2826782ee82560ec5f90a8a9da80880d48dd4036763f5250024fab5b3ef8e8cf</span><br><span class="line">â”‚       â”œâ”€â”€ 8e905c02e6908fbb0e591cea285470208920d32408735bd6a8fcaf85ffba9089</span><br><span class="line">â”‚       â”œâ”€â”€ a5bec9983f6902f4901b38735db9c427190ffcb3734c84ee233ea391da81081b</span><br><span class="line">â”‚       â””â”€â”€ cd784148e3483c2c86c50a48e535302ab0288bebd587accf40b714fffd0646b3</span><br><span class="line">â””â”€â”€ v2metadata-by-diffid</span><br><span class="line">    â””â”€â”€ sha256</span><br><span class="line">        â”œâ”€â”€ 7bff100f35cb359a368537bb07829b055fe8e0b1cb01085a3a628ae9c187c7b8  <span class="comment"># push 4 - ChianID(A)</span></span><br><span class="line">        â”œâ”€â”€ 9edc93f4dcf640f272ed73f933863dbefae6719745093d09c6c6908f402b1c34  <span class="comment"># push 2 - DiffID(C)</span></span><br><span class="line">        â”œâ”€â”€ a6c8828ba4b58628284f783d3c918ac379ae2aba0830f4c926a330842361ffb6  <span class="comment"># push 1 - DiffID(D) </span></span><br><span class="line">        â””â”€â”€ b1ddbff022577cd249a074285a1a7eb76d7c9139132ba5aa4272fc115dfa9e36  <span class="comment"># push 3 - DiffID(B)</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p><br></p>
<p><em>è¡¥å……çŸ¥è¯†ç‚¹:</em><br>Q: 1.docker tagå‘½ä»¤å‘ç”Ÿäº†ä»€ä¹ˆ?</p>
<blockquote>
<p>ç­”:æˆ‘ä»¬è¿˜æ˜¯é‡‡ç”¨ä¸Šé¢çš„test-imageç”Ÿæˆä¸€ä¸ªæ–°çš„tagä¸ºä¾‹è¿›è¡Œå®éªŒæŸ¥çœ‹å¾—çŸ¥,ä¸¤ä¸ªtagçš„é•œåƒéƒ½æŒ‡å‘åŒä¸€ä¸ªimage idï¼Œæ‰€ä»¥è¿™ä¸ªå‘½ä»¤ç›¸å½“äºåªæœ‰ä¿®æ”¹äº†repositories.jsonç±»æ¯”äºè½¯é“¾æ¥;</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-learn overlay2]<span class="variable">$cat</span> repositories.json | python -m json.tool</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"Repositories"</span>: &#123;</span><br><span class="line">        <span class="string">"alpine"</span>: &#123;</span><br><span class="line">            <span class="string">"alpine:latest"</span>: <span class="string">"sha256:3f53bb00af943dfdf815650be70c0fa7b426e56a66f5e3362b47a129d57d5991"</span>,</span><br><span class="line">            <span class="string">"alpine@sha256:46e71df1e5191ab8b8034c5189e325258ec44ea739bba1e5645cff83c9048ff1"</span>: <span class="string">"sha256:3f53bb00af943dfdf815650be70c0fa7b426e56a66f5e3362b47a129d57d5991"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"test-image"</span>: &#123;</span><br><span class="line">            <span class="string">"test-image:latest"</span>: <span class="string">"sha256:6cd0a66e83f133a2bad37103ed03f6480330fa3c469368eb5871320996d3b924"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"test-image-tag"</span>: &#123;</span><br><span class="line">            <span class="string">"test-image-tag:latest"</span>: <span class="string">"sha256:6cd0a66e83f133a2bad37103ed03f6480330fa3c469368eb5871320996d3b924"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>Q: 2.Image Sizeæ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ<br>ç­”: ä¸Šè¿°çš„alpineé•œåƒå’Œtest-imageé•œåƒå¤§å°åˆ†åˆ«æ˜¯ï¼š4.41Må’Œ9.88Mã€‚ä¸ºäº†æ›´å‡†ç¡®çš„åˆ†æï¼Œå¯ä»¥ä½¿ç”¨docker inspect é•œåƒæŸ¥çœ‹è¯¦ç»†å¤§å°ï¼Œåˆ†åˆ«ä¸º4413428å’Œ9876099ã€‚<br>å†æ¬¡æŸ¥çœ‹æ¯å±‚Layerçš„å¤§å°(layerdb/layer chain id/size)ï¼Œåˆ†åˆ«ä¸º<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¯å±‚å¤§å°</span></span><br><span class="line">Layer1ï¼š4413428</span><br><span class="line">Layer2ï¼š3815516</span><br><span class="line">Layer3ï¼š1647117</span><br><span class="line">Layer4ï¼š38</span><br><span class="line"></span><br><span class="line"><span class="comment"># é•œåƒè®¡ç®—</span></span><br><span class="line">alpine     åªæœ‰ä¸€å±‚ï¼Œæ‰€ä»¥image sizeä¸Layer sizeç›¸ç­‰ï¼›</span><br><span class="line"><span class="built_in">test</span>-image æœ‰å››å±‚ï¼Œæ‰€ä»¥image size = sum(Layer1+Layer2+Layer3+Layer4)=9876099</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>Q: 3.Dockerfile æŒ‡ä»¤ä¹‹<code>apk del .build-deps</code>å¯¹Layerå±‚Sizeçš„å½±å“?<br>ç­”: å¦‚ä¸‹Dockerfile æŒ‡ä»¤ä¼˜åŒ–å¹¶å‡å°‘äº†ç”Ÿæˆé•œåƒçš„å¤§å°ï¼Œåˆ†æåŸå› å¦‚ä¸‹å°†ä¸€éƒ¨åˆ†å‘½ä»¤æ”¾åœ¨ä¸€ä¸ªRUNæŒ‡ä»¤ä¸­è¿è¡Œä¼šåœ¨åŒä¸€ä¸ªLayeræ‰§è¡Œå…¶æŒ‡ä»¤ä¸­çš„å¤šæ¡è¯­å¥ä»è€Œä¸ä¼šåœ¨å…¶å®ƒå±‚è¿›è¡Œæ‰§è¡Œï¼Œè¿™æ ·æ‰€åšçš„å¥½å¤„å°±æ˜¯èŠ‚çº¦ç©ºé—´ï¼Œæ­¤å¤„é‡‡ç”¨ä¸€ä¸ªè™šæ‹Ÿç›®å½•<code>.build-deps</code>çš„å®‰è£…å’Œå¸è½½ç›¸å¯¹äºä¸Šä¸€å±‚è€Œè¨€æ ¹æœ¬å°±ä¸å­˜åœ¨ï¼Œè¿™æ˜¯ç”±äº<code>OCI Imageçš„åŸç†æ‰€è‡´ï¼Œåªéœ€è¦è®°ä½çš„æ˜¯æ¯ä¸€ä¸ªLayerè®°å½•çš„æ˜¯ä¸ä¸Šä¸€å±‚Layerç›¸æ¯”çš„å˜åŒ–</code>ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># çµé­‚é‡ç‚¹(DockerFile ä¼˜åŒ–å¿…å¤‡)</span></span><br><span class="line">RUN apk -v add --no-cache --virtual .build-deps gcc make &amp;&amp; \</span><br><span class="line">make clean &amp;&amp; make &amp;&amp; make install &amp;&amp; \</span><br><span class="line">apk del .build-deps</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><em>æ€»ç»“æœ¬ç« :</em></p>
<ul>
<li>1.åœ¨image/overlay2/imagedbç›®å½•ä¸­ï¼Œä¿å­˜çš„Imageçš„é…ç½®ä¿¡æ¯åœ¨contentç›®å½•ä¸­ï¼Œå¹¶ä¸”ä»¥image idä¸ºæ–‡ä»¶åå­˜å‚¨ï¼ŒImageä¹‹é—´å…³è”ä¿¡æ¯åœ¨metadataä¸­ï¼Œä»¥parentæ–‡ä»¶å­˜å‚¨ã€‚æˆ‘ä»¬æ ¹æ®imageç”Ÿæˆå®¹å™¨çš„æ—¶å€™å¯ä»¥ç”Ÿæˆäº†ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä½†æ˜¯ä¸Šè¿°è¿™äº›ä¿¡æ¯å¹¶ä¸åŒ…å«fsçš„æ•°æ®ã€‚<br>å› ä¸ºçœŸæ­£çš„fsæ•°æ®æ˜¯å­˜å‚¨åœ¨Layerä¸­çš„<code>å³Layerçš„ä¿¡æ¯å­˜å‚¨åœ¨layerdbç›®å½•ä¸‹</code>ã€‚</li>
<li>2.å› æ­¤test-imageçš„ç¬¬äºŒå±‚Layerå¯¹åº”çš„ç›®å½•ä¸ºï¼šlayerdb/sha256/db7c15c2f03f63a658285a55edc0a0012ccd0033f4695d4b428b1b464637e655ï¼Œä¸ä¸Šä¸€èŠ‚ä¸­ç›¸æ¯”å¤šäº†parentï¼ŒåŒ…å«äº†ä¸Šä¸€å±‚Layerçš„chain idï¼ŒæŸ¥çœ‹è¯¥Layerçš„ä¿¡æ¯ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-learn sha256]<span class="variable">$ls</span> db7c15c2f03f63a658285a55edc0a0012ccd0033f4695d4b428b1b464637e655/</span><br><span class="line">cache-id  diff  parent  size  tar-split.json.gz</span><br><span class="line"><span class="comment"># parent = sha256:7bff100f35cb359a368537bb07829b055fe8e0b1cb01085a3a628ae9c187c7b8</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="0x01-Dockerd-è¯­æ³•å‚æ•°"><a href="#0x01-Dockerd-è¯­æ³•å‚æ•°" class="headerlink" title="0x01 Dockerd è¯­æ³•å‚æ•°"></a>0x01 Dockerd è¯­æ³•å‚æ•°</h4><p>æè¿°:é€šè¿‡å‰é¢Dockerçš„å­¦ä¹ æˆ‘ä»¬çŸ¥é“äº†å®ƒæ˜¯ä¸€ä¸ªC/Sæ¶æ„, å³Daemon CLI (dockerd)å®ƒæ˜¯dockerçš„æœåŠ¡ç«¯å®ƒæ˜¯ç®¡ç†å®¹å™¨çš„æŒä¹…è¿›ç¨‹;</p>
<p>Dockerä¸ºå®ˆæŠ¤è¿›ç¨‹å’Œå®¢æˆ·ç«¯ä½¿ç”¨ä¸åŒçš„äºŒè¿›åˆ¶æ–‡ä»¶,è¦è¿è¡Œå®ˆæŠ¤è¿›ç¨‹è¾“å…¥dockerdã€‚</p>
<p>DockerdåŸºç¡€è¯­æ³•å‚æ•°:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¯­æ³•:å®¹å™¨çš„è‡ªç»™è‡ªè¶³è¿è¡Œæ—¶ã€‚</span></span><br><span class="line">Usage: dockerd COMMAND</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‚æ•°é€‰é¡¹</span></span><br><span class="line">Options:</span><br><span class="line">  --add-runtime runtime                   Register an additional OCI compatible runtime (default [])</span><br><span class="line">  --allow-nondistributable-artifacts list Allow push of nondistributable artifacts to registry</span><br><span class="line">  --api-cors-header string                Set CORS headers <span class="keyword">in</span> the Engine API</span><br><span class="line">  --authorization-plugin list             Authorization plugins to load</span><br><span class="line">  --bip string                            Specify network bridge IP</span><br><span class="line">-b, --bridge string                         Attach containers to a network bridge</span><br><span class="line">  --cgroup-parent string                  Set parent cgroup <span class="keyword">for</span> all containers</span><br><span class="line">  --cluster-advertise string              Address or interface name to advertise</span><br><span class="line">  --cluster-store string                  URL of the distributed storage backend</span><br><span class="line">  --cluster-store-opt map                 Set cluster store options (default map[])</span><br><span class="line">  --config-file string                    Daemon configuration file (default <span class="string">"/etc/docker/daemon.json"</span>)</span><br><span class="line">  --containerd string                     containerd grpc åœ°å€</span><br><span class="line">  --cpu-rt-period int                     ä»¥å¾®ç§’ä¸ºå•ä½é™åˆ¶CPUçš„å®æ—¶å‘¨æœŸ</span><br><span class="line">  --cpu-rt-runtime int                    ä»¥å¾®ç§’ä¸ºå•ä½é™åˆ¶CPUçš„å®æ—¶è¿è¡Œæ—¶é—´</span><br><span class="line">  --cri-containerd                        ä»¥criå¯åŠ¨containerd</span><br><span class="line">  --data-root string                      Root directory of persistent Docker state (default <span class="string">"/var/lib/docker"</span>)</span><br><span class="line">-D, --debug                                 Enable debug mode</span><br><span class="line">  --default-address-pool pool-options     Default address pools <span class="keyword">for</span> node specific <span class="built_in">local</span> networks</span><br><span class="line">  --default-gateway ip                    Container default gateway IPv4 address</span><br><span class="line">  --default-gateway-v6 ip                 Container default gateway IPv6 address</span><br><span class="line">  --default-ipc-mode string               Default mode <span class="keyword">for</span> containers ipc (<span class="string">"shareable"</span> | <span class="string">"private"</span>) (default <span class="string">"private"</span>)</span><br><span class="line">  --default-runtime string                Default OCI runtime <span class="keyword">for</span> containers (default <span class="string">"runc"</span>)</span><br><span class="line">  --default-shm-size bytes                Default shm size <span class="keyword">for</span> containers (default 64MiB)</span><br><span class="line">  --default-ulimit <span class="built_in">ulimit</span>                 Default ulimits <span class="keyword">for</span> containers (default [])</span><br><span class="line">  --dns list                              DNS server to use</span><br><span class="line">  --dns-opt list                          DNS options to use</span><br><span class="line">  --dns-search list                       DNS search domains to use</span><br><span class="line">  --<span class="built_in">exec</span>-opt list                         Runtime execution options</span><br><span class="line">  --<span class="built_in">exec</span>-root string                      Root directory <span class="keyword">for</span> execution state files (default <span class="string">"/var/run/docker"</span>)</span><br><span class="line">  --experimental                          æ³¨æ„:åœ¨ä¸€å°ä¸»æœºä¸Šè¿è¡Œå¤šä¸ªå®ˆæŠ¤è¿›ç¨‹è¢«è®¤ä¸ºæ˜¯â€œè¯•éªŒæ€§çš„â€ã€‚</span><br><span class="line">  --fixed-cidr string                     IPv4 subnet <span class="keyword">for</span> fixed IPs</span><br><span class="line">  --fixed-cidr-v6 string                  IPv6 subnet <span class="keyword">for</span> fixed IPs</span><br><span class="line">-G, --group string                          Group <span class="keyword">for</span> the unix socket (default <span class="string">"docker"</span>)</span><br><span class="line">  --<span class="built_in">help</span>                                  Print usage</span><br><span class="line">-H, --host list                             Daemon socket(s) to connect to</span><br><span class="line">  --icc                                   Enable inter-container communication (default <span class="literal">true</span>)</span><br><span class="line">  --init                                  Run an init <span class="keyword">in</span> the container to forward signals and reap processes</span><br><span class="line">  --init-path string                      Path to the docker-init binary</span><br><span class="line">  --insecure-registry list                Enable insecure registry communication</span><br><span class="line">  --ip ip                                 Default IP when binding container ports (default 0.0.0.0)</span><br><span class="line">  --ip-forward                            Enable net.ipv4.ip_forward (default <span class="literal">true</span>)</span><br><span class="line">  --ip-masq                               Enable IP masquerading (default <span class="literal">true</span>)</span><br><span class="line">  --iptables                              Enable addition of iptables rules (default <span class="literal">true</span>)</span><br><span class="line">  --ipv6                                  Enable IPv6 networking</span><br><span class="line">  --label list                            Set key=value labels to the daemon</span><br><span class="line">  --live-restore                         å½“å®¹å™¨ä»åœ¨è¿è¡Œæ—¶ï¼Œå¯ç”¨dockerçš„æ´»è¿˜åŸ</span><br><span class="line">  --<span class="built_in">log</span>-driver string                     Default driver <span class="keyword">for</span> container logs (default <span class="string">"json-file"</span>)</span><br><span class="line">-l, --<span class="built_in">log</span>-level string                      Set the logging level (<span class="string">"debug"</span>|<span class="string">"info"</span>|<span class="string">"warn"</span>|<span class="string">"error"</span>|<span class="string">"fatal"</span>) (default <span class="string">"info"</span>)</span><br><span class="line">  --<span class="built_in">log</span>-opt map                           Default <span class="built_in">log</span> driver options <span class="keyword">for</span> containers (default map[])</span><br><span class="line">  --max-concurrent-downloads int          è®¾ç½®æ¯æ¬¡æ‹‰å–çš„æœ€å¤§å¹¶å‘ä¸‹è½½(é»˜è®¤ä¸º3)</span><br><span class="line">  --max-concurrent-uploads int            è®¾ç½®æ¯ä¸ªæ¨é€çš„æœ€å¤§å¹¶å‘ä¸Šä¼ æ•°(é»˜è®¤ä¸º5)</span><br><span class="line">  --metrics-addr string                   Set default address and port to serve the metrics api on</span><br><span class="line">  --mtu int                               Set the containers network MTU</span><br><span class="line">  --network-control-plane-mtu int         Network Control plane MTU (default 1500)</span><br><span class="line">  --no-new-privileges                     Set no-new-privileges by default <span class="keyword">for</span> new containers</span><br><span class="line">  --node-generic-resource list            Advertise user-defined resource</span><br><span class="line">  --oom-score-adjust int                  ä¸ºå®ˆæŠ¤è¿›ç¨‹è®¾ç½®oom_score_adj(é»˜è®¤å€¼ä¸º-500)</span><br><span class="line">-p, --pidfile string                      Path to use <span class="keyword">for</span> daemon PID file (default <span class="string">"/var/run/docker.pid"</span>)</span><br><span class="line">  --raw-logs                              Full timestamps without ANSI coloring</span><br><span class="line">  --registry-mirror list                  Preferred Docker registry mirror</span><br><span class="line">  --rootless                              Enable rootless mode; typically used with RootlessKit (experimental)</span><br><span class="line">  --seccomp-profile string                Path to seccomp profile</span><br><span class="line">  --selinux-enabled                       Enable selinux support</span><br><span class="line">  --shutdown-timeout int                  Set the default shutdown timeout (default 15)</span><br><span class="line">-s, --storage-driver string                 Storage driver to use</span><br><span class="line">  --storage-opt list                      Storage driver options</span><br><span class="line">  --swarm-default-advertise-addr string   Set default address or interface <span class="keyword">for</span> swarm advertised address</span><br><span class="line">  --tls                                   Use TLS; implied by --tlsverify</span><br><span class="line">  --tlscacert string                      Trust certs signed only by this CA (default <span class="string">"~/.docker/ca.pem"</span>)</span><br><span class="line">  --tlscert string                        Path to TLS certificate file (default <span class="string">"~/.docker/cert.pem"</span>)</span><br><span class="line">  --tlskey string                         Path to TLS key file (default <span class="string">"~/.docker/key.pem"</span>)</span><br><span class="line">  --tlsverify                             Use TLS and verify the remote</span><br><span class="line">  --userland-proxy                        Use userland proxy <span class="keyword">for</span> loopback traffic (default <span class="literal">true</span>)</span><br><span class="line">  --userland-proxy-path string            Path to the userland proxy binary</span><br><span class="line">  --userns-remap string                   User/Group setting <span class="keyword">for</span> user namespaces</span><br><span class="line">-v, --version                              ç‰ˆæœ¬ä¿¡æ¯</span><br></pre></td></tr></table></figure></p>
<hr>
<h5 id="åŸºç¡€é€‰é¡¹è®²è§£"><a href="#åŸºç¡€é€‰é¡¹è®²è§£" class="headerlink" title="åŸºç¡€é€‰é¡¹è®²è§£"></a>åŸºç¡€é€‰é¡¹è®²è§£</h5><ul>
<li>docker æœåŠ¡ç«¯è°ƒè¯•æ¨¡å¼Debugå¼€å¯:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker.service</span></span><br><span class="line">dockerd -D --debug</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker.service</span></span><br><span class="line">dockerd --experimental <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># daemon.json file</span></span><br><span class="line"><span class="string">"experimental"</span>: <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<ul>
<li>å®ˆæŠ¤è¿›ç¨‹å¥—æ¥å­—é€‰é¡¹:<br>Dockerå®ˆæŠ¤è¿›ç¨‹å¯ä»¥é€šè¿‡ä¸‰ç§ä¸åŒç±»å‹çš„å¥—æ¥å­—ä¾¦å¬Dockerå¼•æ“APIè¯·æ±‚:unixã€tcpå’Œfdï¼Œå¹¶ä¸”æ”¯æŒä¾¦å¬å¤šä¸ªå¥—æ¥å­—åœ¨åŒä¸€æ—¶é—´ä½¿ç”¨å¤šä¸ª-Hé€‰é¡¹ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) é»˜è®¤æƒ…å†µä¸‹åœ¨/var/run/dockeråˆ›å»ºä¸€ä¸ªunixåŸŸå¥—æ¥å­—(æˆ–IPCå¥—æ¥å­—),éœ€è¦rootæƒé™æˆ–dockerç»„æˆå‘˜èµ„æ ¼ã€‚</span></span><br><span class="line"><span class="comment"># å¦‚æœ‰éœ€è¦è¿œç¨‹è®¿é—®Docker Deamonå»ºè®®ä½¿ç”¨Nginxç­‰è¿›è¡Œé…ç½®HTTPSåŠ å¯†å¥—æ¥å­—(TLS1.0&gt;=), é€šå¸¸ä½¿ç”¨ç«¯å£2375è¿›è¡ŒéåŠ å¯†ï¼Œè€Œä½¿ç”¨ç«¯å£2376ä¸å®ˆæŠ¤è¿›ç¨‹è¿›è¡ŒåŠ å¯†é€šä¿¡ã€‚</span></span><br><span class="line"><span class="comment"># Run docker in daemon mode</span></span><br><span class="line">$ sudo &lt;path to&gt;/dockerd -H tcp://127.0.0.1:2375 -H unix:///var/run/docker.sock &amp;</span><br><span class="line">$ sudo dockerd -H unix:///var/run/docker.sock -H tcp://192.168.59.106 -H tcp://10.10.10.2</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) åœ¨åŸºäºSystemdçš„ç³»ç»Ÿä¸Šï¼Œæ‚¨å¯ä»¥é€šè¿‡æ¿€æ´»Systemdå¥—æ¥å­—ä¸å®ˆæŠ¤è¿›ç¨‹é€šä¿¡ï¼Œä½¿ç”¨dockerd -H fd://ã€‚</span></span><br><span class="line">ä½¿ç”¨fd://å°†å·¥ä½œå®Œç¾çš„å¤§å¤šæ•°è®¾ç½®ï¼Œä½†ä½ ä¹Ÿå¯ä»¥æŒ‡å®šä¸ªåˆ«å¥—æ¥å­—: dockerd -H fd://3ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°æŒ‡å®šçš„å¥—æ¥å­—æ¿€æ´»çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆDockerå°†é€€å‡ºã€‚</span><br><span class="line"><span class="comment"># æ‚¨å¯ä»¥åœ¨Dockeræºæ ‘ä¸­æ‰¾åˆ°ä½¿ç”¨Systemdå¥—æ¥å­—æ¿€æ´»Dockerå’ŒSystemdçš„ç¤ºä¾‹ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) Dockerå®¢æˆ·æœºå°†ä½¿ç”¨DOCKER_HOSTç¯å¢ƒå˜é‡æˆ–è€…ä¸ºå®¢æˆ·æœºè®¾ç½®-Hæ ‡å¿—</span></span><br><span class="line">$ <span class="built_in">export</span> DOCKER_HOST=<span class="string">"tcp://0.0.0.0:2375"</span> \</span><br><span class="line">  <span class="built_in">export</span> DOCKER_TLS_VERIFY=1 \</span><br><span class="line">  &amp;&amp; docker ps &amp;&amp; docker --tlsverify ps</span><br><span class="line"></span><br><span class="line">$ docker -H tcp://127.0.0.1:2375 pull ubuntu</span><br><span class="line">$ docker -H :5555 pull ubuntu</span><br><span class="line">$ docker -H tcp://0.0.0.0:2375 ps</span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) ä»Docker 18.09å¼€å§‹ï¼ŒDockerå®¢æˆ·ç«¯æ”¯æŒé€šè¿‡SSHè¿æ¥åˆ°è¿œç¨‹å®ˆæŠ¤è¿›ç¨‹å¯ä»¥é…ç½®å…¬é’¥è®¤è¯è¿œç¨‹ä¸»æœº:</span></span><br><span class="line">$ docker -H ssh://me@example.com ps</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<ul>
<li>å­˜å‚¨é©±åŠ¨å™¨:<br>æè¿°:åœ¨Linuxä¸ŠDockerå®ˆæŠ¤è¿›ç¨‹æ”¯æŒå‡ ç§ä¸åŒçš„å›¾åƒå±‚å­˜å‚¨é©±åŠ¨ç¨‹åº:<code>aufsã€devicemapperã€btrfsã€zfsã€overlay å’Œ overlay2</code>ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">aufs : æœ€æ—©çš„å­˜å‚¨é©±åŠ¨åŸºäºLinuxè¡¥ä¸å†…æ ¸é›†(å­˜åœ¨æœªçŸ¥ä½ç½®BUG)ï¼Œä½†æ˜¯å…è®¸å®¹å™¨å…±äº«å¯æ‰§è¡Œå†…å­˜å’Œå…±äº«åº“å†…å­˜</span><br><span class="line">devicemapper : é©±åŠ¨ç¨‹åºä½¿ç”¨ç˜¦é…ç½®å’Œå†™ä¸Šå¤åˆ¶(CoW)å¿«ç…§,é»˜è®¤æƒ…å†µä¸‹è¿™äº›å—è®¾å¤‡æ˜¯é€šè¿‡ä½¿ç”¨è‡ªåŠ¨åˆ›å»ºçš„ç¨€ç–æ–‡ä»¶çš„ç¯å›æŒ‚è½½æ¥è‡ªåŠ¨åˆ›å»ºçš„ï¼ˆå…ˆå·²ç»è¢«overlay2æ‰€æ›¿ä»£ï¼‰</span><br><span class="line">btrfs : ä¸ä¸Šè€…ç±»ä¼¼ä½†æ˜¯ä¸åŒçš„æ˜¯å®ƒä¸èƒ½åœ¨è®¾å¤‡ä¹‹é—´å…±äº«å¯æ‰§è¡Œå†…å­˜</span><br><span class="line">zfs : è¯¥é©±åŠ¨ç¨‹åºå¯èƒ½ä¸å¦‚btrfså¿«ä½†åœ¨ç¨³å®šæ€§æ–¹é¢æœ‰è¾ƒé•¿çš„è®°å½•ã€‚ç”±äºåªæœ‰ä¸€ä¸ªå‰¯æœ¬ï¼Œå…‹éš†ä¹‹é—´çš„å…±äº«å—åªç¼“å­˜ä¸€æ¬¡ã€‚</span><br><span class="line">overlay : æ˜¯ä¸€ä¸ªéå¸¸å¿«çš„unionæ–‡ä»¶ç³»ç»Ÿã€‚å®ƒç°åœ¨å·²ç»åˆå¹¶åˆ°3.18.0çš„ä¸»Linuxå†…æ ¸ä¸­ã€‚è¦†ç›–ä¹Ÿæ”¯æŒé¡µé¢ç¼“å­˜å…±äº«ï¼Œè¿™æ„å‘³ç€è®¿é—®åŒä¸€ä¸ªæ–‡ä»¶çš„å¤šä¸ªå®¹å™¨å¯ä»¥å…±äº«ä¸€ä¸ªé¡µé¢ç¼“å­˜æ¡ç›®(æˆ–å¤šä¸ªæ¡ç›®)ï¼Œè¿™ä½¿å¾—è¦†ç›–å’Œaufsé©±åŠ¨ç¨‹åºä¸€æ ·é«˜æ•ˆã€‚</span><br><span class="line">overlay2 : ä½¿ç”¨ç›¸åŒçš„å¿«é€Ÿunionæ–‡ä»¶ç³»ç»Ÿï¼Œä½†æ˜¯åˆ©ç”¨äº†Linuxå†…æ ¸4.0ä¸­æ·»åŠ çš„å…¶ä»–ç‰¹æ€§ï¼Œä»¥é¿å…è¿‡åº¦ä½¿ç”¨inodeã€‚(è°ƒç”¨dockerd -s overlay2æ¥ä½¿ç”¨å®ƒã€‚-å½“å‰é»˜è®¤)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>åŸºç¡€ç¤ºä¾‹:devicemapper<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®šè¦ç”¨äºthin-poolçš„è‡ªå®šä¹‰å—å­˜å‚¨è®¾</span></span><br><span class="line">$ sudo dockerd --storage-opt dm.thinpooldev=/dev/mapper/thin-pool</span><br><span class="line"><span class="comment"># è®¾ç½®å—è®¾å¤‡è¿›è¡Œå­˜å‚¨</span></span><br><span class="line">$ sudo dockerd --storage-opt dm.directlvm_device=/dev/xvdf</span><br><span class="line"><span class="comment"># è®¾ç½®åœ¨å—è®¾å¤‡ä¼ é€’åˆ°ç”¨äºå­˜å‚¨çš„ç™¾åˆ†æ¯”ã€‚</span></span><br><span class="line">$ sudo dockerd --storage-opt dm.thinp_percent=95</span><br><span class="line"><span class="comment"># è®¾ç½®ä¼ å…¥çš„å—è®¾å¤‡çš„ç™¾åˆ†æ¯”ï¼Œç”¨äºå…ƒæ•°æ®å­˜å‚¨ã€‚</span></span><br><span class="line">$ sudo dockerd --storage-opt dm.thinp_metapercent=1</span><br><span class="line"><span class="comment"># è®¾ç½®lvmå°è¯•è‡ªåŠ¨æ‰©å±•å¯ç”¨ç©ºé—´ä¹‹å‰ä½¿ç”¨çš„ç©ºé—´ç™¾åˆ†æ¯”å€¼[100 =ç¦ç”¨]</span></span><br><span class="line">$ sudo dockerd --storage-opt dm.thinp_autoextend_threshold=80</span><br><span class="line"><span class="comment"># è®¾ç½®å€¼ç™¾åˆ†æ¯”å€¼ï¼Œå½“lvmå°è¯•è‡ªåŠ¨æ‰©å±•å¯ç”¨ç©ºé—´æ—¶å¢åŠ ç˜¦æ± [100 =ç¦ç”¨]</span></span><br><span class="line">$ sudo dockerd --storage-opt dm.thinp_autoextend_percent=20</span><br><span class="line"><span class="comment"># æŒ‡å®šè¦ç”¨äºç˜¦æ± çš„è‡ªå®šä¹‰å—å¤§å°ã€‚é»˜è®¤å—å¤§å°ä¸º64Kã€‚</span></span><br><span class="line">$ sudo dockerd --storage-opt dm.blocksize=512K</span><br><span class="line"><span class="comment"># æŒ‡å®šç”¨äºç˜¦æ± æ•°æ®çš„è‡ªå®šä¹‰å—è®¾å¤‡</span></span><br><span class="line">$ sudo dockerd \</span><br><span class="line">  --storage-opt dm.datadev=/dev/sdb1 \</span><br><span class="line"><span class="comment"># æŒ‡å®šç”¨äºç˜¦æ± å…ƒæ•°æ®çš„è‡ªå®šä¹‰å—è®¾å¤‡ã€‚ä¸ºäº†è·å¾—æœ€ä½³æ€§èƒ½ï¼Œå…ƒæ•°æ®åº”è¯¥ä½äºä¸æ•°æ®ä¸åŒçš„è½´ä¸Šï¼Œç”šè‡³æ›´å¥½åœ°ä½äºSSDä¸Šã€‚</span></span><br><span class="line">  --storage-opt dm.metadatadev=/dev/sdc1</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸºæœ¬è®¾å¤‡å¤§å°å¯ä»¥åœ¨å®ˆæŠ¤è¿›ç¨‹é‡å¯æ—¶å¢åŠ ï¼Œè¿™å°†å…è®¸æ‰€æœ‰å°†æ¥çš„æ˜ åƒå’Œå®¹å™¨(åŸºäºè¿™äº›æ–°æ˜ åƒ)éƒ½æ˜¯æ–°çš„åŸºæœ¬è®¾å¤‡å¤§å°ã€‚</span></span><br><span class="line">$ sudo dockerd --storage-opt dm.basesize=50G <span class="comment">#æŒ‡å®šåˆ›å»ºåŸºæœ¬è®¾å¤‡æ—¶è¦ä½¿ç”¨çš„å¤§å°ï¼Œè¯¥è®¾å¤‡é™åˆ¶å›¾åƒå’Œå®¹å™¨çš„å¤§å°</span></span><br><span class="line"><span class="comment"># æŒ‡å®šä¸ºç˜¦æ± ä½¿ç”¨çš„â€œdataâ€è®¾å¤‡åˆ›å»ºå›é€æ–‡ä»¶æ—¶ä½¿ç”¨çš„å¤§å°ã€‚é»˜è®¤å¤§å°æ˜¯100Gï¼Œæ­¤é€‰é¡¹é…ç½®devicemapperç¯å›ï¼Œä¸åº”åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨ã€‚</span></span><br><span class="line">$ sudo dockerd --storage-opt dm.loopdatasize=200G</span><br><span class="line"><span class="comment"># æŒ‡å®šä¸ºç˜¦æ± ä½¿ç”¨çš„â€œå…ƒæ•°æ®â€è®¾å¤‡åˆ›å»ºå›é€æ–‡ä»¶æ—¶ä½¿ç”¨çš„å¤§å°ã€‚é»˜è®¤å¤§å°æ˜¯2G</span></span><br><span class="line">$ sudo dockerd --storage-opt dm.loopmetadatasize=4G</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºåŸºæœ¬è®¾å¤‡æŒ‡å®šè¦ä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ã€‚æ”¯æŒçš„é€‰é¡¹æ˜¯â€œext4â€å’Œâ€œxfsâ€ã€‚é»˜è®¤å€¼æ˜¯â€œxfsâ€</span></span><br><span class="line">$ sudo dockerd --storage-opt dm.fs=ext4</span><br><span class="line"><span class="comment"># æŒ‡å®šåˆ›å»ºåŸºç¡€è®¾å¤‡æ—¶è¦ä½¿ç”¨é¢å¤–çš„mkfså‚æ•°ã€‚</span></span><br><span class="line">$ sudo dockerd --storage-opt <span class="string">"dm.mkfsarg=-O ^has_journal"</span></span><br><span class="line"><span class="comment"># æŒ‡å®šå®‰è£…ç˜¦è®¾å¤‡æ—¶ä½¿ç”¨çš„é¢å¤–æŒ‚è½½é€‰é¡¹</span></span><br><span class="line">$ sudo dockerd --storage-opt dm.mountopt=nodiscard</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœlibdmå’Œå†…æ ¸é©±åŠ¨ç¨‹åºæ”¯æŒå»¶è¿Ÿè®¾å¤‡åˆ é™¤æœºåˆ¶ï¼Œåˆ™æ”¯æŒä½¿ç”¨å»¶è¿Ÿè®¾å¤‡åˆ é™¤ã€‚</span></span><br><span class="line">$ sudo dockerd --storage-opt dm.use_deferred_removal=<span class="literal">true</span></span><br><span class="line"><span class="comment"># å…è®¸å¯¹ç˜¦æ± è®¾å¤‡ä½¿ç”¨å»¶è¿Ÿè®¾å¤‡åˆ é™¤ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç˜¦æ± è®¾å¤‡åˆ é™¤æ˜¯åŒæ­¥çš„åœ¨åˆ é™¤ä¸€ä¸ªå®¹å™¨ä¹‹å‰ï¼ŒDockerå®ˆæŠ¤è¿›ç¨‹ä¼šåˆ é™¤æ‰€æœ‰ç›¸å…³çš„è®¾å¤‡ã€‚å¦‚æœå­˜å‚¨é©±åŠ¨ç¨‹åºä¸èƒ½åˆ é™¤è®¾å¤‡ï¼Œåˆ™å®¹å™¨åˆ é™¤å¤±è´¥ï¼Œå®ˆæŠ¤è¿›ç¨‹è¿”å›ï¼Œä¸‹é¢é¿å…äº†è¿™æ ·çš„æƒ…å†µã€‚</span></span><br><span class="line">$ sudo dockerd \</span><br><span class="line">      --storage-opt dm.use_deferred_deletion=<span class="literal">true</span> \</span><br><span class="line">      --storage-opt dm.use_deferred_removal=<span class="literal">true</span></span><br></pre></td></tr></table></figure></p>
<p>åŸºç¡€ç¤ºä¾‹:Overlay2<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¦†ç›–å…è®¸overlay2çš„Linuxå†…æ ¸ç‰ˆæœ¬æ£€æŸ¥ã€‚</span></span><br><span class="line">$ overlay2.override_kernel_check</span><br><span class="line"><span class="comment"># è®¾ç½®å®¹å™¨çš„é»˜è®¤æœ€å¤§å¤§å°ã€‚ä»…å½“åå¤‡fsæ˜¯xfså¹¶ä½¿ç”¨pquotaæŒ‚è½½é€‰é¡¹æŒ‚è½½æ—¶æ‰æ”¯æŒå®ƒã€‚åœ¨è¿™äº›æ¡ä»¶ä¸‹ç”¨æˆ·å¯ä»¥ä¼ é€’å°äºåå°fså¤§å°çš„ä»»ä½•å¤§å°ã€‚</span></span><br><span class="line">$ sudo dockerd -s overlay2 --storage-opt overlay2.size=1G</span><br></pre></td></tr></table></figure></p>
<hr>
<ul>
<li>Dockerè¿è¡Œæ—¶æ‰§è¡Œé€‰é¡¹<br>Dockerå®ˆæŠ¤è¿›ç¨‹ä¾èµ–äºOCIå…¼å®¹çš„è¿è¡Œæ—¶(é€šè¿‡containerdå®ˆæŠ¤è¿›ç¨‹è°ƒç”¨)ä½œä¸ºå®ƒåˆ°Linuxå†…æ ¸åç§°ç©ºé—´ã€cgroupså’ŒSELinuxçš„æ¥å£ã€‚<br>é»˜è®¤æƒ…å†µä¸‹ï¼ŒDockerå®ˆæŠ¤è¿›ç¨‹ä¼šè‡ªåŠ¨å¯åŠ¨containerdã€‚å¦‚æœæ‚¨æƒ³æ§åˆ¶containerdçš„å¯åŠ¨ï¼Œè¯·æ‰‹åŠ¨å¯åŠ¨containerdå¹¶ä½¿ç”¨â€”containerdæ ‡å¿—å°†è·¯å¾„ä¼ é€’ç»™containerdå¥—æ¥å­—ã€‚ä¾‹å¦‚:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dockerd --containerd /var/run/dev/docker-containerd.sock</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æˆ–ä½¿ç”¨â€”â€”add-runtimeå‘½ä»¤è¡Œå‚æ•°å‘å®ˆæŠ¤è¿›ç¨‹æ³¨å†Œè¿è¡Œæ—¶ã€‚</span></span><br><span class="line">$ sudo dockerd --add-runtime runc=runc --add-runtime custom=/usr/<span class="built_in">local</span>/bin/my-runc-replacement</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€‰é¡¹æŒ‡å®šå®¹å™¨çš„cgroupsçš„ç®¡ç†,è¯¥ç¤ºä¾‹å°†cgroupdriverè®¾ç½®ä¸ºsystemd</span></span><br><span class="line">$ sudo dockerd --<span class="built_in">exec</span>-opt native.cgroupdriver=systemd <span class="comment"># è®¾ç½®æ­¤é€‰é¡¹é€‚ç”¨äºå®ˆæŠ¤è¿›ç¨‹å¯åŠ¨çš„æ‰€æœ‰å®¹å™¨ã€‚</span></span><br><span class="line"><span class="comment"># å°†ä½¿hypervæˆä¸ºWindowsä¸Šçš„é»˜è®¤éš”ç¦»æŠ€æœ¯ã€‚å¦‚æœåœ¨å®ˆæŠ¤è¿›ç¨‹å¯åŠ¨æ—¶æ²¡æœ‰æŒ‡å®šéš”ç¦»å€¼ï¼Œé‚£ä¹ˆåœ¨Windowså®¢æˆ·æœºä¸Šï¼Œé»˜è®¤ä¸ºhypervï¼Œåœ¨WindowsæœåŠ¡å™¨ä¸Šï¼Œé»˜è®¤ä¸ºprocessã€‚</span></span><br><span class="line">$ dockerd --<span class="built_in">exec</span>-opt isolation=hyperv</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<ul>
<li>å®ˆæŠ¤è¿›ç¨‹DNSé€‰é¡¹<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸ºæ‰€æœ‰Dockerå®¹å™¨è®¾ç½®DNSæœåŠ¡å™¨ï¼Œè¯·ä½¿ç”¨:</span></span><br><span class="line">$ sudo dockerd --dns 8.8.8.8</span><br><span class="line"><span class="comment"># ä¸ºæ‰€æœ‰Dockerå®¹å™¨è®¾ç½®DNSæœç´¢åŸŸï¼Œè¯·ä½¿ç”¨:</span></span><br><span class="line">$ sudo dockerd --dns-search example.com</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<ul>
<li>å…è®¸æ¨å…¥ä¸å¯åˆ†å‘çš„å·¥ä»¶<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">To override this behavior <span class="keyword">for</span> specific registries, use the --allow-nondistributable-artifacts option <span class="keyword">in</span> one of the following forms:</span><br><span class="line">--allow-nondistributable-artifacts myregistry:5000 tells the Docker daemon to push nondistributable artifacts to myregistry:5000.</span><br><span class="line">--allow-nondistributable-artifacts 10.1.0.0/16 tells the Docker daemon to push nondistributable artifacts to all registries whose resolved IP address is within the subnet described by the CIDR syntax.</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<ul>
<li>Insecure registries<br>é»˜è®¤æƒ…å†µä¸‹ï¼ŒDockerå‡è®¾æ‰€æœ‰æ³¨å†Œï¼Œä½†æ˜¯åœ¨æœ¬åœ°(å‚è§ä¸‹é¢çš„æœ¬åœ°æ³¨å†Œ)ï¼Œæ³¨å†Œæ˜¯å®‰å…¨çš„ã€‚ä¸ä¸å®‰å…¨çš„æ³¨å†Œè¡¨é€šä¿¡æ˜¯ä¸å¯èƒ½çš„ï¼Œå¦‚æœDockerå‡è®¾æ³¨å†Œè¡¨æ˜¯å®‰å…¨çš„ã€‚ä¸ºäº†ä¸ä¸å®‰å…¨çš„æ³¨å†Œè¡¨é€šä¿¡ï¼ŒDockerå®ˆæŠ¤è¿›ç¨‹éœ€è¦â€”insecureæ³¨å†Œè¡¨åœ¨ä»¥ä¸‹ä¸¤ç§å½¢å¼ä¹‹ä¸€:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--insecure-registry myregistry:5000 tells the Docker daemon that myregistry:5000 should be considered insecure.</span><br><span class="line">--insecure-registry 10.1.0.0/16 tells the Docker daemon that all registries whose domain resolve to an IP address is part of the subnet described by the CIDR syntax, should be considered insecure.</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<ul>
<li>Node discovery<br>é€‰é¡¹æŒ‡å®šè¿™ä¸ªç‰¹å®šå®ˆæŠ¤è¿›ç¨‹å®ä¾‹åœ¨å‘é›†ç¾¤å‘å¸ƒè‡ªèº«æ—¶åº”è¯¥ä½¿ç”¨çš„ä¸»æœº:ç«¯å£æˆ–æ¥å£:ç«¯å£ç»„åˆã€‚<br>å®ˆæŠ¤è¿›ç¨‹ä½¿ç”¨libkvå…¬å¸ƒé›†ç¾¤ä¸­çš„èŠ‚ç‚¹ã€‚ä¸€äº›é”®å€¼åç«¯æ”¯æŒç›¸äº’TLSã€‚è¦é…ç½®å®ˆæŠ¤è¿›ç¨‹ä½¿ç”¨çš„å®¢æˆ·ç«¯TLSè®¾ç½®ï¼Œå¯ä»¥ä½¿ç”¨ â€”â€”cluster-store-opt æ ‡å¿—è¿›è¡Œé…ç½®ï¼ŒæŒ‡å®šPEMç¼–ç æ–‡ä»¶çš„è·¯å¾„ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dockerd \</span><br><span class="line">    --cluster-advertise 192.168.1.2:2376 \</span><br><span class="line">    --cluster-store etcd://192.168.1.2:2379 \</span><br><span class="line">    --cluster-store-opt kv.cacertfile=/path/to/ca.pem \ <span class="comment"># æŒ‡å®šè¦ä¿¡ä»»çš„å¸¦æœ‰PEMç¼–ç CAè¯ä¹¦çš„æœ¬åœ°æ–‡ä»¶çš„è·¯å¾„ã€‚</span></span><br><span class="line">    --cluster-store-opt kv.certfile=/path/to/cert.pem \ <span class="comment"># æŒ‡å®šå…·æœ‰PEMç¼–ç è¯ä¹¦çš„æœ¬åœ°æ–‡ä»¶çš„è·¯å¾„ã€‚</span></span><br><span class="line">    --cluster-store-opt kv.keyfile=/path/to/key.pem     <span class="comment"># ä½¿ç”¨PEMç¼–ç çš„ç§é’¥æŒ‡å®šæœ¬åœ°æ–‡ä»¶çš„è·¯å¾„ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å½“å‰æ”¯æŒçš„é›†ç¾¤å­˜å‚¨é€‰é¡¹æ˜¯</span></span><br><span class="line">discovery.heartbeat = å¿ƒè·³æ£€æµ‹é»˜è®¤é»˜è®¤å€¼æ˜¯20ç§’ã€‚</span><br><span class="line">discovery.ttl = æŒ‡å®šTTL(ç”Ÿå­˜æ—¶é—´)(ä»¥ç§’ä¸ºå•ä½)ï¼Œå¦‚æœåœ¨é…ç½®çš„TTLå€¼å†…æ²¡æœ‰æ¥æ”¶åˆ°æœ‰æ•ˆçš„å¿ƒè·³ï¼Œåˆ™å‘ç°æ¨¡å—ä½¿ç”¨è¯¥TTLä¸ºèŠ‚ç‚¹è¶…æ—¶ã€‚å¦‚æœæ²¡æœ‰é…ç½®ï¼Œé»˜è®¤å€¼æ˜¯60ç§’ã€‚</span><br><span class="line">kv.path = æŒ‡å®šçš„é”®/å€¼å­˜å‚¨çš„è·¯å¾„ã€‚</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<ul>
<li>æ‚é¡¹é€‰é¡¹<br>æè¿°:IPä¼ªè£…ä½¿ç”¨åœ°å€è½¬æ¢æ¥å…è®¸æ²¡æœ‰å…¬å…±IPçš„å®¹å™¨ä¸Internetä¸Šçš„å…¶ä»–æœºå™¨è¿›è¡Œå¯¹è¯ã€‚è¿™å¯èƒ½ä¼šå¹²æ‰°ä¸€äº›ç½‘ç»œæ‹“æ‰‘ï¼Œå¯ä»¥ä½¿ç”¨â€“ip-masq=falseç¦ç”¨ã€‚<br>Dockeræ”¯æŒDockeræ•°æ®ç›®å½•<code>(/var/lib/ Docker)</code>å’Œ<code>/var/lib/Docker/tmp</code>çš„è½¯é“¾æ¥ã€‚DOCKER_TMPDIRå’Œæ•°æ®ç›®å½•å¯ä»¥è¿™æ ·è®¾ç½®:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DOCKER_TMPDIR=/mnt/disk2/tmp /usr/<span class="built_in">local</span>/bin/dockerd -D -g /var/lib/docker -H unix:// &gt; /var/lib/docker-machine/docker.log 2&gt;&amp;1</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line"><span class="built_in">export</span> DOCKER_TMPDIR=/mnt/disk2/tmp</span><br><span class="line">/usr/<span class="built_in">local</span>/bin/dockerd -D -g /var/lib/docker -H unix:// &gt; /var/lib/docker-machine/docker.log 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Dockerçš„è®¿é—®æˆæƒå¯ä»¥é€šè¿‡æˆæƒæ’ä»¶æ¥æ‰©å±•</span></span><br><span class="line">$ sudo dockerd --authorization-plugin=plugin1 --authorization-plugin=plugin2</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<ul>
<li>å®ˆæŠ¤è¿›ç¨‹æŒ‡æ ‡<br>â€“metrics-addr é€‰é¡¹æ¥å—ä¸€ä¸ªtcpåœ°å€æ¥ä¸ºåº¦é‡APIæä¾›æœåŠ¡ã€‚è¦åœ¨localhost:9323ä¸Šæä¾›åº¦é‡APIï¼Œæ‚¨éœ€è¦æŒ‡å®šâ€”â€”metrsts -addr 127.0.0.1:9323ï¼Œå…è®¸æ‚¨å¯¹127.0.0.1:9323/metricsçš„APIå‘å‡ºè¯·æ±‚ï¼Œä»¥æ¥æ”¶ prometheusçš„åº¦é‡ã€‚ç«¯å£9323æ˜¯ä¸Dockeråº¦é‡ç›¸å…³è”çš„é»˜è®¤ç«¯å£ï¼Œä»¥é¿å…ä¸å…¶ä»–prometheuså‡ºå£å•†å’ŒæœåŠ¡å‘ç”Ÿå†²çªã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœä½ è¿è¡Œçš„æ˜¯prometheusæœåŠ¡å™¨ä½ å¯ä»¥å°†è¿™ä¸ªåœ°å€æ·»åŠ åˆ°ä½ çš„scrapeé…ç½®ä¸­</span></span><br><span class="line">scrape_configs:</span><br><span class="line">  - job_name: <span class="string">'docker'</span></span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [<span class="string">'127.0.0.1:9323'</span>]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<p><strong>å‘½ä»¤é€‰é¡¹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">--api-cors-header=<span class="string">""</span>ï¼šCORS å¤´éƒ¨åŸŸï¼Œé»˜è®¤ä¸å…è®¸ CORSï¼Œè¦å…è®¸ä»»æ„çš„è·¨åŸŸè®¿é—®ï¼Œå¯ä»¥æŒ‡å®šä¸º <span class="string">"*"</span>ï¼›</span><br><span class="line">--authorization-plugin=<span class="string">""</span>ï¼šè½½å…¥è®¤è¯çš„æ’ä»¶ï¼›</span><br><span class="line">-b=<span class="string">""</span>ï¼šå°†å®¹å™¨æŒ‚è½½åˆ°ä¸€ä¸ªå·²å­˜åœ¨çš„ç½‘æ¡¥ä¸Šã€‚æŒ‡å®šä¸º none æ—¶åˆ™ç¦ç”¨å®¹å™¨çš„ç½‘ç»œï¼Œä¸ --bip é€‰é¡¹äº’æ–¥ï¼›</span><br><span class="line">--bip=<span class="string">""</span>ï¼šè®©åŠ¨æ€åˆ›å»ºçš„ docker0 ç½‘æ¡¥é‡‡ç”¨ç»™å®šçš„ CIDR åœ°å€; ä¸ -b é€‰é¡¹äº’æ–¥ï¼›</span><br><span class="line">--cgroup-parent=<span class="string">""</span>ï¼šæŒ‡å®š cgroup çš„çˆ¶ç»„ï¼Œé»˜è®¤ fs cgroup é©±åŠ¨ä¸º /dockerï¼Œsystemd cgroup é©±åŠ¨ä¸º system.sliceï¼›</span><br><span class="line">--cluster-store=<span class="string">""</span>ï¼šæ„æˆé›†ç¾¤ï¼ˆå¦‚ Swarmï¼‰æ—¶ï¼Œé›†ç¾¤é”®å€¼æ•°æ®åº“æœåŠ¡åœ°å€ï¼›</span><br><span class="line">--cluster-advertise=<span class="string">""</span>ï¼šæ„æˆé›†ç¾¤æ—¶ï¼Œè‡ªèº«çš„è¢«è®¿é—®åœ°å€ï¼Œå¯ä»¥ä¸º host:port æˆ– interface:portï¼›</span><br><span class="line">--cluster-store-opt=<span class="string">""</span>ï¼šæ„æˆé›†ç¾¤æ—¶ï¼Œé”®å€¼æ•°æ®åº“çš„é…ç½®é€‰é¡¹ï¼›</span><br><span class="line">--config-file=<span class="string">"/etc/docker/daemon.json"</span>ï¼šdaemon é…ç½®æ–‡ä»¶è·¯å¾„ï¼›</span><br><span class="line">--containerd=<span class="string">""</span>ï¼šcontainerd æ–‡ä»¶çš„è·¯å¾„ï¼›</span><br><span class="line">-D, --debug=<span class="literal">true</span>|<span class="literal">false</span>ï¼šæ˜¯å¦ä½¿ç”¨ Debug æ¨¡å¼ã€‚ç¼ºçœä¸º <span class="literal">false</span>ï¼›</span><br><span class="line">--default-gateway=<span class="string">""</span>ï¼šå®¹å™¨çš„ IPv4 ç½‘å…³åœ°å€ï¼Œå¿…é¡»åœ¨ç½‘æ¡¥çš„å­ç½‘æ®µå†…ï¼›</span><br><span class="line">--default-gateway-v6=<span class="string">""</span>ï¼šå®¹å™¨çš„ IPv6 ç½‘å…³åœ°å€ï¼›</span><br><span class="line">--default-ulimit=[]ï¼šé»˜è®¤çš„ <span class="built_in">ulimit</span> å€¼ï¼›</span><br><span class="line">--<span class="built_in">disable</span>-legacy-registry=<span class="literal">true</span>|<span class="literal">false</span>ï¼šæ˜¯å¦å…è®¸è®¿é—®æ—§ç‰ˆæœ¬çš„é•œåƒä»“åº“æœåŠ¡å™¨ï¼›</span><br><span class="line">--dns=<span class="string">""</span>ï¼šæŒ‡å®šå®¹å™¨ä½¿ç”¨çš„ DNS æœåŠ¡å™¨åœ°å€ï¼›æ·»åŠ  DNS æœåŠ¡å™¨åˆ°å®¹å™¨çš„ /etc/resolv.conf ä¸­ï¼Œè®©å®¹å™¨ç”¨è¿™ä¸ªæœåŠ¡å™¨æ¥è§£ææ‰€æœ‰ä¸åœ¨ /etc/hosts ä¸­çš„ä¸»æœºåã€‚</span><br><span class="line">--dns-opt=<span class="string">""</span>ï¼šDNS é€‰é¡¹ï¼›</span><br><span class="line">--dns-search=[]ï¼šDNS æœç´¢åŸŸï¼›å½“è®¾å®šæœç´¢åŸŸä¸º .example.com æ—¶ï¼Œåœ¨æœç´¢ä¸€ä¸ªåä¸º host çš„ä¸»æœºæ—¶ï¼ŒDNS ä¸ä»…æœç´¢ hostï¼Œè¿˜ä¼šæœç´¢ host.example.comã€‚</span><br><span class="line">--<span class="built_in">exec</span>-opt=[]ï¼šè¿è¡Œæ—¶çš„æ‰§è¡Œé€‰é¡¹ï¼›</span><br><span class="line">--<span class="built_in">exec</span>-root=<span class="string">""</span>ï¼šå®¹å™¨æ‰§è¡ŒçŠ¶æ€æ–‡ä»¶çš„æ ¹è·¯å¾„ï¼Œé»˜è®¤ä¸º /var/run/dockerï¼›</span><br><span class="line">--fixed-cidr=<span class="string">""</span>ï¼šé™å®šåˆ†é… IPv4 åœ°å€èŒƒå›´ï¼›</span><br><span class="line">--fixed-cidr-v6=<span class="string">""</span>ï¼šé™å®šåˆ†é… IPv6 åœ°å€èŒƒå›´ï¼›</span><br><span class="line">-G, --group=<span class="string">""</span>ï¼šåˆ†é…ç»™ unix å¥—æ¥å­—çš„ç»„ï¼Œé»˜è®¤ä¸º dockerï¼›</span><br><span class="line">-g, --graph=<span class="string">""</span>ï¼šDocker è¿è¡Œæ—¶çš„æ ¹è·¯å¾„ï¼Œé»˜è®¤ä¸º /var/lib/dockerï¼›</span><br><span class="line">-H, --host=[]ï¼šæŒ‡å®šå‘½ä»¤å¯¹åº” Docker daemon çš„ç›‘å¬æ¥å£ï¼Œå¯ä»¥ä¸º unix å¥—æ¥å­— unix:///path/to/socketï¼Œæ–‡ä»¶å¥æŸ„ fd://socketfd æˆ– tcp å¥—æ¥å­— tcp://[host[:port]]ï¼Œé»˜è®¤ä¸º unix:///var/run/docker.sockï¼›</span><br><span class="line">--icc=<span class="literal">true</span>|<span class="literal">false</span>ï¼šæ˜¯å¦å¯ç”¨å®¹å™¨é—´ä»¥åŠè·Ÿ daemon æ‰€åœ¨ä¸»æœºçš„é€šä¿¡ã€‚é»˜è®¤ä¸º <span class="literal">true</span>ã€‚</span><br><span class="line">--insecure-registry=[]ï¼šå…è®¸è®¿é—®ç»™å®šçš„éå®‰å…¨ä»“åº“æœåŠ¡ï¼›</span><br><span class="line">--ip=<span class="string">""</span>ï¼šç»‘å®šå®¹å™¨ç«¯å£æ—¶å€™çš„é»˜è®¤ IP åœ°å€ã€‚ç¼ºçœä¸º 0.0.0.0ï¼›</span><br><span class="line">--ip-forward=<span class="literal">true</span>|<span class="literal">false</span>ï¼šæ˜¯å¦æ£€æŸ¥å¯åŠ¨åœ¨ Docker ä¸»æœºä¸Šçš„å¯ç”¨ IP è½¬å‘æœåŠ¡ï¼Œé»˜è®¤å¼€å¯ã€‚æ³¨æ„å…³é—­è¯¥é€‰é¡¹å°†ä¸å¯¹ç³»ç»Ÿè½¬å‘èƒ½åŠ›è¿›è¡Œä»»ä½•æ£€æŸ¥ä¿®æ”¹ï¼›</span><br><span class="line">--ip-masq=<span class="literal">true</span>|<span class="literal">false</span>ï¼šæ˜¯å¦è¿›è¡Œåœ°å€ä¼ªè£…ï¼Œç”¨äºå®¹å™¨è®¿é—®å¤–éƒ¨ç½‘ç»œï¼Œé»˜è®¤å¼€å¯ï¼›</span><br><span class="line">--iptables=<span class="literal">true</span>|<span class="literal">false</span>ï¼šæ˜¯å¦å…è®¸ Docker æ·»åŠ  iptables è§„åˆ™ã€‚ç¼ºçœä¸º <span class="literal">true</span>ï¼›</span><br><span class="line">--ipv6=<span class="literal">true</span>|<span class="literal">false</span>ï¼šæ˜¯å¦å¯ç”¨ IPv6 æ”¯æŒï¼Œé»˜è®¤å…³é—­ï¼›</span><br><span class="line">-l, --<span class="built_in">log</span>-level=<span class="string">"debug|info|warn|error|fatal"</span>ï¼šæŒ‡å®šæ—¥å¿—è¾“å‡ºçº§åˆ«ï¼›</span><br><span class="line">--label=<span class="string">"[]"</span>ï¼šæ·»åŠ æŒ‡å®šçš„é”®å€¼å¯¹æ ‡æ³¨ï¼›</span><br><span class="line">--<span class="built_in">log</span>-driver=<span class="string">"json-file|syslog|journald|gelf|fluentd|awslogs|splunk|etwlogs|gcplogs|none"</span>ï¼šæŒ‡å®šæ—¥å¿—åç«¯é©±åŠ¨ï¼Œé»˜è®¤ä¸º json-fileï¼›</span><br><span class="line">--<span class="built_in">log</span>-opt=[]ï¼šæ—¥å¿—åç«¯çš„é€‰é¡¹ï¼›</span><br><span class="line">--mtu=VALUEï¼šæŒ‡å®šå®¹å™¨ç½‘ç»œçš„ mtuï¼›</span><br><span class="line">-p=<span class="string">""</span>ï¼šæŒ‡å®š daemon çš„ PID æ–‡ä»¶è·¯å¾„ã€‚ç¼ºçœä¸º /var/run/docker.pidï¼›</span><br><span class="line">--raw-logsï¼šè¾“å‡ºåŸå§‹ï¼ŒæœªåŠ è‰²å½©çš„æ—¥å¿—ä¿¡æ¯ï¼›</span><br><span class="line">--registry-mirror=&lt;scheme&gt;://&lt;host&gt;ï¼šæŒ‡å®š docker pull æ—¶ä½¿ç”¨çš„æ³¨å†ŒæœåŠ¡å™¨é•œåƒåœ°å€ï¼›</span><br><span class="line">-s, --storage-driver=<span class="string">""</span>ï¼šæŒ‡å®šä½¿ç”¨ç»™å®šçš„å­˜å‚¨åç«¯ï¼›</span><br><span class="line">--selinux-enabled=<span class="literal">true</span>|<span class="literal">false</span>ï¼šæ˜¯å¦å¯ç”¨ SELinux æ”¯æŒã€‚ç¼ºçœå€¼ä¸º <span class="literal">false</span>ã€‚SELinux ç›®å‰å°šä¸æ”¯æŒ overlay å­˜å‚¨é©±åŠ¨ï¼›</span><br><span class="line">--storage-opt=[]ï¼šé©±åŠ¨åç«¯é€‰é¡¹ï¼›</span><br><span class="line">--tls=<span class="literal">true</span>|<span class="literal">false</span>ï¼šæ˜¯å¦å¯¹ Docker daemon å¯ç”¨ TLS å®‰å…¨æœºåˆ¶ï¼Œé»˜è®¤ä¸ºå¦ï¼›</span><br><span class="line">--tlscacert=/.docker/ca.pemï¼šTLS CA ç­¾åçš„å¯ä¿¡è¯ä¹¦æ–‡ä»¶è·¯å¾„ï¼›</span><br><span class="line">--tlscert=/.docker/cert.pemï¼šTLS å¯ä¿¡è¯ä¹¦æ–‡ä»¶è·¯å¾„ï¼›</span><br><span class="line">--tlscert=/.docker/key.pemï¼šTLS å¯†é’¥æ–‡ä»¶è·¯å¾„ï¼›</span><br><span class="line">--tlsverify=<span class="literal">true</span>|<span class="literal">false</span>ï¼šå¯ç”¨ TLS æ ¡éªŒï¼Œé»˜è®¤ä¸ºå¦ï¼›</span><br><span class="line">--userland-proxy=<span class="literal">true</span>|<span class="literal">false</span>ï¼šæ˜¯å¦ä½¿ç”¨ç”¨æˆ·æ€ä»£ç†æ¥å®ç°å®¹å™¨é—´å’Œå‡ºå®¹å™¨çš„å›ç¯é€šä¿¡ï¼Œé»˜è®¤ä¸º <span class="literal">true</span>ï¼›</span><br><span class="line">--userns-remap=default|uid:gid|user:group|user|uidï¼šæŒ‡å®šå®¹å™¨çš„ç”¨æˆ·å‘½åç©ºé—´ï¼Œé»˜è®¤æ˜¯åˆ›å»ºæ–°çš„ UID å’Œ GID æ˜ å°„åˆ°å®¹å™¨å†…è¿›ç¨‹ã€‚</span><br></pre></td></tr></table></figure></p>
<p><strong>dockerd ç®€å•çš„å¯åŠ¨ç¤ºä¾‹1è„šæœ¬:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/dockerd </span><br><span class="line">--config-file /etc/docker/daemon.json</span><br><span class="line">-g /<span class="built_in">export</span>/docker</span><br><span class="line">-H fd:// </span><br><span class="line">-H tcp://0.0.0.0:2375</span><br><span class="line">-H unix:///var/run/docker.sock </span><br><span class="line"></span><br><span class="line"><span class="comment"># Dockerè¿è¡Œæ—¶æ‰§è¡Œé€‰é¡¹</span></span><br><span class="line">--containerd=/run/containerd/containerd.sock</span><br><span class="line">--<span class="built_in">exec</span>-opt native.cgroupdriver=systemd  <span class="comment">#cgroupfs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å½“å®¹å™¨ä»åœ¨è¿è¡Œæ—¶ï¼Œå¯ç”¨dockerçš„æ´»è¿˜åŸ</span></span><br><span class="line">--live-retore  </span><br><span class="line"></span><br><span class="line"><span class="comment"># å­˜å‚¨å¼•æ“ä¸ºdevicemapperåŠç›¸å…³å‚æ•°</span></span><br><span class="line">-s devicemapper</span><br><span class="line">--storage-opt dm.loopdatasize=500G</span><br><span class="line">--storage-opt dm.loopmetadatasize=4G</span><br><span class="line">--storage-opt dm.basesize=100G</span><br><span class="line">--storage-opt dm.fs=ext4</span><br><span class="line"></span><br><span class="line">--insecure-registry https://index.docker.io/v1/</span><br><span class="line">--biq 172.17.42.1/16</span><br><span class="line">--fixed-cidr 172.17.0.0/16</span><br></pre></td></tr></table></figure></p>
<p><strong>ç¤ºä¾‹2:è„šæœ¬çš„Dockerå®ˆæŠ¤è¿›ç¨‹çš„ä¸€ä¸ªå•ç‹¬çš„â€œbootstrapâ€å®ä¾‹æ²¡æœ‰ç½‘ç»œ:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dockerd \</span><br><span class="line">  -H unix:///var/run/docker-bootstrap.sock \</span><br><span class="line">  -p /var/run/docker-bootstrap.pid \</span><br><span class="line">  --iptables=<span class="literal">false</span> \</span><br><span class="line">  --ip-masq=<span class="literal">false</span> \</span><br><span class="line">  --bridge=none \</span><br><span class="line">  --data-root=/var/lib/docker-bootstrap \</span><br><span class="line">  --<span class="built_in">exec</span>-root=/var/run/docker-bootstrap</span><br></pre></td></tr></table></figure></p>
<p><strong>è¡¥å……è¯´æ˜:</strong></p>
<ul>
<li>é‡æ–°åŠ è½½é…ç½®è¡Œä¸º ï¼šåœ¨å®ˆæŠ¤è¿›ç¨‹è¿è¡Œæ—¶ï¼Œå¯ä»¥é‡æ–°é…ç½®ä¸€äº›é€‰é¡¹ï¼Œè€Œä¸éœ€è¦é‡æ–°å¯åŠ¨è¿›ç¨‹ã€‚<code>æˆ‘ä»¬åœ¨Linuxä¸­ä½¿ç”¨SIGHUPä¿¡å·æ¥é‡æ–°åŠ è½½ï¼Œåœ¨Windowsä¸­ä½¿ç”¨ä¸€ä¸ªå…¨å±€äº‹ä»¶</code><br>å½“å‰æ”¯æŒçš„é€‰é¡¹åˆ—è¡¨ï¼Œå¯ä»¥é‡æ–°é…ç½®å¦‚ä¸‹:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># debug: it changes the daemon to debug mode when set to true.</span></span><br><span class="line"><span class="comment"># cluster-store: it reloads the discovery store with the new address.</span></span><br><span class="line"><span class="comment"># cluster-store-opts: it uses the new options to reload the discovery store.</span></span><br><span class="line"><span class="comment"># cluster-advertise: it modifies the address advertised after reloading.</span></span><br><span class="line"><span class="comment"># labels: it replaces the daemon labels with a new set of labels.</span></span><br><span class="line"><span class="comment"># live-restore: Enables keeping containers alive during daemon downtime.</span></span><br><span class="line"><span class="comment"># max-concurrent-downloads: it updates the max concurrent downloads for each pull.</span></span><br><span class="line"><span class="comment"># max-concurrent-uploads: it updates the max concurrent uploads for each push.</span></span><br><span class="line"><span class="comment"># default-runtime: it updates the runtime to be used if not is specified at container creation. It defaults to â€œdefaultâ€ which is the runtime shipped with the official docker packages.</span></span><br><span class="line"><span class="comment"># runtimes: it updates the list of available OCI runtimes that can be used to run containers.</span></span><br><span class="line"><span class="comment"># authorization-plugin: it specifies the authorization plugins to use.</span></span><br><span class="line"><span class="comment"># allow-nondistributable-artifacts: Replaces the set of registries to which the daemon will push nondistributable artifacts with a new set of registries.</span></span><br><span class="line"><span class="comment"># insecure-registries: it replaces the daemon insecure registries with a new set of insecure registries. If some existing insecure registries in daemonâ€™s configuration are not in newly reloaded insecure resgitries, these existing ones will be removed from daemonâ€™s config.</span></span><br><span class="line"><span class="comment"># registry-mirrors: it replaces the daemon registry mirrors with a new set of registry mirrors. If some existing registry mirrors in daemonâ€™s configuration are not in newly reloaded registry mirrors, these existing ones will be removed from daemonâ€™s config.</span></span><br><span class="line"><span class="comment"># shutdown-timeout: it replaces the daemonâ€™s existing configuration timeout with a new timeout for shutting down all containers.</span></span><br><span class="line"><span class="comment"># features: it explicitly enables or disables specific features.</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="0x02-Docker-é…ç½®æ–‡ä»¶"><a href="#0x02-Docker-é…ç½®æ–‡ä»¶" class="headerlink" title="0x02 Docker é…ç½®æ–‡ä»¶"></a>0x02 Docker é…ç½®æ–‡ä»¶</h4><p>æè¿°:æœ¬ç« èŠ‚è®°å½•äº†dockerçš„ä¸€äº›ä¸»è¦çš„é…ç½®æ–‡ä»¶è·¯å¾„åŠå…¶åŠŸèƒ½ï¼Œå¹¶å¯¹å…¶æ–‡ä»¶å†…å®¹è¿›è¡Œè§£æå¤‡æ³¨;</p>
<h5 id="Configure-Path"><a href="#Configure-Path" class="headerlink" title="Configure Path"></a>Configure Path</h5><ul>
<li>/root/.docker/config.json <code>Dockerè®¤è¯+å¯åŠ¨é…ç½®(æ³¨æ„æ‚¨ä½¿ç”¨çš„dockerç‰ˆæœ¬</code>)</li>
<li>/etc/docker/deamon.json   <code>Docker å¯åŠ¨å‚æ•°é…ç½®æ–‡ä»¶(ä¸»è¦æ–‡ä»¶CentOS)</code><ul>
<li>/etc/docker/key.json      <code>Docker è®¤è¯ç›¸å…³é…ç½®(ä¸»è¦æ˜¯å­˜å‚¨ä»“åº“è®¤è¯é‰´æƒä¿¡æ¯)</code></li>
</ul>
</li>
<li>/lib/systemd/system/docker.service</li>
</ul>
<p><br/></p>
<p><strong>1.~/.config.json</strong><br>æè¿°:è¯¥é…ç½®æ–‡ä»¶æ˜¯rootç”¨æˆ·ä¸‹è®¾å®šçš„ docker configure å‚æ•°, ä¼˜å…ˆçº§é«˜äº/etc/docker/deamon.json;<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$vim /root/.docker/config.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"auths"</span>: &#123;</span><br><span class="line">    <span class="attr">"https://index.$docker.io/v1/"</span>: &#123;</span><br><span class="line">      <span class="attr">"auth"</span>: <span class="string">"********"</span>  //è´¦å·ï¼šå¯†ç </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"HttpHeaders"</span>: &#123;</span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"$docker-Client/18.09.5 (linux)"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>2./etc/docker/daemon.json</strong><br>æè¿°:Docker Engine V1.12 ä¹‹åç‰ˆæœ¬ï¼Œç”¨æˆ·å¯ä»¥è‡ªè¡Œåˆ›å»º daemon.json æ–‡ä»¶å¯¹ Docker Engine è¿›è¡Œé…ç½®å’Œè°ƒæ•´ã€‚åœ¨Linuxä¸­ä½¿ç”¨<code>/etc/docker/daemon.jsonï¼ˆLinuxï¼‰</code> ä¸åœ¨Windowsä¸­<code>%programdata%\docker\config\daemon.jsonï¼ˆWindowsï¼‰</code>æ¥é…ç½® Daemon.json, å¯èƒ½åœ¨æ‚¨çš„ç³»ç»Ÿæ²¡æœ‰daemon.jsonç›®å½•æ­¤æ—¶ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå³å¯;</p>
<p>è¦ç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>è¯¥æ–‡ä»¶ä½œä¸º Docker Engine çš„é…ç½®ç®¡ç†æ–‡ä»¶, é‡Œé¢å‡ ä¹æ¶µç›–äº†æ‰€æœ‰ docker å‘½ä»¤è¡Œå¯åŠ¨å¯ä»¥é…ç½®çš„å‚æ•°ã€‚</li>
<li>ä¸ç®¡æ˜¯åœ¨å“ªä¸ªå¹³å°ä»¥ä½•ç§æ–¹å¼å¯åŠ¨, Docker é»˜è®¤éƒ½ä¼šæ¥è¿™é‡Œè¯»å–é…ç½®ï¼Œä½¿ç”¨æˆ·å¯ä»¥ç»Ÿä¸€ç®¡ç†ä¸åŒç³»ç»Ÿä¸‹çš„ docker daemon é…ç½®(ä¼˜å…ˆçº§ä½äºç”¨æˆ·é…ç½®~/.docker/config.json)ã€‚</li>
<li>ç›¸å…³å‚æ•°çš„ä½¿ç”¨è¯´æ˜ï¼Œå¯ä»¥å‚é˜… man dockerd å¸®åŠ©ä¿¡æ¯ï¼Œæˆ–è€…å‚é˜…å®˜æ–¹æ–‡æ¡£ã€‚</li>
</ul>
<p>Docker å®˜æ–¹ daemon-configuration-fileå‚æ•°ä¸€è§ˆï¼š<a href="https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-configuration-file" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-configuration-file</a><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line">&#123;Â </span><br><span class="line">  // é•œåƒä»“åº“é‰´æƒä¿¡æ¯(ä¼˜å…ˆçº§æ²¡æœ‰ç”¨æˆ·é…ç½®æ–‡ä»¶é«˜)</span><br><span class="line">  "auths": &#123;</span><br><span class="line">      "https://registry.weiyigek.top/v2": &#123;"auth": "VlJFpmQE43Sw=="&#125;,</span><br><span class="line">      "localhost": &#123;"auth": "cm9vdDoxMjM0NTY="&#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">  // æ³¨å†Œé•œåƒ-åŠ é€Ÿé•œåƒç«™é…ç½®</span><br><span class="line">  "registry-mirrors": [</span><br><span class="line">    "https://xlx9erfu.mirror.aliyuncs.com",</span><br><span class="line">    <span class="string">"https://docker.mirrors.ustc.edu.cn"</span></span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line"> // ç§æœ‰é•œåƒä»“åº“çš„ IP åœ°å€æˆ–è€…åŸŸå(harboræˆ–è€…docker)ä¸è¿›è¡ŒHTTPSè®¤è¯</span><br><span class="line">  "insecure-registries" : [</span><br><span class="line">    "https://harbor.weiyigeek.top",</span><br><span class="line">    <span class="string">"192.168.10.200:5000"</span></span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  // ç§æœ‰ä»“åº“registryä»“åº“ä¸å¯¹å¤–åˆ†å‘çš„äº§å“</span><br><span class="line">  "allow-nondistributable-artifacts": ["192.168.10.200:5000"],</span><br><span class="line"></span><br><span class="line">  // docker å®¢æˆ·ç«¯ User-Agent è®¾ç½®</span><br><span class="line">  "HttpHeaders": &#123;</span><br><span class="line">    "User-Agent": "Docker-Client/19.03.5 (linux)"</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  // Dockerå®ˆæŠ¤è¿›ç¨‹çš„ç›‘å¬æ¥å£ä»¥åŠå­˜å‚¨å®ˆæŠ¤ç¨‹åºçš„pidæ–‡ä»¶</span><br><span class="line">  "hosts": ["/var/run/docker.sock"],  </span><br><span class="line">  "pidfile":"/var/run/docker.pid", </span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  // å­˜å‚¨ä½ç½®æ›´æ”¹</span><br><span class="line">  "graph": "/disk/docker",</span><br><span class="line">  // æ›´æ”¹ Docker çš„é»˜è®¤å­˜å‚¨ä½ç½®(æŒ‡å®šæŒ‚è½½ç£ç›˜åˆ†åŒºç›®å½•é™å®šå®¹å™¨ä½¿ç”¨ç£ç›˜çš„å¤§å°)</span><br><span class="line">  "data-root": "/data/docker",</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  //  å®¹å™¨è¿è¡Œæ—¶ç›¸å…³é…ç½®</span><br><span class="line">  "containerd": "/run/containerd/containerd.sock",</span><br><span class="line">  "containerd-namespace": "docker",</span><br><span class="line">  "containerd-plugin-namespace": "docker-plugins",</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  // å­˜å‚¨é©±åŠ¨é‡‡ç”¨ overlay2</span><br><span class="line">  "storage-driver": "overlay2",</span><br><span class="line">  //å­˜å‚¨é©±åŠ¨ç¨‹åºé€‰é¡¹</span><br><span class="line">  "storage-opts": [</span><br><span class="line">    "overlay2.override_kernel_check=true",</span><br><span class="line">    <span class="string">"overlay2.size=1G"</span></span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  // å­˜å‚¨é©±åŠ¨é‡‡ç”¨ devicemapper æ—¶å€™</span><br><span class="line">  "storage-driver": "devicemapper",</span><br><span class="line">  "storage-opts": [</span><br><span class="line">    "dm.thinpooldev=/dev/mapper/thin-pool", #æŒ‡å®šè¦ç”¨äºç˜¦æ± çš„è‡ªå®šä¹‰å—å­˜å‚¨è®¾å¤‡</span><br><span class="line">    "dm.use_deferred_deletion=true",</span><br><span class="line">    <span class="string">"dm.use_deferred_removal=true"</span></span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  // å®¹å™¨æ—¥å¿—æ–‡ä»¶åˆ†å‰²æ¯ä¸ªæ–‡ä»¶æœ€å¤§500MB</span><br><span class="line">  "log-driver":"json-file",</span><br><span class="line">  "log-opts": &#123;</span><br><span class="line">    "max-size":"500m", </span><br><span class="line">    "max-file":"3",</span><br><span class="line">    "labels": "production_status",</span><br><span class="line">    "env": "os,customer"</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  // å®¹å™¨ä¸­ulimitsé™åˆ¶(åŸºäºå®¿ä¸»æœºè¿›è¡Œulimitsæ¥è®¾ç½®)</span><br><span class="line">  "default-ulimits": &#123;</span><br><span class="line">        "nofile": &#123;</span><br><span class="line">            "Name": "nofile",</span><br><span class="line">            "Hard": 1024000,</span><br><span class="line">            "Soft": 1024000</span><br><span class="line">        &#125;,</span><br><span class="line">        "nproc": &#123;</span><br><span class="line">            "Name": "nproc",</span><br><span class="line">            "Hard": 1024000,</span><br><span class="line">            "Soft": 1024000</span><br><span class="line">        &#125;,</span><br><span class="line">       "core": &#123;</span><br><span class="line">            "Name": "core",</span><br><span class="line">            "Hard": -1,</span><br><span class="line">            "Soft": -1</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  // æ ‡å¿—æŒ‡å®šçš„é€‰é¡¹é…ç½®è¿è¡Œæ—¶ã€‚æŠŠdockeræ›´æ”¹é©±åŠ¨ä¸ºsystemtdæˆ–è€…cgroupfs</span><br><span class="line">  "exec-opts": ["native.cgroupdriver=cgroupfs"],</span><br><span class="line">  // Dockerè¿è¡Œæ—¶æ‰§è¡Œé€‰é¡¹,ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­å°†é€šè¿‡é…ç½®2ä¸ªè¿è¡Œæ—¶</span><br><span class="line">  "default-runtime": "runc",</span><br><span class="line">  "runtimes": &#123;</span><br><span class="line">    "runc": &#123;</span><br><span class="line">      "path": "runc"</span><br><span class="line">    &#125;,</span><br><span class="line">    "custom": &#123;</span><br><span class="line">      "path": "/usr/local/bin/my-runc-replacement",</span><br><span class="line">      "runtimeArgs": [</span><br><span class="line">        <span class="string">"--debug"</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">  //æ°¸ä¹…ç»‘å®šåˆ°æŸä¸ªå›ºå®šçš„ IP åœ°å€</span><br><span class="line">  "ip": "0.0.0.0",  </span><br><span class="line">  //ç¦æ­¢è®¿é—®æ‰€æœ‰ç«¯å£ï¼ˆæ¥å…³é—­å®¹å™¨ä¹‹é—´çš„é€šä¿¡ï¼‰</span><br><span class="line">  "icc": false, </span><br><span class="line">  //å¯ç”¨iptablesè§„åˆ™æ·»åŠ ï¼ˆé»˜è®¤ä¸ºtrueï¼‰</span><br><span class="line">  "iptables": true,</span><br><span class="line">  //è®¾ç½®é»˜è®¤æ¡¥æ¥åˆ°æ–°å»ºç«‹çš„æ¡¥æ¥ç½‘å¡(å°†å®¹å™¨é™„åŠ åˆ°ç½‘æ¡¥)</span><br><span class="line">  "bridge": "bridge0",</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  // å®¹å™¨ä¸­ä½¿ç”¨çš„DNSè§£æåœ°å€ç›¸å…³é…ç½®ï¼Œè®¾å®šå®¹å™¨DNSé¢å¤–æ‰©å±•ã€å®¹å™¨çš„æœç´¢åŸŸ</span><br><span class="line">  "dns" :[</span><br><span class="line">    "114.114.114.114",</span><br><span class="line">    <span class="string">"8.8.8.8"</span></span><br><span class="line">  ],  </span><br><span class="line">  "dns-opts": [], </span><br><span class="line">  "dns-search": [], </span><br><span class="line">  </span><br><span class="line">  //æ­¤æ—¶ dockerd ä¼šåœ¨æ—¥å¿—ä¸­è¾“å…¥æ›´å¤šä¿¡æ¯ä¾›åˆ†æ</span><br><span class="line">  "debug": true,   </span><br><span class="line"></span><br><span class="line">  //æ³¨æ„:åœ¨ä¸€å°ä¸»æœºä¸Šè¿è¡Œå¤šä¸ªå®ˆæŠ¤è¿›ç¨‹è¢«è®¤ä¸ºæ˜¯â€œè¯•éªŒæ€§çš„â€ã€‚</span><br><span class="line">  "experimental": "enabled",</span><br><span class="line"></span><br><span class="line">  //ä¸ºå®ˆæŠ¤è¿›ç¨‹è®¾ç½®oom_score_adj(é»˜è®¤å€¼ä¸º-500)</span><br><span class="line">  "oom-score-adjust": -1000,</span><br><span class="line"></span><br><span class="line">  //è®¾ç½®æ¯æ¬¡æ‹‰å–çš„æœ€å¤§å¹¶å‘ä¸‹è½½(é»˜è®¤ä¸º3)</span><br><span class="line">  "max-concurrent-downloads": 3,    </span><br><span class="line"></span><br><span class="line">  //è®¾ç½®æ¯ä¸ªæ¨é€çš„æœ€å¤§å¹¶å‘ä¸Šä¼ æ•°(é»˜è®¤ä¸º5)      </span><br><span class="line">  "max-concurrent-uploads": 5,</span><br><span class="line">  </span><br><span class="line">  //è®¾ç½®è¯¥é€‰é¡¹ä¿è¯ docker daemoné‡å¯æ—¶å®¹å™¨ä¸é‡å¯(éœ€è¦è®¾ç½® docker.server åªæ€æ­»dockerè¿›ç¨‹ï¼Œè€Œä¸æ˜¯cgroupä¸­çš„æ‰€æœ‰è¿›ç¨‹)</span><br><span class="line">  "live-restore": true,</span><br><span class="line"></span><br><span class="line">  // æ”¯æŒIPV6</span><br><span class="line">  "ipv6": true,</span><br><span class="line">  "fixed-cidr-v6": "2001:db8:1::/64",</span><br><span class="line">  </span><br><span class="line">  // å…è®¸æ‚¨è®¾ç½®é»˜è®¤çš„ cgroup çˆ¶çº§ ç”¨äºå®¹å™¨ã€‚ å¦‚æœæœªè®¾ç½®æ­¤é€‰é¡¹ï¼Œåˆ™é»˜è®¤ä¸º /dockerä¸ºäº† fs cgroup é©±åŠ¨ç¨‹åºå’Œ system.sliceç”¨äº systemd cgroup é©±åŠ¨ç¨‹åºã€‚ </span><br><span class="line">  "cgroup-parent": "/custom",</span><br><span class="line"></span><br><span class="line">  // è®¾ç½®ä¸ä½¿ç”¨ç”¨æˆ·æ€ä»£ç†æ¥å®ç°å®¹å™¨é—´å’Œå‡ºå®¹å™¨çš„å›ç¯é€šä¿¡ï¼Œ</span><br><span class="line">  "userland-proxy": false,</span><br><span class="line">  "userland-proxy-path": "/usr/libexec/docker-proxy",</span><br><span class="line"></span><br><span class="line">  // è®¾ç½®ä¸ä¸ºæ–°å®¹å™¨è®¾ç½®æ–°æƒé™</span><br><span class="line">  "no-new-privileges": false,</span><br><span class="line"></span><br><span class="line">  // å¯ç”¨ SELinux æ”¯æŒ, SELinux ç›®å‰å°šä¸æ”¯æŒ overlay å­˜å‚¨é©±åŠ¨, redhat ä¸ centOSæ”¯æŒè®¾ç½®ï¼Œubuntuéœ€è¦è‡ªè¡Œå®‰è£…ï¼›</span><br><span class="line">  "selinux-enabled": true,</span><br><span class="line"></span><br><span class="line">  // é…ç½®dockerd APIçš„TLSè®¤è¯</span><br><span class="line">  "tls": true,        // é»˜è®¤ false, å¯åŠ¨TLSè®¤è¯å¼€å…³</span><br><span class="line">  "tlscacert": "/etc/docker/ssl/ca.pem",    // é»˜è®¤ ~/.docker/ca.pemï¼Œé€šè¿‡CAè®¤è¯è¿‡çš„çš„certificateæ–‡ä»¶è·¯å¾„</span><br><span class="line">  "tlscert": "/etc/docker/ssl/cert.pem",      // é»˜è®¤ ~/.docker/cert.pem ï¼ŒTLSçš„certificateæ–‡ä»¶è·¯å¾„</span><br><span class="line">  "tlskey": "/etc/docker/ssl/key.pem",       // é»˜è®¤~/.docker/key.pemï¼ŒTLSçš„keyæ–‡ä»¶è·¯å¾„</span><br><span class="line">  "tlsverify": true,  // é»˜è®¤falseï¼Œä½¿ç”¨TLSå¹¶åšåå°è¿›ç¨‹ä¸å®¢æˆ·ç«¯é€šè®¯çš„éªŒè¯</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>3.docker.service</strong></p>
<ul>
<li>åŸºäºDocker-CE17.12ç‰ˆæœ¬ä»¥åŠä¹‹å, build 481bc77156<br>dockeræœåŠ¡é…ç½®æ–‡ä»¶è·¯å¾„ï¼š/lib/systemd/system/docker.service<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ExecStart=/usr/bin/dockerd --registry-mirror=https://xlx9erfu.mirror.aliyuncs.com</span><br></pre></td></tr></table></figure>
<br></li>
</ul>
<p><strong>æœåŠ¡é‡å¯</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¿®æ”¹é…ç½®æ–‡ä»¶åè¿›è¡Œå¹³æ»‘é‡å¯</span></span><br><span class="line"><span class="variable">$sudo</span> <span class="built_in">kill</span> -SIGHUP $(pidof dockerd)</span><br><span class="line"></span><br><span class="line"><span class="comment">#é€šç”¨å¯åŠ¨</span></span><br><span class="line"><span class="variable">$sudo</span> systemctl daemon-reload   <span class="comment">#é‡è½½å®ˆæŠ¤</span></span><br><span class="line"><span class="variable">$sudo</span> systemctl restart docker</span><br></pre></td></tr></table></figure></p>
<p>è¡¥å……è¯´æ˜:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Docker Server/Client:</span></span><br><span class="line">Version:         1.12.6</span><br><span class="line">API version:     1.24</span><br><span class="line">- /etc/systemd/system/docker.service.requires/flanneld.service </span><br><span class="line">- /etc/docker/</span><br></pre></td></tr></table></figure></p>
<p><em>Q:å¦‚ä½•é…ç½®Docker Deamonèƒ½è¢«Docker Clientè¿œç¨‹é“¾æ¥?</em><br>ç­”: æˆ‘ä»¬éœ€è¦åœ¨docker.serviceé…ç½®æ–‡ä»¶ä¸­è¿›è¡Œæ›´æ”¹dockerdçš„å¯åŠ¨å‚æ•°ä¸­æ·»åŠ <code>-H tcp://0.0.0.0:2375</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹å¯åŠ¨å‚æ•°</span></span><br><span class="line">nano /usr/lib/systemd/system/docker.service</span><br><span class="line">ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock -H tcp://0.0.0.0:2375</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡è½½å®ˆæŠ¤è¿›ç¨‹ä¸é‡å¯docker</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç›‘å¬æƒ…å†µ</span></span><br><span class="line">netstat -tlnp</span><br><span class="line"><span class="comment"># Active Internet connections (only servers)</span></span><br><span class="line"><span class="comment"># Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span></span><br><span class="line"><span class="comment"># tcp6       0      0 :::2375                 :::*                    LISTEN      11389/dockerd</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç®€å•éªŒè¯è¿œç¨‹è®¿é—®</span></span><br><span class="line">curl http://127.0.0.1:2375/containers/json | jq</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">"Id"</span>: <span class="string">"25d2d645bfc9e6530039d6aac890f69dd9af33f8f966adc2d7287b74964678e3"</span>,</span><br><span class="line">    <span class="string">"Names"</span>: [</span><br><span class="line">      <span class="string">"/test1"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"Image"</span>: <span class="string">"test1"</span>,</span><br><span class="line">    <span class="string">"ImageID"</span>: <span class="string">"sha256:5ec0e2b89f7aadb6178c17b3db73aba2e209f9556a436562de7f32b077b776bd"</span>,</span><br><span class="line">    <span class="string">"Command"</span>: <span class="string">"top -b -d 2"</span>,</span><br><span class="line">    <span class="string">"Created"</span>: 1592451272,</span><br><span class="line">    <span class="string">"Ports"</span>: [],</span><br><span class="line">    <span class="string">"Labels"</span>: &#123;</span><br><span class="line">      <span class="string">"Author"</span>: <span class="string">"WeiyiGeek"</span>,</span><br><span class="line">      <span class="string">"Description"</span>: <span class="string">"Test Dockerfile"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"State"</span>: <span class="string">"running"</span>,</span><br><span class="line">    <span class="string">"Status"</span>: <span class="string">"Up 35 minutes"</span>,</span><br><span class="line">    <span class="string">"HostConfig"</span>: &#123;</span><br><span class="line">      <span class="string">"NetworkMode"</span>: <span class="string">"default"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"NetworkSettings"</span>: &#123;</span><br><span class="line">      <span class="string">"Networks"</span>: &#123;</span><br><span class="line">        <span class="string">"bridge"</span>: &#123;</span><br><span class="line">          <span class="string">"IPAMConfig"</span>: null,</span><br><span class="line">          <span class="string">"Links"</span>: null,</span><br><span class="line">          <span class="string">"Aliases"</span>: null,</span><br><span class="line">          <span class="string">"NetworkID"</span>: <span class="string">"257f6a8500710d76efba6a1c9be8c0f10b4308afb481baf1e9ba77cf98f596bd"</span>,</span><br><span class="line">          <span class="string">"EndpointID"</span>: <span class="string">"ac4518815359da7b8182167dfeeec728c0ea51accd1736719005f1596797e944"</span>,</span><br><span class="line">          <span class="string">"Gateway"</span>: <span class="string">"172.17.0.1"</span>,</span><br><span class="line">          <span class="string">"IPAddress"</span>: <span class="string">"172.17.0.2"</span>,</span><br><span class="line">          <span class="string">"IPPrefixLen"</span>: 16,</span><br><span class="line">          <span class="string">"IPv6Gateway"</span>: <span class="string">""</span>,</span><br><span class="line">          <span class="string">"GlobalIPv6Address"</span>: <span class="string">""</span>,</span><br><span class="line">          <span class="string">"GlobalIPv6PrefixLen"</span>: 0,</span><br><span class="line">          <span class="string">"MacAddress"</span>: <span class="string">"02:42:ac:11:00:02"</span>,</span><br><span class="line">          <span class="string">"DriverOpts"</span>: null</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"Mounts"</span>: []</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=n2.Dockerå®¶æ–‡ä»¶ç›®å½•ä»‹ç»å’Œé…ç½®æ–‡ä»¶ä¸å®ˆæŠ¤è¿›ç¨‹å‘½ä»¤å‚æ•°ä¸€è§ˆ href="https://img.weiyigeek.top/2020/1/20200702100012.png" target="_blank" title="WeiyiGeek.Dockerd-TCP" data-fancybox="images"><img src="https://img.weiyigeek.top/2020/1/20200702100012.png" alt="WeiyiGeek.Dockerd-TCP" title="" class=""></a>
                <p>WeiyiGeek.Dockerd-TCP</p>
            </figure></p>
<p><br/></p>
<p><strong>å®¹å™¨ HTTP/HTTPS proxy è®¾ç½®</strong><br>Docker å®ˆæŠ¤ç¨‹åºåœ¨å…¶å¯åŠ¨ç¯å¢ƒä¸­ä½¿ç”¨ HTTP_PROXYã€HTTPS_PROXY å’Œ NO_PROXY ç¯å¢ƒå˜é‡æ¥é…ç½® HTTP æˆ– HTTPS ä»£ç†è¡Œä¸ºã€‚  æ‚¨æ— æ³•ä½¿ç”¨ daemon.json æ–‡ä»¶é…ç½®è¿™äº›ç¯å¢ƒå˜é‡ã€‚</p>
<p>å¦‚æœæ‚¨åœ¨ HTTP æˆ– HTTPS ä»£ç†æœåŠ¡å™¨åé¢ï¼Œä¾‹å¦‚åœ¨å…¬å¸è®¾ç½®ä¸­ï¼Œåˆ™éœ€è¦åœ¨ Docker systemd æœåŠ¡æ–‡ä»¶ä¸­æ·»åŠ æ­¤é…ç½®ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.ä¸º docker æœåŠ¡åˆ›å»ºä¸€ä¸ª systemd æ’å…¥ç›®å½•ï¼š</span></span><br><span class="line">sudo mkdir -p /etc/systemd/system/docker.service.d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.åˆ›å»ºä¸€ä¸ªåä¸º /etc/systemd/system/docker.service.d/http-proxy.conf çš„æ–‡ä»¶ï¼Œå…¶ä¸­æ·»åŠ äº† HTTP_PROXY ç¯å¢ƒå˜é‡ï¼š</span></span><br><span class="line">[Service]</span><br><span class="line">Environment=<span class="string">"HTTP_PROXY=http://proxy.example.com:80"</span></span><br><span class="line">Environment=<span class="string">"HTTPS_PROXY=https://proxy.example.com:443"</span></span><br><span class="line"><span class="comment"># å¦‚æœæ‚¨æœ‰å†…éƒ¨ Docker æ³¨å†Œè¡¨éœ€è¦åœ¨ä¸ä½¿ç”¨ä»£ç†çš„æƒ…å†µä¸‹è”ç³»ï¼Œæ‚¨å¯ä»¥é€šè¿‡ NO_PROXY ç¯å¢ƒå˜é‡æŒ‡å®šå®ƒä»¬ã€‚</span></span><br><span class="line">Environment=<span class="string">"NO_PROXY=localhost,127.0.0.1,docker-registry.example.com,.corp"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.Flush changes and restart Docker</span></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.éªŒè¯é…ç½®æ˜¯å¦å·²åŠ è½½å¹¶ä¸æ‚¨æ‰€åšçš„æ›´æ”¹ç›¸åŒ¹é…ï¼Œä¾‹å¦‚ï¼š</span></span><br></pre></td></tr></table></figure></p>

        </div>
        
        <!-- Google å¹¿å‘Š -->
          

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>
  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·ä¸Visit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº" >
    <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ã€è½¬ä¸ªå‘ã€èµä¸ªåŠ©ã€‘</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°†æŒç»­æ•´ç†å‘å¸ƒæ›´å¤šä¼˜è´¨åŸåˆ›æ–‡ç« ï¼ã€‚</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2023-01-31T02:29:10.642Z" itemprop="dateUpdated">2023-01-31 10:29:10</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Docker/n2.Dockeré…ç½®æ–‡ä»¶ä¸å®ˆæŠ¤è¿›ç¨‹å‚æ•°ä¸€è§ˆ.md" target="_blank" rel="noopener noreferrer">_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Docker/n2.Dockeré…ç½®æ–‡ä»¶ä¸å®ˆæŠ¤è¿›ç¨‹å‚æ•°ä¸€è§ˆ.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2019/5-6-462.html" target="_blank" rel="external">https://blog.weiyigeek.top/2019/5-6-462.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">â˜•ï¸ è¯·ä½œè€…å–æ¯å’–å•¡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/5-6-462.html&title=ã€Šn2.Dockerå®¶æ–‡ä»¶ç›®å½•ä»‹ç»å’Œé…ç½®æ–‡ä»¶ä¸å®ˆæŠ¤è¿›ç¨‹å‘½ä»¤å‚æ•°ä¸€è§ˆã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/5-6-462.html&title=ã€Šn2.Dockerå®¶æ–‡ä»¶ç›®å½•ä»‹ç»å’Œé…ç½®æ–‡ä»¶ä¸å®ˆæŠ¤è¿›ç¨‹å‘½ä»¤å‚æ•°ä¸€è§ˆã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/5-6-462.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Šn2.Dockerå®¶æ–‡ä»¶ç›®å½•ä»‹ç»å’Œé…ç½®æ–‡ä»¶ä¸å®ˆæŠ¤è¿›ç¨‹å‘½ä»¤å‚æ•°ä¸€è§ˆã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/5-6-462.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/5-6-462.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2019/5-7-83.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">3-MYSQLä¼˜åŒ–å­¦ä¹ åŸºç¡€</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2019/5-6-461.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">n1.Dockerå‘½ä»¤å‚æ•°ä¸€è§ˆè¡¨</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x00-Dockeråº”ç”¨è·¯å¾„"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 Dockeråº”ç”¨è·¯å¾„</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x01-Dockerd-è¯­æ³•å‚æ•°"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 Dockerd è¯­æ³•å‚æ•°</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x02-Docker-é…ç½®æ–‡ä»¶"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 Docker é…ç½®æ–‡ä»¶</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    

    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå°±è¯·ä½œè€…å–æ¯ Coffee â˜•ï¸â˜•ï¸!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="/img/share-wechat.jpg" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">åšä¸»Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">åšä¸»Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">çŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.modb.pro/u/506690" target="_blank">å¢¨å¤©è½®</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.ixigua.com/home/3984243135350727" target="_blank">è¥¿ç“œè§†é¢‘</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2023 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/><a id="SiteRunTime"></a>
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener">
            <img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto">
          </a>
        </div>
      </p>
    </div>
</footer>



    <div class="mask" id="mask"></div>

<div id="go" class="waves-effect waves-light">
  <a href="javascript:;" id="goqrcode"> <span class="icon icon-lg icon-qrcode"></span> </a>
  <a href="javascript:;" id="gotop"> <span class="icon icon-lg icon-chevron-up"></span></a>
</div>





<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/5-6-462.html&title=ã€Šn2.Dockerå®¶æ–‡ä»¶ç›®å½•ä»‹ç»å’Œé…ç½®æ–‡ä»¶ä¸å®ˆæŠ¤è¿›ç¨‹å‘½ä»¤å‚æ•°ä¸€è§ˆã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/5-6-462.html&title=ã€Šn2.Dockerå®¶æ–‡ä»¶ç›®å½•ä»‹ç»å’Œé…ç½®æ–‡ä»¶ä¸å®ˆæŠ¤è¿›ç¨‹å‘½ä»¤å‚æ•°ä¸€è§ˆã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/5-6-462.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Šn2.Dockerå®¶æ–‡ä»¶ç›®å½•ä»‹ç»å’Œé…ç½®æ–‡ä»¶ä¸å®ˆæŠ¤è¿›ç¨‹å‘½ä»¤å‚æ•°ä¸€è§ˆã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/5-6-462.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/5-6-462.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJklEQVR42u3aQY7CMAwFUO5/6Y40W2j5jstocF5WCCqal4VlO3484nX8rrPPz+v5yefnz95y9usNCwMD42sZx+W6fsEaKfmffG8YGBj7MJIgm4fU62NKtp7vDQMDAyMPkTkpCfcYGBgYHUa/WF0LxBgYGBhrJWgeavNA/PFaHAMD4wsZ/YuBz33+0/sNDAyMf8k4ius6NUxeX00ro11hYGCMZlSb/jnjc7G/kOFiYGBswLgrycsHMvJdvTgsDAyMoYy8KVZN4AqBMq5JT3kYGBgbMKrbrTb382GL/GLgRcDFwMDYgFHdxBq++kwUuDEwMEYzEkw+WlEthvNnku8xMDB2YOTDFnnx2Ukiy/+MgYExlNFp+q9dCVQPKEo6MTAwRjPyEjFP2srF59KFxJs3YmBgjGMc8Upembf485CdXCdgYGBMZeSt+bVgmsOqIRgDAwMjL2I7Ifu2C1EMDIzRjM7IxdoFZxJq8+B+w+QIBgbGVzGSJKwzflFtrlVLaAwMjKmMfiutev+wGEyvjwADA2MbxvVGO2Hx3qGxqN2GgYExiNFv8SeF7tr4V97Uw8DAmM04iisfg0jwnbGMKDXEwMAYwchX/++qBXMrNcTAwBjHuOsCID+OTlA+RWJgYGzAqAbZfHP9Vl20KwwMDIzG2ET/VwwMDIxPDFtUi96E8eZ+AwMDYwPGWhGbD1VU08pq0omBgTGb0Skd80uCtRd3DhQDA2ME4wfSvtYsNcfpbQAAAABJRU5ErkJggg==" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  





<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
<script type="text/javascript">
// ç«™ç‚¹è¿è¡Œæ—¶é—´
var BootDate = new Date("2018/01/01 00:00:00");
function ShowRunTime(id) {
  var NowDate = new Date();
  var RunDateM = parseInt(NowDate - BootDate);
  var RunDays = Math.floor(RunDateM/(24*3600*1000));
  var RunHours = Math.floor(RunDateM%(24*3600*1000)/(3600*1000));
  var RunMinutes = Math.floor(RunDateM%(24*3600*1000)%(3600*1000)/(60*1000));
  var RunSeconds = Math.round(RunDateM%(24*3600*1000)%(3600*1000)%(60*1000)/1000);
  var RunTime = RunDays + "å¤©" + RunHours + "æ—¶" + RunMinutes + "åˆ†" + RunSeconds + "ç§’";
  document.getElementById(id).innerHTML = "ç½‘ç«™å·²åœ¨é£é›¨ä¸­å‹‰å‹‰å¼ºå¼ºè¿è¡Œäº†ã€" + RunTime + "ã€‘";
}
setInterval("ShowRunTime('SiteRunTime')", 1000);
</script>
</body>
</html>