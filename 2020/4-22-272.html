<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ æŒç»­é›†æˆgitlab-ci.ymlé…ç½®æ–‡æ¡£åŸºç¡€|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="gitlab">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
        
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/2018/1-1-1.html"  >
                <i class="icon icon-lg icon-mortar-board"></i>
                å­¦ä¹ ä¹‹è·¯
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>æŒç»­é›†æˆgitlab-ci.ymlé…ç½®æ–‡æ¡£åŸºç¡€</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">æŒç»­é›†æˆgitlab-ci.ymlé…ç½®æ–‡æ¡£åŸºç¡€</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-04-22T12:35:30.000Z" itemprop="datePublished" class="page-time">
  2020-04-22
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E4%B8%8E%E4%BA%A4%E4%BA%92/">æŒç»­é›†æˆä¸äº¤äº’</a></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap" style="display: none;">
  <article id="post-ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/CI-CD/GitLab-CI/2.åŸºäºGitlabä»£ç ä»“åº“çš„æŒç»­é›†æˆgitlab-ci.ymlåŸºç¡€é…ç½®"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">æŒç»­é›†æˆgitlab-ci.ymlé…ç½®æ–‡æ¡£åŸºç¡€</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-04-22 20:35:30" datetime="2020-04-22T12:35:30.000Z"  itemprop="datePublished">2020-04-22</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E4%B8%8E%E4%BA%A4%E4%BA%92/">æŒç»­é›†æˆä¸äº¤äº’</a></li></ul>



            

            


            
        </div>
        <span class="post-href" style="display: none;">|</span>
        <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
        
          <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½çœ‹å‹,æ¬¢è¿å…³æ³¨åšä¸»å¾®ä¿¡å…¬ä¼—å·å“Ÿ! â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘å³å¯å…³é—­ç»§ç»­æµè§ˆæ–‡ç« .<br>  <b style="color:red;"> æ¸©é¦¨æç¤º: æœªè§£é”çš„ç”¨æˆ·ä¸èƒ½ç²˜è´´å¤åˆ¶æ–‡ç« å†…å®¹å“Ÿ!</b> <br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
            
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h4 id="0x00-ç®€è¿°"><a href="#0x00-ç®€è¿°" class="headerlink" title="0x00 ç®€è¿°"></a>0x00 ç®€è¿°</h4><p><em>Q:ä»€ä¹ˆæ˜¯.gitlab-ci.yaml?å®ƒæœ‰ä»€ä¹ˆä½œç”¨?</em><br>ç­”ï¼šgitlab-ciå…¨ç§°æ˜¯gitlab continuous integrationçš„æ„æ€å°±æ˜¯æŒç»­é›†æˆ;gitlab-ci.yamlæ˜¯Gitlab-CIåšæŒç»­é›†æˆå’Œå‘å¸ƒçš„æ‰§é…ç½®æ–‡ä»¶ï¼Œé‡Œé¢å®šä¹‰äº†å¦‚ä½•æµ‹è¯•ã€ç¼–è¯‘ã€ä»¥åŠéƒ¨ç½²é˜¶æ®µæ‰§è¡Œçš„è„šæœ¬ï¼Œè¯¥æ–‡ä»¶çš„é…ç½®é«˜åº¦ä¾èµ–äºé¡¹ç›®æœ¬èº«ï¼Œä»¥åŠ CI/CD æµæ°´çº¿çš„éœ€æ±‚ã€‚å³æ¯æ¬¡åœ¨æˆ‘ä»¬pushåˆ°gitlabçš„æ—¶å€™ï¼Œéƒ½ä¼šè§¦å‘æ­¤è„šæœ¬</p>
<figure class="image-box">
                <a rel=æŒç»­é›†æˆgitlab-ci.ymlé…ç½®æ–‡æ¡£åŸºç¡€ href="https://img.weiyigeek.top/2020/1/20200419000810.png" target="_blank" title="WeiyiGeek.CI/CDæµç¨‹æ¦‚è§ˆ" data-fancybox="images"><img src="https://img.weiyigeek.top/2020/1/20200419000810.png" alt="WeiyiGeek.CI/CDæµç¨‹æ¦‚è§ˆ" title="" class=""></a>
                <p>WeiyiGeek.CI/CDæµç¨‹æ¦‚è§ˆ</p>
            </figure>
<p><em>gitlab-ci.yml å…¶é…ç½®æ–‡ä»¶ä¸»è¦ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š</em></p>
<ul>
<li><p>1.Pipeline<br>æè¿°:ä¸€æ¬¡ Pipeline å…¶å®ç›¸å½“äºä¸€æ¬¡æ„å»ºä»»åŠ¡ï¼Œé‡Œé¢å¯ä»¥åŒ…å«å¾ˆå¤šä¸ªæµç¨‹ï¼Œå¦‚<code>å®‰è£…ä¾èµ–ã€è¿è¡Œæµ‹è¯•ã€ç¼–è¯‘ã€éƒ¨ç½²æµ‹è¯•æœåŠ¡å™¨ã€éƒ¨ç½²ç”Ÿäº§æœåŠ¡å™¨ç­‰æµç¨‹</code>ã€‚ä»»ä½•æäº¤æˆ–è€… Merge Request çš„åˆå¹¶éƒ½å¯ä»¥è§¦å‘ Pipeline æ„å»ºï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+----------------+           +----------+</span><br><span class="line">|                |  trigger  |          |  </span><br><span class="line">| Commit / Merge +----------&gt;+ Pipeline |</span><br><span class="line">|                |           |          |</span><br><span class="line">+----------------+           +----------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.Stages<br>æè¿°:Stages è¡¨ç¤ºä¸€ä¸ªæ„å»ºé˜¶æ®µï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„ä¸€ä¸ªæµç¨‹ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä¸€æ¬¡ Pipeline ä¸­å®šä¹‰å¤šä¸ª Stagesï¼Œè¿™äº› Stagesä¼šæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>1) æ‰€æœ‰ Stages ä¼šæŒ‰ç…§é¡ºåºè¿è¡Œï¼Œå³å½“ä¸€ä¸ª Stage å®Œæˆåä¸‹ä¸€ä¸ª Stage æ‰ä¼šå¼€å§‹</li>
<li>2) åªæœ‰å½“æ‰€æœ‰ Stages å®Œæˆåï¼Œè¯¥æ„å»ºä»»åŠ¡ (Pipeline) æ‰ä¼šæˆåŠŸ</li>
<li>3) å¦‚æœä»»ä½•ä¸€ä¸ª Stage å¤±è´¥ï¼Œé‚£ä¹ˆåé¢çš„ Stages ä¸ä¼šæ‰§è¡Œï¼Œè¯¥æ„å»ºä»»åŠ¡ (Pipeline) å¤±è´¥<br>Stages å’Œ Pipeline çš„å…³ç³»å¦‚ä¸‹æ‰€ç¤ºï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+--------------------------------------------------------+</span><br><span class="line">|                                                        |</span><br><span class="line">| Pipeline                                               |</span><br><span class="line">|                                                        |</span><br><span class="line">| +-----------+  +------------+  +------------+          |</span><br><span class="line">| | Stage 1   |-&gt;| Stage 2    |-&gt;| Stage 3    |          |</span><br><span class="line">| +-----------+  +------------+  +------------+          |</span><br><span class="line">|                                                        |</span><br><span class="line">+--------------------------------------------------------+</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li>3.Jobs<br>æè¿°:Jobs è¡¨ç¤ºæ„å»ºå·¥ä½œï¼Œè¡¨ç¤ºæŸä¸ª Stage é‡Œé¢æ‰§è¡Œçš„å·¥ä½œã€‚æˆ‘ä»¬å¯ä»¥åœ¨ Stages é‡Œé¢å®šä¹‰å¤šä¸ª Jobsï¼Œè¿™äº› Jobs ä¼šæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</li>
</ul>
<ul>
<li>1) ç›¸åŒ Stage ä¸­çš„ Jobs ä¼šå¹¶è¡Œæ‰§è¡Œ</li>
<li>2) ç›¸åŒ Stage ä¸­çš„ Jobs éƒ½æ‰§è¡ŒæˆåŠŸæ—¶ï¼Œè¯¥ Stage æ‰ä¼šæˆåŠŸ</li>
<li>3) å¦‚æœä»»ä½•ä¸€ä¸ª Job å¤±è´¥ï¼Œé‚£ä¹ˆè¯¥ Stage å¤±è´¥ï¼Œå³è¯¥æ„å»ºä»»åŠ¡ (Pipeline) å¤±è´¥, ä½†æ˜¯<code>å¯ä»¥é€šè¿‡å‚æ•°è®¾ç½®allow_failure</code>è¿›è¡Œè·³è¿‡</li>
</ul>
<p>Jobs å’Œ Stage çš„å…³ç³»å¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+------------------------------------------+</span><br><span class="line">|                                          |</span><br><span class="line">| Stage 1                                  |</span><br><span class="line">|                                          |</span><br><span class="line">| +---------+ +---------+ +---------+      |</span><br><span class="line">| | Job 1   | | Job 2   | | Job 3   |      |</span><br><span class="line">| +---------+ +---------+ +---------+      |</span><br><span class="line">|                                          |</span><br><span class="line">+------------------------------------------+</span><br></pre></td></tr></table></figure></p>
<p>.gitlab-ci.yml åŸºç¡€å®ä¾‹:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ„å»ºé˜¶æ®µ-ä»»åŠ¡</span></span><br><span class="line"><span class="attr">stages:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">analytics</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">test</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">build</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">package</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">deploy</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ„å»ºå·¥ä½œjobåç§°</span></span><br><span class="line"><span class="attr">build_analytics:</span></span><br><span class="line">  <span class="comment">#è¯¥å·¥ä½œæ‰§è¡Œé˜¶æ®µ</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">analytics</span></span><br><span class="line">  <span class="comment">#è®¾ç½®åªå¯¹masteråˆ†æ”¯æœ‰æ•ˆ</span></span><br><span class="line"><span class="attr">  only:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">master</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">tags</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">runner-tag-snoreqube</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"=============== å¼€å§‹ä»£ç è´¨é‡æ£€æµ‹ ==============="</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"=============== ç»“æŸä»£ç è´¨é‡æ£€æµ‹ ==============="</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build_test:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">  only:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">master</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">tags</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">runner-tag</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"=============== å¼€å§‹æµ‹è¯•ä»»åŠ¡ ==============="</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"=============== ç»“æŸæµ‹è¯•ä»»åŠ¡ ==============="</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">build:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">build</span></span><br><span class="line"><span class="attr">  only:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">master</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">tags</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">runner-tag</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"=============== å¼€å§‹ç¼–è¯‘ä»»åŠ¡ ==============="</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"=============== ç»“æŸç¼–è¯‘ä»»åŠ¡ ==============="</span></span><br><span class="line"></span><br><span class="line"><span class="attr">package:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">package</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">runner-tag</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"=============== å¼€å§‹æ‰“åŒ…ä»»åŠ¡ ==============="</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"=============== ç»“æŸæ‰“åŒ…ä»»åŠ¡ ==============="</span></span><br><span class="line"></span><br><span class="line"><span class="attr">deploy_test:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">runner-tag</span></span><br><span class="line">  <span class="comment">#è¾“å‡ºåœ¨gitlab-ciä¸­è®¾ç½®çš„å˜é‡</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"=============== è‡ªåŠ¨éƒ¨ç½²åˆ°æµ‹è¯•æœåŠ¡å™¨ ==============="</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"æµ‹è¯•æœåŠ¡å™¨:"</span> <span class="string">$&#123;SERVER_TEST&#125;</span></span><br><span class="line">  <span class="comment">#ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="attr">  environment:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">https://staging.example.com</span></span><br><span class="line"></span><br><span class="line"><span class="attr">deploy_test_manual:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">runner-tag</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"=============== æ‰‹åŠ¨éƒ¨ç½²åˆ°æµ‹è¯•æœåŠ¡å™¨ ==============="</span></span><br><span class="line"><span class="attr">  environment:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">https://staging.example.com</span></span><br><span class="line">  <span class="comment">#è®¾ç½®æ¡ä»¶ manual å…è®¸å¤±è´¥  </span></span><br><span class="line"><span class="attr">  when:</span> <span class="string">manual</span></span><br><span class="line"></span><br><span class="line"><span class="attr">deploy_production_manual:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">runner-tag</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"=============== æ‰‹åŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§æœåŠ¡å™¨ ==============="</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"æµ‹è¯•æœåŠ¡å™¨:"</span> <span class="string">$&#123;SERVER_TEST&#125;</span></span><br><span class="line"><span class="attr">  environment:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">production</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">https://staging.example.com</span></span><br><span class="line"><span class="attr">  when:</span> <span class="string">manual</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h4 id="0x01-é…ç½®æ–‡æ¡£"><a href="#0x01-é…ç½®æ–‡æ¡£" class="headerlink" title="0x01 é…ç½®æ–‡æ¡£"></a>0x01 é…ç½®æ–‡æ¡£</h4><p>æè¿°:æœ¬ç« ä¸»è¦ç”¨äºæè¿° <code>.gitlab-ci.yml çš„è¯­æ³•ï¼Œ. gitlab-ci.yml</code> æ–‡ä»¶è¢«ç”¨æ¥ç®¡ç†é¡¹ç›®çš„ runner ä»»åŠ¡ã€‚<br>ä»»åŠ¡æ˜¯ç”±Runnersæ¥ç®¡å¹¶ä¸”ç”±æœåŠ¡å™¨ä¸­runneræ‰§è¡Œã€‚æ›´é‡è¦çš„æ˜¯<code>æ¯ä¸€ä¸ªä»»åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹éƒ½æ˜¯ç‹¬ç«‹è¿è¡Œ</code>çš„,è¿™å°†æ„å‘³ç€ä¸Šä¸ªè„šæœ¬äº§ç”Ÿçš„å˜é‡æ˜¯æ— æ³•åœ¨ä¸‹ä¸€ä¸ªä»»åŠ¡è„šæœ¬ä¸­è¿›è¡Œä½¿ç”¨ã€‚</p>
<p>ä¸‹é¢åˆ—å‡ºä¿ç•™å­—æ®µï¼Œè¿™äº›ä¿ç•™å­—æ®µä¸èƒ½è¢«å®šä¹‰ä¸º job åç§°ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">å…³é”®å­— æ˜¯å¦å¿…é¡»   æè¿°</span><br><span class="line">image å¦        ç”¨äºdockeré•œåƒï¼ŒæŸ¥çœ‹dockeræ–‡æ¡£</span><br><span class="line">services å¦ 	   ç”¨äºdockeræœåŠ¡ï¼ŒæŸ¥çœ‹dockeræ–‡æ¡£</span><br><span class="line">stages å¦       å®šä¹‰æ„å»ºé˜¶æ®µ</span><br><span class="line">types å¦        stages çš„åˆ«å(å·²åºŸé™¤)</span><br><span class="line">before_script å¦  å®šä¹‰åœ¨æ¯ä¸ªjobä¹‹å‰è¿è¡Œçš„å‘½ä»¤</span><br><span class="line">after_script å¦   å®šä¹‰åœ¨æ¯ä¸ªjobä¹‹åè¿è¡Œçš„å‘½ä»¤</span><br><span class="line">variable å¦      å®šä¹‰æ„å»ºå˜é‡</span><br><span class="line">cache å¦         å®šä¹‰ä¸€ç»„æ–‡ä»¶åˆ—è¡¨ï¼Œå¯åœ¨åç»­è¿è¡Œä¸­ä½¿ç”¨</span><br></pre></td></tr></table></figure>
<p>å¼€å§‹æ„å»ºä¹‹å‰YAMLæ–‡ä»¶å®šä¹‰äº†ä¸€ç³»åˆ—å¸¦æœ‰çº¦æŸè¯´æ˜çš„ä»»åŠ¡ï¼Œç”¨ä¸‹é¢è¿™ä¸ªä¾‹å­æ¥è¯´æ˜ï¼š<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">image:</span> <span class="attr">ruby:2.1</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">postgres</span></span><br><span class="line"></span><br><span class="line"><span class="attr">before_script:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">bundle</span> <span class="string">install</span></span><br><span class="line"></span><br><span class="line"><span class="attr">after_script:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">rm</span> <span class="string">secrets</span></span><br><span class="line"></span><br><span class="line"><span class="attr">stages:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">build</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">test</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">deploy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">job1:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">build</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">execute-script-for-job1</span></span><br><span class="line"><span class="attr">  only:</span></span><br><span class="line"><span class="bullet">   -</span> <span class="string">master</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">docker</span></span><br><span class="line"></span><br><span class="line"><span class="attr">job2:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">  script:</span> <span class="string">"execute-script-for-job2"</span></span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢è¿™ä¸ªä¾‹å­å°±æ˜¯å¸¦æœ‰å››ä¸ªç‹¬ç«‹ä»»åŠ¡çš„CIé…ç½®ï¼Œæ¯ä¸ªä»»åŠ¡åˆ†åˆ«æ‰§è¡Œä¸åŒçš„å‘½ä»¤ï¼Œå¯ä»¥çœ‹å‡ºè¿™äº›ä»»åŠ¡éƒ½æ˜¯ä»¥ä»»åŠ¡åå¼€å§‹å¹¶ä¸”è‡³å°‘è¦åŒ…å« script éƒ¨åˆ†ï¼Œå¹¶ä¸”script å¯ä»¥ç›´æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤(<code>ä¾‹å¦‚ï¼š./configure;make;make install</code>)æˆ–è€…æ˜¯ç›´æ¥æ‰§è¡Œè„šæœ¬(test.sh)éœ€è¦æ³¨æ„å…¶æ‰§è¡Œæƒé™ï¼›</p>
<p><br/></p>
<p><strong>gitlab-ci.ymlæŒ‡ä»¤çº¦æŸè¯´æ˜</strong></p>
<ul>
<li><p>imageå’Œservices </p>
<p>è¿™ä¸¤ä¸ªå…³é”®å­—å…è®¸ä½¿ç”¨ä¸€ä¸ªè‡ªå®šä¹‰çš„Dockeré•œåƒå’Œä¸€ç³»åˆ—çš„æœåŠ¡ï¼Œå¹¶ä¸”å¯ä»¥ç”¨äºæ•´ä¸ªjobå‘¨æœŸã€‚è¯¦ç»†é…ç½®æ–‡æ¡£è¯·æŸ¥çœ‹ï¼š<a href="https://docs.gitlab.com/ce/ci/docker/README.html" target="_blank" rel="noopener">https://docs.gitlab.com/ce/ci/docker/README.html</a></p>
</li>
<li><p>before_script </p>
<p>ç”¨æ¥å®šä¹‰<code>æ‰€æœ‰jobä¹‹å‰è¿è¡Œçš„å‘½ä»¤</code>ï¼ŒåŒ…æ‹¬deploy(éƒ¨ç½²) jobsï¼Œä½†æ˜¯åœ¨ä¿®å¤artifactsä¹‹åã€‚å®ƒå¯ä»¥æ˜¯ä¸€ä¸ª æ•°ç»„æˆ–è€…æ˜¯å¤šè¡Œå­—ç¬¦ä¸²ã€‚</p>
</li>
<li><p>after_script </p>
<p>ç”¨æ¥å®šä¹‰æ‰€æœ‰jobä¹‹åè¿è¡Œçš„å‘½ä»¤ã€‚å®ƒå¿…é¡»æ˜¯ä¸€ä¸ªæ•°ç»„æˆ–è€…æ˜¯å¤šè¡Œå­—ç¬¦ä¸²</p>
</li>
<li><p>stages</p>
<p>å‰é¢ç®€è¿°äº†stagesä¸pipelinsä¹‹é”®çš„å…³ç³»ï¼Œå®ƒç”¨æ¥å®šä¹‰å¯ä»¥è¢«jobè°ƒç”¨çš„stagesã€‚stagesçš„è§„èŒƒå…è®¸ æœ‰çµæ´»çš„å¤šçº§pipelinesï¼Œstagesä¸­çš„å…ƒç´ é¡ºåºå†³å®šäº†å¯¹åº”jobçš„æ‰§è¡Œé¡ºåºã€‚</p>
<ul>
<li>1.ç›¸åŒstageçš„jobå¯ä»¥å¹³è¡Œæ‰§è¡Œã€‚</li>
<li>2.ä¸‹ä¸€ä¸ªstageçš„jobä¼šåœ¨å‰ä¸€ä¸ªstageçš„jobæˆåŠŸåå¼€å§‹æ‰§è¡Œã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¾‹å¦‚ä¸Šé¢stagesæ„å»ºé˜¶æ®µä»»åŠ¡çš„ä¾‹å­</span></span><br><span class="line">1. é¦–å…ˆï¼Œæ‰€æœ‰ build çš„<span class="built_in">jobs</span>éƒ½æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ã€‚</span><br><span class="line">2. æ‰€æœ‰ build çš„<span class="built_in">jobs</span>æ‰§è¡ŒæˆåŠŸåï¼Œ <span class="built_in">test</span> çš„<span class="built_in">jobs</span>æ‰ä¼šå¼€å§‹å¹¶è¡Œæ‰§è¡Œã€‚</span><br><span class="line">3. æ‰€æœ‰ <span class="built_in">test</span> çš„<span class="built_in">jobs</span>æ‰§è¡ŒæˆåŠŸï¼Œ deploy çš„<span class="built_in">jobs</span>æ‰ä¼šå¼€å§‹å¹¶è¡Œæ‰§è¡Œã€‚</span><br><span class="line">4. æ‰€æœ‰çš„ deploy çš„<span class="built_in">jobs</span>æ‰§è¡ŒæˆåŠŸï¼Œcommitæ‰ä¼šæ ‡è®°ä¸º success</span><br><span class="line">5. ä»»ä½•ä¸€ä¸ªå‰ç½®çš„<span class="built_in">jobs</span>å¤±è´¥äº†ï¼Œcommitä¼šæ ‡è®°ä¸º failed å¹¶ä¸”ä¸‹ä¸€ä¸ªstagesçš„<span class="built_in">jobs</span>éƒ½ä¸ä¼šæ‰§è¡Œ</span><br><span class="line"></span><br><span class="line"><span class="comment">#æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„ä¾‹å­å€¼å¾—ä¸€æï¼š</span></span><br><span class="line">1. å¦‚æœ .gitlab-ci.yml ä¸­æ²¡æœ‰å®šä¹‰ stages ï¼Œé‚£ä¹ˆjob<span class="string">'s stages ä¼šé»˜è®¤å®šä¹‰ä¸º build ï¼Œ test å’Œ deploy ã€‚</span></span><br><span class="line"><span class="string">2. å¦‚æœä¸€ä¸ªjobæ²¡æœ‰æŒ‡å®š stage ï¼Œé‚£ä¹ˆè¿™ä¸ªä»»åŠ¡ä¼šåˆ†é…åˆ° test stageã€‚</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>variables<br>GItLab CI å…è®¸åœ¨ .gitlab-ci.yml æ–‡ä»¶ä¸­æ·»åŠ å˜é‡ï¼Œå¹¶åœ¨jobç¯å¢ƒä¸­èµ·ä½œç”¨ã€‚å› ä¸ºè¿™äº›é…ç½®æ˜¯å­˜å‚¨åœ¨gitä»“åº“ä¸­ï¼Œæ‰€ä»¥æœ€å¥½æ˜¯å­˜å‚¨é¡¹ç›®çš„éæ•æ„Ÿé…ç½®ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">variables:</span></span><br><span class="line"><span class="attr">DATABASE_URL:</span><span class="string">"postgres://postgres@postgres/WeiyiGeek"</span></span><br></pre></td></tr></table></figure>
<p>è¿™äº›å˜é‡å¯ä»¥è¢«åç»­çš„å‘½ä»¤å’Œè„šæœ¬ä½¿ç”¨ã€‚æœåŠ¡å®¹å™¨ä¹Ÿå¯ä»¥ä½¿ç”¨YAMLä¸­å®šä¹‰çš„å˜é‡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¾ˆå¥½çš„è°ƒæ§æœåŠ¡å®¹<br>å™¨ã€‚å˜é‡ä¹Ÿå¯ä»¥å®šä¹‰æˆjob levelã€‚é™¤äº†ç”¨æˆ·è‡ªå®šä¹‰çš„å˜é‡å¤–ï¼ŒRunnerä¹Ÿå¯ä»¥å®šä¹‰å®ƒè‡ªå·±çš„å˜é‡ä¾‹å¦‚ <code>CI_COMMIT_REG_NAME å®ƒçš„å€¼è¡¨ç¤ºç”¨äºæ„å»ºé¡¹ç›®çš„åˆ†æ”¯æˆ–tagåç§°</code>ã€‚é™¤äº†åœ¨ .gitlab-ci.yml ä¸­è®¾ç½®å˜é‡å¤–ï¼Œè¿˜æœ‰å¯ä»¥é€šè¿‡<code>GitLabçš„CI/CDç•Œé¢ä¸Šè®¾ç½®ç§æœ‰å˜é‡</code>ã€‚</p>
</li>
<li><p>cache<br>ç”¨æ¥æŒ‡å®šéœ€è¦åœ¨jobä¹‹é—´ç¼“å­˜çš„æ–‡ä»¶æˆ–ç›®å½•ã€‚åªèƒ½ä½¿ç”¨è¯¥é¡¹ç›®å·¥ä½œç©ºé—´å†…çš„è·¯å¾„,<code>ä»GitLab 9.0å¼€å§‹ï¼Œpipelineså’Œjobå°±é»˜è®¤å¼€å¯äº†ç¼“å­˜</code>,å¦‚æœ cache å®šä¹‰åœ¨jobsçš„ä½œç”¨åŸŸä¹‹å¤–ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯å…¨å±€ç¼“å­˜ï¼Œæ‰€æœ‰jobséƒ½å¯ä»¥ä½¿ç”¨è¯¥ç¼“å­˜ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å±€éƒ¨ç¼“å­˜</span></span><br><span class="line"><span class="comment">#ç¼“å­˜ binaries å’Œ .config ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼š</span></span><br><span class="line">rspec:</span><br><span class="line">  script: <span class="built_in">test</span></span><br><span class="line">  cache:</span><br><span class="line">    paths:</span><br><span class="line">      - binaries/</span><br><span class="line">      - .config</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¼“å­˜gitä¸­æ²¡æœ‰è¢«è·Ÿè¸ªçš„æ–‡ä»¶ï¼š</span></span><br><span class="line">rspec:</span><br><span class="line">  script: <span class="built_in">test</span></span><br><span class="line">  cache:</span><br><span class="line">    untracked: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å…¨å±€ç¼“å­˜</span></span><br><span class="line"><span class="comment">#jobä¸­ä¼˜å…ˆçº§é«˜äºå…¨å±€çš„ã€‚ä¸‹é¢è¿™ä¸ª rspec jobä¸­å°†åªä¼šç¼“å­˜ binaries/ ä¸‹çš„æ–‡ä»¶ï¼š</span></span><br><span class="line">cache:</span><br><span class="line">  paths:</span><br><span class="line">    - my/files</span><br><span class="line"></span><br><span class="line">rspec:</span><br><span class="line">  script: <span class="built_in">test</span></span><br><span class="line">  cache:</span><br><span class="line">    key: rspec</span><br><span class="line">    paths:</span><br><span class="line">      - binaries/</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>å¦‚æœä½ ä¸åŒçš„jobsç¼“å­˜ä¸åŒçš„æ–‡ä»¶è·¯å¾„ï¼Œå¿…é¡»è®¾ç½®ä¸åŒçš„cache:keyï¼Œå¦åˆ™ç¼“å­˜<br>å†…å®¹å°†è¢«é‡å†™ã€‚<br>ç¼“å­˜keyæŒ‡ä»¤å…è®¸æˆ‘ä»¬å®šä¹‰ç¼“å­˜çš„ä½œç”¨åŸŸ(äº²å’Œæ€§)ï¼Œå¯ä»¥æ˜¯æ‰€æœ‰jobsçš„å•ä¸ªç¼“å­˜ï¼Œä¹Ÿå¯ä»¥æ˜¯æ¯ä¸ªjobï¼Œä¹Ÿå¯ä»¥æ˜¯æ¯ä¸ªåˆ†æ”¯æˆ–<br>è€…æ˜¯ä»»ä½•ä½ è®¤ä¸ºåˆé€‚çš„åœ°æ–¹ï¼Œå¹¶ä¸”cache:key å¯ä»¥ä½¿ç”¨ä»»ä½•çš„<a href="https://docs.gitlab.com/ce/ci/variables/README.html" target="_blank" rel="noopener">é¢„å®šä¹‰å˜é‡</a>ã€‚<br>é»˜è®¤keyæ˜¯é»˜è®¤è®¾ç½®çš„è¿™ä¸ªé¡¹ç›®ç¼“å­˜ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªpipelineså’Œjobsä¸­å¯ä»¥å…±äº«ä¸€åˆ‡ï¼Œä»GitLab 9.0å¼€å§‹ã€‚<br><em>é…ç½®ç¤ºä¾‹</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç¼“å­˜æ¯ä¸ªjobï¼š</span></span><br><span class="line">cache:</span><br><span class="line">  key: <span class="string">"<span class="variable">$CI_JOB_NAME</span>"</span></span><br><span class="line">  untracked: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¼“å­˜æ¯ä¸ªåˆ†æ”¯ï¼š</span></span><br><span class="line">cache:</span><br><span class="line">  key: <span class="string">"<span class="variable">$CI_COMMIT_REF_NAME</span>"</span></span><br><span class="line">  untracked: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¼“å­˜æ¯ä¸ªjobä¸”æ¯ä¸ªåˆ†æ”¯ï¼š</span></span><br><span class="line">cache:</span><br><span class="line">  key: <span class="string">"<span class="variable">$CI_JOB_NAME</span>/<span class="variable">$CI_COMMIT_REF_NAME</span>"</span></span><br><span class="line">  untracked: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¼“å­˜æ¯ä¸ªåˆ†æ”¯ä¸”æ¯ä¸ªstageï¼š</span></span><br><span class="line">cache:</span><br><span class="line">  key: <span class="string">"<span class="variable">$CI_JOB_STAGE</span>/<span class="variable">$CI_COMMIT_REF_NAME</span>"</span></span><br><span class="line">  untracked: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœä½¿ç”¨çš„Windows Batch(windowsæ‰¹å¤„ç†)æ¥è·‘è„šæœ¬éœ€è¦ç”¨ % æ›¿ä»£ $ ï¼š</span></span><br><span class="line">cache:</span><br><span class="line">  key: <span class="string">"%CI_JOB_STAGE%/%CI_COMMIT_REF_NAME%"</span></span><br><span class="line">  untracked: <span class="literal">true</span></span><br></pre></td></tr></table></figure></p>
<p>_æ³¨æ„_ï¼šç¼“å­˜æ˜¯åœ¨jobsä¹‹å‰è¿›è¡Œå…±äº«çš„ã€‚ç¼“å­˜åªæ˜¯å°½åŠ›è€Œä¸ºä¹‹ï¼Œæ‰€ä»¥åˆ«æœŸæœ›ç¼“å­˜ä¼šä¸€ç›´å­˜åœ¨ã€‚æŸ¥çœ‹æ›´å¤šè¯¦ç»†å†…å®¹ï¼Œè¯·æŸ¥é˜…GitLab Runnerã€‚</p>
<ul>
<li><p>Jobs<br>.gitlab-ci.yml å…è®¸æŒ‡å®šæ— é™é‡jobsã€‚æ¯ä¸ªjobså¿…é¡»æœ‰ä¸€ä¸ªå”¯ä¸€çš„åå­—ï¼Œè€Œä¸”ä¸èƒ½æ˜¯ä¸Šé¢æåˆ°çš„å…³é”®å­—ã€‚jobç”±ä¸€åˆ—<br>å‚æ•°æ¥å®šä¹‰jobsçš„è¡Œä¸ºã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">job_name:</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">rake</span> <span class="string">spec</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">coverage</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">  only:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">master</span></span><br><span class="line"><span class="attr">  except:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">develop</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">ruby</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">postgres</span></span><br><span class="line"><span class="attr">  allow_failure:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŒ‡ä»¤è¯´æ˜</span></span><br><span class="line"><span class="string">script</span> <span class="literal">yes</span> <span class="comment">#Runneræ‰§è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬</span></span><br><span class="line"><span class="string">image</span> <span class="literal">no</span>   <span class="comment">#æ‰€ä½¿ç”¨çš„dockeré•œåƒï¼ŒæŸ¥é˜…ä½¿ç”¨dockeré•œåƒ</span></span><br><span class="line"><span class="string">services</span> <span class="literal">no</span> <span class="comment">#æ‰€ä½¿ç”¨çš„dockeræœåŠ¡ï¼ŒæŸ¥é˜…ä½¿ç”¨dockeré•œåƒ</span></span><br><span class="line"><span class="string">stage</span> <span class="literal">no</span> <span class="comment">#å®šä¹‰job stageï¼ˆé»˜è®¤ï¼š test ï¼‰</span></span><br><span class="line"><span class="string">type</span> <span class="literal">no</span> <span class="comment">#stage çš„åˆ«åï¼ˆå·²å¼ƒç”¨ï¼‰</span></span><br><span class="line"><span class="string">variables</span> <span class="comment">#no å®šä¹‰jobçº§åˆ«çš„å˜é‡</span></span><br><span class="line"><span class="string">only</span> <span class="literal">no</span> <span class="comment">#å®šä¹‰ä¸€åˆ—gitåˆ†æ”¯ï¼Œå¹¶ä¸ºå…¶åˆ›å»ºjob</span></span><br><span class="line"><span class="string">except</span> <span class="literal">no</span> <span class="comment">#å®šä¹‰ä¸€åˆ—gitåˆ†æ”¯ï¼Œä¸åˆ›å»ºjob</span></span><br><span class="line"><span class="string">tags</span> <span class="literal">no</span> <span class="comment">#å®šä¹‰ä¸€åˆ—tagsç”¨æ¥æŒ‡å®šé€‰æ‹©å“ªä¸ªGitlab-Runnerï¼ˆåŒæ—¶Runnerä¹Ÿè¦è®¾ç½®tagsï¼‰</span></span><br><span class="line"><span class="string">allow_failure</span> <span class="literal">no</span> <span class="comment">#å…è®¸jobå¤±è´¥ã€‚å¤±è´¥çš„jobä¸å½±å“commitçŠ¶æ€</span></span><br><span class="line"><span class="string">when</span> <span class="literal">no</span>  <span class="comment">#å®šä¹‰ä½•æ—¶å¼€å§‹job å¯ä»¥æ˜¯ on_success ï¼Œ on_failure ï¼Œ always æˆ–è€… manual</span></span><br><span class="line"><span class="string">dependencies</span> <span class="literal">no</span> <span class="comment">#å®šä¹‰jobä¾èµ–å…³ç³»ï¼Œè¿™æ ·ä»–ä»¬å°±å¯ä»¥äº’ç›¸ä¼ é€’artifacts</span></span><br><span class="line"><span class="string">cache</span> <span class="literal">no</span> <span class="comment">#å®šä¹‰åº”åœ¨åç»­è¿è¡Œä¹‹é—´ç¼“å­˜çš„æ–‡ä»¶åˆ—è¡¨</span></span><br><span class="line"><span class="string">before_script</span> <span class="literal">no</span> <span class="comment">#é‡å†™ä¸€ç»„åœ¨ä½œä¸šå‰æ‰§è¡Œçš„å‘½ä»¤</span></span><br><span class="line"><span class="string">after_script</span> <span class="literal">no</span> <span class="comment">#é‡å†™ä¸€ç»„åœ¨ä½œä¸šåæ‰§è¡Œçš„å‘½ä»¤</span></span><br><span class="line"><span class="string">environment</span> <span class="literal">no</span> <span class="comment">#å®šä¹‰æ­¤ä½œä¸šå®Œæˆéƒ¨ç½²çš„ç¯å¢ƒåç§°</span></span><br><span class="line"><span class="string">coverage</span> <span class="literal">no</span> <span class="comment">#å®šä¹‰ç»™å®šä½œä¸šçš„ä»£ç è¦†ç›–ç‡è®¾ç½®</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>script<br>æ˜¯Runneræ‰§è¡Œçš„è„šæœ¬ï¼Œè¯¥å‚æ•°ä¹Ÿå¯ä»¥ç”¨æ•°ç»„åŒ…å«å¤šä¸ªå‘½ä»¤ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">job:</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">uname</span> <span class="bullet">-a</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">bundle</span> <span class="string">exec</span> <span class="string">rspec</span></span><br></pre></td></tr></table></figure>
<p>æœ‰æ—¶å€™ script å‘½ä»¤éœ€è¦è¢«å•å¼•å·æˆ–è€…æ˜¯åŒå¼•å·åŒ…è£¹èµ·æ¥ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå½“å‘½ä»¤ä¸­åŒ…å«å†’å·( : )æ—¶ï¼Œscriptéœ€è¦è¢«åŒ…<br>åœ¨åŒå¼•å·ä¸­ï¼Œè¿™æ ·YAMLè§£æå™¨æ‰å¯ä»¥æ­£ç¡®è§£æä¸ºä¸€ä¸ªå­—ç¬¦ä¸²è€Œä¸æ˜¯ä¸€ä¸ªé”®å€¼å¯¹(key:value)ã€‚ä½¿ç”¨è¿™äº›ç‰¹æ®Šå­—ç¬¦çš„æ—¶å€™ä¸€å®š<br>è¦æ³¨æ„ï¼š<code>: , { , } , [ , ] , , , &amp; , * , # , ? , | , - , &lt; , &gt; , = , !</code>ã€‚</p>
</li>
<li><p>stage<br>stage å…è®¸ä¸€ç»„jobsè¿›å…¥ä¸åŒçš„stagesã€‚<code>jobsåœ¨ç›¸åŒçš„ stage æ—¶ä¼š parallel åŒæ—¶è¿›è¡Œ</code>ã€‚æŸ¥é˜… stages æ›´å¤šçš„ç”¨æ³•è¯·æŸ¥çœ‹<a href="https://docs.gitlab.com/ce/ci/yaml/README.html#stages" target="_blank" rel="noopener">stages</a>ã€‚</p>
</li>
<li><p>only and except<br>only å’Œ exceptæ˜¯ä¸¤ä¸ªå‚æ•°ç”¨åˆ†æ”¯ç­–ç•¥æ¥é™åˆ¶jobsæ„å»ºï¼š</p>
<ul>
<li>1.only å®šä¹‰å“ªäº›åˆ†æ”¯å’Œæ ‡ç­¾çš„gité¡¹ç›®å°†ä¼šè¢«jobæ‰§è¡Œã€‚</li>
<li>2.except å®šä¹‰å“ªäº›åˆ†æ”¯å’Œæ ‡ç­¾çš„gité¡¹ç›®å°†ä¸ä¼šè¢«jobæ‰§è¡Œã€‚<br>ä¸‹é¢æ˜¯refsç­–ç•¥çš„ä½¿ç”¨è§„åˆ™ï¼š</li>
<li>only å’Œ except å¯åŒæ—¶ä½¿ç”¨,å¦‚æœ only å’Œ except åœ¨ä¸€ä¸ªjobé…ç½®ä¸­åŒæ—¶å­˜åœ¨ï¼Œåˆ™ä»¥ only ä¸ºå‡†ï¼Œè·³è¿‡except (ä»ä¸‹é¢ç¤ºä¾‹ä¸­å¾—å‡º)ã€‚</li>
<li>only å’Œ except å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€‚</li>
<li>only å’Œ except å…è®¸ä½¿ç”¨ç‰¹æ®Šçš„å…³é”®å­—ï¼šbranches ï¼Œ tags å’Œ triggers ã€‚</li>
<li>only å’Œ except å…è®¸ä½¿ç”¨æŒ‡å®šä»“åº“åœ°å€ä½†ä¸æ˜¯forksçš„ä»“åº“(æŸ¥çœ‹ç¤ºä¾‹3)ã€‚<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#(1)åœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œ job å°†åªä¼šè¿è¡Œä»¥ issue- å¼€å§‹çš„refs(åˆ†æ”¯)ï¼Œç„¶è€Œexceptä¸­è®¾ç½®å°†è¢«è·³è¿‡ã€‚</span></span><br><span class="line"><span class="attr">job:</span></span><br><span class="line">  <span class="comment"># use regexp</span></span><br><span class="line"><span class="attr">  only:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">/^issue-.*$/</span></span><br><span class="line">  <span class="comment"># use special keyword</span></span><br><span class="line"><span class="attr">  except:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">branches</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#(2)åœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œ job å°†åªä¼šæ‰§è¡Œæœ‰tagsçš„refsï¼Œæˆ–è€…é€šè¿‡APIè§¦å‘å™¨æ˜ç¡®åœ°è¯·æ±‚æ„å»ºã€‚</span></span><br><span class="line"><span class="attr">job:</span></span><br><span class="line"><span class="comment"># use special keywords</span></span><br><span class="line"><span class="attr">  only:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">tags</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">triggers</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#(3)ä»“åº“è·¯å¾„åªèƒ½ç”¨äºçˆ¶çº§ä»“åº“æ‰§è¡Œjobsè€Œä¸æ˜¯forks,å°†ä¼šä¸ºæ‰€æœ‰çš„åˆ†æ”¯æ‰§è¡Œ job ï¼Œä½†masteråˆ†æ”¯é™¤å¤–ã€‚</span></span><br><span class="line"><span class="attr">job:</span></span><br><span class="line"><span class="attr">  only:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">branches@gitlab-org/gitlab-ce</span></span><br><span class="line"><span class="attr">  except:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">master@gitlab-org/gitlab-ce</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Job variables<br>åœ¨jobä¸­æ˜¯å¯ä»¥ä½¿ç”¨å…³é”®å­— variables æ¥å®šä¹‰jobå˜é‡ã€‚å®ƒçš„è¿è¡ŒåŸç†è·Ÿglobal-levelæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯å®ƒå…è®¸è®¾ç½®ç‰¹æ®Šçš„jobå˜é‡, Jobå˜é‡çš„ä¼˜å…ˆçº§å…³ç³»å¯æŸ¥çœ‹é™„å½•çš„<a href="https://docs.gitlab.com/ce/ci/variables/README.html" target="_blank" rel="noopener">variablesæ–‡æ¡£è¯´æ˜</a>ã€‚<br>å½“è®¾ç½®äº†jobçº§åˆ«çš„å…³é”®å­— variables ï¼Œå®ƒä¼šè¦†ç›–å…¨å±€YAMLå’Œé¢„å®šä¹‰ä¸­çš„jobå˜é‡ã€‚æƒ³è¦å…³é—­å…¨å±€å˜é‡å¯ä»¥åœ¨jobä¸­è®¾ç½®ä¸€ä¸ªç©ºæ•°ç»„ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">job_name:</span></span><br><span class="line"><span class="attr">  variables:</span> <span class="string">[]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>tags<br>tags å¯ä»¥ä»å…è®¸è¿è¡Œåˆ†é…ç»™æ­¤é¡¹ç›®çš„æ‰€æœ‰Gitlab-Runnersä¸­é€‰æ‹©ç‰¹å®šçš„Runnersæ¥æ‰§è¡Œjobs,tags å¯é€šè¿‡tagsæ¥æŒ‡å®šç‰¹æ®Šçš„Runnersæ¥è¿è¡Œjobsï¼š<br>åœ¨æ³¨å†ŒRunnerçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®Runnerçš„æ ‡ç­¾ï¼Œæ¯”å¦‚ <code>ruby ï¼Œ postgres ï¼Œ development</code> ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">job:</span></span><br><span class="line"><span class="attr">  tags:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">ruby</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">postgres</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œéœ€è¦ç¡®ä¿æ„å»ºæ­¤ job çš„Runnerå¿…é¡»å®šä¹‰äº† ruby å’Œ postgres è¿™ä¸¤ä¸ªtags,å¦åˆ™æŠ¥é”™<code>æ­¤ä½œä¸šè¢«å¡ä½ï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½•è¯¥é¡¹ç›®æŒ‡å®šæ ‡ç­¾çš„ runner åœ¨çº¿</code>ã€‚</p>
</li>
<li><p>allow_failure<br>allow_failure å¯ä»¥ç”¨äºå½“ä½ æƒ³è®¾ç½®ä¸€ä¸ªjobå¤±è´¥çš„ä¹‹åå¹¶ä¸å½±å“åç»­çš„CIç»„ä»¶çš„æ—¶å€™ã€‚å¤±è´¥çš„jobsä¸ä¼šå½±å“åˆ°<br>commitçŠ¶æ€ã€‚<br>å½“å¼€å¯äº†å…è®¸jobå¤±è´¥ï¼Œæ‰€æœ‰çš„intentså’Œpurposesé‡Œçš„pipelineéƒ½æ˜¯æˆåŠŸ/ç»¿è‰²ï¼Œä½†æ˜¯ä¹Ÿä¼šæœ‰ä¸€ä¸ª<code>&quot;CI build passed with warnings&quot;</code>ä¿¡æ¯æ˜¾ç¤ºåœ¨merge requestæˆ–commitæˆ–job pageã€‚è¿™è¢«å…è®¸å¤±è´¥çš„ä½œä¸šä½¿ç”¨ï¼Œä½†æ˜¯å¦‚æœå¤±è´¥è¡¨ç¤ºå…¶ä»–åœ°æ–¹åº”é‡‡å–å…¶ä»–ï¼ˆæ‰‹åŠ¨ï¼‰æ­¥éª¤ã€‚<br>ä¸‹é¢çš„è¿™ä¸ªä¾‹å­ä¸­:job1 å’Œ job2 å°†ä¼šå¹¶åˆ—è¿›è¡Œï¼Œå¦‚æœ job1 å¤±è´¥äº†ï¼Œå®ƒä¹Ÿä¸ä¼šå½±å“è¿›è¡Œä¸­çš„ä¸‹ä¸€ä¸ªstageï¼Œå› ä¸º<br>è¿™é‡Œæœ‰è®¾ç½®äº† allow_failure: true ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">job1:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">execute_script_that_will_fail</span></span><br><span class="line"><span class="attr">  allow_failure:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">job2:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">execute_script_that_will_succeed</span></span><br><span class="line"><span class="attr">job3:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">deploy_to_staging</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>when<br>when ç”¨äºå®ç°åœ¨å‘ç”Ÿæ•…éšœæˆ–å°½ç®¡å‘ç”Ÿæ•…éšœä»åœ¨è¿è¡Œçš„ä½œä¸šï¼Œå¯ä»¥è®¾ç½®ä»¥ä¸‹å€¼ï¼š</p>
<ul>
<li>1.<code>on_success</code> - åªæœ‰å‰é¢stagesçš„æ‰€æœ‰å·¥ä½œæˆåŠŸæ—¶æ‰æ‰§è¡Œ(<code>é»˜è®¤å€¼</code>)</li>
<li>2.<code>on_failure</code> - å½“å‰é¢stagesä¸­ä»»æ„ä¸€ä¸ªjobså¤±è´¥åæ‰§è¡Œã€‚</li>
<li>3.<code>always</code> - æ— è®ºå‰é¢stagesä¸­jobsçŠ¶æ€å¦‚ä½•éƒ½æ‰§è¡Œã€‚</li>
<li>4.<code>manual</code> - æ‰‹åŠ¨æ‰§è¡Œ(GitLab8.10å¢åŠ )ã€‚æ›´å¤šè¯·æŸ¥çœ‹æ‰‹åŠ¨æ“ä½œã€‚<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">build</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">cleanup_build</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">test</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">deploy</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">cleanup</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build_job:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">build</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">make</span> <span class="string">build</span></span><br><span class="line"></span><br><span class="line"><span class="attr">cleanup_build_job:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">cleanup_build</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">cleanup</span> <span class="string">build</span> <span class="string">when</span> <span class="string">failed</span></span><br><span class="line"><span class="attr">  when:</span> <span class="string">on_failure</span> <span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="attr">test_job:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">make</span> <span class="string">test</span></span><br><span class="line"></span><br><span class="line"><span class="attr">deploy_job:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">make</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">  when:</span> <span class="string">manual</span>  <span class="comment">#æ‰‹åŠ¨æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="attr">cleanup_job:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">cleanup</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">cleanup</span> <span class="string">after</span> <span class="string">jobs</span></span><br><span class="line"><span class="attr">  when:</span> <span class="string">always</span>  <span class="comment">#å§‹ç»ˆæ‰§è¡Œ</span></span><br></pre></td></tr></table></figure>
è„šæœ¬è¯´æ˜ï¼š<br>1.åªæœ‰å½“<code>build_job</code>å¤±è´¥çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œ <code>cleanup_build_job</code> ã€‚<br>2.ä¸ç®¡å‰ä¸€ä¸ªjobæ‰§è¡Œå¤±è´¥è¿˜æ˜¯æˆåŠŸéƒ½ä¼šæ‰§è¡Œ <code>cleanup_job</code> ã€‚<br>3.å¯ä»¥ä»GitLabç•Œé¢ä¸­æ‰‹åŠ¨æ‰§è¡Œ <code>deploy_jobs</code> ã€‚</li>
</ul>
</li>
</ul>
<p>è¡¥å……è¯´æ˜:Manual actionsæ‰‹åŠ¨æ“ä½œæŒ‡ä»¤æ˜¯ä¸è‡ªåŠ¨æ‰§è¡Œçš„ç‰¹æ®Šç±»å‹çš„job, å®ƒä»¬å¿…é¡»è¦äººä¸ºå¯åŠ¨ã€‚æ‰‹åŠ¨æ“ä½œæŒ‡ä»¤å¯ä»¥<code>ä»pipelineï¼Œbuildï¼Œenvironmentå’Œdeploymentè§†å›¾ä¸­å¯åŠ¨</code>ã€‚éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæ˜¯æ‰‹åŠ¨æ“ä½œæŒ‡ä»¤çš„ä¸€ä¸ªå¾ˆå¥½ç¤ºä¾‹ã€‚</p>
<ul>
<li><p>æ‰‹åŠ¨æ“ä½œæŒ‡ä»¤å¯ä»¥æ˜¯å¯é€‰çš„æˆ–é˜»å¡ã€‚åœ¨å®šä¹‰äº†æ‰‹åŠ¨æ‰§è¡Œçš„é‚£ä¸ªstageä¸­ï¼Œæ‰‹åŠ¨æ“ä½œæŒ‡ä»¤å°†ä¼šåœæ­¢piplineä¸­çš„è‡ªåŠ¨æ‰§è¡ŒæŒ‡ä»¤ã€‚å½“æœ‰äººé€šè¿‡ç‚¹å‡»playæŒ‰é’®æ¥æ‰§è¡Œéœ€è¦æ‰‹åŠ¨æ‰§è¡Œçš„jobæ—¶ï¼Œå¯ä»¥æ¥æ¢å¤pipelineçš„æ‰§è¡Œã€‚</p>
</li>
<li><p>å½“pipelineè¢«é˜»å¡æ—¶ï¼Œå³ä½¿æ˜¯pipelineæ˜¯æˆåŠŸçŠ¶æ€ä¹Ÿä¸ä¼šmergeã€‚è¢«é˜»å¡çš„pipelinesä¹Ÿæœ‰ä¸€ä¸ªç‰¹æ®Šçš„çŠ¶æ€ï¼Œå«<br>manual ã€‚</p>
</li>
<li>æ‰‹åŠ¨æ“ä½œæŒ‡ä»¤é»˜è®¤æ˜¯ä¸é˜»å¡çš„ã€‚å¦‚æœä½ æƒ³è¦æ‰‹åŠ¨æ“ä½œæŒ‡ä»¤äº§ç”Ÿé˜»å¡ï¼Œé¦–å…ˆéœ€è¦åœ¨jobçš„é…ç½®æ–‡ä»¶ .gitlab-ci.yml ä¸­æ·»åŠ  allow_failure:false ,å¯é€‰çš„<code>æ‰‹åŠ¨æ“ä½œæŒ‡ä»¤é»˜è®¤è®¾ç½®allow_failure:true</code> ã€‚å¯é€‰åŠ¨ä½œçš„çŠ¶æ€ä¸å½±å“æ•´ä¸ªpipelineçš„çŠ¶æ€,æ‰‹åŠ¨æ“ä½œæŒ‡ä»¤è¢«è®¤ä¸ºæ˜¯å†™æ“ä½œï¼Œæ‰€ä»¥å½“å‰ç”¨æˆ·è§¦å‘æ“ä½œæ—¶ï¼Œå¿…é¡»æ‹¥æœ‰æ“ä½œä¿æŠ¤åˆ†æ”¯çš„æƒé™ã€‚æ¢å¥è¯è¯´ï¼Œä¸ºäº†è§¦å‘ä¸€ä¸ªæ‰‹åŠ¨æ“ä½œæŒ‡ä»¤åˆ°pipelineä¸­æ­£åœ¨è¿è¡Œçš„æŒ‡å®šåˆ†æ”¯ï¼Œå½“å‰ç”¨æˆ·å¿…é¡»æ‹¥æœ‰æ¨é€åˆ°è¿™åˆ†æ”¯çš„æƒé™ã€‚</li>
</ul>
<hr>
<ul>
<li><p>enviroment<br>environment ç”¨äºå®šä¹‰jobéƒ¨ç½²åˆ°ç‰¹æ®Šçš„ç¯å¢ƒä¸­ã€‚å¦‚æœæŒ‡å®šäº† environment ï¼Œå¹¶ä¸”æ²¡æœ‰è¯¥åç§°ä¸‹çš„ç¯å¢ƒï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ›å»ºæ–°ç¯å¢ƒã€‚<br>åœ¨æœ€ç®€å•çš„æ ¼å¼ä¸­ï¼Œç¯å¢ƒå…³é”®å­—å¯ä»¥å®šä¹‰ä¸ºï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">deploy</span> <span class="string">to</span> <span class="attr">production:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">  script:</span> <span class="string">git</span> <span class="string">push</span> <span class="string">production</span> <span class="attr">HEAD:master</span></span><br><span class="line"><span class="attr">  environment:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">production</span></span><br><span class="line"><span class="string">```</span> </span><br><span class="line"><span class="attr">  - environment:</span><span class="string">name</span> <span class="string">åç§°å¯ä»¥åŒ…å«ï¼š</span> <span class="string">`è‹±æ–‡å­—æ¯(</span> <span class="string">letters</span> <span class="string">),</span> <span class="string">æ•°å­—(</span> <span class="string">digits</span> <span class="string">)</span> <span class="string">,ç©ºæ ¼(</span> <span class="string">spaces</span> <span class="string">)</span> <span class="string">,-</span> <span class="string">,_</span> <span class="string">,/</span> <span class="string">,$</span> <span class="string">,</span> <span class="string">&#123;</span> <span class="string">,</span> <span class="string">&#125;`</span></span><br><span class="line">  <span class="string">å¸¸ç”¨çš„åç§°æœ‰</span> <span class="string">qa</span> <span class="string">,</span> <span class="string">staging</span> <span class="string">ï¼Œå’Œ</span> <span class="string">production</span> <span class="string">ï¼Œå½“ç„¶ä½ å¯ä»¥åœ¨ä½ çš„å·¥ä½œæµä¸­ä½¿ç”¨ä»»æ„åå­—ã€‚</span></span><br><span class="line">  <span class="string">é™¤äº†åœ¨</span> <span class="string">environment</span> <span class="string">å…³é”®å­—å³è¾¹ç´§è·Ÿnameå®šä¹‰æ–¹æ³•å¤–ï¼Œä¹Ÿæ˜¯å¯ä»¥ä¸ºç¯å¢ƒåç§°å•ç‹¬è®¾å®šä¸€ä¸ªå€¼ã€‚ä¾‹å¦‚ï¼Œç”¨</span> <span class="string">name</span> <span class="string">å…³é”®å­—åœ¨</span> <span class="string">environment</span> <span class="string">ä¸‹é¢è®¾ç½®ï¼š</span></span><br><span class="line"><span class="string">```yaml</span></span><br><span class="line"><span class="string">deploy</span> <span class="string">to</span> <span class="attr">production:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">  script:</span> <span class="string">git</span> <span class="string">push</span> <span class="string">production</span> <span class="attr">HEAD:master</span></span><br><span class="line"><span class="attr">  environment:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">production</span></span><br></pre></td></tr></table></figure>
<ul>
<li>environment:url è¿™æ˜¯è®¾ç½®ä¸€ä¸ªå¯é€‰å€¼ï¼Œå®ƒä¼šæ˜¾ç¤ºåœ¨æŒ‰é’®ä¸­ï¼Œç‚¹å‡»å®ƒå¯ä»¥è·³è½¬åˆ°è®¾ç½®çš„URLé¡µé¢ã€‚<br>åœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœjobéƒ½æˆåŠŸå®Œæˆäº†ï¼Œåœ¨environment/deploymentsé¡µé¢ä¸­å°†ä¼šåˆ›å»ºä¸€ä¸ªåˆå¹¶è¯·æ±‚çš„æŒ‰é’®ï¼Œå®ƒå°†æŒ‡å‘ <a href="https://prod.example.com" target="_blank" rel="noopener">https://prod.example.com</a> ã€‚<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">deploy</span> <span class="string">to</span> <span class="attr">production:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">  script:</span> <span class="string">git</span> <span class="string">push</span> <span class="string">production</span> <span class="attr">HEAD:master</span></span><br><span class="line"><span class="attr">  environment:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">production</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">https://prod.example.com</span></span><br></pre></td></tr></table></figure></li>
<li>environment:on_stop: å…³é—­(åœæ­¢)environmentså¯ä»¥é€šè¿‡åœ¨ environment ä¸‹å®šä¹‰å…³é”®å­— on_stop æ¥å®ç°ã€‚å®ƒå®šä¹‰äº†ä¸€ä¸ªä¸åŒçš„jobï¼Œç”¨äºå…³é—­environmentã€‚</li>
<li>environment:action: action å’Œ on_stop è”åˆä½¿ç”¨ï¼Œå®šä¹‰åœ¨jobä¸­ï¼Œç”¨æ¥å…³é—­environmentã€‚<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">review_app:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">  script:</span> <span class="string">make</span> <span class="string">deploy-app</span></span><br><span class="line"><span class="attr">  environment:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">review</span></span><br><span class="line"><span class="attr">  on_stop:</span> <span class="string">stop_review_app</span></span><br><span class="line"></span><br><span class="line"><span class="attr">stop_review_app:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">  script:</span> <span class="string">make</span> <span class="string">delete-app</span></span><br><span class="line"><span class="attr">  when:</span> <span class="string">manual</span></span><br><span class="line"><span class="attr">  environment:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">review</span></span><br><span class="line"><span class="attr">    action:</span> <span class="string">stop</span></span><br></pre></td></tr></table></figure>
ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº† review_app jobæ¥éƒ¨ç½²åˆ° review ç¯å¢ƒä¸­ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿå®šä¹‰äº†ä¸€ä¸ªæ–°stop_review_app jobåœ¨ on_stop ä¸­ã€‚ä¸€æ—¦ review_app jobæ‰§è¡Œå®Œæˆå¹¶ä¸”æˆåŠŸï¼Œå®ƒå°†è§¦å‘å®šä¹‰åœ¨ when ä¸­çš„stop_review_app jobã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è®¾ç½®ä¸º manual ï¼Œéœ€è¦é€šè¿‡GitLabâ€™s webç•Œé¢æ¥å…è®¸manual actionã€‚</li>
</ul>
<p>stop_review_app jobéœ€è¦å®šä¹‰ä¸‹é¢è¿™äº›å…³é”®å­—ï¼š<br>  when - è¯´æ˜<br>  environment:name<br>  environment:action<br>  stage éœ€è¦å’Œ review_app ç›¸åŒï¼Œä»¥ä¾¿åˆ†æ”¯åˆ é™¤è¢«åˆ é™¤çš„æ—¶å€™è‡ªåŠ¨æ‰§è¡Œåœæ­¢ã€‚</p>
<ul>
<li><p>dynamic environment : ä¹Ÿå¯ä»¥æ˜¯ä»£è¡¨é…ç½®é¡¹ï¼Œå…¶ä¸­åŒ…å« name å’Œ url ã€‚è¿™äº›å‚æ•°å¯ä»¥ä½¿ç”¨ä»»ä½•çš„CI variables(åŒ…æ‹¬é¢„å®šä¹‰ã€å®‰å…¨å˜é‡å’Œ .gitlab-ci.yml ä¸­çš„å˜é‡)ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">deploy</span> <span class="string">as</span> <span class="string">review</span> <span class="attr">app:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">  script:</span> <span class="string">make</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">  environment:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">review/$CI_COMMIT_REF_NAME</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">https://$CI_ENVIRONMENT_SLUG.example.com/</span></span><br></pre></td></tr></table></figure>
<p>å½“ $CI_COMMIT_REF_NAME è¢«Runnerè®¾ç½®ä¸ºenvironment variableæ—¶ï¼Œ deply as review app jobå°†ä¼šè¢«æŒ‡å®šéƒ¨ç½²åˆ°åŠ¨<br>æ€åˆ›å»º revuew/$CI_COMMIT_REF_NAME çš„ç¯å¢ƒä¸­ã€‚ $CI_ENVIRONMENT_SLUG å˜é‡æ˜¯åŸºäºç¯å¢ƒåç§°çš„ï¼Œæœ€ç»ˆç»„åˆæˆå®Œæ•´çš„URLsã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœ deploy as review app jobæ˜¯è¿è¡Œåœ¨åç§°ä¸º pow çš„åˆ†æ”¯ä¸‹ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡URL httpsâ€//review-pw.example.com/ æ¥è®¿é—®è¿™ä¸ªç¯å¢ƒã€‚<br>è¿™å½“ç„¶æ„å‘³ç€æ‰˜ç®¡åº”ç”¨ç¨‹åºçš„åº•å±‚æœåŠ¡å™¨å·²ç»æ­£ç¡®é…ç½®ã€‚</p>
<p>å¸¸è§çš„åšæ³•æ˜¯ä¸ºåˆ†æ”¯åˆ›å»ºåŠ¨æ€ç¯å¢ƒï¼Œå¹¶è®²å®ƒä»¬ä½œä¸ºReview Appsã€‚å¯ä»¥é€šè¿‡<a href="https://gitlab.com/gitlab-examples/reviewapps-nginx/ä¸ŠæŸ¥çœ‹ä½¿ç”¨Review" target="_blank" rel="noopener">https://gitlab.com/gitlab-examples/reviewapps-nginx/ä¸ŠæŸ¥çœ‹ä½¿ç”¨Review</a> Appsçš„ç®€å•ç¤ºä¾‹ã€‚</p>
</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li><p>artifacts<br>artifacts ç”¨äºæŒ‡å®šæˆåŠŸååº”é™„åŠ åˆ°jobçš„æ–‡ä»¶å’Œç›®å½•çš„åˆ—è¡¨ã€‚åªèƒ½ä½¿ç”¨é¡¹ç›®å·¥ä½œé—´å†…çš„æ–‡ä»¶æˆ–ç›®å½•è·¯å¾„ã€‚å¦‚æœæƒ³è¦åœ¨ä¸é€šçš„jobä¹‹é—´ä¼ é€’artifactsï¼Œè¯·æŸ¥é˜…ä¾èµ–å…³ç³»ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ä¾‹å­ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å‘é€ binaries å’Œ .config ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼š</span></span><br><span class="line"><span class="attr">artifacts:</span></span><br><span class="line"><span class="attr">  paths:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">binaries/</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">.config</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å‘é€æ‰€æœ‰æ²¡æœ‰è¢«Gitè·Ÿè¸ªçš„æ–‡ä»¶ï¼š</span></span><br><span class="line"><span class="attr">artifacts:</span></span><br><span class="line"><span class="attr">  untracked:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å‘é€æ²¡æœ‰è¢«Gitè·Ÿè¸ªå’Œ binaries ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼š</span></span><br><span class="line"><span class="attr">artifacts:</span></span><br><span class="line"><span class="attr">  untracked:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  paths:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">binaries/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å®šä¹‰ä¸€ä¸ªç©ºçš„dependencieså¯ä»¥ç¦ç”¨artifactä¼ é€’ï¼š</span></span><br><span class="line"><span class="attr">job:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">build</span></span><br><span class="line"><span class="attr">  script:</span> <span class="string">make</span> <span class="string">build</span></span><br><span class="line"><span class="attr">  dependencies:</span> <span class="string">[]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æœ‰æ—¶å€™åªéœ€è¦ä¸ºæ ‡ç­¾ä¸ºreleasesåˆ›å»ºartifactsï¼Œä»¥é¿å…å°†ä¸´æ—¶æ„å»ºçš„artifactsä¼ é€’åˆ°ç”Ÿäº§æœåŠ¡å™¨ä¸­ã€‚</span></span><br><span class="line"><span class="comment">#åªä¸ºtagsåˆ›å»ºartifactsï¼ˆ default-job å°†ä¸ä¼šåˆ›å»ºartifactsï¼‰ï¼š</span></span><br><span class="line"><span class="attr">default-job:</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">mvn</span> <span class="string">test</span> <span class="bullet">-U</span></span><br><span class="line"><span class="attr">  except:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">tags</span></span><br><span class="line"></span><br><span class="line"><span class="attr">release-job:</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">mvn</span> <span class="string">package</span> <span class="bullet">-U</span></span><br><span class="line"><span class="attr">  artifacts:</span></span><br><span class="line"><span class="attr">    paths:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">target/*.war</span></span><br><span class="line"><span class="attr">  only:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">tags</span></span><br></pre></td></tr></table></figure>
<p>åœ¨jobæˆåŠŸå®Œæˆåartifactså°†ä¼šå‘é€åˆ°GitLabä¸­ï¼ŒåŒæ—¶ä¹Ÿä¼šåœ¨GitLab UIä¸­æä¾›ä¸‹è½½ã€‚</p>
<ul>
<li><p>artifacts:name å…è®¸å®šä¹‰åˆ›å»ºçš„artifactså­˜æ¡£çš„åç§°ã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªå­˜æ¡£æä¾›ä¸€ä¸ªå”¯ä¸€çš„åç§°ï¼Œå½“éœ€è¦ä»GitLabä¸­ä¸‹è½½æ˜¯æ‰ä¸ä¼šæ··ä¹±ã€‚ <code>artifacts:name</code> å¯ä»¥ä½¿ç”¨ä»»ä½•çš„é¢„å®šä¹‰å˜é‡(predefined variables)ã€‚å®ƒçš„é»˜è®¤åç§°ä¸º artifacts ï¼Œå½“ä¸‹è½½æ˜¯å°±å˜æˆäº† artifacts.zip ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é€šè¿‡ä½¿ç”¨å½“å‰jobçš„åå­—ä½œä¸ºå­˜æ¡£åç§°ï¼š</span></span><br><span class="line"><span class="attr">job:</span></span><br><span class="line"><span class="attr">  artifacts:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">"$CI_JOB_NAME"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨å½“å‰åˆ†æ”¯åç§°æˆ–è€…æ˜¯tagä½œä¸ºå­˜åˆ°åç§°ï¼Œåªå­˜æ¡£æ²¡æœ‰è¢«Gitè·Ÿè¸ªçš„æ–‡ä»¶ï¼š</span></span><br><span class="line"><span class="attr">job:</span></span><br><span class="line"><span class="attr">  artifacts:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">"$CI_COMMIT_REF_NAME"</span></span><br><span class="line"><span class="attr">    untracked:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨å½“å‰jobåç§°å’Œå½“å‰åˆ†æ”¯åç§°æˆ–è€…æ˜¯tagä½œä¸ºå­˜æ¡£åç§°ï¼Œåªå­˜æ¡£æ²¡æœ‰è¢«Gitè·Ÿè¸ªçš„æ–‡ä»¶ï¼š</span></span><br><span class="line"><span class="attr">job:</span></span><br><span class="line"><span class="attr">  artifacts:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">"$&#123;CI_JOB_NAME&#125;_$&#123;CI_COMMIT_REF_NAME&#125;"</span></span><br><span class="line"><span class="attr">    untracked:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨å½“å‰stageå’Œåˆ†æ”¯åç§°ä½œä¸ºå­˜æ¡£åç§°ï¼š  </span></span><br><span class="line"><span class="attr">job:</span></span><br><span class="line"><span class="attr">  artifacts:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">"$&#123;CI_JOB_STAGE&#125;_$&#123;CI_COMMIT_REF_NAME&#125;"</span></span><br><span class="line"><span class="attr">    untracked:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœæ˜¯ä½¿ç”¨Windowsæ‰¹å¤„ç†æ¥è¿è¡Œyamlè„šæœ¬ï¼Œéœ€è¦ç”¨ % æ›¿æ¢ $ ï¼š</span></span><br><span class="line"><span class="attr">job:</span></span><br><span class="line"><span class="attr">  artifacts:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">"%CI_JOB_STAGE%_%CI_COMMIT_REF_NAME%"</span></span><br><span class="line"><span class="attr">    untracked:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>artifacts:when åœ¨jobå¤±è´¥çš„æ—¶å€™ï¼Œ artifacts:when ç”¨æ¥ä¸Šä¼ artifactsæˆ–è€…å¿½ç•¥å¤±è´¥ã€‚<br>artifacts:when å¯ä»¥è®¾ç½®ä¸€ä¸‹å€¼ï¼š</p>
<ul>
<li>1.on_success - å½“jobæˆåŠŸçš„æ—¶å€™ä¸Šä¼ artifactsã€‚é»˜è®¤å€¼ã€‚</li>
<li>2.on_failure - å½“jobå¤±è´¥çš„æ—¶å€™ä¸Šä¼ artifactsã€‚</li>
<li>3.always - ä¸è®ºjobå¤±è´¥è¿˜æ˜¯æˆåŠŸéƒ½ä¸Šä¼ artifactsã€‚</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åªåœ¨jobå¤±è´¥çš„æ—¶å€™ä¸Šä¼ artifactsã€‚</span></span><br><span class="line"><span class="attr">job:</span></span><br><span class="line"><span class="attr">  artifacts:</span></span><br><span class="line"><span class="attr">    when:</span> <span class="string">on_failure</span></span><br></pre></td></tr></table></figure></li>
<li>artifacts:expire_in ç”¨äºè¿‡æœŸååˆ é™¤é‚®ä»¶ä¸Šä¼ çš„artifactsã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œartifactséƒ½æ˜¯åœ¨GitLabä¸­æ°¸ä¹…ä¿å­˜ã€‚expire_in å…è®¸è®¾ç½®è®¾ç½®artifactsçš„å­˜å‚¨æ—¶é—´ï¼Œä»å®ƒä»¬è¢«ä¸Šä¼ å­˜å‚¨åˆ°GitLabå¼€å§‹è®¡ç®—ã€‚<br>å¯ä»¥é€šè¿‡jobé¡µé¢çš„Keepæ¥ä¿®æ”¹æœ‰æ•ˆæœŸã€‚è¿‡æœŸåartifactsä¼šè¢«é€šè¿‡ä¸€ä¸ªé»˜è®¤æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡çš„å®šæ—¶jobåˆ é™¤ï¼Œæ‰€ä»¥åœ¨è¿‡æœŸåæ— æ³•è®¿é—®artifactsã€‚<br>expire_in æ˜¯ä¸€ä¸ªæ—¶é—´åŒºé—´ã€‚ä¸‹é¢å¯è®¾ç½®çš„å€¼ï¼š<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'3 mins 4 sec'</span></span><br><span class="line"><span class="string">'2 hrs 20 min'</span></span><br><span class="line"><span class="string">'2h20min'</span></span><br><span class="line"><span class="string">'6 mos 1 day'</span></span><br><span class="line"><span class="string">'47 yrs 6 mos and 4d'</span></span><br><span class="line"><span class="string">'3 weeks and 2 days'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®artifactsçš„æœ‰æ•ˆæœŸä¸ºä¸€ä¸ªæ˜ŸæœŸï¼š</span></span><br><span class="line"><span class="attr">job:</span></span><br><span class="line"><span class="attr">  artifacts:</span></span><br><span class="line"><span class="attr">    expire_in:</span> <span class="number">1</span> <span class="string">week</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>dependencies<br>è¿™ä¸ªåŠŸèƒ½åº”è¯¥ä¸ artifacts ä¸€èµ·ä½¿ç”¨ï¼Œå¹¶å…è®¸å®šä¹‰åœ¨ä¸åŒjobsä¹‹é—´ä¼ é€’artifactsã€‚æ³¨æ„ï¼šæ‰€æœ‰ä¹‹å‰çš„stageséƒ½æ˜¯é»˜è®¤è®¾ç½®é€šè¿‡ã€‚<br>å¦‚æœè¦ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œåº”è¯¥åœ¨ä¸Šä¸‹æ–‡çš„jobä¸­å®šä¹‰ dependencies ï¼Œå¹¶ä¸”åˆ—å‡ºä¹‹å‰éƒ½å·²ç»é€šè¿‡çš„jobså’Œå¯ä¸‹è½½çš„artifactsã€‚ä½ åªèƒ½åœ¨å½“å‰æ‰§è¡Œçš„stageså‰å®šä¹‰jobsã€‚ä½ å¦‚æœåœ¨å½“å‰stagesæˆ–è€…åç»­çš„stagesä¸­å®šä¹‰äº†jobsï¼Œå®ƒå°†ä¼šæŠ¥é”™ã€‚å¯ä»¥é€šè¿‡å®šä¹‰ä¸€ä¸ªç©ºæ•°ç»„æ˜¯å½“å‰jobè·³è¿‡ä¸‹è½½artifactsã€‚<br>åœ¨æ¥ä¸‹æ¥çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸¤ä¸ªå¸¦artifactsçš„jobsï¼Œ <code>build:osx å’Œ build:linux ã€‚å½“ test:osx å¼€å§‹æ‰§è¡Œçš„æ—¶å€™</code>ï¼Œ build:osx çš„ artifactså°±ä¼šå¼€å§‹ä¸‹è½½å¹¶ä¸”ä¼šåœ¨buildçš„stagesä¸‹æ‰§è¡Œã€‚<code>åŒæ ·çš„ä¼šå‘ç”Ÿåœ¨ test:linux ï¼Œä»build:linux ä¸­ä¸‹è½½artifacts</code>ã€‚<br>å› ä¸ºstagesçš„ä¼˜å…ˆçº§å…³ç³»deploy jobå°†ä¼šä¸‹è½½ä¹‹å‰jobsçš„æ‰€æœ‰artifactsï¼š</p>
 <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr"> build:</span><span class="attr">osx:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">build</span></span><br><span class="line"><span class="attr">  script:</span> <span class="string">make</span> <span class="attr">build:osx</span></span><br><span class="line"><span class="attr">  artifacts:</span></span><br><span class="line"><span class="attr">    paths:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">binaries/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build:</span><span class="attr">linux:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">build</span></span><br><span class="line"><span class="attr">  script:</span> <span class="string">make</span> <span class="attr">build:linux</span></span><br><span class="line"><span class="attr">  artifacts:</span></span><br><span class="line"><span class="attr">    paths:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">binaries/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">test:</span><span class="attr">osx:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">  script:</span> <span class="string">make</span> <span class="attr">test:osx</span></span><br><span class="line"><span class="attr">  dependencies:</span></span><br><span class="line"><span class="attr">    - build:</span><span class="string">osx</span>  <span class="comment">#ä»build:osx ä¸­ä¸‹è½½artifacts</span></span><br><span class="line"></span><br><span class="line"><span class="attr">test:</span><span class="attr">linux:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">  script:</span> <span class="string">make</span> <span class="attr">test:linux</span></span><br><span class="line"><span class="attr">  dependencies:</span></span><br><span class="line"><span class="attr">    - build:</span><span class="string">linux</span>  <span class="comment">#ä»build:linux ä¸­ä¸‹è½½artifacts</span></span><br><span class="line"></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">  script:</span> <span class="string">make</span> <span class="string">deploy</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<ul>
<li>before_script å’Œ after_script<br>å®ƒå¯èƒ½ä¼šè¦†ç›–å…¨å±€å®šä¹‰çš„ before_script å’Œ after_script ,ä»–å¯ä»¥åœ¨å…¨å±€æˆ–è€…é˜¶æ®µå·¥ä½œä¸­ä½¿ç”¨;<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ¯ä¸ªjobéƒ½å°†æ‰§è¡Œ</span></span><br><span class="line"><span class="attr">before_script:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">global</span> <span class="string">before</span> <span class="string">script</span></span><br><span class="line"><span class="attr">after_script:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">global</span> <span class="string">after</span> <span class="string">script</span></span><br><span class="line"></span><br><span class="line"><span class="attr">job:</span></span><br><span class="line"><span class="attr">  before_script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">execute</span> <span class="string">this</span> <span class="string">instead</span> <span class="string">of</span> <span class="string">global</span> <span class="string">before</span> <span class="string">script</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">my</span> <span class="string">command</span></span><br><span class="line"><span class="attr">  after_script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">execute</span> <span class="string">this</span> <span class="string">after</span> <span class="string">my</span> <span class="string">script</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<ul>
<li>coverage ï¼šå…è®¸ä½ é…ç½®ä»£ç è¦†ç›–ç‡å°†ä¼šä»è¯¥jobä¸­æå–è¾“å‡ºã€‚<br> åœ¨è¿™é‡Œæ­£åˆ™è¡¨è¾¾å¼æ˜¯å”¯ä¸€æœ‰æ•ˆçš„å€¼ã€‚å› æ­¤ï¼Œå­—ç¬¦ä¸²çš„å‰åå¿…é¡»ä½¿ç”¨ / åŒ…å«æ¥è¡¨æ˜ä¸€ä¸ªæ­£ç¡®çš„æ­£åˆ™è¡¨è¾¾å¼è§„åˆ™ã€‚ç‰¹æ®Šå­—ç¬¦ä¸²éœ€è¦è½¬ä¹‰ã€‚ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">job1:</span></span><br><span class="line"><span class="attr">  coverage:</span> <span class="string">'/Code coverage: \d+\.\d+/'</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="0x02-ä»“åº“ç›¸å…³"><a href="#0x02-ä»“åº“ç›¸å…³" class="headerlink" title="0x02 ä»“åº“ç›¸å…³"></a>0x02 ä»“åº“ç›¸å…³</h4><ul>
<li><p>Git Strategy<br>ä½ å¯ä»¥é€šè¿‡è®¾ç½® GIT_STRATEGY ç”¨äºè·å–æœ€æ–°çš„ä»£ç ï¼Œå¯ä»¥å†å…¨å±€ variables æˆ–è€…æ˜¯åœ¨å•ä¸ªjobçš„ variables æ¨¡å—ä¸­è®¾ç½®ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œå°†ä»é¡¹ç›®ä¸­ä½¿ç”¨é»˜è®¤å€¼ã€‚<br>å¯ä»¥è®¾ç½®çš„å€¼æœ‰ï¼š <code>clone ï¼Œ fetch ï¼Œå’Œ none</code> ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">variables:</span></span><br><span class="line"><span class="comment">#clone æ˜¯æœ€æ…¢çš„é€‰é¡¹ã€‚å®ƒä¼šä»å¤´å¼€å§‹å…‹éš†æ•´ä¸ªä»“åº“ï¼ŒåŒ…å«æ¯ä¸€ä¸ªjobï¼Œä»¥ç¡®ä¿é¡¹ç›®å·¥ä½œåŒºæ˜¯æœ€åŸå§‹çš„ã€‚</span></span><br><span class="line"><span class="attr">  GIT_STRATEGY:</span> <span class="string">clone</span></span><br><span class="line"><span class="comment">#å½“å®ƒé‡æ–°ä½¿ç”¨é¡¹ç›®å·¥ä½œåŒºæ˜¯ï¼Œ fetch æ˜¯æ›´å¿«ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›å…‹éš†ï¼‰ã€‚ git clean ç”¨äºæ’¤é”€ä¸Šä¸€ä¸ªjobåšçš„ä»»ä½•æ”¹å˜ï¼Œ git fetch ç”¨äºè·å–ä¸Šä¸€ä¸ªjobåˆ°ç°åœ¨çš„çš„commitã€‚  </span></span><br><span class="line"><span class="attr">  GIT_STRATEGY:</span> <span class="string">fetch</span></span><br><span class="line"><span class="comment">#none ä¹Ÿæ˜¯é‡æ–°ä½¿ç”¨é¡¹ç›®å·¥ä½œåŒºï¼Œä½†æ˜¯å®ƒä¼šè·³è¿‡æ‰€æœ‰çš„Gitæ“ä½œï¼ˆåŒ…æ‹¬GitLab Runnerå‰çš„å…‹éš†è„šæœ¬ï¼Œå¦‚æœå­˜åœ¨çš„è¯ï¼‰ã€‚å®ƒä¸»è¦ç”¨åœ¨æ“ä½œjobçš„artifactsï¼ˆä¾‹å¦‚ï¼š deploy ï¼‰ã€‚</span></span><br><span class="line"><span class="comment">#Gitæ•°æ®ä»“åº“è‚¯å®šæ˜¯å­˜åœ¨çš„ï¼Œä½†æ˜¯ä»–è‚¯å®šä¸æ˜¯æœ€æ–°çš„ï¼Œæ‰€ä»¥ä½ åªèƒ½ä¾èµ–äºä»é¡¹ç›®å·¥ä½œåŒºçš„ç¼“å­˜æˆ–è€…æ˜¯artifactså¸¦æ¥çš„æ–‡ä»¶ã€‚</span></span><br><span class="line"><span class="attr">  GIT_STRATEGY:</span> <span class="string">none</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Git Checout<br>å½“ GIT_STRATEGY  <code>è®¾ç½®ä¸º clone æˆ– fetch æ—¶</code>ï¼Œå¯ä»¥ä½¿ç”¨ GIT_CHECKOUT å˜é‡æ¥æŒ‡å®šæ˜¯å¦åº”è¯¥è¿è¡Œ git checkout ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œå®ƒé»˜è®¤ä¸ºtrueã€‚å°±åƒ GIT_STRATEGY ä¸€æ ·ï¼Œå®ƒå¯ä»¥è®¾ç½®åœ¨å…¨å±€ variables æˆ–è€…æ˜¯å•ä¸ªjobçš„ variables ä¸­è®¾ç½®ã€‚å¦‚æœè®¾ç½®ä¸º falseæ—¶Runnerå°±ä¼šï¼š</p>
<ul>
<li>fetch - æ›´æ–°ä»“åº“å¹¶åœ¨å½“å‰ç‰ˆæœ¬ä¸­ä¿ç•™å·¥ä½œå‰¯æœ¬ï¼Œ</li>
<li>clone - å…‹éš†ä»“åº“å¹¶åœ¨é»˜è®¤åˆ†æ”¯ä¸­ä¿ç•™å·¥ä½œå‰¯æœ¬ã€‚<br>ã€å¦‚æœè®¾ç½®è¿™ä¸ªä¸º true å°†æ„å‘³ç€ clone å’Œ fetch ç­–ç•¥éƒ½ä¼šè®©Runneræ‰§è¡Œé¡¹ç›®å·¥ä½œåŒºæ›´æ–°åˆ°æœ€æ–°ï¼šã€‘ <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">variables:</span></span><br><span class="line"><span class="attr">  GIT_STRATEGY:</span> <span class="string">clone</span></span><br><span class="line"><span class="attr">  GIT_CHECKOUT:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">script:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">git</span> <span class="string">checkout</span> <span class="string">master</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">git</span> <span class="string">merge</span> <span class="string">$CI_BUILD_REF_NAME</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Git Submodule Strategy<br>GIT_SUBMODULE_STRATEGY å˜é‡ç”¨äºåœ¨æ„å»ºä¹‹å‰æ‹‰å–ä»£ç æ—¶ï¼ŒGitå­æ¨¡å—æ˜¯å¦æˆ–è€…å¦‚ä½•è¢«å¼•å…¥ã€‚å°±åƒ GIT_STRATEGY ä¸€æ ·ï¼Œå®ƒå¯åœ¨<code>å…¨å±€ variables æˆ–è€…æ˜¯å•ä¸ªjobçš„ variables æ¨¡å—ä¸­è®¾ç½®</code>ã€‚<br>å®ƒçš„å¯ç”¨å€¼æœ‰ï¼š none ï¼Œ normal å’Œ recursive ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">none æ„å‘³ç€åœ¨æ‹‰å–é¡¹ç›®ä»£ç æ—¶ï¼Œå­æ¨¡å—å°†ä¸ä¼šè¢«å¼•å…¥ã€‚è¿™ä¸ªæ˜¯é»˜è®¤å€¼ï¼Œä¸v1.10ä¹‹å‰ç›¸åŒçš„ã€‚</span><br><span class="line">normal æ„å‘³ç€åœ¨åªæœ‰é¡¶çº§å­æ¨¡å—ä¼šè¢«å¼•å…¥ã€‚å®ƒç›¸å½“äºï¼š </span><br><span class="line">  git submodule sync</span><br><span class="line">  git submodule update --init</span><br><span class="line">recursive æ„å‘³ç€æ‰€æœ‰çš„å­æ¨¡å—ï¼ˆåŒ…æ‹¬å­æ¨¡å—çš„å­æ¨¡å—ï¼‰éƒ½ä¼šè¢«å¼•å…¥ï¼Œä»–ç›¸å½“äºï¼š</span><br><span class="line">  git submodule sync --recursive</span><br><span class="line">  git submodule update --init --recursive</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šå¦‚æœæƒ³è¦æ­¤åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼Œå­æ¨¡å—å¿…é¡»é…ç½®ï¼ˆåœ¨ .gitmodules ï¼‰ä¸‹é¢ä¸­ä»»æ„ä¸€ä¸ªï¼š</p>
<ul>
<li>å¯è®¿é—®çš„å…¬å…±ä»“åº“http(s)åœ°å€ï¼Œ</li>
<li>åœ¨åŒä¸€ä¸ªGitLabæœåŠ¡å™¨ä¸Šæœ‰ä¸€ä¸ªå¯è®¿é—®åˆ°å¦å¤–çš„ä»“åº“çš„çœŸå®åœ°å€ã€‚æ›´å¤šæŸ¥çœ‹Git å­æ¨¡å—æ–‡æ¡£ã€‚</li>
</ul>
</li>
<li><p>Job stages attempts<br>æ­£åœ¨æ‰§è¡Œçš„jobå°†ä¼šæŒ‰ç…§ä½ è®¾ç½®å°è¯•æ¬¡æ•°ä¾æ¬¡æ‰§è¡Œä¸‹é¢çš„stagesï¼ˆé»˜è®¤æ˜¯ä¸€æ¬¡å°è¯•ï¼‰ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">GET_SOURCES_ATTEMPTS</span>       <span class="string">è·å–jobæºçš„å°è¯•æ¬¡æ•°</span></span><br><span class="line"><span class="string">ARTIFACT_DOWNLOAD_ATTEMPTS</span> <span class="string">ä¸‹è½½artifactsçš„å°è¯•æ¬¡æ•°</span></span><br><span class="line"><span class="string">RESTORE_CACHE_ATTEMPTS</span>     <span class="string">é‡å»ºç¼“å­˜çš„å°è¯•æ¬¡æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#åŸºç¡€å®ä¾‹</span></span><br><span class="line"><span class="attr">variables:</span></span><br><span class="line"><span class="attr">  GET_SOURCES_ATTEMPTS:</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>ä½ å¯ä»¥åœ¨å…¨å±€ variables æ¨¡å—ä¸­è®¾ç½®ï¼Œä¹Ÿå¯ä»¥åœ¨å•ä¸ªjobçš„ variables æ¨¡å—ä¸­è®¾ç½®ã€‚</p>
</li>
</ul>
<ul>
<li><p>Shallow cloning<br>ä½ å¯ä»¥é€šè¿‡ GIT_DEPTH æ¥æŒ‡å®šæŠ“å–æˆ–å…‹éš†çš„æ·±åº¦ã€‚å®ƒå¯æµ…å±‚çš„å…‹éš†ä»“åº“ï¼Œè¿™å¯ä»¥æ˜¾è‘—åŠ é€Ÿå…·æœ‰å¤§é‡æäº¤å’Œæ—§çš„å¤§å‹äºŒè¿›åˆ¶æ–‡ä»¶çš„ä»“åº“çš„å…‹éš†ã€‚è¿™ä¸ªè®¾ç½®çš„å€¼ä¼šä¼ é€’ç»™ git fetch å’Œ git clone ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœè®¾ç½®depth=1ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªjobsé˜Ÿåˆ—æˆ–è€…æ˜¯é‡è¯•jobsï¼Œåˆ™jobså¯èƒ½ä¼šå¤±è´¥ã€‚</p>
</blockquote>
<p>ç”±äºGitæŠ“å–å’Œå…‹éš†æ˜¯åŸºäºä¸€ä¸ªREFï¼Œä¾‹å¦‚åˆ†æ”¯çš„åç§°ï¼Œæ‰€ä»¥Runnerä¸èƒ½æŒ‡å®šå…‹éš†ä¸€ä¸ªcommit SHAã€‚å¦‚æœé˜Ÿåˆ—ä¸­æœ‰å¤šä¸ªjobsï¼Œæˆ–è€…æ‚¨æ­£åœ¨é‡è¯•æ—§çš„jobï¼Œåˆ™éœ€è¦æµ‹è¯•çš„æäº¤åº”è¯¥åœ¨å…‹éš†çš„Gitå†å²è®°å½•ä¸­å­˜åœ¨ã€‚è®¾ç½® GIT_DEPTH å¤ªå°çš„å€¼å¯èƒ½ä¼šå¯¼è‡´æ— æ³•è¿è¡Œå“ªäº›æ—§çš„commitsã€‚åœ¨jobæ—¥å¿—ä¸­å¯ä»¥æŸ¥çœ‹ unresolved reference ã€‚ä½ åº”è¯¥è€ƒè™‘è®¾ç½® GIT_DEPTH ä¸ºä¸€ä¸ªæ›´å¤§çš„å€¼ã€‚<br>å½“ GIT_DEPTH åªç½®äº†éƒ¨åˆ†å­˜åœ¨çš„è®°å½•æ—¶ï¼Œå“ªäº›ä¾èµ–äº git describe çš„jobsä¹Ÿè®¸ä¸èƒ½æ­£ç¡®çš„å·¥ä½œã€‚åªæŠ“å–æˆ–å…‹éš†æœ€åçš„3æ¬¡commitsï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">variables:</span></span><br><span class="line"><span class="attr">  GIT_DEPTH:</span> <span class="string">"3"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Hidden keys<br>Key æ˜¯ä»¥ . å¼€å§‹çš„ï¼ŒGitLab CI å°†ä¸ä¼šå¤„ç†å®ƒã€‚ä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½æ¥å¿½ç•¥jobsï¼Œæˆ–è€…ç”¨Special YAML features è½¬æ¢éšè—é”®ä¸ºæ¨¡ç‰ˆã€‚åœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ .key_name å°†ä¼šè¢«å¿½ç•¥ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.key_name:</span><br><span class="line">  script:</span><br><span class="line">  - rake spec</span><br></pre></td></tr></table></figure>
<p>Hidden keys å¯ä»¥æ˜¯åƒæ™®é€šCI jobsä¸€æ ·çš„å“ˆå¸Œå€¼ï¼Œä½†ä½ ä¹Ÿå¯ä»¥åˆ©ç”¨special YAMLfeaturesæ¥ä½¿ç”¨ä¸åŒç±»å‹çš„ç»“æ„ã€‚ä½¿ç”¨special YAML features åƒ<code>anchors( &amp; )ï¼Œaliases( * )å’Œmap merging( &lt;&lt; )</code>ï¼Œè¿™å°†ä½¿æ‚¨å¯ä»¥å¤§å¤§é™ä½ .gitlabci.yml çš„å¤æ‚æ€§ã€‚</p>
</li>
<li><p>Anchors<br>YAMLæœ‰ä¸ªæ–¹ä¾¿çš„åŠŸèƒ½ç§°ä¸ºâ€é”šâ€,å®ƒå¯ä»¥è®©ä½ è½»æ¾çš„åœ¨æ–‡æ¡£ä¸­å¤åˆ¶å†…å®¹ã€‚Anchorså¯ç”¨äºå¤åˆ¶/ç»§æ‰¿å±æ€§ï¼Œå¹¶ä¸”æ˜¯ä½¿ç”¨hidden keysæ¥æä¾›æ¨¡ç‰ˆçš„å®Œç¾ç¤ºä¾‹ã€‚<br>ä¸‹é¢è¿™ä¸ªä¾‹å­ä½¿ç”¨äº†anchorså’Œmap mergingã€‚å®ƒå°†ä¼šåˆ›å»ºä¸¤ä¸ªjobsï¼Œ test1 å’Œ test2 ï¼Œè¯¥jobså°†é›†æˆ .job_template çš„å‚æ•°ï¼Œæ¯ä¸ªjobéƒ½è‡ªå®šä¹‰è„šæœ¬</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">.job_template:</span> <span class="meta">&amp;job_definition</span> <span class="comment"># Hidden key that defines an anchor named 'job_definition'</span></span><br><span class="line"><span class="attr">image:</span> <span class="attr">ruby:2.1</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">postgres</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">redis</span></span><br><span class="line"></span><br><span class="line"><span class="attr">test1:</span></span><br><span class="line">  <span class="string">&lt;&lt;:</span> <span class="meta">*job_definition</span> <span class="comment"># Merge the contents of the 'job_definition' alias</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">test1</span> <span class="string">project</span></span><br><span class="line"></span><br><span class="line"><span class="attr">test2:</span></span><br><span class="line">  <span class="string">&lt;&lt;:</span> <span class="meta">*job_definition</span> <span class="comment"># Merge the contents of the 'job_definition' alias</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">test2</span> <span class="string">project</span></span><br></pre></td></tr></table></figure>
<p>&amp; åœ¨anchorçš„åç§°( job_definition )å‰è®¾ç½®ï¼Œ <code>&lt;&lt; è¡¨ç¤º&quot;merge the given hash into the current one&quot;</code>ï¼Œ * åŒ…æ‹¬å‘½åçš„anchor( job_definition )ã€‚æ‰©å±•ç‰ˆæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">.job_template:</span></span><br><span class="line"><span class="attr">  image:</span> <span class="attr">ruby:2.1</span></span><br><span class="line"><span class="attr">  services:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">postgres</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">redis</span></span><br><span class="line"></span><br><span class="line"><span class="attr">test1:</span></span><br><span class="line">  <span class="comment">#'job_definition' alias (åˆ«åæ•ˆæœå¦‚ä¸‹)</span></span><br><span class="line"><span class="attr">  image:</span> <span class="attr">ruby:2.1</span></span><br><span class="line"><span class="attr">  services:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">postgres</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">test1</span> <span class="string">project</span></span><br><span class="line"></span><br><span class="line"><span class="attr">test2:</span></span><br><span class="line"><span class="attr">  image:</span> <span class="attr">ruby:2.1</span></span><br><span class="line"><span class="attr">  services:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">postgres</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">test2</span> <span class="string">project</span></span><br></pre></td></tr></table></figure>
<p>è®©æˆ‘ä»¬æ¥çœ‹å¦å¤–ä¸€ä¸ªä¾‹å­ã€‚è¿™ä¸€æ¬¡æˆ‘ä»¬å°†ç”¨anchorsæ¥å®šä¹‰ä¸¤ä¸ªæœåŠ¡ã€‚ä¸¤ä¸ªæœåŠ¡ä¼šåˆ›å»ºä¸¤ä¸ªjobï¼Œ test:postgres å’Œ test:mysql ï¼Œä»–ä»¬ä¼šåœ¨ .job_template ä¸­å…±äº«å®šä¹‰çš„ script æŒ‡ä»¤ï¼Œä»¥åŠåˆ†åˆ«åœ¨ <code>postgres_services å’Œ .mysql_services ä¸­å®šä¹‰çš„ service æŒ‡ä»¤</code>ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">.job_template:</span> <span class="meta">&amp;job_definition</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">test</span> <span class="string">project</span></span><br><span class="line"></span><br><span class="line"><span class="string">.postgres_services:</span></span><br><span class="line"><span class="attr">  services:</span> <span class="meta">&amp;postgres_definition</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">postgres</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">ruby</span></span><br><span class="line"></span><br><span class="line"><span class="attr">test:</span><span class="attr">postgres:</span></span><br><span class="line">  <span class="string">&lt;&lt;:</span> <span class="meta">*job_definition</span></span><br><span class="line"><span class="attr">  services:</span> <span class="meta">*postgres_definition</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰©å±•ç‰ˆæœ¬å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="string">.job_template:</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">   -</span> <span class="string">test</span> <span class="string">project</span></span><br><span class="line"></span><br><span class="line"><span class="string">.postgres_services:</span></span><br><span class="line"><span class="attr">  services:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">postgres</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">ruby</span></span><br><span class="line"></span><br><span class="line"><span class="attr">test:</span><span class="attr">postgres:</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">test</span> <span class="string">project</span></span><br><span class="line"><span class="attr">  services:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">postgres</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">ruby</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Triggers:å¯ç”¨äºå¼ºåˆ¶ä½¿ç”¨APIè°ƒç”¨é‡å»ºç‰¹å®šåˆ†æ”¯ï¼Œtagæˆ–commitsã€‚</p>
</li>
<li>pages:æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„jobï¼Œç”¨äºå°†é™æ€çš„å†…å®¹ä¸Šä¼ åˆ°GitLabï¼Œå¯ç”¨äºä¸ºæ‚¨çš„ç½‘ç«™æä¾›æœåŠ¡ã€‚å®ƒæœ‰ç‰¹æ®Šçš„è¯­æ³•ï¼Œå› æ­¤å¿…é¡»æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªè¦æ±‚ï¼š</li>
</ul>
<ul>
<li>1.ä»»ä½•é™æ€å†…å®¹å¿…é¡»æ”¾åœ¨ public/ ç›®å½•ä¸‹</li>
<li>2.artifacts å¿…é¡»å®šä¹‰åœ¨ public/ ç›®å½•ä¸‹<br>ä¸‹é¢çš„è¿™ä¸ªä¾‹å­æ˜¯å°†æ‰€æœ‰æ–‡ä»¶ä»é¡¹ç›®æ ¹ç›®å½•ç§»åŠ¨åˆ° public/ ç›®å½•ã€‚.public å·¥ä½œæµæ˜¯ cp ï¼Œå¹¶ä¸”å®ƒä¸ä¼šå¾ªç¯å¤åˆ¶public/ æœ¬èº«ã€‚<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pages:</span></span><br><span class="line"><span class="attr">  stage:</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">mkdir</span> <span class="string">.public</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">cp</span> <span class="bullet">-r</span> <span class="string">*</span> <span class="string">.public</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">mv</span> <span class="string">.public</span> <span class="string">public</span></span><br><span class="line"><span class="attr">  artifacts:</span></span><br><span class="line"><span class="attr">    paths:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">public</span></span><br><span class="line"><span class="attr">    only:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">master</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>Skipping jobs:å¦‚æœä½ çš„commitä¿¡æ¯ä¸­åŒ…å« <code>[ci skip] æˆ–è€… [skip ci]</code>ï¼Œä¸è®ºå¤§å°å†™ï¼Œé‚£ä¹ˆè¿™ä¸ªcommitå°†ä¼šåˆ›å»ºä½†æ˜¯jobsä¹Ÿä¼šè·³è¿‡;</li>
</ul>
<hr>
<h4 id="0x03-ç®¡é“ä»‹ç»"><a href="#0x03-ç®¡é“ä»‹ç»" class="headerlink" title="0x03 ç®¡é“ä»‹ç»"></a>0x03 ç®¡é“ä»‹ç»</h4><p>ç®¡é“æ˜¯<code>æŒç»­é›†æˆã€äº¤ä»˜å’Œéƒ¨ç½²çš„é¡¶çº§ç»„ä»¶</code>æ˜¯ä¸€ç»„åˆ†é˜¶æ®µï¼ˆæ‰¹å¤„ç†ï¼‰æ‰§è¡Œçš„å·¥ä½œã€‚åŒä¸€ä¸ªé˜¶æ®µä¸­çš„æ‰€æœ‰å·¥ä½œéƒ½æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼ˆå¦‚æœæœ‰è¶³å¤Ÿçš„å¹¶å‘Runnersï¼‰ï¼Œå¦‚æœå®ƒä»¬å…¨éƒ¨æˆåŠŸï¼Œç®¡é“å°±è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªjobså¤±è´¥ï¼Œåˆ™ä¸‹ä¸€ä¸ªé˜¶æ®µä¸ï¼ˆé€šå¸¸ï¼‰æ‰§è¡Œã€‚æ‚¨å¯ä»¥è®¿é—®é¡¹ç›®çš„Pipelineé€‰é¡¹å¡ä¸­çš„ç®¡é“é¡µé¢ã€‚<br>åœ¨ä¸‹å›¾ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ç®¡é“ç”±4ä¸ªé˜¶æ®µç»„æˆï¼ˆ<code>build(æ„å»º) , test(æµ‹è¯•) , staging(åˆ†çº§) , production(ç”Ÿäº§)</code> ï¼‰ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå·¥ä½œã€‚</p>
<h5 id="1-ç®¡é“ç±»å‹"><a href="#1-ç®¡é“ç±»å‹" class="headerlink" title="1.ç®¡é“ç±»å‹"></a>1.ç®¡é“ç±»å‹</h5><p>æè¿°ï¼šç®¡é“åˆ†ä¸‰ç§ï¼Œä½†æ˜¯é€šå¸¸éƒ½ä½¿ç”¨å•ä¸€çš„â€œç®¡é“â€æ¥ä»£æ›¿æ‰€æœ‰ã€‚äººä»¬ç»å¸¸è°ˆè®ºä»–ä»¬ï¼Œå°±å¥½åƒæ¯ä¸ªéƒ½æ˜¯â€œç®¡é“â€ä¸€æ ·ï¼Œä½†å®é™…ä¸Šä»–ä»¬åªæ˜¯ç»¼åˆç®¡é“çš„ä¸€éƒ¨åˆ†ã€‚</p>
<ol>
<li>CI Pipelineï¼š åœ¨ gitlab-ci.yml ä¸­å®šä¹‰çš„æ„å»ºå’Œæµ‹è¯•é˜¶æ®µã€‚</li>
<li>Deploy Pipelineï¼š åœ¨ .gitlab-ci.yml ä¸­å®šä¹‰çš„éƒ¨ç½²é˜¶æ®µï¼Œç”¨æ¥é€šè¿‡å„ç§å„æ ·çš„æ–¹å¼å°†ä»£ç éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼š<br>ä¾‹å¦‚ï¼Œå°†ä»£ç å‘å¸ƒåˆ°ç”Ÿæˆç¯å¢ƒ</li>
<li>Project Pipelineï¼šé€šè¿‡APIè§¦å‘è·¨é¡¹ç›®CIä¾èµ–å…³ç³»ï¼Œå°¤å…¶æ˜¯é’ˆå¯¹å¾®æœåŠ¡ï¼Œä½†ä¹Ÿé€‚ç”¨äºå¤æ‚çš„æ„å»ºä¾èµ–å…³ç³»ï¼š<br>ä¾‹å¦‚ï¼Œ<code>api-&gt; front-endï¼Œce / ee-&gt; omnibus</code>ã€‚</li>
</ol>
<p>å¼€å‘å·¥ä½œæµç¨‹:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="string">Branch</span> <span class="string">Flowï¼ˆä¾‹å¦‚ï¼Œdevï¼Œqaï¼Œåˆ†æœŸï¼Œç”Ÿäº§ç­‰ä¸åŒåˆ†æ”¯ï¼‰</span></span><br><span class="line"><span class="number">2.</span> <span class="string">Trunk-based</span> <span class="string">Flow</span> <span class="string">ï¼ˆä¾‹å¦‚ï¼ŒåŠŸèƒ½åˆ†æ”¯ã€å•ä¸€çš„ä¸»åˆ†æ”¯å’Œå¯èƒ½å¸¦æœ‰æ ‡ç­¾çš„å‘å¸ƒï¼‰</span></span><br><span class="line"><span class="number">3.</span> <span class="string">åŸºäºåˆ†å‰çš„æµç¨‹ï¼ˆä¾‹å¦‚ï¼Œæ¥è‡ªforkçš„åˆå¹¶è¯·æ±‚ï¼‰</span></span><br></pre></td></tr></table></figure></p>
<h5 id="2-åè¯ä»‹ç»"><a href="#2-åè¯ä»‹ç»" class="headerlink" title="2.åè¯ä»‹ç»"></a>2.åè¯ä»‹ç»</h5><ul>
<li>å·¥ä½œï¼šå¯ä»¥åœ¨ .gitlab-ci.yml æ–‡ä»¶ä¸­å®šä¹‰ã€‚ä¸è¦ä¸ build å·¥ä½œæˆ– build é˜¶æ®µæ··æ·†ã€‚</li>
<li>å®šä¹‰ç®¡é“:åœ¨ .gitlab-ci.yml ä¸­é€šè¿‡æŒ‡å®šé˜¶æ®µè¿è¡Œçš„ä½œä¸šæ¥å®šä¹‰ç®¡é“ã€‚</li>
<li>æŸ¥çœ‹ç®¡é“çŠ¶æ€: æ‚¨å¯ä»¥åœ¨é¡¹ç›®çš„ Pipelineé€‰é¡¹å¡ä¸‹æ‰¾åˆ°å½“å‰å’Œå†å²è¿è¡Œçš„ç®¡é“ ã€‚ç‚¹å‡»ç®¡é“å°†æ˜¾ç¤ºä¸ºè¯¥ç®¡é“è¿è¡Œçš„ä½œä¸šã€‚</li>
<li>æŸ¥çœ‹å·¥ä½œçŠ¶æ€: å½“æ‚¨è®¿é—®å•ä¸ªç®¡é“æ—¶ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°è¯¥ç®¡é“çš„ç›¸å…³ä½œä¸šã€‚ç‚¹å‡»å•ä¸ªä½œä¸šä¼šæ˜¾ç¤ºè¯¥ä½œä¸šè¿è¡Œå†å²ï¼Œå¹¶å…è®¸æ‚¨å–æ¶ˆä½œä¸šï¼Œé‡è¯•ä½œä¸šæˆ–æ¸…é™¤ä½œä¸šè¿è¡Œæ—¥å¿—ã€‚</li>
<li>æŸ¥çœ‹å·¥ä½œå¤±è´¥çš„åŸå› : å½“ç®¡é“å‘ç”Ÿæ•…éšœæˆ–å…è®¸å¤±è´¥æ—¶ï¼Œæœ‰å‡ ä¸ªåœ°æ–¹å¯ä»¥å¿«é€Ÿæ£€æŸ¥å¤±è´¥çš„åŸå› ï¼š<ul>
<li>åœ¨ç®¡é“å›¾ä¸­ å‡ºç°åœ¨ç®¡é“å›¾ä¸­ã€‚</li>
<li>åœ¨ç®¡é“å°éƒ¨ä»¶ä¸­ å‡ºç°åœ¨åˆå¹¶è¯·æ±‚å’Œæäº¤é¡µé¢ä¸­ã€‚</li>
<li>åœ¨å·¥ä½œè§†å›¾ä¸­ å‡ºç°åœ¨å…¨å±€å’Œè¯¦ç»†çš„å·¥ä½œè§†å›¾ä¸­ã€‚</li>
</ul>
</li>
<li>ç®¡é“å›¾ï¼šç®¡é“å¯ä»¥æ˜¯å¤æ‚çš„ç»“æ„ï¼Œå…·æœ‰è®¸å¤šé¡ºåºå’Œå¹³è¡Œçš„ä½œä¸šã€‚ä¸ºäº†è®©æ‚¨æ›´å®¹æ˜“çœ‹åˆ°å‘ç”Ÿäº†ä»€ä¹ˆï¼Œå®ƒå¯ä»¥æŸ¥çœ‹å•ä¸ªç®¡é“åŠå…¶çŠ¶æ€ã€‚<ul>
<li>ç®¡é“å›¾å¯ä»¥é€šè¿‡ä¸¤ç§ä¸åŒçš„æ–¹å¼æ˜¾ç¤ºï¼Œå…·ä½“å–å†³äºæ‚¨æ‰€å¤„çš„é¡µé¢ã€‚</li>
<li>å½“æ‚¨åœ¨å•ä¸ªç®¡é“é¡µé¢ä¸Šæ—¶ï¼Œå¯ä»¥æ‰¾åˆ°æ˜¾ç¤ºæ¯ä¸ªé˜¶æ®µä½œä¸šåç§°çš„å¸¸è§„ç®¡é“å›¾ã€‚</li>
<li>å…¶æ¬¡æœ‰ç®¡é“è¿·ä½ å›¾ï¼Œå ç”¨æ›´å°‘çš„ç©ºé—´ï¼Œå¹¶ä¸”å¯ä»¥å¿«é€Ÿæµè§ˆæ‰€æœ‰ä½œä¸šæ˜¯æˆæœè¿˜æ˜¯å¤±è´¥ã€‚ç®¡é“è¿·ä½ å›¾å¯ä»¥åœ¨æ‚¨è®¿é—®ä»¥ä¸‹,é¡µé¢æ—¶æ‰¾åˆ°ï¼š <code>ç®¡é“ç´¢å¼•é¡µé¢ / æäº¤é¡µé¢ /åˆå¹¶è¯·æ±‚é¡µé¢</code></li>
</ul>
</li>
<li>å°†ç›¸ä¼¼çš„å·¥ä½œåˆ†ç»„: å¦‚æœä½ æœ‰è®¸å¤šç±»ä¼¼çš„å·¥ä½œï¼Œä½ çš„ç®¡é“å›¾ä¼šå˜å¾—å¾ˆé•¿ï¼Œå¾ˆéš¾é˜…è¯»ã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œç±»ä¼¼çš„å·¥ä½œå¯ä»¥è‡ªåŠ¨ç»„åˆåœ¨ä¸€èµ·ã€‚å¦‚æœä½œä¸šåç§°ä»¥æŸç§æ ¼å¼å‘½åï¼Œåˆ™å®ƒä»¬å°†åœ¨å¸¸è§„ç®¡çº¿å›¾ï¼ˆéè¿·ä½ å›¾ï¼‰ä¸­æŠ˜å ä¸ºä¸€ä¸ªç»„ã€‚å¦‚æœæ‚¨æ²¡æœ‰çœ‹åˆ°é‡è¯•æˆ–å–æ¶ˆæŒ‰é’®ï¼Œæ‚¨å°±çŸ¥é“ç®¡é“å°†ä½œä¸šå·²ç»åˆå¹¶åˆ†ç»„äº†ã€‚å°†é¼ æ ‡æ‚¬åœåœ¨ä¸Šé¢ä¼šæ˜¾ç¤ºåˆ†ç»„ä½œä¸šçš„æ•°é‡ã€‚å¯ä»¥ç‚¹å‡»å±•å¼€å®ƒä»¬ã€‚<ul>
<li>åŸºæœ¬è¦æ±‚æ˜¯éœ€ä½¿ç”¨ä»¥ä¸‹æ–¹å¼çš„ä¸€ç§å°†ä¸¤ä¸ªæ•°å­—åˆ†éš”å¼€ï¼ˆå¯ä»¥äº’æ¢ä½¿ç”¨ï¼‰ï¼ˆæŸ¥çœ‹ä¸‹é¢çš„ç¤ºä¾‹ï¼‰ï¼š<code>ç©ºé—´ / æ–œçº¿ï¼ˆ / ï¼‰ / å†’å·ï¼ˆ : ï¼‰</code> æ³¨æ„ï¼š æ›´å‡†ç¡®åœ°è¯´ï¼Œå®ƒä½¿ç”¨è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼š \d+[\s:\/\]+\d+\s* ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è¿™äº›å·¥ä½œå°†é€šè¿‡ä»å·¦åˆ°å³æ¯”è¾ƒè¿™ä¸¤ä¸ªæ•°å­—æ¥è¿›è¡Œæ’åºã€‚é€šå¸¸ç¬¬ä¸€ä¸ªæ˜¯ç´¢å¼•ï¼Œç¬¬äºŒä¸ªæ˜¯æ€»æ•°ã€‚</span></span><br><span class="line"><span class="comment">#ä¾‹å¦‚ï¼Œä»¥ä¸‹ä½œä¸šå°†è¢«åˆ†ç»„åœ¨ä¸€ä¸ªåä¸ºçš„ä½œä¸šä¸‹ test ï¼š</span></span><br><span class="line"><span class="built_in">test</span> 0 3 =&gt; <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span> 1 3 =&gt; <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span> 2 3 =&gt; <span class="built_in">test</span></span><br><span class="line"><span class="comment">#ä»¥ä¸‹ä½œä¸šå°†è¢«åˆ†ç»„åœ¨ä¸‹åˆ—ä½œä¸šä¸­ test ruby ï¼š</span></span><br><span class="line"><span class="built_in">test</span> 1:2 ruby =&gt; <span class="built_in">test</span> ruby</span><br><span class="line"><span class="built_in">test</span> 2:2 ruby =&gt; <span class="built_in">test</span> ruby</span><br><span class="line"><span class="comment">#ä¸‹åˆ—ä½œä¸šä¹Ÿå°†è¢«å½’ç±»åœ¨ä¸€ä¸ªä½œä¸šä¸­ test ruby ï¼š</span></span><br><span class="line">1/3 <span class="built_in">test</span> ruby =&gt; <span class="built_in">test</span> ruby</span><br><span class="line">2/3 <span class="built_in">test</span> ruby =&gt; <span class="built_in">test</span> ruby</span><br><span class="line">3/3 <span class="built_in">test</span> ruby =&gt; <span class="built_in">test</span> ruby</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>æ‰‹åŠ¨æ“ä½œ:æ‰‹åŠ¨æ“ä½œå…è®¸æ‚¨åœ¨ä½¿ç”¨CIä¸­çš„æŒ‡å®šä½œä¸šä¹‹å‰éœ€è¦æ‰‹åŠ¨æ“ä½œã€‚æ•´ä¸ªç®¡é“å¯ä»¥è‡ªåŠ¨è¿è¡Œï¼Œä½†å®é™…éƒ¨ç½²åˆ°ç”Ÿäº§éœ€è¦ç‚¹å‡»ã€‚ï¼ˆåœ¨GitLab 8.15ä¸­å¼•å…¥ï¼‰</li>
<li>ä½œä¸šæ’åº:å¸¸è§„ç®¡é“å›¾åœ¨å•ä¸ªç®¡é“é¡µé¢ä¸­ï¼Œä½œä¸šæŒ‰åç§°æ’åºã€‚</li>
<li>å¤šé¡¹ç›®ç®¡é“å›¾:å¯åœ¨GitLab Premium ã€GitLab Sliveræˆ–æ›´é«˜çº§ç‰ˆæœ¬ä¸­ä½¿ç”¨ã€‚</li>
<li>å¾½ç« ï¼šç®¡é“çŠ¶æ€å’Œæµ‹è¯•èŒƒå›´å†…æŠ¥å‘Šå¾½ç« å¯ç”¨ã€‚æ‚¨å¯ä»¥åœ¨ç®¡é“è®¾ç½®é¡µé¢æ‰¾åˆ°å®ƒä»¬å„è‡ªçš„é“¾æ¥ã€‚</li>
<li>å—ä¿æŠ¤åˆ†è¡Œçš„å®‰å…¨ï¼šç®¡é“åœ¨å—ä¿æŠ¤çš„åˆ†æ”¯ä¸Šæ‰§è¡Œæ—¶ï¼Œå°†æ‰§è¡Œä¸¥æ ¼çš„å®‰å…¨æ¨¡å‹ï¼Œåªæœ‰åœ¨å…è®¸ç”¨æˆ·åˆå¹¶æˆ–æ¨é€ ç‰¹å®šåˆ†æ”¯æ—¶ï¼Œæ‰å…è®¸åœ¨å—ä¿æŠ¤çš„åˆ†æ”¯ä¸Šæ‰§è¡Œä»¥ä¸‹æ“ä½œ ï¼š<ul>
<li>è¿è¡Œæ‰‹åŠ¨ç®¡é“ï¼ˆä½¿ç”¨Web UIæˆ–Pipelines APIï¼‰</li>
<li>è¿è¡Œé¢„å®šçš„ç®¡é“</li>
<li>ä½¿ç”¨è§¦å‘å™¨è¿è¡Œç®¡é“</li>
<li>åœ¨ç°æœ‰ç®¡çº¿ä¸Šè§¦å‘æ‰‹åŠ¨æ“ä½œ</li>
<li>é‡è¯•/å–æ¶ˆç°æœ‰ä½œä¸šï¼ˆä½¿ç”¨Web UIæˆ–Pipelines APIï¼‰</li>
<li>æ ‡è®°ä¸ºå—ä¿æŠ¤çš„å˜é‡ä»…é€‚ç”¨äºåœ¨å—ä¿æŠ¤åˆ†æ”¯ä¸Šè¿è¡Œçš„ä½œä¸šï¼Œä»è€Œé¿å…ä¸å—ä¿¡ä»»çš„ç”¨æˆ·æ— æ„ä¸­è®¿é—®æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚éƒ¨ç½²å‡­è¯å’Œä»¤ç‰Œã€‚</li>
<li>æ ‡è®°ä¸ºå—ä¿æŠ¤çš„Runnersåªèƒ½ä¿æŠ¤åˆ†æ”¯æœºæ„è¿è¡Œçš„ä½œä¸šï¼Œé¿å…ä¸å—ä¿¡ä»»çš„ä»£ç è¦åœ¨ä¿æŠ¤runnerå’Œä¿å­˜éƒ¨ç½²é”®è¢«æ„å¤–åœ°è§¦å‘æˆ–å…¶ä»–å‡­è¯æ‰§è¡Œã€‚ä¸ºäº†ç¡®ä¿æ‰“ç®—åœ¨å—ä¿æŠ¤çš„è·‘æ­¥è€…ä¸Šæ‰§è¡Œçš„å·¥ä½œä¸ä¼šä½¿ç”¨å¸¸è§„runnerï¼Œå¿…é¡»å¯¹å…¶è¿›è¡Œç›¸åº”æ ‡è®°ã€‚</li>
</ul>
</li>
</ul>
<p>Q:å¦‚ä½•è®¡ç®—ç®¡é“æŒç»­æ—¶é—´ï¼Ÿ</p>
<blockquote>
<p>ç®¡é“çš„æ€»è¿è¡Œæ—¶é—´å°†æ’é™¤é‡è¯•å’Œå¾…å¤„ç†ï¼ˆæ’é˜Ÿï¼‰æ—¶é—´ã€‚æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªé—®é¢˜ç¼©å‡ä¸ºå¯»æ‰¾å‘¨æœŸçš„è”åˆã€‚<br>æ‰€ä»¥æ¯ä¸ªå·¥ä½œéƒ½ä¼šè¢«è¡¨ç¤ºä¸º Period ï¼Œå…¶ä¸­åŒ…æ‹¬ Period#first å·¥ä½œå¼€å§‹ Period#last æ—¶å’Œå·¥ä½œå®Œæˆæ—¶ã€‚ä¸€ä¸ªç®€å•çš„ä¾‹å­æ˜¯ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Aï¼ˆ1,3ï¼‰</span><br><span class="line">Bï¼ˆ2,4ï¼‰</span><br><span class="line">Cï¼ˆ6,7ï¼‰</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>è¿™é‡ŒAä»1å¼€å§‹ï¼Œåˆ°3ç»“æŸã€‚Bä»2å¼€å§‹ï¼Œå¹¶åˆ°4ç»“æŸã€‚Cä»6å¼€å§‹ï¼Œåˆ°7ç»“æŸã€‚è§†è§‰ä¸Šå®ƒå¯ä»¥è¢«çœ‹ä½œï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0 1 2 3 4 5 6 7</span><br><span class="line">AAAAAAA</span><br><span class="line">    BBBBBBB</span><br><span class="line">            CCCC</span><br><span class="line"><span class="comment">#Aï¼ŒBå’ŒCçš„è”åˆå°†æ˜¯ï¼ˆ1,4ï¼‰å’Œï¼ˆ6,7ï¼‰ï¼Œå› æ­¤æ€»è¿è¡Œæ—¶é—´åº”è¯¥æ˜¯ï¼š</span></span><br><span class="line"> (4 - 1) + (7 - 6) =&gt; 4</span><br></pre></td></tr></table></figure></p>
<hr>
<h4 id="0x04-Variables"><a href="#0x04-Variables" class="headerlink" title="0x04 Variables"></a>0x04 Variables</h4><p>æè¿°:å½“GitLab CI ä¸­æ¥å—åˆ°ä¸€ä¸ªjobåï¼ŒRunnerå°±å¼€å§‹å‡†å¤‡æ„å»ºç¯å¢ƒã€‚å¼€å§‹è®¾ç½®é¢„å®šä¹‰çš„å˜é‡(ç¯å¢ƒå˜é‡)å’Œç”¨æˆ·è‡ªå®šä¹‰çš„å˜é‡ã€‚<br>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.gitlab.com/ce/ci/variables/README.html" target="_blank" rel="noopener">https://docs.gitlab.com/ce/ci/variables/README.html</a></p>
<p><strong>variables çš„æ‰§è¡Œé¡ºåº</strong></p>
<p>å˜é‡å¯ä»¥è¢«é‡å†™ï¼Œå¹¶ä¸”æ˜¯æŒ‰ç…§ä¸‹é¢çš„é¡ºåºè¿›è¡Œæ‰§è¡Œï¼š</p>
<ul>
<li>1.è§¦å‘å˜é‡æˆ–è®¡åˆ’ç®¡é“å˜é‡ã€‚</li>
<li>2.é¡¹ç›®çº§å˜é‡æˆ–å—ä¿æŠ¤å˜é‡ã€‚</li>
<li>3.ç»„çº§å˜é‡æˆ–å—ä¿æŠ¤å˜é‡ã€‚</li>
<li>4.YAML å®šä¹‰çš„ä½œä¸šçº§å˜é‡ã€‚</li>
<li>5.YAML å®šä¹‰çš„å…¨å±€å˜é‡ã€‚</li>
<li>6.éƒ¨ç½²å˜é‡ã€‚</li>
<li>7.é¢„å®šä¹‰çš„ç¯å¢ƒå˜é‡ã€‚</li>
</ul>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ å®šä¹‰äº†ç§æœ‰å˜é‡ API_TOKEN=secure ï¼Œ<code>å¹¶ä¸”åœ¨ .gitlab-ci.yml ä¸­å®šä¹‰äº† API_TOKEN=yaml</code>ï¼Œé‚£ä¹ˆç§æœ‰å˜é‡ API_TOKEN çš„å€¼å°†æ˜¯ secure ï¼Œå› ä¸ºsecret variablesçš„ä¼˜å…ˆçº§è¾ƒé«˜ã€‚</p>
<ul>
<li>Predefined variables(Environment variables): æœ‰éƒ¨åˆ†é¢„å®šä¹‰çš„ç¯å¢ƒå˜é‡ä»…ä»…åªèƒ½åœ¨æœ€å°ç‰ˆæœ¬çš„GitLab Runnerä¸­ä½¿ç”¨ã€‚<ul>
<li>æ³¨æ„ï¼šä»GitLab 9.0 å¼€å§‹ï¼Œéƒ¨åˆ†å˜é‡å·²ç»ä¸æå€¡ä½¿ç”¨ã€‚è¯·æŸ¥çœ‹9.0 Renamingéƒ¨åˆ†æ¥æŸ¥æ‰¾ä»–ä»¬çš„æ›¿ä»£å˜é‡ã€‚å¼ºçƒˆå»ºè®®ä½¿ç”¨æ–°çš„å˜é‡ï¼Œæˆ‘ä»¬ä¹Ÿä¼šåœ¨å°†æ¥çš„GitLabç‰ˆæœ¬ä¸­å°†ä»–ä»¬ç§»é™¤ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Variable GitLab Runner Description</span><br><span class="line">CI all 0.4 æ ‡è¯†è¯¥jobæ˜¯åœ¨CIç¯å¢ƒä¸­æ‰§è¡Œ</span><br><span class="line">CI_COMMIT_REF_NAME 9.0 all ç”¨äºæ„å»ºé¡¹ç›®çš„åˆ†æ”¯æˆ–tagåç§°</span><br><span class="line">CI_COMMIT_REF_SLUG 9.0 all å…ˆå°† <span class="variable">$CI_COMMIT_REF_NAME</span> çš„å€¼è½¬æ¢æˆå°å†™ï¼Œæœ€ å¤§ä¸èƒ½è¶…è¿‡63ä¸ªå­—èŠ‚ï¼Œç„¶åæŠŠé™¤äº† 0-9 å’Œ a-z çš„å…¶ä»–å­—ç¬¦è½¬æ¢æˆ - ã€‚åœ¨URLså’ŒåŸŸååç§°ä¸­ä½¿ç”¨ã€‚</span><br><span class="line">CI_COMMIT_SHA 9.0 all commitçš„ç‰ˆæœ¬å·</span><br><span class="line">CI_COMMIT_TAG 9.0 0.5 commitçš„tagåç§°ã€‚åªæœ‰åˆ›å»ºäº†tagsæ‰ä¼šå‡ºç°ã€‚</span><br><span class="line">CI_DEBUG_TRACE 9.0 1.7 debug tracingå¼€å¯æ—¶æ‰ç”Ÿæ•ˆ</span><br><span class="line">CI_ENVIRONMENT_NAME 8.15 all jobçš„ç¯å¢ƒåç§°</span><br><span class="line">CI_ENVIRONMENT_SLUG 8.15 all ç¯å¢ƒåç§°çš„ç®€åŒ–ç‰ˆæœ¬ï¼Œé€‚ç”¨äºDNSï¼ŒURLsï¼Œ Kubernetes labelsç­‰</span><br><span class="line">CI_JOB_ID 9.0 all GItLab CIå†…éƒ¨è°ƒç”¨jobçš„ä¸€ä¸ªå”¯ä¸€ID</span><br><span class="line">CI_JOB_MANUAL 8.12 all è¡¨ç¤ºjobå¯ç”¨çš„æ ‡è¯†</span><br><span class="line">CI_JOB_NAME 9.0 0.5 .gitlab-ci.yml ä¸­å®šä¹‰çš„jobçš„åç§°</span><br><span class="line">CI_JOB_STAGE 9.0 0.5 .gitlab-ci.yml ä¸­å®šä¹‰çš„stageçš„åç§°</span><br><span class="line">CI_JOB_TOKEN 9.0 1.2 ç”¨äºåŒGitLabå®¹å™¨ä»“åº“éªŒè¯çš„token</span><br><span class="line">CI_REPOSITORY_URL 9.0 all gitä»“åº“åœ°å€ï¼Œç”¨äºå…‹éš†</span><br><span class="line">CI_RUNNER_DESCRIPTION 8.10 0.5 GitLabä¸­å­˜å‚¨çš„Runneræè¿°</span><br><span class="line">CI_RUNNER_ID 8.10 0.5 Runneræ‰€ä½¿ç”¨çš„å”¯ä¸€ID</span><br><span class="line">CI_RUNNER_TAGS 8.10 0.5 Runnerå®šä¹‰çš„tags</span><br><span class="line">CI_PIPELINE_ID 8.10 0.5 GitLab CI åœ¨å†…éƒ¨ä½¿ç”¨çš„å½“å‰pipelineçš„å”¯ä¸€ID</span><br><span class="line">CI_PIPELINE_TRIGGERED all all ç”¨äºæŒ‡ç¤ºè¯¥jobè¢«è§¦å‘çš„æ ‡è¯†</span><br><span class="line">CI_PROJECT_DIR all all ä»“åº“å…‹éš†çš„å®Œæ•´åœ°å€å’Œjobå…è®¸çš„å®Œæ•´åœ°å€</span><br><span class="line">CI_PROJECT_ID all all GitLab CIåœ¨å†…éƒ¨ä½¿ç”¨çš„å½“å‰é¡¹ç›®çš„å”¯ä¸€ID</span><br><span class="line">CI_PROJECT_NAME 8.10 0.5 å½“å‰æ­£åœ¨æ„å»ºçš„é¡¹ç›®åç§°ï¼ˆäº‹å®ä¸Šæ˜¯é¡¹ç›®æ–‡ä»¶å¤¹</span><br><span class="line">åç§°ï¼‰</span><br><span class="line">CI_PROJECT_NAMESPACE 8.10 0.5 å½“å‰æ­£åœ¨æ„å»ºçš„é¡¹ç›®å‘½åç©ºé—´ï¼ˆç”¨æˆ·åæˆ–è€…æ˜¯ç»„</span><br><span class="line">åç§°ï¼‰</span><br><span class="line">CI_PROJECT_PATH 8.10 0.5 å‘½åç©ºé—´åŠ é¡¹ç›®åç§°</span><br><span class="line">CI_PROJECT_PATH_SLUG 9.3 all <span class="variable">$CI_PROJECT_PATH</span> å°å†™å­—æ¯ã€é™¤äº† 0-9 å’Œ a-zçš„å…¶ä»–å­—æ¯éƒ½æ›¿æ¢æˆ - ã€‚ç”¨äºåœ°å€å’ŒåŸŸååç§°ã€‚</span><br><span class="line">CI_PROJECT_URL 8.10 0.5 é¡¹ç›®çš„è®¿é—®åœ°å€ï¼ˆhttpå½¢å¼ï¼‰</span><br><span class="line">CI_REGISTRY 8.10 0.5 å¦‚æœå¯ç”¨äº†Container Registryï¼Œåˆ™è¿”å›GitLabçš„Container Registryçš„åœ°å€</span><br><span class="line">CI_REGISTRY_IMAGE 8.10 0.5 å¦‚æœä¸ºé¡¹ç›®å¯ç”¨äº†Container Registryï¼Œå®ƒå°†è¿”å›ä¸ç‰¹å®šé¡¹ç›®ç›¸å…³è”çš„æ³¨å†Œè¡¨çš„åœ°å€</span><br><span class="line">CI_REGISTRY_PASSWORD 9.0 all ç”¨äºpush containersåˆ°GitLabçš„Container Registry çš„å¯†ç </span><br><span class="line">CI_REGISTRY_USER 9.0 allç”¨äºpush containersåˆ°GItLabçš„Container Registry çš„ç”¨æˆ·å</span><br><span class="line">CI_SERVER all all æ ‡è®°è¯¥jobæ˜¯åœ¨CIç¯å¢ƒä¸­æ‰§è¡Œ</span><br><span class="line">CI_SERVER_NAME all all ç”¨äºåè°ƒjobçš„CIæœåŠ¡å™¨åç§°</span><br><span class="line">CI_SERVER_REVISION all all ç”¨äºè°ƒåº¦jobçš„GitLabä¿®è®¢ç‰ˆ</span><br><span class="line">CI_SERVER_VERSION all all ç”¨äºè°ƒåº¦jobçš„GItLabç‰ˆæœ¬</span><br><span class="line">ARTIFACT_DOWNLOAD_ATTEMPTS 8.15 1.9 å°è¯•è¿è¡Œä¸‹è½½artifactsçš„jobçš„æ¬¡æ•°</span><br><span class="line">GET_SOURCES_ATTEMPTS 8.15 1.9 å°è¯•è¿è¡Œè·å–æºçš„jobæ¬¡æ•°</span><br><span class="line">GITLAB_CI all all ç”¨äºæŒ‡ç¤ºè¯¥jobæ˜¯åœ¨GItLab CIç¯å¢ƒä¸­è¿è¡Œ</span><br><span class="line">GITLAB_USER_ID 8.12 all å¼€å¯è¯¥jobçš„ç”¨æˆ·ID</span><br><span class="line">GITLAB_USER_EMAIL 8.12 all å¼€å¯è¯¥jobçš„ç”¨æˆ·é‚®ç®±</span><br><span class="line">RESTORE_CACHE_ATTEMPTS 8.15 1.9 å°è¯•è¿è¡Œå­˜å‚¨ç¼“å­˜çš„jobçš„æ¬¡æ•°</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>ä½œä¸šè„šæœ¬ä¸­ç¯å¢ƒå˜é‡çš„è¯­æ³•:æ‰€æœ‰å˜é‡éƒ½è®¾ç½®ä¸ºç”Ÿæˆç¯å¢ƒä¸­çš„ç¯å¢ƒå˜é‡ï¼Œå¹¶ä¸”å®ƒä»¬å¯é€šè¿‡ç”¨äºè®¿é—®æ­¤ç±»å˜é‡çš„æ­£å¸¸æ–¹æ³•è®¿é—®ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ–ç”¨äºæ‰§è¡Œä½œä¸šè„šæœ¬ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">job_name:</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line">    <span class="comment">#bash ä¸­è®¿é—®ç¯å¢ƒå˜é‡ï¼Œä½¿ç”¨ ï¼ˆï¼‰ å‰ç¼€å˜é‡åç§°ï¼š$</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">$CI_JOB_ID</span></span><br><span class="line">    <span class="comment">#Windows æ‰¹å¤„ç†ä¸­çš„ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ä½¿ç”¨ ï¼ˆï¼‰ ç¯ç»•å˜é‡ï¼š%</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">%CI_JOB_ID%</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å‘½ä»¤åˆ—å‡ºæ‰€æœ‰ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line"><span class="attr">  script:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">echo</span> <span class="string">"#Gitlab Variable:"</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">export</span></span><br></pre></td></tr></table></figure>
<p>æ¯”å¦‚ä¸Šé¢å†…ç½®çš„é¢„å®šä¹‰å˜é‡ä»¥åŠRunnerä¸»æœºç¯å¢ƒå˜é‡é»˜è®¤å€¼å¦‚ä¸‹:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">"#Gitlab Variable:"</span></span><br><span class="line"><span class="comment">#Gitlab Variable:</span></span><br><span class="line">$ <span class="built_in">export</span></span><br><span class="line"><span class="built_in">declare</span> -x CATALINA_HOME=<span class="string">"/app/tomcat-9.0.22"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI=<span class="string">"true"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_API_V4_URL=<span class="string">"http://gitlab.weiyigeek.top/api/v4"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_BUILDS_DIR=<span class="string">"/home/gitlab-runner/builds"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_BUILD_BEFORE_SHA=<span class="string">"5bd0b719c43f196c26e3563948834cc863410950"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_BUILD_ID=<span class="string">"86"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_BUILD_NAME=<span class="string">"jobs"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_BUILD_REF=<span class="string">"b022716f52d7905d392bb090acafa358adde2bd6"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_BUILD_REF_NAME=<span class="string">"master"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_BUILD_REF_SLUG=<span class="string">"master"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_BUILD_STAGE=<span class="string">"test"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_BUILD_TOKEN=<span class="string">"[MASKED]"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_COMMIT_BEFORE_SHA=<span class="string">"5bd0b719c43f196c26e3563948834cc863410950"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_COMMIT_BRANCH=<span class="string">"master"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_COMMIT_DESCRIPTION=<span class="string">""</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_COMMIT_MESSAGE=<span class="string">"æ›´æ–° .gitlab-ci.yml"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_COMMIT_REF_NAME=<span class="string">"master"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_COMMIT_REF_PROTECTED=<span class="string">"true"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_COMMIT_REF_SLUG=<span class="string">"master"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_COMMIT_SHA=<span class="string">"b022716f52d7905d392bb090acafa358adde2bd6"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_COMMIT_SHORT_SHA=<span class="string">"b022716f"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_COMMIT_TITLE=<span class="string">"æ›´æ–° .gitlab-ci.yml"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_CONCURRENT_ID=<span class="string">"0"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_CONCURRENT_PROJECT_ID=<span class="string">"0"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_CONFIG_PATH=<span class="string">".gitlab-ci.yml"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_DEFAULT_BRANCH=<span class="string">"master"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_JOB_ID=<span class="string">"86"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_JOB_NAME=<span class="string">"jobs"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_JOB_STAGE=<span class="string">"test"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_JOB_TOKEN=<span class="string">"[MASKED]"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_JOB_URL=<span class="string">"http://gitlab.weiyigeek.top/newproject/secopsdev/-/jobs/86"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_NODE_TOTAL=<span class="string">"1"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_PAGES_DOMAIN=<span class="string">"example.com"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_PAGES_URL=<span class="string">"http://newproject.example.com/secopsdev"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_PIPELINE_ID=<span class="string">"32"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_PIPELINE_IID=<span class="string">"11"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_PIPELINE_SOURCE=<span class="string">"push"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_PIPELINE_URL=<span class="string">"http://gitlab.weiyigeek.top/newproject/secopsdev/pipelines/32"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_PROJECT_DIR=<span class="string">"/home/gitlab-runner/builds/5UmJ5uEC/0/newproject/secopsdev"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_PROJECT_ID=<span class="string">"1"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_PROJECT_NAME=<span class="string">"secopsdev"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_PROJECT_NAMESPACE=<span class="string">"newproject"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_PROJECT_PATH=<span class="string">"newproject/secopsdev"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_PROJECT_PATH_SLUG=<span class="string">"newproject-secopsdev"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_PROJECT_REPOSITORY_LANGUAGES=<span class="string">""</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_PROJECT_TITLE=<span class="string">"SecOpsDev"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_PROJECT_URL=<span class="string">"http://gitlab.weiyigeek.top/newproject/secopsdev"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_PROJECT_VISIBILITY=<span class="string">"private"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_REGISTRY_PASSWORD=<span class="string">"[MASKED]"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_REGISTRY_USER=<span class="string">"gitlab-ci-token"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_REPOSITORY_URL=<span class="string">"http://gitlab-ci-token:[MASKED]@gitlab.weiyigeek.top/newproject/secopsdev.git"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_RUNNER_DESCRIPTION=<span class="string">"TestRunner"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_RUNNER_EXECUTABLE_ARCH=<span class="string">"linux/amd64"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_RUNNER_ID=<span class="string">"1"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_RUNNER_REVISION=<span class="string">"4c96e5ad"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_RUNNER_SHORT_TOKEN=<span class="string">"5UmJ5uEC"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_RUNNER_TAGS=<span class="string">"TestRunner"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_RUNNER_VERSION=<span class="string">"12.9.0"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_SERVER=<span class="string">"yes"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_SERVER_HOST=<span class="string">"gitlab.weiyigeek.top"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_SERVER_NAME=<span class="string">"GitLab"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_SERVER_PORT=<span class="string">"80"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_SERVER_PROTOCOL=<span class="string">"http"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_SERVER_REVISION=<span class="string">"ac5568eb5d8"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_SERVER_URL=<span class="string">"http://gitlab.weiyigeek.top"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_SERVER_VERSION=<span class="string">"12.9.2"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_SERVER_VERSION_MAJOR=<span class="string">"12"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_SERVER_VERSION_MINOR=<span class="string">"9"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_SERVER_VERSION_PATCH=<span class="string">"2"</span></span><br><span class="line"><span class="built_in">declare</span> -x CI_SHARED_ENVIRONMENT=<span class="string">"true"</span></span><br><span class="line"><span class="built_in">declare</span> -x CLASSPATH=<span class="string">".:/usr/local/jdk1.8.0_211/lib/dt.jar:/usr/local/jdk1.8.0_211/lib/tools.jar:%CATALINA_HOME%/lib/servlet-api.jar"</span></span><br><span class="line"><span class="built_in">declare</span> -x CONFIG_FILE=<span class="string">"/etc/gitlab-runner/config.toml"</span></span><br><span class="line"><span class="built_in">declare</span> -x CVS_RSH=<span class="string">"ssh"</span></span><br><span class="line"><span class="built_in">declare</span> -x FF_CMD_DISABLE_DELAYED_ERROR_LEVEL_EXPANSION=<span class="string">"false"</span></span><br><span class="line"><span class="built_in">declare</span> -x FF_NETWORK_PER_BUILD=<span class="string">"false"</span></span><br><span class="line"><span class="built_in">declare</span> -x FF_USE_LEGACY_BUILDS_DIR_FOR_DOCKER=<span class="string">"false"</span></span><br><span class="line"><span class="built_in">declare</span> -x FF_USE_LEGACY_KUBERNETES_EXECUTION_STRATEGY=<span class="string">"true"</span></span><br><span class="line"><span class="built_in">declare</span> -x FF_USE_LEGACY_VOLUMES_MOUNTING_ORDER=<span class="string">"false"</span></span><br><span class="line"><span class="built_in">declare</span> -x GITLAB_CI=<span class="string">"true"</span></span><br><span class="line"><span class="built_in">declare</span> -x GITLAB_FEATURES=<span class="string">""</span></span><br><span class="line"><span class="built_in">declare</span> -x GITLAB_USER_EMAIL=<span class="string">"admin@example.com"</span></span><br><span class="line"><span class="built_in">declare</span> -x GITLAB_USER_ID=<span class="string">"1"</span></span><br><span class="line"><span class="built_in">declare</span> -x GITLAB_USER_LOGIN=<span class="string">"root"</span></span><br><span class="line"><span class="built_in">declare</span> -x GITLAB_USER_NAME=<span class="string">"Administrator"</span></span><br><span class="line"><span class="built_in">declare</span> -x HISTCONTROL=<span class="string">"ignoredups"</span></span><br><span class="line"><span class="built_in">declare</span> -x HISTSIZE=<span class="string">"1000"</span></span><br><span class="line"><span class="built_in">declare</span> -x HOME=<span class="string">"/home/gitlab-runner"</span></span><br><span class="line"><span class="built_in">declare</span> -x HOSTNAME=<span class="string">"initiator"</span></span><br><span class="line"><span class="built_in">declare</span> -x JAVA_HOME=<span class="string">"/usr/local/jdk1.8.0_211"</span></span><br><span class="line"><span class="built_in">declare</span> -x JRE_HOME=<span class="string">"/usr/local/jdk1.8.0_211/jre"</span></span><br><span class="line"><span class="built_in">declare</span> -x LANG=<span class="string">"zh_CN.UTF-8"</span></span><br><span class="line"><span class="built_in">declare</span> -x LESSOPEN=<span class="string">"||/usr/bin/lesspipe.sh %s"</span></span><br><span class="line"><span class="built_in">declare</span> -x LOGNAME=<span class="string">"gitlab-runner"</span></span><br><span class="line"><span class="built_in">declare</span> -x MAIL=<span class="string">"/var/spool/mail/gitlab-runner"</span></span><br><span class="line"><span class="built_in">declare</span> -x MYSQL_HOME=<span class="string">"/usr/local/mysql-5.7.24"</span></span><br><span class="line"><span class="built_in">declare</span> -x OLDPWD=<span class="string">"/home/gitlab-runner"</span></span><br><span class="line"><span class="built_in">declare</span> -x PATH=<span class="string">"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/usr/local/jdk1.8.0_211/bin:/usr/local/mysql-5.7.24/bin:/home/gitlab-runner/.local/bin:/home/gitlab-runner/bin"</span></span><br><span class="line"><span class="built_in">declare</span> -x PWD=<span class="string">"/home/gitlab-runner/builds/5UmJ5uEC/0/newproject/secopsdev"</span></span><br><span class="line"><span class="built_in">declare</span> -x SHELL=<span class="string">"/bin/bash"</span></span><br><span class="line"><span class="built_in">declare</span> -x SHLVL=<span class="string">"2"</span></span><br><span class="line"><span class="built_in">declare</span> -x TOMCAT_HOME=<span class="string">"/app/tomcat-9.0.22"</span></span><br><span class="line"><span class="built_in">declare</span> -x USER=<span class="string">"gitlab-runner"</span></span><br><span class="line"><span class="built_in">declare</span> -x XDG_RUNTIME_DIR=<span class="string">"/run/user/996"</span></span><br><span class="line"><span class="built_in">declare</span> -x XDG_SESSION_ID=<span class="string">"c383"</span></span><br><span class="line"><span class="built_in">declare</span> -x url=<span class="string">"blog.wieyigeek.top"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>9.0 Renaming:æ ¹æ®GitLabçš„å‘½åè§„åˆ™ï¼Œåœ¨9.0ä»¥åå°†ä» build æœ¯è¯­è½¬åˆ° job CIå˜é‡ä¸­ï¼Œå¹¶ä¸”å·²ç»è¢«é‡å‘½åã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">8.x name     9.0+  name</span><br><span class="line">CI_BUILD_ID  -&gt;  CI_JOB_ID</span><br><span class="line">CI_BUILD_REF  -&gt;  CI_COMMIT_SHA</span><br><span class="line">CI_BUILD_TAG  -&gt;  CI_COMMIT_TAG</span><br><span class="line">CI_BUILD_REF_NAME  -&gt;  CI_COMMIT_REF_NAME</span><br><span class="line">CI_BUILD_REF_SLUG  -&gt;  CI_COMMIT_REF_SLUG</span><br><span class="line">CI_BUILD_NAME  -&gt;  CI_JOB_NAME</span><br><span class="line">CI_BUILD_STAGE  -&gt;  CI_JOB_STAGE</span><br><span class="line">CI_BUILD_REPO  -&gt;  CI_REPOSITORY_URL</span><br><span class="line">CI_BUILD_TRIGGERED  -&gt;  CI_PIPELINE_TRIGGERED</span><br><span class="line">CI_BUILD_MANUAL  -&gt;  CI_JOB_MANUAL</span><br><span class="line">CI_BUILD_TOKEN  -&gt;  CI_JOB_TOKEN</span><br></pre></td></tr></table></figure>
</li>
<li><p>gitlab-ci.yaml defined variables:æ³¨æ„ï¼šæ­¤åŠŸèƒ½è¦æ±‚GitLab Runner 0.5æˆ–è€…æ›´é«˜ç‰ˆæœ¬ï¼Œå¹¶ä¸”GitLab CI 7.14æˆ–è€…æ›´é«˜ç‰ˆæœ¬;</p>
<ul>
<li>GitLab CIå…è®¸ä½ å‘ .gitlab-ci.yml ä¸­æ·»åŠ å˜é‡ï¼Œè¿™ä¸ªå˜é‡åœ¨æ„å»ºç¯å¢ƒä¸­è®¾ç½®ã€‚å› æ­¤ï¼Œå˜é‡å°†ä¿å­˜åœ¨å­˜å‚¨ä¸­ï¼Œä»–ä»¬ç”¨äºå­˜å‚¨éæ•æ„Ÿçš„é¡¹ç›®é…ç½®ï¼Œä¾‹å¦‚ï¼š RAILS_ENV æˆ–è€… DATABASE_URL ã€‚</li>
<li>YAMLä¸­å®šä¹‰çš„å˜é‡ä¹Ÿå°†åº”ç”¨åˆ°æ‰€æœ‰åˆ›å»ºçš„æœåŠ¡å®¹å™¨ä¸­ï¼Œå› æ­¤å¯ä»¥å¯¹å®ƒè¿›è¡Œå¾®è°ƒã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœå°†å˜é‡è®¾ç½®ä¸ºå…¨å±€ä»¥ä¸‹ï¼ˆä¸æ˜¯åœ¨ä¸€ä¸ªä½œä¸šä¸­ï¼‰ï¼Œåˆ™å®ƒå°†ç”¨äºæ‰€æœ‰æ‰§è¡Œçš„å‘½ä»¤è„šæœ¬ä¸­ï¼š</span></span><br><span class="line">variables:</span><br><span class="line">  DATABASE_URL: <span class="string">"postgres://postgres@postgres/my_database"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å˜é‡å¯ä»¥å®šä¹‰ä¸ºå…¨å±€ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å®šä¹‰ä¸ºjobçº§åˆ«ã€‚è‹¥è¦å…³é—­ä½œä¸šä¸­çš„å…¨å±€å®šä¹‰å˜é‡ï¼Œè¯·å®šä¹‰ä¸€ä¸ªç©ºhashï¼š</span></span><br><span class="line">job_name:</span><br><span class="line">  variables: &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‚¨å¯ä»¥åœ¨å˜é‡å®šä¹‰ä¸­ä½¿ç”¨å…¶ä»–å˜é‡ï¼ˆæˆ–ä½¿ç”¨$$å°†å…¶è½¬ä¹‰ï¼‰ï¼š</span></span><br><span class="line">variables:</span><br><span class="line">  LS_CMD: <span class="string">'ls $FLAGS $$TMP_DIR'</span></span><br><span class="line">  FLAGS: <span class="string">'-al'</span></span><br><span class="line">script:</span><br><span class="line">  - <span class="string">'eval $LS_CMD'</span> <span class="comment"># will execute 'ls -al $TMP_DIR'</span></span><br></pre></td></tr></table></figure>
æ‰§è¡Œç»“æœ:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">jobs</span>:</span><br><span class="line">  variables:</span><br><span class="line">    LS_CMD: <span class="string">'whoami'</span></span><br><span class="line">    USERNAME: <span class="string">'weiyigeek'</span></span><br><span class="line">  script:</span><br><span class="line">      - <span class="string">"echo -e\"# <span class="variable">$LS_CMD</span> \n<span class="variable">$USERNAME</span>\""</span> <span class="comment"># will execute 'ls -al $TMP_DIR'</span></span><br><span class="line">       - <span class="string">'eval $LS_CMD'</span></span><br><span class="line">$ <span class="built_in">echo</span> -e <span class="string">"&gt; <span class="variable">$LS_CMD</span>  # collapsed multi-line command</span></span><br><span class="line"><span class="string"># whoami </span></span><br><span class="line"><span class="string">weiyigeek </span></span><br><span class="line"><span class="string">$ eval <span class="variable">$LS_CMD</span></span></span><br><span class="line"><span class="string">gitlab-runner</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Secret variables:å®‰å…¨å˜é‡</p>
<ul>
<li>GitLab CIå…è®¸ä½ åœ¨æ„å»ºç¯å¢ƒè¿‡ç¨‹ä¸­è®¾ç½®é¡¹ç›®çš„ç§æœ‰å˜é‡ã€‚ç§æœ‰å˜é‡å­˜å‚¨åœ¨ä»“åº“(.gitlab-ci.yml)ä¸­ï¼Œå¹¶è¢«å®‰å…¨çš„ä¼ é€’ç»™GitLab Runnerï¼Œä½¿å…¶åœ¨æ„å»ºç¯å¢ƒä¸­å¯ç”¨ã€‚å»ºè®®ä½¿ç”¨è¯¥æ–¹æ³•å­˜å‚¨è¯¸å¦‚å¯†ç ã€ç§˜é’¥å’Œå‡­æ®ä¹‹ç±»çš„ä¸œè¥¿ã€‚</li>
<li>å¯ç”¨é€šè¿‡Settings â” Pipelinesæ¥å¢åŠ ç§æœ‰å˜é‡ï¼Œé€šè¿‡Settings â” Pipelinesæ‰¾åˆ°çš„æ¨¡å—ç§°ä¹‹ä¸ºç§æœ‰å˜é‡ã€‚<code>ä¸€æ¬¡è®¾ç½®ï¼Œæ‰€æœ‰çš„åç»­pipelineæ˜¯éƒ½å¯ä»¥ä½¿ç”¨å®ƒä»¬</code>ã€‚</li>
</ul>
</li>
<li><p>Protected secret variables</p>
<ul>
<li>ç§æœ‰å˜é‡å¯ä»¥è¢«ä¿æŠ¤ã€‚æ¯å½“ä¸€ä¸ªç§æœ‰å˜é‡è¢«ä¿æŠ¤æ—¶ï¼Œå®ƒåªä¼šå®‰å…¨çš„ä¼ é€’åˆ°åœ¨å—ä¿æŠ¤çš„åˆ†æ”¯æˆ–å—ä¿æŠ¤çš„æ ‡ç­¾ä¸Šè¿è¡Œçš„pipelineã€‚å…¶ä»–çš„pipelineå°†ä¸ä¼šå¾—åˆ°å—ä¿æŠ¤çš„å˜é‡</li>
<li>å¯ç”¨é€šè¿‡Settings â” Pipelinesæ¥å¢åŠ ç§æœ‰å˜é‡ï¼Œé€šè¿‡Settings â” Pipelinesæ‰¾åˆ°çš„æ¨¡å—ç§°ä¹‹ä¸ºç§æœ‰å˜é‡ï¼Œç„¶åç‚¹å‡»Protectedã€‚</li>
</ul>
</li>
<li><p>Deploment variables</p>
<ul>
<li>è´Ÿè´£éƒ¨ç½²é…ç½®çš„é¡¹ç›®æœåŠ¡å¯ä»¥å®šä¹‰åœ¨æ„å»ºç¯å¢ƒä¸­è®¾ç½®è‡ªå·±çš„å˜é‡ã€‚è¿™äº›å˜é‡åªå®šä¹‰ç”¨äºéƒ¨ç½²jobã€‚è¯·å‚è€ƒæ‚¨æ­£åœ¨ä½¿ç”¨çš„é¡¹ç›®æœåŠ¡çš„æ–‡æ¡£ï¼Œä»¥äº†è§£ä»–ä»¬å®šä¹‰çš„å˜é‡ã€‚</li>
</ul>
</li>
<li><p>Debug tracing:å¯ç”¨è°ƒè¯•è·Ÿè¸ª</p>
<ul>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼ŒGitLab Runnerä¼šéšè—äº†å¤„ç†jobæ—¶æ­£åœ¨åšçš„å¤§éƒ¨åˆ†ç»†èŠ‚ã€‚è¿™ç§è¡Œä¸ºä½¿jobè·Ÿè¸ªå¾ˆçŸ­ï¼Œå¹¶ä¸”é˜²æ­¢ç§˜å¯†æ³„éœ²åˆ°è·Ÿè¸ªä¸­ï¼Œé™¤éæ‚¨çš„è„šæœ¬å°†ä»–ä»¬è¾“å‡ºåˆ°å±å¹•ä¸­ã€‚</li>
<li>å¦‚æœjobæ²¡æœ‰æŒ‰ç…§é¢„æœŸçš„è¿è¡Œï¼Œè¿™ä¹Ÿä¼šè®©é—®é¢˜æŸ¥æ‰¾å˜å¾—æ›´åŠ å›°éš¾ï¼›åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥åœ¨ .gitlab-ci.yml ä¸­å¼€å¯è°ƒè¯•è®°å½•ã€‚å®ƒéœ€è¦GitLab Runner v1.7ç‰ˆæœ¬ä»¥ä¸Šï¼Œæ­¤åŠŸèƒ½å¯å¯ç”¨shellçš„æ‰§è¡Œè®°å½•ï¼Œä»è€Œäº§ç”Ÿè¯¦ç»†çš„jobè®°å½•ï¼Œåˆ—å‡ºæ‰€æœ‰æ‰§è¡Œçš„å‘½ä»¤ï¼Œè®¾ç½®å˜é‡ç­‰ã€‚<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è®¾ç½® CI_DEBUG_TRACE å˜é‡çš„å€¼ä¸º true æ¥å¼€å¯è°ƒè¯•è®°å½•ã€‚</span></span><br><span class="line"><span class="attr">job_name:</span></span><br><span class="line"><span class="attr">  variables:</span></span><br><span class="line"><span class="attr">    CI_DEBUG_TRACE:</span> <span class="string">"true"</span></span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=æŒç»­é›†æˆgitlab-ci.ymlé…ç½®æ–‡æ¡£åŸºç¡€ href="https://img.weiyigeek.top/2020/1/20200419123703.png" target="_blank" title="WeiyiGeek.Debug" data-fancybox="images"><img src="https://img.weiyigeek.top/2020/1/20200419123703.png" alt="WeiyiGeek.Debug" title="" class=""></a>
                <p>WeiyiGeek.Debug</p>
            </figure></li>
<li>è­¦å‘Šï¼šå¯ç”¨è°ƒè¯•è·Ÿè¸ªå¯èƒ½ä¼šä¸¥é‡çš„å®‰å…¨éšæ‚£ã€‚è¾“å‡ºå†…å®¹å°†åŒ…å«æ‰€æœ‰çš„ç§æœ‰å˜é‡å’Œå…¶ä»–çš„éšç§ï¼è¾“å‡ºçš„å†…å®¹å°†è¢«ä¸Šä¼ åˆ°GitLabæœåŠ¡å™¨å¹¶ä¸”å°†ä¼šåœ¨jobè®°å½•ä¸­æ˜æ˜¾ä½“ç°ã€‚</li>
</ul>
</li>
</ul>

        </div>
        
        <!-- Google å¹¿å‘Š -->
          

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>
  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·ä¸Visit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº" >
    <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ã€è½¬ä¸ªå‘ã€èµä¸ªåŠ©ã€‘</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°†æŒç»­æ•´ç†å‘å¸ƒæ›´å¤šä¼˜è´¨åŸåˆ›æ–‡ç« ï¼ã€‚</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2023-01-31T02:29:10.467Z" itemprop="dateUpdated">2023-01-31 10:29:10</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/CI-CD/GitLab-CI/2.åŸºäºGitlabä»£ç ä»“åº“çš„æŒç»­é›†æˆgitlab-ci.ymlåŸºç¡€é…ç½®.md" target="_blank" rel="noopener noreferrer">_posts/ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/CI-CD/GitLab-CI/2.åŸºäºGitlabä»£ç ä»“åº“çš„æŒç»­é›†æˆgitlab-ci.ymlåŸºç¡€é…ç½®.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2020/4-22-272.html" target="_blank" rel="external">https://blog.weiyigeek.top/2020/4-22-272.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">â˜•ï¸ è¯·ä½œè€…å–æ¯å’–å•¡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gitlab/" rel="tag">gitlab</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/4-22-272.html&title=ã€ŠæŒç»­é›†æˆgitlab-ci.ymlé…ç½®æ–‡æ¡£åŸºç¡€ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/4-22-272.html&title=ã€ŠæŒç»­é›†æˆgitlab-ci.ymlé…ç½®æ–‡æ¡£åŸºç¡€ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/4-22-272.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠæŒç»­é›†æˆgitlab-ci.ymlé…ç½®æ–‡æ¡£åŸºç¡€ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/4-22-272.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/4-22-272.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2020/4-23-476.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">EtcdåŸºç¡€å­¦ä¹ ä¹‹æ¶æ„åŠå·¥ä½œåŸç†</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2020/4-22-307.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Redis-KVæ•°æ®åº“Javaè¿æ¥ä»¥åŠJedisåŒ…çš„ä½¿ç”¨</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x00-ç®€è¿°"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 ç®€è¿°</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x01-é…ç½®æ–‡æ¡£"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 é…ç½®æ–‡æ¡£</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x02-ä»“åº“ç›¸å…³"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 ä»“åº“ç›¸å…³</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x03-ç®¡é“ä»‹ç»"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x03 ç®¡é“ä»‹ç»</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x04-Variables"><span class="post-toc-number">5.</span> <span class="post-toc-text">0x04 Variables</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    

    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå°±è¯·ä½œè€…å–æ¯ Coffee â˜•ï¸â˜•ï¸!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="/img/share-wechat.jpg" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">åšä¸»Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">åšä¸»Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">çŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.modb.pro/u/506690" target="_blank">å¢¨å¤©è½®</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.ixigua.com/home/3984243135350727" target="_blank">è¥¿ç“œè§†é¢‘</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2023 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/><a id="SiteRunTime"></a>
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener">
            <img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto">
          </a>
        </div>
      </p>
    </div>
</footer>



    <div class="mask" id="mask"></div>

<div id="go" class="waves-effect waves-light">
  <a href="javascript:;" id="goqrcode"> <span class="icon icon-lg icon-qrcode"></span> </a>
  <a href="javascript:;" id="gotop"> <span class="icon icon-lg icon-chevron-up"></span></a>
</div>





<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/4-22-272.html&title=ã€ŠæŒç»­é›†æˆgitlab-ci.ymlé…ç½®æ–‡æ¡£åŸºç¡€ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/4-22-272.html&title=ã€ŠæŒç»­é›†æˆgitlab-ci.ymlé…ç½®æ–‡æ¡£åŸºç¡€ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/4-22-272.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠæŒç»­é›†æˆgitlab-ci.ymlé…ç½®æ–‡æ¡£åŸºç¡€ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/4-22-272.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/4-22-272.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACL0lEQVR42u3aQXKDMAwF0N7/0nTbmTTJl0Q6tf1YdVLAPBZClvT1FR/XjyP57/VwPLsqX+WGAwMDY1nG9fJ4fU6Oefboj78n6/5yHwwMjAMYn7h1fs6EjYGBgZGncZNf8nUxMDAwqgE333z+6+8GBgbGIoxkE5sslhfakqs+shfHwMBYkJFX3f/+74/0NzAwMJZiXMWjep9e4lh+KgwMjK0ZeYBL0sH5hnbyPBgYGLsyqlvNfLG7CnDRLxgYGMcw7hqe6BX9q83OcoaLgYGxESNP9XqNgcngRZQaYmBgbMqYJG3VFDMf7Ci8PgwMjK0Z+ehDNQV8HUCrzcuowYmBgbEpYzKdUW12zpsBT6/CwMA4gDEZtuhtU5NAnH8SMDAw9mbkSVuyKZ2Pjs03zBgYGPsxqsMQeXjthexqmQ8DA+McRrJwNSDmxbLqqMdoZgQDA2NZxiSO5a8gKajlZza/GxgYGAsy5sjeZjUfKSuniRgYGJsy8lJ+/hC98lzeNngzcoGBgbEpIwlz1fSuh29urTEwMA5gTAYmqqW6JK/LS3UYGBjnMKpNxx5+XlaLpkUwMDA2YswL/VVqHmSTF4GBgXECoxrm8mZANQT30sRmrwMDA2NBRq9AVl24V9orBHQMDIwDGL3UrTp+0RvsiJAYGBgYrYfIA251wOLNzAgGBgbGrWG3N1h2W8DFwMBYilFtBkyGMHov5bZyGwYGxoKMyaTGZPM5SSibjUwMDIz1GN8g6NE/QF6k6wAAAABJRU5ErkJggg==" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  





<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
<script type="text/javascript">
// ç«™ç‚¹è¿è¡Œæ—¶é—´
var BootDate = new Date("2018/01/01 00:00:00");
function ShowRunTime(id) {
  var NowDate = new Date();
  var RunDateM = parseInt(NowDate - BootDate);
  var RunDays = Math.floor(RunDateM/(24*3600*1000));
  var RunHours = Math.floor(RunDateM%(24*3600*1000)/(3600*1000));
  var RunMinutes = Math.floor(RunDateM%(24*3600*1000)%(3600*1000)/(60*1000));
  var RunSeconds = Math.round(RunDateM%(24*3600*1000)%(3600*1000)%(60*1000)/1000);
  var RunTime = RunDays + "å¤©" + RunHours + "æ—¶" + RunMinutes + "åˆ†" + RunSeconds + "ç§’";
  document.getElementById(id).innerHTML = "ç½‘ç«™å·²åœ¨é£é›¨ä¸­å‹‰å‹‰å¼ºå¼ºè¿è¡Œäº†ã€" + RunTime + "ã€‘";
}
setInterval("ShowRunTime('SiteRunTime')", 1000);
</script>
</body>
</html>