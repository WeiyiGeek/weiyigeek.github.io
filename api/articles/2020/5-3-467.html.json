{"title":"Dockerå®¹å™¨é•œåƒä½“ç§¯ç¼©å°æŠ€å·§","slug":"è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Docker/å¥‡æŠ€æ·«å·§/1.Dockerå®¹å™¨é•œåƒä½“ç§¯ç¼©å°æŠ€å·§","date":"2020-05-03T06:36:30.000Z","updated":"2022-02-16T03:10:28.530Z","url":"2020/5-3-467.html","path":"api/articles/2020/5-3-467.html.json","covers":null,"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x01-å‰è¨€ç®€è¿°\"><a href=\"#0x01-å‰è¨€ç®€è¿°\" class=\"headerlink\" title=\"0x01 å‰è¨€ç®€è¿°\"></a>0x01 å‰è¨€ç®€è¿°</h4><p>æè¿°:å‰é¢æˆ‘ä»¬å­¦ä¹ å¹¶ä¸”è®°å½•äº† Dockerfile æœ€ä½³å®è·µçš„ä¸€äº›è§„åˆ™ï¼Œä½†æ˜¯ä»…ä»…åœåœ¨ç†è®ºä¸­å¹¶ä¸æ˜¯æˆ‘çš„é£æ ¼ï¼Œæ‰€ä»¥å‡ºç°äº†æœ¬ç¯‡æ–‡ç« åŒæ—¶ä¹ŸåŠ æ·±å­¦ä¹ ;<br>ä»æœ€ä½³å®è·µåŸåˆ™æˆ‘ä»¬çŸ¥é“è¦ç¼©å°é•œåƒå¤§å°ï¼Œä¸é€‰æ‹©çš„åŸºç¡€é•œåƒæ˜¯éå¸¸æœ‰å…³ç³»çš„ï¼Œæ¯”å¦‚<code>buysbox (å·¥å…·ç®±)ä¸alpine (æ“ä½œç³»ç»Ÿ)</code>é•œåƒå°çš„æ‚¨è¶…å‡ºæ‚¨çš„æƒ³è±¡,éœ€è¦<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull alpine  <span class=\"comment\"># å®¹å™¨ä¸­æœ€å°çš„Linuxå‘è¡Œç‰ˆ</span></span><br><span class=\"line\">docker pull busybox <span class=\"comment\"># åµŒå…¥å¼ä»¥åŠç‰©è”ç½‘ç³»ç»Ÿä¸­æœ€å¸¸ç”¨çš„Linuxä¸‹çš„å·¥å…·ç®±</span></span><br><span class=\"line\">docker images | grep -E <span class=\"string\">\"busybox|alpine\"</span></span><br><span class=\"line\">busybox                              latest              c7c37e472d31        3 weeks ago         1.22MB</span><br><span class=\"line\">alpine                               latest              a24bb4013296        8 weeks ago         5.57MB</span><br></pre></td></tr></table></figure></p>\n<p>å¯¹äºåˆšæ¥è§¦å®¹å™¨çš„äººæ¥è¯´ä»–ä»¬å¾ˆå®¹æ˜“è¢«è‡ªå·±æ„å»ºçš„ Docker é•œåƒä½“ç§¯å“åˆ°ï¼Œæˆ‘åªéœ€è¦ä¸€ä¸ªå‡  MB çš„å¯æ‰§è¡Œæ–‡ä»¶è€Œå·²ï¼Œä¸ºä½•é•œåƒçš„ä½“ç§¯ä¼šè¾¾åˆ° 1 GB ä»¥ä¸Šï¼Ÿ<br>ç­”:ç›¸ä¿¡ä¸‹é¢çš„å¥‡æŠ€æ·«å·§ä¼šå¸®åŠ©ä½ ç²¾ç®€é•œåƒï¼ŒåŒæ—¶åˆä¸ç‰ºç‰²å¼€å‘äººå‘˜å’Œè¿ç»´äººå‘˜çš„æ“ä½œä¾¿åˆ©æ€§ã€‚</p>\n<p><br></p>\n<p>åŸºç¡€ç¯å¢ƒ.å®éªŒ(å®è·µ)ç¯å¢ƒå‡†å¤‡:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@k8s-yum-server ~]<span class=\"comment\"># cat /etc/system-release</span></span><br><span class=\"line\">CentOS Linux release 7.8.2003 (Core)</span><br><span class=\"line\"></span><br><span class=\"line\">[root@k8s-yum-server ~]<span class=\"comment\"># uname -r</span></span><br><span class=\"line\">5.7.0-1.el7.elrepo.x86_64</span><br></pre></td></tr></table></figure></p>\n<hr>\n<h4 id=\"0x02-Docker-æœ€ä½³å®è·µè¡¥å……\"><a href=\"#0x02-Docker-æœ€ä½³å®è·µè¡¥å……\" class=\"headerlink\" title=\"0x02 Docker æœ€ä½³å®è·µè¡¥å……\"></a>0x02 Docker æœ€ä½³å®è·µè¡¥å……</h4><ul>\n<li><p>(1) å»ºç«‹ä¸€ä¸ªç©ºç™½ç›®å½•è¿›è¡Œæ„å»ºä¸Šä¸‹æ–‡å‡†å¤‡,<span style=\"color:red\">åˆ‡è®°ä¸è¦åœ¨å®¶é‡Œå½•ä¸‹åˆ›å»ºä¸€ä¸ª Dockerfile ç´§æ¥ç€ docker build ä¸€æŠŠæ¢­</span></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ­£ç¡®åšæ³•æ˜¯ä¸ºé¡¹ç›®å»ºç«‹ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ŒæŠŠæ„å»ºé•œåƒæ—¶æ‰€éœ€è¦çš„èµ„æºæ”¾åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹</span></span><br><span class=\"line\">mkdir /opt/project &amp;&amp; <span class=\"built_in\">cd</span> !$</span><br><span class=\"line\">vi Dockerfile <span class=\"comment\"># ç¼–å†™ Dockerfile</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>Tips:ä¹Ÿå¯ä»¥é€šè¿‡ <code>.dockerignore</code> æ–‡ä»¶æ¥å¿½ç•¥ä¸éœ€è¦çš„æ–‡ä»¶å‘é€åˆ° docker å®ˆæŠ¤è¿›ç¨‹</li>\n</ul>\n</li>\n<li><p>(2) ä½¿ç”¨ä½“ç§¯è¾ƒå°çš„åŸºç¡€é•œåƒï¼Œæ¯”å¦‚ alpine æˆ–è€… debian:buster-slimï¼Œåƒ openjdk å¯ä»¥é€‰ç”¨openjdk:8-slimï¼›</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$docker</span> pull debian:buster-slim</span><br><span class=\"line\"><span class=\"variable\">$docker</span> pull openjdk:8-slim</span><br><span class=\"line\"><span class=\"variable\">$docker</span> images</span><br><span class=\"line\">REPOSITORY   TAG             SIZE</span><br><span class=\"line\">debian       buster-slim     69.2MB  </span><br><span class=\"line\">busybox      latest          1.22MB  <span class=\"comment\"># ä¸å»ºè®®é‡‡ç”¨æ„å»ºå¤ªè¿‡è€—æ—¶ä»¥åŠè°ƒè¯•</span></span><br><span class=\"line\">alpine       latest          5.57MB  <span class=\"comment\"># æ¨è</span></span><br><span class=\"line\">centos       latest          220MB   <span class=\"comment\"># ä¸å»ºè®®é‡‡ç”¨åŸºç¡€é•œåƒ</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>Tips:ç”±äº openjdk æ˜¯åŸºäº debian çš„åŸºç¡€é•œåƒæ„å»ºçš„ï¼Œæ‰€ä»¥å‘ debian åŸºç¡€é•œåƒä¸€æ ·åé¢å¸¦ä¸ª slim å°±æ˜¯åŸºäº debian:xxx-slim é•œåƒæ„å»ºçš„ã€‚</li>\n<li>Tips:alpine çš„ c åº“æ˜¯<code>musl libc</code> è€Œä¸æ˜¯æ­£ç»Ÿçš„ glibc åº“ï¼Œå¦å¤–å¯¹äºä¸€äº›ä¾èµ– glibc çš„å¤§å‹é¡¹ç›®åƒ <code>openjdk ã€tomcatã€rabbitmq</code> ç­‰éƒ½ä¸å»ºè®®ä½¿ç”¨ alpine åŸºç¡€é•œåƒï¼Œå› ä¸º musl libc å¯èƒ½ä¼šå¯¼è‡´ jvm ä¸€äº›å¥‡æ€ªçš„é—®é¢˜,è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ tomcat å®˜æ–¹æ²¡æœ‰ç»™å‡ºåŸºç¡€é•œåƒæ˜¯ alpine çš„ Dockerfile çš„åŸå› ã€‚</li>\n</ul>\n</li>\n<li><p>(3) æ›´æ”¹ä¸ºå›½å†…é•œåƒè½¯ä»¶æºï¼Œæå‡å®¹å™¨æ„å»ºé€Ÿåº¦ç›®å‰å›½å†…ç¨³å®šå¯é çš„é•œåƒç«™ä¸»è¦æœ‰ï¼Œåä¸ºäº‘ã€é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€163ç­‰ã€‚</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># alpine åŸºç¡€é•œåƒä¿®æ”¹è½¯ä»¶æº</span></span><br><span class=\"line\">RUN <span class=\"built_in\">echo</span> <span class=\"string\">\"http://mirrors.huaweicloud.com/alpine/latest-stable/main/\"</span> &gt; /etc/apk/repositories ;\\</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"http://mirrors.huaweicloud.com/alpine/latest-stable/community/\"</span> &gt;&gt; /etc/apk/repositories ;\\</span><br><span class=\"line\">apk update ;\\</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># debian åŸºç¡€é•œåƒä¿®æ”¹è½¯ä»¶æº</span></span><br><span class=\"line\">sed -i <span class=\"string\">'s/deb.debian.org/mirrors.huaweicloud.com/g'</span> /etc/apt/sources.list ;\\</span><br><span class=\"line\">sed -i <span class=\"string\">'s|security.debian.org/debian-security|mirrors.huaweicloud.com/debian-security|g'</span> /etc/apt/sources.list ;\\</span><br><span class=\"line\">apt update ;\\</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Ubuntu åŸºç¡€é•œåƒä¿®æ”¹è½¯ä»¶æº</span></span><br><span class=\"line\">sed -i <span class=\"string\">'s/archive.ubuntu.com/mirrors.huaweicloud.com/g'</span> /etc/apt/sources.list</span><br><span class=\"line\">apt update ;\\</span><br></pre></td></tr></table></figure>\n<ul>\n<li>Tips: å»ºè®®æ›´æ–°è½¯ä»¶æºæ—¶å€™RUNæŒ‡ä»¤æ”¾åœ¨é•œåƒæè¿°åçš„é¦–æ¡ï¼Œç„¶åå†updateè½¯ä»¶æºä»¥åŠinstallç›¸åº”çš„è½¯ä»¶åŒ…;</li>\n</ul>\n</li>\n<li><p>(4) é•œåƒæ—¶åŒºè®¾ç½®ç”±äºç»å¤§å¤šæ•°åŸºç¡€é•œåƒéƒ½æ˜¯é»˜è®¤é‡‡ç”¨UTCçš„æ—¶åŒºä¸åŒ—äº¬æ—¶é—´ç›¸å·®8ä¸ªå°æ—¶,å°†ä¼šä¼šå¯¼è‡´å®¹å™¨å†…çš„æ—¶é—´ä¸åŒ—äº¬æ—¶é—´ä¸ä¸€è‡´ï¼Œå› è€Œä¼šå¯¹ä¸€äº›åº”ç”¨é€ æˆä¸€äº›å½±å“ï¼Œè¿˜ä¼šå½±å“å®¹å™¨å†…æ—¥å¿—å’Œç›‘æ§çš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ“ä½œè¿›è¡Œè§£å†³;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ–¹å¼1.é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡æ¥è®¾å®šå®¹å™¨å†…çš„æ—¶åŒºã€‚</span></span><br><span class=\"line\">-e TZ=Asia/Shanghai</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  debianè®¾ç½®ä¸¤ç§æ–¹å¼</span></span><br><span class=\"line\"><span class=\"comment\"># -å¯åŠ¨æ—¶è®¾å®šç¯å¢ƒå˜é‡æŒ‡å®šæ—¶åŒº</span></span><br><span class=\"line\">docker run --rm -it -e TZ=Asia/Shanghai debian date</span><br><span class=\"line\"><span class=\"comment\"># -æ„å»ºé•œåƒçš„æ—¶å€™å¤åˆ¶æ—¶åŒºæ–‡ä»¶è®¾å®šå®¹å™¨å†…æ—¶åŒº</span></span><br><span class=\"line\">cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime ;\\</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"Asia/shanghai\"</span> &gt; /etc/timezone ;\\</span><br></pre></td></tr></table></figure>\n<ul>\n<li>Tips: alpine åŸºç¡€é•œåƒæ— æ³•é€šè¿‡ TZ ç¯å¢ƒå˜é‡çš„æ–¹å¼è®¾å®šæ—¶åŒºï¼Œéœ€è¦å®‰è£… tzdata æ¥é…ç½®æ—¶åŒºä¹Ÿå¯ä»¥åœ¨ RUN æŒ‡ä»¤åé¢è¿½åŠ ä¸Šæ—¶åŒºå¤åˆ¶åˆ°/etc/localtimeå‘½ä»¤;<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ–¹å¼1</span></span><br><span class=\"line\">docker run --rm -it -e TZ=Asia/Shanghai alpine date</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ–¹å¼2</span></span><br><span class=\"line\">apk add --no-cache tzdata ;\\</span><br><span class=\"line\">cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime ;\\</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"Asia/Shanghai\"</span> &gt; /etc/timezone ;\\</span><br><span class=\"line\">apk del tzdata ;\\</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n<li><p>(5) ä½¿ç”¨URLæ·»åŠ æºç ,å¦‚æœä¸é‡‡ç”¨åˆ†é˜¶æ®µæ„å»ºå¯¹äºä¸€äº›éœ€è¦åœ¨å®¹å™¨å†…è¿›è¡Œç¼–è¯‘çš„é¡¹ç›®,æœ€å¥½é€šè¿‡ git æˆ–è€… wegt çš„æ–¹å¼å°†æºç æ‰“å…¥åˆ°é•œåƒå†…ï¼Œè€Œéé‡‡ç”¨ ADD æˆ–è€… COPY ï¼Œå› ä¸ºæºç ç¼–è¯‘å®Œæˆä¹‹åæºç å°±ä¸éœ€è¦å¯ä»¥åˆ æ‰äº†ï¼Œè€Œé€šè¿‡ ADD æˆ–è€… COPY æ·»åŠ è¿›å»çš„æºç å·²ç»ç”¨åœ¨ä¸‹ä¸€å±‚é•œåƒä¸­äº†æ˜¯åˆ ä¸æ‰æ»´å•¦;</p>\n<ul>\n<li>é¡¹ç›®å®˜æ–¹çš„ Dockerfile<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># centos 7</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> centos:<span class=\"number\">7</span></span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ é…ç½®æ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"comment\"># add profiles</span></span><br><span class=\"line\"><span class=\"keyword\">ADD</span><span class=\"bash\"> conf/client.conf /etc/fdfs/</span></span><br><span class=\"line\"><span class=\"keyword\">ADD</span><span class=\"bash\"> conf/http.conf /etc/fdfs/</span></span><br><span class=\"line\"><span class=\"keyword\">ADD</span><span class=\"bash\"> conf/mime.types /etc/fdfs/</span></span><br><span class=\"line\"><span class=\"keyword\">ADD</span><span class=\"bash\"> conf/storage.conf /etc/fdfs/</span></span><br><span class=\"line\"><span class=\"keyword\">ADD</span><span class=\"bash\"> conf/tracker.conf /etc/fdfs/</span></span><br><span class=\"line\"><span class=\"keyword\">ADD</span><span class=\"bash\"> fastdfs.sh /home</span></span><br><span class=\"line\"><span class=\"keyword\">ADD</span><span class=\"bash\"> conf/nginx.conf /etc/fdfs/</span></span><br><span class=\"line\"><span class=\"keyword\">ADD</span><span class=\"bash\"> conf/mod_fastdfs.conf /etc/fdfs</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ æºæ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"comment\"># add source code</span></span><br><span class=\"line\"><span class=\"keyword\">ADD</span><span class=\"bash\"> <span class=\"built_in\">source</span>/libfastcommon.tar.gz /usr/<span class=\"built_in\">local</span>/src/</span></span><br><span class=\"line\"><span class=\"keyword\">ADD</span><span class=\"bash\"> <span class=\"built_in\">source</span>/fastdfs.tar.gz /usr/<span class=\"built_in\">local</span>/src/</span></span><br><span class=\"line\"><span class=\"keyword\">ADD</span><span class=\"bash\"> <span class=\"built_in\">source</span>/fastdfs-nginx-module.tar.gz /usr/<span class=\"built_in\">local</span>/src/</span></span><br><span class=\"line\"><span class=\"keyword\">ADD</span><span class=\"bash\"> <span class=\"built_in\">source</span>/nginx-1.15.4.tar.gz /usr/<span class=\"built_in\">local</span>/src/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Run</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> yum install git gcc gcc-c++ make automake autoconf libtool pcre pcre-devel zlib zlib-devel openssl-devel wget vim -y \\</span></span><br><span class=\"line\"><span class=\"bash\">  &amp;&amp;  mkdir /home/dfs   \\</span></span><br><span class=\"line\"><span class=\"bash\">  &amp;&amp;  <span class=\"built_in\">cd</span> /usr/<span class=\"built_in\">local</span>/src/  \\</span></span><br><span class=\"line\"><span class=\"bash\">  &amp;&amp;  <span class=\"built_in\">cd</span> libfastcommon/   \\</span></span><br><span class=\"line\"><span class=\"bash\">  &amp;&amp;  ./make.sh &amp;&amp; ./make.sh install  \\</span></span><br><span class=\"line\"><span class=\"bash\">  &amp;&amp;  <span class=\"built_in\">cd</span> ../  \\</span></span><br><span class=\"line\"><span class=\"bash\">  &amp;&amp;  <span class=\"built_in\">cd</span> fastdfs/   \\</span></span><br><span class=\"line\"><span class=\"bash\">  &amp;&amp;  ./make.sh &amp;&amp; ./make.sh install  \\</span></span><br><span class=\"line\"><span class=\"bash\">  &amp;&amp;  <span class=\"built_in\">cd</span> ../  \\</span></span><br><span class=\"line\"><span class=\"bash\">  &amp;&amp;  <span class=\"built_in\">cd</span> nginx-1.15.4/  \\</span></span><br><span class=\"line\"><span class=\"bash\">  &amp;&amp;  ./configure --add-module=/usr/<span class=\"built_in\">local</span>/src/fastdfs-nginx-module/src/   \\</span></span><br><span class=\"line\"><span class=\"bash\">  &amp;&amp;  make &amp;&amp; make install  \\</span></span><br><span class=\"line\"><span class=\"bash\">  &amp;&amp;  chmod +x /home/fastdfs.sh</span></span><br><span class=\"line\"><span class=\"comment\"># export config</span></span><br><span class=\"line\"><span class=\"keyword\">VOLUME</span><span class=\"bash\"> /etc/fdfs</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">EXPOSE</span> <span class=\"number\">22122</span> <span class=\"number\">23000</span> <span class=\"number\">8888</span> <span class=\"number\">80</span></span><br><span class=\"line\"><span class=\"keyword\">ENTRYPOINT</span><span class=\"bash\"> [<span class=\"string\">\"/home/fastdfs.sh\"</span>]</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li>ä¼˜åŒ–åçš„ Dockerfile<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FROM alpine:3.10</span><br><span class=\"line\">RUN <span class=\"built_in\">set</span> -x \\</span><br><span class=\"line\">    &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">\"http://mirrors.huaweicloud.com/alpine/latest-stable/main/\"</span> &gt; /etc/apk/repositories \\</span><br><span class=\"line\">    &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">\"http://mirrors.huaweicloud.com/alpine/latest-stable/community/\"</span> &gt;&gt; /etc/apk/repositories \\</span><br><span class=\"line\">    &amp;&amp; apk update \\</span><br><span class=\"line\">    &amp;&amp; apk add --no-cache --virtual .build-deps gcc libc-dev make perl-dev openssl-dev pcre-dev zlib-dev git \\</span><br><span class=\"line\">    &amp;&amp; mkdir -p /usr/<span class=\"built_in\">local</span>/src \\</span><br><span class=\"line\">    &amp;&amp; <span class=\"built_in\">cd</span> /usr/<span class=\"built_in\">local</span>/src \\</span><br><span class=\"line\">    &amp;&amp; git <span class=\"built_in\">clone</span> https://github.com/happyfish100/libfastcommon.git --depth 1 \\</span><br><span class=\"line\">    &amp;&amp; git <span class=\"built_in\">clone</span> https://github.com/happyfish100/fastdfs.git --depth 1    \\</span><br><span class=\"line\">    &amp;&amp; git <span class=\"built_in\">clone</span> https://github.com/happyfish100/fastdfs-nginx-module.git --depth 1  \\</span><br><span class=\"line\">    &amp;&amp; wget http://nginx.org/download/nginx-1.15.4.tar.gz \\</span><br><span class=\"line\">    &amp;&amp; tar -xf nginx-1.15.4.tar.gz \\</span><br><span class=\"line\">    &amp;&amp; <span class=\"built_in\">cd</span> /usr/<span class=\"built_in\">local</span>/src/libfastcommon \\</span><br><span class=\"line\">    &amp;&amp; ./make.sh \\</span><br><span class=\"line\">    &amp;&amp; ./make.sh install \\</span><br><span class=\"line\">    &amp;&amp; <span class=\"built_in\">cd</span> /usr/<span class=\"built_in\">local</span>/src/fastdfs/ \\</span><br><span class=\"line\">    &amp;&amp; ./make.sh \\</span><br><span class=\"line\">    &amp;&amp; ./make.sh install \\</span><br><span class=\"line\">    &amp;&amp; <span class=\"built_in\">cd</span> /usr/<span class=\"built_in\">local</span>/src/nginx-1.15.4/ \\</span><br><span class=\"line\">    &amp;&amp; ./configure --add-module=/usr/<span class=\"built_in\">local</span>/src/fastdfs-nginx-module/src/ \\</span><br><span class=\"line\">    &amp;&amp; make &amp;&amp; make install \\</span><br><span class=\"line\">    &amp;&amp; apk del .build-deps \\</span><br><span class=\"line\">    &amp;&amp; apk add --no-cache pcre-dev bash \\</span><br><span class=\"line\">    &amp;&amp; mkdir -p /home/dfs  \\</span><br><span class=\"line\">    &amp;&amp; mv /usr/<span class=\"built_in\">local</span>/src/fastdfs/docker/dockerfile_network/fastdfs.sh /home \\</span><br><span class=\"line\">    &amp;&amp; mv /usr/<span class=\"built_in\">local</span>/src/fastdfs/docker/dockerfile_network/conf/* /etc/fdfs \\</span><br><span class=\"line\">    &amp;&amp; chmod +x /home/fastdfs.sh \\</span><br><span class=\"line\">    &amp;&amp; rm -rf /usr/<span class=\"built_in\">local</span>/src*</span><br><span class=\"line\">VOLUME /home/dfs</span><br><span class=\"line\">EXPOSE 22122 23000 8888 8080</span><br><span class=\"line\">CMD [<span class=\"string\">\"/home/fastdfs.sh\"</span>]</span><br></pre></td></tr></table></figure></li>\n<li><p>æ„å»ºä¹‹åçš„å¯¹æ¯”ä½¿ç”¨é¡¹ç›®é»˜è®¤çš„ Dockerfile è¿›è¡Œæ„å»ºçš„è¯ï¼Œé•œåƒå¤§å°æ¥è¿‘ 500MB ğŸ˜‚ï¼Œè€Œç»è¿‡ä¸€äº›çš„ä¼˜åŒ–ï¼Œå°†æ‰€æœ‰çš„ RUN æŒ‡ä»¤åˆå¹¶ä¸ºä¸€æ¡ï¼Œæœ€ç»ˆæ„å»ºå‡ºæ¥çš„é•œåƒå¤§å°ä¸º 30MB ğŸ˜‚ã€‚</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç»“è®º: å»ºè®®é‡‡ç”¨alpineè¿›è¡Œæ„å»ºåªä¸è¿‡éœ€è¦æ³¨æ„å…¶alpineçš„cåº“æ˜¯`musl libc`è€Œä¸æ˜¯æ­£ç»Ÿçš„glibcåº“</span></span><br><span class=\"line\">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">fastdfs             alpine              e855bd197dbe        10 seconds ago      29.3MB</span><br><span class=\"line\">fastdfs             debian              e05ca1616604        20 minutes ago      103MB</span><br><span class=\"line\">fastdfs             centos              c1488537c23c        30 minutes ago      483MB</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>(6) ä½¿ç”¨è™šæ‹Ÿç¼–è¯‘ç¯å¢ƒå¯¹äºåªåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°çš„ä¾èµ–ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›ä¾èµ–å®‰è£…åœ¨è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œç¼–è¯‘å®Œæˆä¹‹åå¯ä»¥ä¸€å¹¶åˆ é™¤è¿™äº›ä¾èµ–</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#æ¯”å¦‚ alpine ä¸­å¯ä»¥ä½¿ç”¨ apk add --no-cache --virtual .build-deps ï¼Œåé¢åŠ ä¸Šéœ€è¦å®‰è£…çš„ç›¸å…³ä¾èµ–ã€‚</span></span><br><span class=\"line\">apk add --no-cache --virtual .build-deps gcc libc-dev make perl-dev openssl-dev pcre-dev zlib-dev git</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#æ„å»ºå®Œæˆä¹‹åå¯ä»¥ä½¿ç”¨ apk del .build-deps å‘½ä»¤ï¼Œä¸€å¹¶å°†è¿™äº›ç¼–è¯‘ä¾èµ–å…¨éƒ¨åˆ é™¤ã€‚</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>æ³¨æ„çš„æ˜¯<code>.build-deps</code> åé¢æ¥çš„æ˜¯ç¼–è¯‘æ—¶ä»¥æ¥çš„è½¯ä»¶åŒ…ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ç¼–è¯‘ä¾èµ–éƒ½å¯ä»¥åˆ é™¤ï¼Œä¸è¦æŠŠè¿è¡Œæ—¶çš„ä¾èµ–åŒ…æ¥åœ¨åé¢æœ€å¥½å•ç‹¬ add ä¸€ä¸‹ã€‚</li>\n</ul>\n</li>\n<li><p>(7) æœ€å°åŒ–å±‚æ•°è‡³docker åœ¨ 1.10 ä»¥åï¼Œåªæœ‰ RUNã€COPY å’Œ ADD æŒ‡ä»¤ä¼šåˆ›å»ºå±‚ï¼Œå…¶ä»–æŒ‡ä»¤ä¼šåˆ›å»ºä¸´æ—¶çš„ä¸­é—´é•œåƒä½†æ˜¯ä¸ä¼šç›´æ¥å¢åŠ æ„å»ºçš„é•œåƒå¤§å°äº†;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚æœå¤šä¸ªæ–‡ä»¶éœ€è¦æ·»åŠ åˆ°å®¹å™¨ä¸­ä¸åŒçš„è·¯å¾„ï¼Œæ¯ä¸ªæ–‡ä»¶ä½¿ç”¨ä¸€æ¡ ADD æŒ‡ä»¤çš„è¯å°±ä¼šå¢åŠ ä¸€å±‚é•œåƒï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡Œç²¾ç®€é•œåƒæ„å»ºæ—¶çš„å¤§å°;</span></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶å¯ä»¥é€šè¿‡å°†æ‰€æœ‰çš„ä¾èµ–æ–‡ä»¶æ‰“åŒ…ä¸ºä¸€ä¸ªæ–‡ä»¶ src.tar.gz ç„¶åé€šè¿‡ ADD çš„æ–¹å¼æŠŠæ–‡ä»¶æ·»åŠ åˆ°å½“ä¸­å»ï¼Œç„¶ååœ¨ RUN æŒ‡ä»¤åä½¿ç”¨ mv å‘½ä»¤æŠŠæ–‡ä»¶ç§»åŠ¨åˆ°æŒ‡å®šçš„ä½ç½®ã€‚</span></span><br><span class=\"line\">COPY src.tar.gz /usr/<span class=\"built_in\">local</span>/src.tar.gz</span><br></pre></td></tr></table></figure>\n<ul>\n<li>Tips: å…¶ä»–æœ€å°åŒ–å±‚æ•°æ— éå°±æ˜¯æŠŠæ„å»ºé¡¹ç›®çš„æ•´ä¸ªæ­¥éª¤å¼„æˆä¸€æ¡ RUN æŒ‡ä»¤ä¸è¿‡å¤šæ¡å‘½ä»¤åˆå¹¶å¯ä»¥ä½¿ç”¨ &amp;&amp; æˆ–è€… <code>;</code>,åœ¨å­¦ä¹ å®˜æ–¹çš„DockerFileåˆ™å‘ç°ä½¿ç”¨çš„<code>;</code>çš„å±…å¤š;</li>\n</ul>\n</li>\n<li><p>(8) é‡‡ç”¨å¤šé˜¶æ®µæ„å»ºé•œåƒå¯ä»¥å‡å°é•œåƒå¤§å°ï¼Œä½†æ˜¯æ³¨æ„ä¸ºäº†ä¿è¯é•œåƒæ­£å¸¸æ„å»ºè¿è¡Œï¼Œéœ€è¦åœ¨<code>COPY --from=0</code>æŒ‡ä»¤æ‰§è¡Œæ—¶å€™å°†ä¸Šé˜¶æ®µçš„æˆæœé‡‡ç”¨ç»å¯¹è·¯å¾„å¤åˆ¶é˜²æ­¢æ„å»ºå‡ºé”™;</p>\n<ul>\n<li>Tips: æœ€å¥½çš„æ–¹æ³•æ˜¯åœ¨ç¬¬ä¸€é˜¶æ®µæŒ‡å®š WORKDIRï¼Œåœ¨ç¬¬äºŒé˜¶æ®µä½¿ç”¨ç»å¯¹è·¯å¾„æ‹·è´æ–‡ä»¶ï¼Œå³ä½¿åŸºç¡€é•œåƒä¿®æ”¹äº† WORKDIR ä¸ä¼šå½±å“åˆ°é•œåƒçš„æ„å»º<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">FROM</span> golang   <span class=\"comment\"># é»˜è®¤å·¥ä½œç©ºé—´ä¸º/go</span></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"bash\"> /src</span></span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"bash\"> hello.go .</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> go build hello.go</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> ubuntu</span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"bash\"> --from=0 /src/hello .</span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> [<span class=\"string\">\"./hello\"</span>]</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h4 id=\"0x03-é•œåƒä½“ç§¯ç¼©å‡å®æˆ˜\"><a href=\"#0x03-é•œåƒä½“ç§¯ç¼©å‡å®æˆ˜\" class=\"headerlink\" title=\"0x03 é•œåƒä½“ç§¯ç¼©å‡å®æˆ˜\"></a>0x03 é•œåƒä½“ç§¯ç¼©å‡å®æˆ˜</h4><h5 id=\"1-å¥‡æŠ€æ·«å·§æ„å»ºé•œåƒä½“ç§¯å‡å°-99\"><a href=\"#1-å¥‡æŠ€æ·«å·§æ„å»ºé•œåƒä½“ç§¯å‡å°-99\" class=\"headerlink\" title=\"(1) å¥‡æŠ€æ·«å·§æ„å»ºé•œåƒä½“ç§¯å‡å° 99%\"></a>(1) å¥‡æŠ€æ·«å·§æ„å»ºé•œåƒä½“ç§¯å‡å° 99%</h5><p>æè¿°:æ¯ä¸€ä¸ªåˆæ¬¡ä½¿ç”¨è‡ªå·±å†™å¥½çš„ä»£ç æŒ‡ä»¤æ„å»ºDockeré•œåƒæ—¶å€™éƒ½ä¼šè¢«é•œåƒçš„å¤§å°æ‰€å“å€’å› ä¸ºç¡®å®å¤ªå¤§ï¼Œå½“ç„¶å‰ææ˜¯æ²¡æœ‰è¿›è¡Œ DockerFile ä¼˜åŒ–ä¸­ï¼›</p>\n<p>æ¯”å¦‚: æ„å»ºä¸€ä¸ªé•œåƒé‡‡ç”¨ç¼–è¯‘.cçš„Cç¨‹åºç„¶åå¹¶è¿è¡Œå®¹å™¨<br>ç¤ºä¾‹Cç¨‹åº:<br><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir /opt/hello &amp;&amp; cd $_</span><br><span class=\"line\">cat &gt; hello.c &lt;&lt;EOF</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"comment\">/* hello.c */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span> <span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">puts</span>(<span class=\"string\">\"Hello, world!\"</span>);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure></p>\n<p>DockerFile<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt; Dockerfile &lt;&lt;EOF</span><br><span class=\"line\">FROM gcc</span><br><span class=\"line\">COPY hello.c .</span><br><span class=\"line\">RUN gcc -o hello hello.c</span><br><span class=\"line\">CMD [<span class=\"string\">\"./hello\"</span>]</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure></p>\n<p>åŸºç¡€å®è·µ:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$docker</span> build --tag gcc-hello:latest .</span><br><span class=\"line\"><span class=\"comment\"># è¡¨ç¤º docker cli å‘½ä»¤è¡Œå®¢æˆ·ç«¯å°†æˆ‘ä»¬å½“å‰ç›®å½•ï¼ˆå³æ„å»ºä¸Šä¸‹æ–‡ï¼‰ build context æ‰“åŒ…å‘é€ Docker daemon å®ˆæŠ¤è¿›ç¨‹ ï¼ˆå³ dockerdï¼‰çš„è¿‡ç¨‹ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># KB: ä»£è¡¨å½“å‰ä¸Šä¸‹æ–‡å¤§å°</span></span><br><span class=\"line\">Sending build context to Docker daemon  3.072kB</span><br><span class=\"line\">....</span><br><span class=\"line\">Successfully built eb9ae8b1c49c</span><br><span class=\"line\">Successfully tagged gcc-hello:latest</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ­¤æ—¶æ‚¨ä¼šå‘ç°æ„å»ºæˆåŠŸçš„é•œåƒä½“ç§¯è¿œè¿œè¶…è¿‡äº† 1 GB, å› ä¸ºè¯¥é•œåƒåŒ…å«äº†æ•´ä¸ª gcc é•œåƒçš„å†…å®¹;</span></span><br><span class=\"line\"><span class=\"variable\">$docker</span> images gcc-hello </span><br><span class=\"line\">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">gcc-hello           latest              eb9ae8b1c49c        5 minutes ago       1.19GB</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœä½¿ç”¨ Ubuntu é•œåƒå®‰è£… C ç¼–è¯‘å™¨ï¼Œæœ€åç¼–è¯‘ç¨‹åºä½ ä¼šå¾—åˆ°ä¸€ä¸ªå¤§æ¦‚ 300 MB å¤§å°çš„é•œåƒæ¯”ä¸Šé¢çš„é•œåƒå°å¤šäº†</span></span><br><span class=\"line\"><span class=\"variable\">$docker</span> run -it --rm gcc-hello</span><br><span class=\"line\">Hello, world!</span><br><span class=\"line\"><span class=\"variable\">$docker</span> run -it --rm gcc-hello ls -alh hello</span><br><span class=\"line\">-rwxr-xr-x. 1 root root 16K Jul 27 08:21 hello  <span class=\"comment\">#å› ä¸ºç¼–è¯‘å¥½çš„å¯æ‰§è¡Œæ–‡ä»¶è¿˜ä¸åˆ° 20 KB</span></span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p>ç¤ºä¾‹Goç¨‹åº:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir /opt/go-hello/ &amp;&amp; <span class=\"built_in\">cd</span> <span class=\"variable\">$_</span></span><br><span class=\"line\">cat &gt; hello.go &lt;&lt;EOF</span><br><span class=\"line\">package main</span><br><span class=\"line\"></span><br><span class=\"line\">import <span class=\"string\">\"fmt\"</span></span><br><span class=\"line\">func <span class=\"function\"><span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">  fmt.Println(<span class=\"string\">\"Hello, world!\"</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure></p>\n<p>Dockerfile:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt; dockerfile &lt;&lt;EOF</span><br><span class=\"line\">FROM golang</span><br><span class=\"line\">COPY hello.go .</span><br><span class=\"line\">RUN go build hello.go </span><br><span class=\"line\">CMD [<span class=\"string\">\"./hello\"</span>,<span class=\"string\">\"ls -alh ./hello\"</span>]</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure></p>\n<p>ä½¿ç”¨åŸºç¡€é•œåƒ golang æ„å»ºçš„é•œåƒå¤§å°æ˜¯ 800 MBï¼Œè€Œç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶åªæœ‰ 2 MB å¤§å°ï¼š<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é•œåƒæ„å»º</span></span><br><span class=\"line\"><span class=\"variable\">$docker</span> build --tag go-hello .</span><br><span class=\"line\">Sending build context to Docker daemon  3.072kB</span><br><span class=\"line\">....</span><br><span class=\"line\">Successfully built d1bb1eb974f4</span><br><span class=\"line\">Successfully tagged go-hello:latest</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿è¡Œé•œåƒ</span></span><br><span class=\"line\">[root@k8s-yum-server go-hello]$ docker run -it --rm go-hello</span><br><span class=\"line\">Hello, world!</span><br><span class=\"line\">[root@k8s-yum-server go-hello]$ docker run -it --rm go-hello bash</span><br><span class=\"line\">root@f610b4030f2d:/go<span class=\"comment\"># ls -alh hello</span></span><br><span class=\"line\">-rwxr-xr-x. 1 root root 2.0M Jul 27 08:43 hello  <span class=\"comment\"># æ¯”gccç”Ÿæˆçš„å¤§å¤šäº†</span></span><br></pre></td></tr></table></figure></p>\n<p>Tips: ä¸ºäº†æ›´ç›´è§‚åœ°å¯¹æ¯”ä¸åŒé•œåƒçš„å¤§å°ï¼Œæ‰€æœ‰é•œåƒéƒ½ä½¿ç”¨ç›¸åŒçš„é•œåƒåä¸åŒçš„æ ‡ç­¾ï¼Œå½“ç„¶æ‚¨éœ€è¦åœ¨æ„å»ºé•œåƒæ—¶å€™é‡‡ç”¨<code>--tag</code>å‚æ•°è¿›è¡Œã€‚</p>\n<p><br/></p>\n<p><strong>å¦‚ä½•ç¼©å‡é•œåƒå¤§å°?</strong><br>ç­”:è¦æƒ³å¤§å¹…åº¦å‡å°‘é•œåƒçš„ä½“ç§¯ï¼Œå¤šé˜¶æ®µæ„å»ºæ˜¯å¿…ä¸å¯å°‘çš„ã€‚<br>å¤šé˜¶æ®µæ„å»ºçš„æƒ³æ³•å¾ˆç®€å•: â€œ<code>æˆ‘ä¸æƒ³åœ¨æœ€ç»ˆçš„é•œåƒä¸­åŒ…å«ä¸€å † C æˆ– Go ç¼–è¯‘å™¨å’Œæ•´ä¸ªç¼–è¯‘å·¥å…·é“¾ï¼Œæˆ‘åªè¦ä¸€ä¸ªç¼–è¯‘å¥½çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼</code>â€œ</p>\n<p>å¤šé˜¶æ®µæ„å»ºå¯ä»¥ç”±å¤šä¸ª FROM æŒ‡ä»¤è¯†åˆ«ï¼Œæ¯ä¸€ä¸ª FROM è¯­å¥è¡¨ç¤ºä¸€ä¸ªæ–°çš„æ„å»ºé˜¶æ®µï¼Œé˜¶æ®µåç§°å¯ä»¥ç”¨ AS å‚æ•°æŒ‡å®šï¼Œä¾‹å¦‚ï¼š</p>\n<p>æœ¬ä¾‹ä½¿ç”¨åŸºç¡€é•œåƒ gcc æ¥ç¼–è¯‘ç¨‹åº hello.cï¼Œç„¶åå¯åŠ¨ä¸€ä¸ªæ–°çš„æ„å»ºé˜¶æ®µï¼Œå®ƒä»¥ ubuntu ä½œä¸ºåŸºç¡€é•œåƒï¼Œå°†å¯æ‰§è¡Œæ–‡ä»¶ hello ä»ä¸Šä¸€é˜¶æ®µæ‹·è´åˆ°æœ€ç»ˆçš„é•œåƒä¸­<br><figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt; dockerfile &lt;&lt;EOF</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> gcc AS mybuildstage</span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"bash\"> hello.c .</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> gcc -o hello hello.c</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> ubuntu</span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"bash\"> --from=mybuildstage hello .</span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> [<span class=\"string\">\"./hello\"</span>]</span></span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure></p>\n<p>é•œåƒæ„å»º:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$docker</span> build -t go-hello:stage -f Dockerfile .</span><br><span class=\"line\">Sending build context to Docker daemon  3.072kB</span><br><span class=\"line\">Step 1/6 : FROM gcc AS mybuildstage</span><br><span class=\"line\"> ---&gt; 21f378ba43ec</span><br><span class=\"line\">Step 2/6 : COPY hello.c .</span><br><span class=\"line\"> ---&gt; Using cache</span><br><span class=\"line\"> ---&gt; 09252ee7e000</span><br><span class=\"line\">Step 3/6 : RUN gcc -o hello hello.c</span><br><span class=\"line\"> ---&gt; Using cache</span><br><span class=\"line\"> ---&gt; 9615c168cdc0</span><br><span class=\"line\">Step 4/6 : FROM ubuntu</span><br><span class=\"line\">latest: Pulling from library/ubuntu</span><br><span class=\"line\">3ff22d22a855: Pull complete</span><br><span class=\"line\">e7cb79d19722: Pull complete</span><br><span class=\"line\">323d0d660b6a: Pull complete</span><br><span class=\"line\">b7f616834fd0: Pull complete</span><br><span class=\"line\">Digest: sha256:5d1d5407f353843ecf8b16524bc5565aa332e9e6a1297c73a92d3e754b8a636d</span><br><span class=\"line\">Status: Downloaded newer image <span class=\"keyword\">for</span> ubuntu:latest</span><br><span class=\"line\"> ---&gt; 1e4467b07108</span><br><span class=\"line\">Step 5/6 : COPY --from=mybuildstage hello .</span><br><span class=\"line\"> ---&gt; 4659f572446e</span><br><span class=\"line\">Step 6/6 : CMD [<span class=\"string\">\"./hello\"</span>]</span><br><span class=\"line\"> ---&gt; Running <span class=\"keyword\">in</span> be24d1c6b4aa</span><br><span class=\"line\">Removing intermediate container be24d1c6b4aa</span><br><span class=\"line\"> ---&gt; 5934753f8f4f</span><br><span class=\"line\">Successfully built 5934753f8f4f</span><br><span class=\"line\">Successfully tagged go-hello:stage</span><br></pre></td></tr></table></figure></p>\n<p>æœ€ç»ˆçš„é•œåƒå¤§å°æ˜¯73.9 MBï¼Œæ¯”ä¹‹å‰çš„ 1.1 GB å‡å°‘äº† 95%<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$docker</span> images go-hello</span><br><span class=\"line\">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">go-hello            stage               5934753f8f4f        9 minutes ago       73.9MB</span><br><span class=\"line\">ubuntu              latest              1e4467b07108        2 days ago          73.9MB</span><br><span class=\"line\">gcc                 latest              21f378ba43ec        3 days ago          1.19GB</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$docker</span> run -it --rm go-hello:stage</span><br><span class=\"line\">Hello, world!</span><br></pre></td></tr></table></figure><br>å¦‚æœ Dockerfile å†…å®¹ä¸æ˜¯å¾ˆå¤æ‚ï¼Œæ„å»ºé˜¶æ®µä¹Ÿä¸æ˜¯å¾ˆå¤šå¯ä»¥ç›´æ¥ä½¿ç”¨åºå·è¡¨ç¤ºæ„å»ºé˜¶æ®µã€‚ä¸€æ—¦ Dockerfile å˜å¤æ‚äº†ï¼Œæ„å»ºé˜¶æ®µå¢å¤šäº†ï¼Œæœ€å¥½è¿˜æ˜¯é€šè¿‡å…³é”®è¯ AS ä¸ºæ¯ä¸ªé˜¶æ®µå‘½åè¿™æ ·ä¹Ÿä¾¿äºåæœŸç»´æŠ¤ã€‚<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åœ¨å£°æ˜æ„å»ºé˜¶æ®µæ—¶å¯ä»¥ä¸å¿…ä½¿ç”¨å…³é”®è¯ ASï¼Œæœ€ç»ˆé˜¶æ®µæ‹·è´æ–‡ä»¶æ—¶å¯ä»¥ç›´æ¥ä½¿ç”¨åºå·è¡¨ç¤ºä¹‹å‰çš„æ„å»ºé˜¶æ®µï¼ˆä»é›¶å¼€å§‹ï¼‰ä¸‹é¢ä¸¤è¡Œæ˜¯ç­‰æ•ˆçš„</span></span><br><span class=\"line\">COPY --from=0 hello .              <span class=\"comment\"># ä¸æ˜¯å¾ˆå¤æ‚æ—¶å€™ä½¿ç”¨</span></span><br><span class=\"line\">COPY --from=mybuildstage hello .   <span class=\"comment\"># å¤æ‚æ—¶å€™ä¸€å®šè¦ç”¨é˜¶æ®µåç§°è€Œä¸æ˜¯é˜¶æ®µç´¢å¼•;</span></span><br></pre></td></tr></table></figure></p>\n<hr>\n<h5 id=\"2-FROM-scratch-çš„é­”åŠ›\"><a href=\"#2-FROM-scratch-çš„é­”åŠ›\" class=\"headerlink\" title=\"(2) FROM scratch çš„é­”åŠ›\"></a>(2) FROM scratch çš„é­”åŠ›</h5><p>æè¿°:å›åˆ°æˆ‘ä»¬çš„ hello worldï¼ŒC è¯­è¨€ç‰ˆæœ¬çš„ç¨‹åºå¤§å°ä¸º 16 kBï¼ŒGo è¯­è¨€ç‰ˆæœ¬çš„ç¨‹åºå¤§å°ä¸º 2 MBï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆ°åº•èƒ½ä¸èƒ½å°†é•œåƒç¼©å‡åˆ°è¿™ä¹ˆå°ï¼Ÿèƒ½å¦æ„å»ºä¸€ä¸ªåªåŒ…å«æˆ‘éœ€è¦çš„ç¨‹åºï¼Œæ²¡æœ‰ä»»ä½•å¤šä½™æ–‡ä»¶çš„é•œåƒï¼Ÿ<br>ç­”æ¡ˆ:æ˜¯è‚¯å®šçš„ï¼Œä½ åªéœ€è¦å°†å¤šé˜¶æ®µæ„å»ºçš„ç¬¬äºŒé˜¶æ®µçš„åŸºç¡€é•œåƒæ”¹ä¸º scratch ï¼ˆä¸€ä¸ªè™šæ‹Ÿé•œåƒï¼‰ï¼Œä¸èƒ½è¢« pullï¼Œä¹Ÿä¸èƒ½è¿è¡Œï¼Œå› ä¸ºå®ƒè¡¨ç¤ºç©ºã€nothingï¼è¿™å°±æ„å‘³ç€æ–°é•œåƒçš„æ„å»ºæ˜¯ä»é›¶å¼€å§‹ï¼Œä¸å­˜åœ¨å…¶ä»–çš„é•œåƒå±‚ï¼›<br>è™½ç„¶å®ƒå¯ä»¥æå¤§çš„ç¼©å°é•œåƒå¤§å°ï¼Œä½†æ˜¯ä½¿ç”¨å®ƒ scratch ä½œä¸ºåŸºç¡€é•œåƒæ—¶ä¼šå¸¦æ¥å¾ˆå¤šçš„ä¸ä¾¿(äº‹ç‰©å¾€å¾€éƒ½ä¸æ˜¯é‚£ä¹ˆå®Œç¾çš„)ã€‚</p>\n<p>ä½¿ç”¨scratchä½œä¸ºåŸºç¡€é•œåƒç¼ºç‚¹:</p>\n<ul>\n<li>1) scratch é•œåƒçš„ç¬¬ä¸€ä¸ªä¸ä¾¿æ˜¯æ²¡æœ‰ shellæ„å‘³ç€ CMD/RUN è¯­å¥ä¸­ä¸èƒ½ä½¿ç”¨å­—ç¬¦ä¸²<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FROM scratch</span><br><span class=\"line\">COPY --from=0 /go/hello .</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡‡ç”¨Jonsæ ¼å¼</span></span><br><span class=\"line\">CMD [<span class=\"string\">\"./hello\"</span>]</span><br></pre></td></tr></table></figure></li>\n<li>2)  scratch é•œåƒä¸åŒ…å«ä»»ä½•è°ƒè¯•å·¥å…·ä¾‹å¦‚<code>lsã€psã€ping</code>ç­‰å‘½ä»¤ç»Ÿç»Ÿæ²¡æœ‰ï¼Œå½“ç„¶äº†shell ä¹Ÿæ²¡æœ‰ï¼ˆä¸Šæ–‡æè¿‡äº†ï¼‰ï¼Œä½ æ— æ³•ä½¿ç”¨Â·<code>docker exec</code>è¿›å…¥å®¹å™¨ï¼Œä¹Ÿæ— æ³•æŸ¥çœ‹ç½‘ç»œå †æ ˆä¿¡æ¯ç­‰ç­‰ã€‚<ul>\n<li>è§£å†³åŠæ³•:æŠ˜ä¸­ä¸€ä¸‹å¯ä»¥é€‰æ‹© busybox æˆ– alpine é•œåƒæ¥æ›¿ä»£ scratch;<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$docker</span> run --rm -it go-hello:scratch ls</span><br><span class=\"line\">docker: Error response from daemon: OCI runtime create failed: container_linux.go:349: starting container process caused <span class=\"string\">\"exec: \\\"ls\\\": executable file not found in <span class=\"variable\">$PATH</span>\"</span>: unknown.</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li>3) scratch é•œåƒç¼ºå°‘ lib é“¾æ¥åº“è¿™æ˜¯æ¯”è¾ƒéš¾å¤„ç†çš„é—®é¢˜,ä½¿ç”¨ scratch ä½œä¸ºåŸºç¡€é•œåƒæ—¶ Go è¯­è¨€ç‰ˆæœ¬çš„ hello world è·‘å¾—å¾ˆæ¬¢å¿«ï¼ŒC è¯­è¨€ç‰ˆæœ¬å°±ä¸è¡Œäº†ï¼Œæˆ–è€…æ¢ä¸ªæ›´å¤æ‚çš„ Go ç¨‹åºä¹Ÿæ˜¯è·‘ä¸èµ·æ¥çš„ï¼ˆä¾‹å¦‚ç”¨åˆ°äº†ç½‘ç»œç›¸å…³çš„å·¥å…·åŒ…ï¼‰ï¼Œä½ ä¼šé‡åˆ°ç±»ä¼¼äºä¸‹é¢çš„é”™è¯¯<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># é”™è¯¯ä¿¡æ¯:standard_init_linux.go:211: exec user process caused \"no such file or directory\"</span></span><br><span class=\"line\">æŠ¥é”™ä¿¡æ¯å¯ä»¥çœ‹å‡ºç¼ºå°‘æ–‡ä»¶ï¼Œä½†æ²¡æœ‰å‘Šè¯‰æˆ‘ä»¬åˆ°åº•ç¼ºå°‘å“ªäº›æ–‡ä»¶ï¼Œå…¶å®è¿™äº›æ–‡ä»¶å°±æ˜¯ç¨‹åºè¿è¡Œæ‰€å¿…éœ€çš„åŠ¨æ€åº“ï¼ˆdynamic libraryï¼‰ã€‚</span><br></pre></td></tr></table></figure>\n<ul>\n<li>Tips:å›åˆ°æœ€åˆçš„é—®é¢˜é»˜è®¤æƒ…å†µä¸‹<code>Cç¨‹åº/Go ç¨‹åºä½¿ç”¨çš„æ˜¯åŠ¨æ€é“¾æ¥</code>ã€‚ä¸Šé¢çš„ hello world ç¨‹åºä½¿ç”¨äº†<code>æ ‡å‡†åº“æ–‡ä»¶ libc.so.6</code>ï¼Œæ‰€ä»¥åªæœ‰é•œåƒä¸­åŒ…å«è¯¥æ–‡ä»¶ï¼Œç¨‹åºæ‰èƒ½æ­£å¸¸è¿è¡Œã€‚<br>ä½¿ç”¨ scratch ä½œä¸ºåŸºç¡€é•œåƒè‚¯å®šæ˜¯ä¸è¡Œçš„ä½¿ç”¨ busybox å’Œ alpine ä¹Ÿä¸è¡Œï¼Œå› ä¸º busybox ä¸åŒ…å«æ ‡å‡†åº“ï¼Œè€Œ alpine ä½¿ç”¨çš„æ ‡å‡†åº“æ˜¯ musl libcï¼Œä¸å¤§å®¶å¸¸ç”¨çš„æ ‡å‡†åº“ glibc ä¸å…¼å®¹</li>\n</ul>\n</li>\n</ul>\n<p><br></p>\n<p>Q:é‚£ä¹ˆè¯¥å¦‚ä½•è§£å†³æ ‡å‡†åº“çš„é—®é¢˜å‘¢ï¼Ÿ<br>ç­”:æœ‰ä¸‰ç§æ–¹æ¡ˆã€‚<br>1.ä½¿ç”¨é™æ€åº“æˆ‘ä»¬å¯ä»¥è®©ç¼–è¯‘å™¨ä½¿ç”¨é™æ€åº“ç¼–è¯‘ç¨‹åºåŠæ³•æœ‰å¾ˆå¤šï¼Œå¦‚æœä½¿ç”¨ gcc ä½œä¸ºç¼–è¯‘å™¨ï¼Œåªéœ€åŠ ä¸Šä¸€ä¸ªå‚æ•° -static(æ¨èæ–¹å¼:ä»¥å¤§å°ç‰ºç‰²æ»¡è¶³ç¨‹åºçš„å¥å£®æ€§)ï¼š<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$gcc</span> -o hello hello.c -static</span><br></pre></td></tr></table></figure><br>ç¼–è¯‘å®Œçš„å¯æ‰§è¡Œæ–‡ä»¶å¤§å°ä¸º 760 kBç›¸æ¯”äºä¹‹å‰çš„ 16kB æ˜¯å¤§äº†å¥½å¤šï¼Œè¿™æ˜¯å› ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ä¸­åŒ…å«äº†å…¶è¿è¡Œæ‰€éœ€è¦çš„åº“æ–‡ä»¶,ç¼–è¯‘å®Œçš„ç¨‹åºå°±å¯ä»¥è·‘åœ¨ scratch é•œåƒä¸­äº†ã€‚<br>å¦‚æœä½¿ç”¨ alpine é•œåƒä½œä¸ºåŸºç¡€é•œåƒæ¥ç¼–è¯‘å¾—åˆ°çš„å¯æ‰§è¡Œæ–‡ä»¶ä¼šæ›´å°ï¼ˆ&lt; 100kBï¼‰ã€‚</p>\n<p>2.æ‹·è´åº“æ–‡ä»¶åˆ°é•œåƒä¸­ä¸ºäº†æ‰¾å‡ºç¨‹åºè¿è¡Œéœ€è¦å“ªäº›åº“æ–‡ä»¶å¯ä»¥ä½¿ç”¨ ldd å·¥å…·:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$ldd</span> hello</span><br><span class=\"line\">  linux-vdso.so.1 (0x00007ffdf8acb000)</span><br><span class=\"line\">  libc.so.6 =&gt; /usr/lib/libc.so.6 (0x00007ff897ef6000)</span><br><span class=\"line\">  /lib64/ld-linux-x86-64.so.2 =&gt; /usr/lib64/ld-linux-x86-64.so.2 (0x00007ff8980f7000)</span><br><span class=\"line\"><span class=\"comment\"># ä»è¾“å‡ºç»“æœå¯çŸ¥è¯¥ç¨‹åºåªéœ€è¦ libc.so.6 è¿™ä¸€ä¸ªåº“æ–‡ä»¶,linux-vdso.so.1 ä¸ä¸€ç§å«åšVDSO[3]çš„æœºåˆ¶æœ‰å…³ï¼Œç”¨æ¥åŠ é€ŸæŸäº›ç³»ç»Ÿè°ƒç”¨å¯æœ‰å¯æ— , ld-linux-x86-64.so.2 è¡¨ç¤ºåŠ¨æ€é“¾æ¥å™¨æœ¬èº«ï¼ŒåŒ…å«äº†æ‰€æœ‰ä¾èµ–çš„åº“æ–‡ä»¶çš„ä¿¡æ¯ã€‚</span></span><br><span class=\"line\">ä½ å¯ä»¥é€‰æ‹©å°† ldd åˆ—å‡ºçš„æ‰€æœ‰åº“æ–‡ä»¶æ‹·è´åˆ°é•œåƒä¸­ä½†è¿™ä¼šå¾ˆéš¾ç»´æŠ¤ï¼Œç‰¹åˆ«æ˜¯å½“ç¨‹åºæœ‰å¤§é‡ä¾èµ–åº“æ—¶(ä¸åˆ‡å®é™…äº†ä¸å»ºè®®ä½¿ç”¨);</span><br></pre></td></tr></table></figure><br>å¯¹äº hello world ç¨‹åºæ¥è¯´ï¼Œæ‹·è´åº“æ–‡ä»¶å®Œå…¨æ²¡æœ‰é—®é¢˜ï¼Œä½†å¯¹äºæ›´å¤æ‚çš„ç¨‹åºï¼ˆä¾‹å¦‚ä½¿ç”¨åˆ° DNS çš„ç¨‹åºï¼‰å°±ä¼šé‡åˆ°ä»¤äººè´¹è§£çš„é—®é¢˜,<code>glibcï¼ˆGNU C libraryï¼‰é€šè¿‡ä¸€ç§ç›¸å½“å¤æ‚çš„æœºåˆ¶æ¥å®ç° DNS</code>ï¼Œè¿™ç§æœºåˆ¶å« NSSï¼ˆName Service Switch, åç§°æœåŠ¡å¼€å…³ï¼‰ã€‚<br>å®ƒéœ€è¦ä¸€ä¸ªé…ç½®æ–‡ä»¶ /etc/nsswitch.conf å’Œé¢å¤–çš„å‡½æ•°åº“ï¼Œä½†ä½¿ç”¨ ldd æ—¶ä¸ä¼šæ˜¾ç¤ºè¿™äº›å‡½æ•°åº“ï¼Œå› ä¸ºè¿™äº›åº“åœ¨ç¨‹åºè¿è¡Œåæ‰ä¼šåŠ è½½ã€‚<br>å¦‚æœæƒ³è®© DNS è§£ææ­£ç¡®å·¥ä½œï¼Œå¿…é¡»è¦æ‹·è´è¿™äº›é¢å¤–çš„åº“æ–‡ä»¶ï¼ˆ/lib64/libnss_*ï¼‰ã€‚</p>\n<p>3.ä½¿ç”¨ busybox:glibc ä½œä¸ºåŸºç¡€é•œåƒ<br>æœ‰ä¸€ä¸ªé•œåƒå¯ä»¥å®Œç¾è§£å†³æ‰€æœ‰çš„è¿™äº›é—®é¢˜é‚£å°±æ˜¯ busybox:glibc, å› ä¸ºå®ƒåªæœ‰ 5 MB å¤§å°å¹¶ä¸”åŒ…å«äº† glibc å’Œå„ç§è°ƒè¯•å·¥å…·ã€‚<br>å¦‚æœä½ æƒ³é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„é•œåƒæ¥è¿è¡Œä½¿ç”¨åŠ¨æ€é“¾æ¥çš„ç¨‹åºbusybox:glibcæ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚</p>\n<p>æ³¨æ„ï¼šå¦‚æœä½ çš„ç¨‹åºä½¿ç”¨åˆ°äº†é™¤æ ‡å‡†åº“ä¹‹å¤–çš„åº“ï¼Œä»ç„¶éœ€è¦å°†è¿™äº›åº“æ–‡ä»¶æ‹·è´åˆ°é•œåƒä¸­ã€‚</p>\n<p>å®é™…æ¡ˆä¾‹:<br><figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt; Dockerfile&lt;&lt;EOF</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> golang</span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"bash\"> /go</span></span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"bash\"> hello.go .</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> go build hello.go</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> scratch</span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"bash\"> --from=0 /go/hello .</span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> [<span class=\"string\">\"./hello\"</span>]</span></span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure></p>\n<p>é•œåƒæ„é€ :<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$docker</span> build -f Dockerfile -t go-hello:scratch .</span><br><span class=\"line\">Sending build context to Docker daemon  4.096kB</span><br><span class=\"line\">Step 1/7 : FROM golang</span><br><span class=\"line\">...</span><br><span class=\"line\"> ---&gt; Running <span class=\"keyword\">in</span> 8eba3646dcc4</span><br><span class=\"line\">Removing intermediate container 8eba3646dcc4</span><br><span class=\"line\"> ---&gt; b3d1964b4d47</span><br><span class=\"line\">Step 5/7 : FROM scratch</span><br><span class=\"line\">Step 6/7 : COPY --from=0 /go/hello .</span><br><span class=\"line\"> ---&gt; 52e976b8f1f3</span><br><span class=\"line\">Step 7/7 : CMD [<span class=\"string\">\"./hello\"</span>]</span><br><span class=\"line\"> ---&gt; Running <span class=\"keyword\">in</span> 2247a541f3c6</span><br><span class=\"line\">Removing intermediate container 2247a541f3c6</span><br><span class=\"line\"> ---&gt; cb05b87d0012</span><br><span class=\"line\">Successfully built cb05b87d0012</span><br><span class=\"line\">Successfully tagged go-hello:scratch</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$docker</span> run --rm -it go-hello:scratch</span><br><span class=\"line\">Hello, world!</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ„å»ºé•œåƒçš„å¤§å°æ¯”å¯¹</span></span><br><span class=\"line\"><span class=\"variable\">$docker</span> images go-hello</span><br><span class=\"line\">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">go-hello            scratch             cb05b87d0012        3 minutes ago       2.07MB <span class=\"comment\">#æ„å»ºçš„é•œåƒå¤§å°æ­£å¥½å°±æ˜¯ 2 MB</span></span><br><span class=\"line\">go-hello            stage               5934753f8f4f        5 hours ago         73.9MB</span><br><span class=\"line\">go-hello            latest              d1bb1eb974f4        6 hours ago         812MB</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p>é™æ€åº“å®è·µ:<br><figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir /opt/gcc-static &amp;&amp; cd $_</span><br><span class=\"line\">cat &gt; Dockerfile-static&lt;&lt;EOF</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> gcc AS mybuildstage</span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"bash\"> /src</span></span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"bash\"> hello.c .</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> gcc -o hello hello.c -static</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> scratch</span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"bash\"> --from=0 /src/hello .</span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> [<span class=\"string\">\"./hello\"</span>]</span></span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure></p>\n<p>æ„å»ºå®è·µ:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$docker</span> build -f Dockerfile-static -t gcc-static:scratch .</span><br><span class=\"line\">Sending build context to Docker daemon  3.072kB</span><br><span class=\"line\">Step 1/7 : FROM gcc AS mybuildstage</span><br><span class=\"line\"> ---&gt; 21f378ba43ec</span><br><span class=\"line\">Step 2/7 : WORKDIR /src</span><br><span class=\"line\"> ---&gt; Running <span class=\"keyword\">in</span> 7055a4f90b2a</span><br><span class=\"line\">Removing intermediate container 7055a4f90b2a</span><br><span class=\"line\"> ---&gt; a02107ce9204</span><br><span class=\"line\">Step 3/7 : COPY hello.c .</span><br><span class=\"line\"> ---&gt; cd278ef2de60</span><br><span class=\"line\">Step 4/7 : RUN gcc -o hello hello.c -static</span><br><span class=\"line\"> ---&gt; Running <span class=\"keyword\">in</span> 368cc4437ac4</span><br><span class=\"line\">Removing intermediate container 368cc4437ac4</span><br><span class=\"line\"> ---&gt; 506e744092b2</span><br><span class=\"line\">Step 5/7 : FROM scratch</span><br><span class=\"line\">Step 6/7 : COPY --from=0 /src/hello .</span><br><span class=\"line\"> ---&gt; 1867700fa780</span><br><span class=\"line\">Step 7/7 : CMD [<span class=\"string\">\"./hello\"</span>]</span><br><span class=\"line\"> ---&gt; Running <span class=\"keyword\">in</span> bb19b78211bd</span><br><span class=\"line\">Removing intermediate container bb19b78211bd</span><br><span class=\"line\"> ---&gt; a6991f9571b3</span><br><span class=\"line\">Successfully built a6991f9571b3</span><br><span class=\"line\">Successfully tagged gcc-static:scratch</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é•œåƒæŸ¥çœ‹ä»¥åŠæ‰§è¡Œé•œåƒ</span></span><br><span class=\"line\"><span class=\"variable\">$docker</span> images gcc-static</span><br><span class=\"line\">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">gcc-static          scratch             a6991f9571b3        56 seconds ago      945kB  <span class=\"comment\">#æ­¤ç§æ–¹å¼æ¯”golangå¤šé˜¶æ®µæ„å»ºç”Ÿæˆçš„é•œåƒæ›´å°</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½†æ˜¯è°ƒè¯•æ˜¯çœŸçš„çƒ¦</span></span><br><span class=\"line\"><span class=\"variable\">$docker</span> run --rm -it gcc-static:scratch   </span><br><span class=\"line\">Hello, world!</span><br></pre></td></tr></table></figure><br><br></p>\n<p><strong>æ€»ç»“</strong><br>æè¿°:æœ€åæ¥å¯¹æ¯”ä¸€ä¸‹ä¸åŒæ„å»ºæ–¹æ³•æ„å»ºçš„é•œåƒå¤§å°ï¼š</p>\n<ul>\n<li>åŸå§‹çš„æ„å»ºæ–¹æ³•ï¼š1.14 GB</li>\n<li>ä½¿ç”¨ ubuntu é•œåƒçš„å¤šé˜¶æ®µæ„å»ºï¼š64.2 MB</li>\n<li>ä½¿ç”¨ alpine é•œåƒå’Œé™æ€ <code>glibc</code>ï¼š6.5 MB</li>\n<li>ä½¿ç”¨ alpine é•œåƒå’ŒåŠ¨æ€åº“ï¼š5.6 MB</li>\n<li>ä½¿ç”¨ scratch é•œåƒå’Œé™æ€ <code>glibc</code>ï¼š940 kB</li>\n<li>ä½¿ç”¨ scratch é•œåƒå’Œé™æ€ <code>musl libc</code>ï¼š94 kB<br>æœ€ç»ˆæˆ‘ä»¬å°†é•œåƒçš„ä½“ç§¯å‡å°‘äº† 99.99%ã€‚</li>\n</ul>\n<hr>\n<h4 id=\"0x04-è¡¥å……è¯´æ˜\"><a href=\"#0x04-è¡¥å……è¯´æ˜\" class=\"headerlink\" title=\"0x04 è¡¥å……è¯´æ˜\"></a>0x04 è¡¥å……è¯´æ˜</h4><p>æè¿°:è®°å½•é•œåƒåˆ†æç¼©å‡å»ºè®®å·¥å…·ä¸å­¦ä¹ é˜¶æ®µæ‰€é‡çš„ä¸€äº›æŠ€å·§è®°å½•</p>\n<h5 id=\"openjdké•œåƒçš„tagè¯´æ˜-å…¶å®ƒé•œåƒå¯ä»¥ç±»æ¯”\"><a href=\"#openjdké•œåƒçš„tagè¯´æ˜-å…¶å®ƒé•œåƒå¯ä»¥ç±»æ¯”\" class=\"headerlink\" title=\"openjdké•œåƒçš„tagè¯´æ˜(å…¶å®ƒé•œåƒå¯ä»¥ç±»æ¯”)\"></a>openjdké•œåƒçš„tagè¯´æ˜(å…¶å®ƒé•œåƒå¯ä»¥ç±»æ¯”)</h5><p>æè¿°:åœ¨è¿›è¡ŒDockerå®‰è£…Tomcatå‰æˆ‘ä»¬å…ˆç®€å•èŠåˆ°openjdké•œåƒçš„tagè¯´æ˜,å› ä¸ºTomcatå±äºJavaåº”ç”¨æ‰€ä»¥å®‰è£…JDKç¯å¢ƒæ˜¯å¿…ä¸å¯å°‘çš„;</p>\n<p>å°†javaåº”ç”¨ä½œæˆdockeré•œåƒæ—¶ï¼Œéœ€è¦é•œåƒä¸­å¸¦æœ‰jdkæˆ–è€…jreç¯å¢ƒï¼Œé€šå¸¸æœ‰ä¸‰ç§æƒ…å†µï¼š</p>\n<ul>\n<li>åœ¨Dockerfileä¸­åŠ å…¥å®‰è£…jdkç¯å¢ƒçš„è„šæœ¬ï¼›</li>\n<li>é•œåƒä¸­åªæœ‰åº”ç”¨jaråŒ…ï¼Œå¯åŠ¨å®¹å™¨æ—¶é€šè¿‡æ•°æ®å·æ˜ å°„(-vå‚æ•°)å°†å®¿ä¸»æœºçš„jdkæ–‡ä»¶å¤¹æ˜ å°„åˆ°å®¹å™¨å†…ï¼›</li>\n<li>ä½¿ç”¨å¸¦æœ‰jdkçš„é•œåƒä½œä¸ºåŸºç¡€é•œåƒï¼›</li>\n</ul>\n<p>ä¸‰ç§æ–¹å¼å„æœ‰ä¼˜åŠ£</p>\n<ul>\n<li>ç¬¬ä¸€ç§ï¼Œå®Œå…¨è‡ªå·±åŠ¨æ‰‹ï¼Œå¯æ§æ€§å¼ºï¼Œä½†å¢åŠ äº†Dockerfileç¼–å†™çš„å·¥ä½œé‡ï¼Œè„šæœ¬è´¨é‡è¦è‡ªå·±ä¿è¯ï¼›</li>\n<li>ç¬¬äºŒç§ï¼Œè¦æ±‚å®¿ä¸»æœºé¢„å…ˆéƒ¨ç½²jdkï¼Œå¢åŠ äº†å®¿ä¸»æœºå·¥ä½œé‡ï¼›</li>\n<li>ç¬¬ä¸‰ç§ï¼Œç›¸å¯¹å·¥ä½œé‡å°ä¸€äº›ï¼Œå¦‚æœæ‰¾çš„åŸºç¡€é•œåƒä¸åˆé€‚ï¼Œä¼šå¯¼è‡´åšæˆçš„é•œåƒä½“ç§¯è¿‡å¤§ï¼Œæˆ–è€…å¤šäº†äº›ä¸éœ€è¦çš„å†…å®¹ï¼›</li>\n</ul>\n<p>ä¸ºäº†æ›´åŠ ç²¾ç®€ä»¥åŠç¨‹åºå¯ä»¥æ­£å¸¸è¿è¡Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å¯¹å…¶åŸºç¡€é•œåƒé€‰æ‹©æœ‰ä¸€ä¸ªç®€å•çš„äº†è§£;<br>åœ¨hub.docker.comä¸Šæœç´¢jdkå®˜æ–¹é•œåƒå…³é”®å­—openjdkï¼Œç‚¹è¿›è¯¦æƒ…é¡µåå¯»æ‰¾æˆ‘ä»¬å¸¸ç”¨çš„jdk8çš„é•œåƒæœ‰å¤šä¸ªTagsä¾‹å¦‚:<a href=\"https://hub.docker.com/_/openjdk?tab=tags\" target=\"_blank\" rel=\"noopener\">https://hub.docker.com/_/openjdk?tab=tags</a></p>\n<p>å®é™…ä¸ŠDockerå¤§å¤šæ•°åº”ç”¨éƒ½é»˜è®¤é‡‡ç”¨Debianæ“ä½œç³»ç»Ÿè¿›è¡Œæ„å»ºé•œåƒ,æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹debianç‰ˆæœ¬å·è¿›è¡Œä¸€ä¸ªç®€å•çš„äº†è§£:<br>|debianå‘è¡Œç‰ˆæœ¬å· | å«ä¹‰ |<br>|:- | :- |<br>|buster|å½“å‰çš„ç¨³å®šç‰ˆ|<br>|stretch |æ—§çš„ç¨³å®šç‰ˆï¼ŒåŒ…å«äº†Debianå®˜æ–¹æœ€è¿‘ä¸€æ¬¡å‘è¡Œçš„è½¯ä»¶åŒ…ï¼Œä¼˜å…ˆæ¨èä½¿ç”¨çš„ç‰ˆæœ¬|<br>|testing |æµ‹è¯•ç‰ˆæœ¬ï¼ŒåŒ…å«äº†å“ªäº›æš‚æ—¶æœªè¢«æ”¶å½•è¿›â€ç¨³å®šç‰ˆâ€œçš„è½¯ä»¶åŒ…|<br>|ubstable |ä¸ç¨³å®šç‰ˆï¼Œå¼€å‘ç‰ˆæœ¬|</p>\n<p>Q:å¦‚æ­¤å¤šçš„çš„tagæˆ‘ä»¬åˆè¯¥å¦‚ä½•é€‰æ‹©å‘¢?<br>ç­”: å¸¸è§„çš„åº”ç”¨å…¶Dockeré•œåƒTagå¾€å¾€æ˜¯ç›¸äº’ç»„åˆçš„<code>ç‰ˆæœ¬+æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆæœ¬å·+ea/slim</code>ç­‰å…³é”®å­—ç»„åˆ<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç‰ˆæœ¬å· openjdk:&lt;version&gt;</span></span><br><span class=\"line\"><span class=\"comment\"># Tag : openjdk:8</span></span><br><span class=\"line\">åŸºç¡€é•œåƒä¸ºDebainä¸Šæ„å»ºçš„openjdké•œåƒ;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># stretch å…³é”®å­—</span></span><br><span class=\"line\"><span class=\"comment\"># Tag : 8-jdk-stretch / 8-jre-stretch </span></span><br><span class=\"line\">å…¶ä¸­çš„stretchè¡¨æ˜è¿™ä¸ªé•œåƒçš„æ“ä½œç³»ç»Ÿæ˜¯debian9åœ¨æ­¤åŸºç¡€ä¸Šæ„å»ºäº†Jdk8æˆ–è€…Jre8ç¯å¢ƒçš„dockeré•œåƒ</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># eaå…³é”®å­—</span></span><br><span class=\"line\"><span class=\"comment\"># Tag : 16-ea-jdk</span></span><br><span class=\"line\">å…¶ä¸­çš„eaè¡¨ç¤ºçš„æ„æ€æ˜¯<span class=\"string\">\"Early Access\"</span>æ­£æ˜¯å‘å¸ƒä¹‹å‰çš„é¢„è§ˆç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬å¸¦æœ‰æ–°ç‰¹æ€§å¹¶ä¸”ä¿®å¤äº†è‹¥å¹²bug,éReleaseç‰ˆæœ¬ä¸å»ºè®®ç”Ÿäº§ç¯å¢ƒä½¿ç”¨;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># alpine å…³é”®å­— openjdk:&lt;version&gt;-alpine</span></span><br><span class=\"line\"><span class=\"comment\"># Tag : 13-ea-19-jdk-alpine3.9</span></span><br><span class=\"line\">å…¶ä¸­ä»¥alpineä½œä¸ºåŸºç¡€é•œåƒæ„å»ºå‡ºçš„openjdké•œåƒ</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># oraclelinux7å…³é”®å­— openjdk:&lt;version&gt;-oraclelinux7</span></span><br><span class=\"line\"><span class=\"comment\"># Tag : 13-ea-oraclelinux7</span></span><br><span class=\"line\">å…¶ä¸­çš„oraclelinux7è¡¨æ˜é•œåƒçš„æ“ä½œç³»ç»Ÿæ˜¯Oracle Linux 7ï¼Œä»jdk12å¼€å§‹openjdkå®˜æ–¹å¼€å§‹æä¾›åŸºäºOracle Linux 7çš„jdké•œåƒï¼›</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># buster å…³é”®å­—</span></span><br><span class=\"line\"><span class=\"comment\"># Tag : 15-jdk-buster</span></span><br><span class=\"line\">å…¶ä¸­busterè¡¨æ˜å½“å‰çš„æ˜¯ç¨³å®šçš„ç‰ˆæœ¬</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># slim å…³é”®å­—</span></span><br><span class=\"line\"><span class=\"comment\"># Tag : 15-jdk-slim</span></span><br><span class=\"line\">å…¶ä¸­slimè¡¨æ˜å½“å‰çš„jreå¹¶éæ ‡å‡†jreç‰ˆæœ¬è€Œæ˜¯headlessç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬çš„ç‰¹ç‚¹æ˜¯å»æ‰äº†UIã€é”®ç›˜ã€é¼ æ ‡ç›¸å…³çš„åº“ï¼Œå› æ­¤æ›´åŠ ç²¾ç®€é€‚åˆæœåŠ¡ç«¯åº”ç”¨ä½¿ç”¨</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># slim-buster å…³é”®å­—</span></span><br><span class=\"line\"><span class=\"comment\"># Tag : 15-slim-buster</span></span><br><span class=\"line\">å…¶ä¸­slim-busterè¡¨ç¤ºå½“å‰é•œåƒæ˜¯ç²¾ç®€ç¨³å®šç‰ˆæœ¬</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># windowsservercore å…³é”®å­— openjdk:&lt;version&gt;-windowsservercore</span></span><br><span class=\"line\"><span class=\"comment\"># Tag : 15-windowsservercore-ltsc2016  #å…¶å¤§å°è¶…ä¹æ‚¨çš„æƒ³è±¡</span></span><br><span class=\"line\">åŸºäºWindows Server Core (microsoft/windowsservercore)ã€‚å› æ­¤å®ƒåªé€‚ç”¨äºé•œåƒçš„ä½ç½®ï¼Œæ¯”å¦‚Windows 10 Professional/Enterprise(å‘¨å¹´çºªå¿µç‰ˆ)æˆ–Windows Server 2016ã€‚</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p><strong>è¾…åŠ©å·¥å…·</strong></p>\n<ul>\n<li>Docker é•œåƒåˆ†æå·¥å…· Dive ä¸‹å·¥å…·çš„ä½¿ç”¨å¯ä»¥åœ¨æˆ‘çš„å¦å¤–ä¸€ç¯‡æ–‡ç« <code>Dockerä½¿ç”¨è¾…åŠ©å·¥å…·æ±‡æ€»</code>ä¸­æ‰¾åˆ°å®ƒ:</li>\n</ul>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Containers","path":"api/categories/Containers.json"},{"name":"OperationTools","path":"api/categories/OperationTools.json"}],"tags":[{"name":"Docker","path":"api/tags/Docker.json"}]}