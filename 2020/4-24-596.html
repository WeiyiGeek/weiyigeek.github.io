<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ 7.Goç¼–ç¨‹å¿«é€Ÿå…¥é—¨å­¦ä¹ |WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="Go">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9134434519967436" crossorigin="anonymous"></script>    
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/2018/1-1-1.html"  >
                <i class="icon icon-lg icon-mortar-board"></i>
                å­¦ä¹ ä¹‹è·¯
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>7.Goç¼–ç¨‹å¿«é€Ÿå…¥é—¨å­¦ä¹ </span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">7.Goç¼–ç¨‹å¿«é€Ÿå…¥é—¨å­¦ä¹ </h1>
        <h5 class="subtitle">
            
                <time datetime="2020-04-24T03:16:58.000Z" itemprop="datePublished" class="page-time">
  2020-04-24
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Development/">Development</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Development/Programming/">Programming</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
  <article id="post-ç¼–ç¨‹ä¸–ç•Œ/Go/7.Goç¼–ç¨‹å¿«é€Ÿå…¥é—¨å­¦ä¹ "
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">7.Goç¼–ç¨‹å¿«é€Ÿå…¥é—¨å­¦ä¹ </h1>
        <div class="post-meta">
            <time class="post-time" title="2020-04-24 11:16:58" datetime="2020-04-24T03:16:58.000Z"  itemprop="datePublished">2020-04-24</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Development/">Development</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Development/Programming/">Programming</a></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h2 id="0X00-Goè¯­è¨€åŸºç¡€ä¹‹åå°„"><a href="#0X00-Goè¯­è¨€åŸºç¡€ä¹‹åå°„" class="headerlink" title="0X00 Goè¯­è¨€åŸºç¡€ä¹‹åå°„"></a>0X00 Goè¯­è¨€åŸºç¡€ä¹‹åå°„</h2><p>æˆ‘ä»¬åœ¨è¿›è¡Œè®²è§£Goåå°„æ¦‚å¿µå’Œä½¿ç”¨å‰ï¼Œå…ˆæ¥å¤ä¹ äº†è§£å˜é‡çš„å†…åœ¨æœºåˆ¶ã€‚</p>
<p>Goè¯­è¨€ä¸­çš„å˜é‡(Variables)æ˜¯åˆ†ä¸ºä¸¤éƒ¨åˆ†çš„:</p>
<ul>
<li>ç±»å‹ä¿¡æ¯ï¼šé¢„å…ˆå®šä¹‰å¥½çš„å…ƒä¿¡æ¯ã€‚</li>
<li>å€¼ä¿¡æ¯ï¼šç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­å¯åŠ¨æ€å˜åŒ–çš„ã€‚</li>
</ul>
<p><br/></p>
<p><strong>åå°„åº”ç”¨:</strong></p>
<ul>
<li>Json æ•°æ®è§£æ</li>
<li>ORM æ¡†æ¶å·¥å…·</li>
</ul>
<p><br/></p>
<h3 id="1-åŸºç¡€ä»‹ç»"><a href="#1-åŸºç¡€ä»‹ç»" class="headerlink" title="1.åŸºç¡€ä»‹ç»"></a>1.åŸºç¡€ä»‹ç»</h3><p>æè¿°: åå°„æ˜¯æŒ‡åœ¨ç¨‹åº<code>è¿è¡ŒæœŸ</code>å¯¹ç¨‹åºæœ¬èº«è¿›è¡Œ<code>è®¿é—®å’Œä¿®æ”¹</code>çš„èƒ½åŠ›ã€‚å³æ”¯æŒåå°„çš„è¯­è¨€å¯ä»¥åœ¨ç¨‹åºç¼–è¯‘æœŸå°†å˜é‡çš„åå°„ä¿¡æ¯ï¼Œå¦‚<code>å­—æ®µåç§°ã€ç±»å‹ä¿¡æ¯ã€ç»“æ„ä½“ä¿¡æ¯</code>ç­‰æ•´åˆåˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œå¹¶ç»™ç¨‹åºæä¾›æ¥å£è®¿é—®åå°„ä¿¡æ¯ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ç¨‹åºè¿è¡ŒæœŸè·å–ç±»å‹çš„åå°„ä¿¡æ¯ï¼Œå¹¶ä¸”æœ‰èƒ½åŠ›ä¿®æ”¹å®ƒä»¬ã€‚</p>
<p><br/></p>
<p><strong>ç¨‹åºè¿è¡ŒæœŸè¯´æ˜:</strong></p>
<ul>
<li>ç¨‹åºåœ¨ç¼–è¯‘æ—¶ï¼Œå˜é‡è¢«è½¬æ¢ä¸ºå†…å­˜åœ°å€ï¼Œå˜é‡åä¸ä¼šè¢«ç¼–è¯‘å™¨å†™å…¥åˆ°å¯æ‰§è¡Œéƒ¨åˆ†ã€‚</li>
<li>åœ¨è¿è¡Œç¨‹åºæ—¶ï¼Œç¨‹åºæ— æ³•è·å–è‡ªèº«çš„ä¿¡æ¯ã€‚</li>
</ul>
<p><br/></p>
<p>å‰é¢æˆ‘ä»¬ä»‹ç»ç©ºæ¥å£å¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹çš„å˜é‡ï¼Œé‚£æˆ‘ä»¬å¦‚ä½•çŸ¥é“è¿™ä¸ªç©ºæ¥å£ä¿å­˜çš„æ•°æ®æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<blockquote>
<p>ç­”: Goç¨‹åºåœ¨è¿è¡ŒæœŸä½¿ç”¨r eflectåŒ…è®¿é—®ç¨‹åºçš„åå°„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨åå°„åœ¨è¿è¡Œæ—¶åŠ¨æ€çš„è·å–ä¸€ä¸ªå˜é‡çš„ç±»å‹ä¿¡æ¯å’Œå€¼ä¿¡æ¯ã€‚<br>æ¥å£ç±»å‹çš„å˜é‡åº•å±‚åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†: <code>åŠ¨æ€ç±»å‹</code> å’Œ <code>åŠ¨æ€å€¼</code>ã€‚</p>
</blockquote>
<p><br/></p>
<p><strong>reflectåŒ…è¯´æ˜</strong></p>
<blockquote>
<p>ç­”: åœ¨Goè¯­è¨€çš„åå°„æœºåˆ¶ä¸­ï¼Œä»»ä½•æ¥å£å€¼éƒ½ç”±æ˜¯ä¸€ä¸ª<code>å…·ä½“ç±»å‹</code>å’Œ<code>å…·ä½“ç±»å‹çš„å€¼</code>ä¸¤éƒ¨åˆ†ç»„æˆçš„ã€‚ åœ¨Goè¯­è¨€ä¸­åå°„çš„ç›¸å…³åŠŸèƒ½ç”±å†…ç½®çš„reflectåŒ…æä¾›ï¼Œä»»æ„æ¥å£å€¼åœ¨åå°„ä¸­éƒ½å¯ä»¥ç†è§£ä¸ºç”±<code>reflect.Type</code>å’Œ<code>reflect.Value</code>ä¸¤éƒ¨åˆ†ç»„æˆï¼Œå¹¶ä¸”reflectåŒ…æä¾›äº†<code>reflect.TypeOf</code>å’Œ<code>reflect.ValueOf</code>ä¸¤ä¸ªå‡½æ•°æ¥è·å–ä»»æ„å¯¹è±¡çš„Valueå’ŒTypeã€‚</p>
</blockquote>
<p><br></p>
<p><strong>ç¤ºä¾‹1.Goå¦‚ä½•åšåˆ°è§£æJSONå­—ç¬¦ä¸²åˆ°å¯¹è±¡å±æ€§ä¸­çš„ã€‚</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">demo1</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">    Id   <span class="keyword">int</span>    <span class="string">`json:"id"`</span></span><br><span class="line">    Name <span class="keyword">string</span> <span class="string">`json:"name"`</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> p person</span><br><span class="line">  strJson := <span class="string">`&#123;"id": 1024,"name": "WeiyiGeek"&#125;`</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1.ååºåˆ—åŒ–å°†JSONå­—ç¬¦ä¸²ç»‘å®šåˆ°å¯¹è±¡å¯¹åº”å±æ€§ä¹‹ä¸­.(ä»–ä¸ºä½•å¯ä»¥æ ¹æ®JSONå­—ç¬¦ä¸²å¯¹åº”çš„keyè§£æåˆ°å¯¹è±¡å±æ€§ä¹‹ä¸­)</span></span><br><span class="line">  json.Unmarshal([]<span class="keyword">byte</span>(strJson), &amp;p)</span><br><span class="line">  <span class="comment">// 2.è¾“å‡ºå¯¹è±¡å±æ€§å€¼è¿›è¡ŒéªŒè¯</span></span><br><span class="line">  fmt.Println(<span class="string">"Id = "</span>, p.Id, <span class="string">",Name = "</span>, p.Name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// # è°ƒç”¨æ‰§è¡Œç»“æœ</span></span><br><span class="line">Id =  <span class="number">1024</span> ,Name =  WeiyiGeek</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="2-ç±»å‹å¯¹è±¡-reflect-Type"><a href="#2-ç±»å‹å¯¹è±¡-reflect-Type" class="headerlink" title="2.ç±»å‹å¯¹è±¡-reflect.Type"></a>2.ç±»å‹å¯¹è±¡-reflect.Type</h3><p>æè¿°: åœ¨Goè¯­è¨€ä¸­ï¼Œä½¿ç”¨<code>reflect.TypeOf()</code>å‡½æ•°å¯ä»¥è·å¾—ä»»æ„å€¼çš„ç±»å‹å¯¹è±¡ï¼ˆreflect.Typeï¼‰ï¼Œç¨‹åºé€šè¿‡ç±»å‹å¯¹è±¡å¯ä»¥è®¿é—®ä»»æ„å€¼çš„ç±»å‹ä¿¡æ¯ã€‚</p>
<p>åœ¨åå°„ä¸­å…³äºç±»å‹(<code>reflect.TypeOf</code>)è¿˜åˆ’åˆ†ä¸ºä¸¤ç§ï¼š<code>ç±»å‹ï¼ˆTypeï¼‰</code>å’Œ<code>ç§ç±»ï¼ˆKindï¼‰</code>ï¼Œå³æˆ‘ä»¬å¸¸è¯´çš„<code>reflect.TypeOf</code>è¿”å›çš„tå¯¹è±¡å¦‚<code>t.Name()ã€ t.Kind()</code>æ–¹æ³•è·å–çš„ä¿¡æ¯ã€‚</p>
<ul>
<li>åœ¨Goè¯­è¨€çš„åå°„ä¸­åƒæ•°ç»„ã€åˆ‡ç‰‡ã€Mapã€æŒ‡é’ˆç­‰ç±»å‹çš„å˜é‡ï¼Œå®ƒä»¬çš„.Name()éƒ½æ˜¯è¿”å›ç©ºã€‚</li>
<li>åœ¨Goè¯­è¨€ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨typeå…³é”®å­—æ„é€ å¾ˆå¤šè‡ªå®šä¹‰ç±»å‹ï¼Œè€Œç§ç±»ï¼ˆKindï¼‰å°±æ˜¯æŒ‡åº•å±‚çš„ç±»å‹ï¼Œä½†åœ¨åå°„ä¸­ï¼Œå½“éœ€è¦<code>åŒºåˆ†æŒ‡é’ˆã€ç»“æ„ä½“ã€ç±»å‹åˆ«å</code>ç­‰å¤§å“ç§çš„ç±»å‹æ—¶ï¼Œå°±ä¼šç”¨åˆ°ç§ç±»ï¼ˆKindï¼‰ã€‚</li>
</ul>
<p><br></p>
<p>åœ¨reflectåŒ…ä¸­å®šä¹‰çš„Kindç±»å‹å¦‚ä¸‹ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Kind <span class="keyword">uint</span></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">  Invalid Kind = <span class="literal">iota</span>  <span class="comment">// éæ³•ç±»å‹</span></span><br><span class="line">  Bool                 <span class="comment">// å¸ƒå°”å‹</span></span><br><span class="line">  Int                  <span class="comment">// æœ‰ç¬¦å·æ•´å‹</span></span><br><span class="line">  Int8                 <span class="comment">// æœ‰ç¬¦å·8ä½æ•´å‹</span></span><br><span class="line">  Int16                <span class="comment">// æœ‰ç¬¦å·16ä½æ•´å‹</span></span><br><span class="line">  Int32                <span class="comment">// æœ‰ç¬¦å·32ä½æ•´å‹</span></span><br><span class="line">  Int64                <span class="comment">// æœ‰ç¬¦å·64ä½æ•´å‹</span></span><br><span class="line">  Uint                 <span class="comment">// æ— ç¬¦å·æ•´å‹</span></span><br><span class="line">  Uint8                <span class="comment">// æ— ç¬¦å·8ä½æ•´å‹</span></span><br><span class="line">  Uint16               <span class="comment">// æ— ç¬¦å·16ä½æ•´å‹</span></span><br><span class="line">  Uint32               <span class="comment">// æ— ç¬¦å·32ä½æ•´å‹</span></span><br><span class="line">  Uint64               <span class="comment">// æ— ç¬¦å·64ä½æ•´å‹</span></span><br><span class="line">  Uintptr              <span class="comment">// æŒ‡é’ˆ</span></span><br><span class="line">  Float32              <span class="comment">// å•ç²¾åº¦æµ®ç‚¹æ•°</span></span><br><span class="line">  Float64              <span class="comment">// åŒç²¾åº¦æµ®ç‚¹æ•°</span></span><br><span class="line">  Complex64            <span class="comment">// 64ä½å¤æ•°ç±»å‹</span></span><br><span class="line">  Complex128           <span class="comment">// 128ä½å¤æ•°ç±»å‹</span></span><br><span class="line">  Array                <span class="comment">// æ•°ç»„</span></span><br><span class="line">  Chan                 <span class="comment">// é€šé“</span></span><br><span class="line">  Func                 <span class="comment">// å‡½æ•°</span></span><br><span class="line">  Interface            <span class="comment">// æ¥å£</span></span><br><span class="line">  Map                  <span class="comment">// æ˜ å°„</span></span><br><span class="line">  Ptr                  <span class="comment">// æŒ‡é’ˆ</span></span><br><span class="line">  Slice                <span class="comment">// åˆ‡ç‰‡</span></span><br><span class="line">  String               <span class="comment">// å­—ç¬¦ä¸²</span></span><br><span class="line">  Struct               <span class="comment">// ç»“æ„ä½“</span></span><br><span class="line">  UnsafePointer        <span class="comment">// åº•å±‚æŒ‡é’ˆ</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªæŒ‡é’ˆç±»å‹å’Œä¸¤ä¸ªç»“æ„ä½“ç±»å‹ï¼Œé€šè¿‡åå°„æŸ¥çœ‹å®ƒä»¬çš„ç±»å‹å’Œç§ç±»ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> myInt <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reflectType</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">  v := reflect.TypeOf(x)</span><br><span class="line">  k := v.Kind()   <span class="comment">// è·å–çš„æ˜¯åå°„å¯¹è±¡çš„ç±»å‹ (æ³¨æ„ä¸ä¸‹é¢ reflect.ValueOf(x).Kind() çš„åŒºåˆ«)</span></span><br><span class="line">  fmt.Printf(<span class="string">"Reflect Type = %v, Name Type : %v,Kind : %s (%d)\n"</span>, v, v.Name(), k, k)  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">demo1</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> a <span class="keyword">int64</span> = <span class="number">100</span>    <span class="comment">// æ•´å½¢</span></span><br><span class="line">  <span class="keyword">var</span> b <span class="keyword">float32</span> = <span class="number">3.14</span> <span class="comment">// æµ®ç‚¹å‹</span></span><br><span class="line">  <span class="keyword">var</span> c <span class="keyword">rune</span>           <span class="comment">// ç±»å‹åˆ«å</span></span><br><span class="line">  <span class="keyword">var</span> d myInt = <span class="number">1024</span>   <span class="comment">// è‡ªå®šä¹‰ç±»å‹</span></span><br><span class="line">  <span class="keyword">type</span> person <span class="keyword">struct</span> &#123; <span class="comment">// ç»“æ„ä½“</span></span><br><span class="line">    name <span class="keyword">string</span></span><br><span class="line">    age  <span class="keyword">int</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">type</span> book <span class="keyword">struct</span>&#123; title <span class="keyword">string</span> &#125;</span><br><span class="line">  <span class="keyword">var</span> e = person&#123;</span><br><span class="line">    name: <span class="string">"WeiyiGeek"</span>,</span><br><span class="line">    age:  <span class="number">18</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> f = book&#123;title: <span class="string">"ã€Šè·ŸWeiyiGeekå­¦Goè¯­è¨€ã€‹"</span>&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è°ƒç”¨æŸ¥çœ‹åå°„ç±»å‹</span></span><br><span class="line">  reflectType(a)</span><br><span class="line">  reflectType(b)</span><br><span class="line">  reflectType(c)</span><br><span class="line">  reflectType(d)</span><br><span class="line">  reflectType(e)</span><br><span class="line">  reflectType(f)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  demo1()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œç»“æœ:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Reflect Type = <span class="keyword">int64</span>, Name Type : <span class="keyword">int64</span>,Kind : <span class="keyword">int64</span> (<span class="number">6</span>)</span><br><span class="line">Reflect Type = <span class="keyword">float32</span>, Name Type : <span class="keyword">float32</span>,Kind : <span class="keyword">float32</span> (<span class="number">13</span>)</span><br><span class="line">Reflect Type = <span class="keyword">int32</span>, Name Type : <span class="keyword">int32</span>,Kind : <span class="keyword">int32</span> (<span class="number">5</span>)</span><br><span class="line">Reflect Type = main.myInt, Name Type : myInt,Kind : <span class="keyword">int</span> (<span class="number">2</span>)</span><br><span class="line">Reflect Type = main.person, Name Type : person,Kind : <span class="keyword">struct</span> (<span class="number">25</span>)</span><br><span class="line">Reflect Type = main.book, Name Type : book,Kind : <span class="keyword">struct</span> (<span class="number">25</span>)</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="3-ç±»å‹å¯¹è±¡å€¼-reflect-Value"><a href="#3-ç±»å‹å¯¹è±¡å€¼-reflect-Value" class="headerlink" title="3.ç±»å‹å¯¹è±¡å€¼-reflect.Value"></a>3.ç±»å‹å¯¹è±¡å€¼-reflect.Value</h3><p>æè¿°: <code>reflect.ValueOf()</code>è¿”å›çš„æ˜¯<code>reflect.Value</code>ç±»å‹ï¼Œå…¶ä¸­åŒ…å«äº†åŸå§‹å€¼çš„å€¼ä¿¡æ¯,reflect.Valueä¸åŸå§‹å€¼ä¹‹é—´å¯ä»¥äº’ç›¸è½¬æ¢ã€‚</p>
<ul>
<li><p>é€šè¿‡åå°„è·å–å€¼ , reflect.Value ç±»å‹æä¾›çš„è·å–åŸå§‹å€¼çš„æ–¹æ³•å¦‚ä¸‹:</p>
<ul>
<li><code>Interface() interface {}</code>    : å°†å€¼ä»¥ interface{} ç±»å‹è¿”å›ï¼Œå¯ä»¥é€šè¿‡ç±»å‹æ–­è¨€è½¬æ¢ä¸ºæŒ‡å®šç±»å‹</li>
<li><code>Int() int64</code>    :     å°†å€¼ä»¥ int ç±»å‹è¿”å›ï¼Œæ‰€æœ‰æœ‰ç¬¦å·æ•´å‹å‡å¯ä»¥æ­¤æ–¹å¼è¿”å›</li>
<li><code>Uint() uint64</code>    :     å°†å€¼ä»¥ uint ç±»å‹è¿”å›ï¼Œæ‰€æœ‰æ— ç¬¦å·æ•´å‹å‡å¯ä»¥æ­¤æ–¹å¼è¿”å›</li>
<li><code>Float() float64</code>    :     å°†å€¼ä»¥åŒç²¾åº¦ï¼ˆfloat64ï¼‰ç±»å‹è¿”å›ï¼Œæ‰€æœ‰æµ®ç‚¹æ•°ï¼ˆfloat32ã€float64ï¼‰å‡å¯ä»¥æ­¤æ–¹å¼è¿”å›</li>
<li><code>Bool() bool</code>    :     å°†å€¼ä»¥ bool ç±»å‹è¿”å›</li>
<li><code>Bytes() []bytes</code>    :     å°†å€¼ä»¥å­—èŠ‚æ•°ç»„ []bytes ç±»å‹è¿”å›</li>
<li><code>String() string</code>    :     å°†å€¼ä»¥å­—ç¬¦ä¸²ç±»å‹è¿”å›</li>
</ul>
</li>
<li><p>é€šè¿‡åå°„è®¾ç½®å˜é‡çš„å€¼ã€‚</p>
<ul>
<li>åœ¨å‡½æ•°ä¸­é€šè¿‡åå°„ä¿®æ”¹å˜é‡çš„å€¼ï¼Œå¦‚æœä¼ é€’éå˜é‡åœ°å€å€¼åˆ™ä¼šæŠ¥<code>panic: reflect: reflect.Value.Type using unaddressable value</code>é”™è¯¯ã€‚</li>
<li>åœ¨å‡½æ•°ä¸­é€šè¿‡åå°„ä¿®æ”¹å˜é‡çš„å€¼ï¼Œéœ€è¦æ³¨æ„å‡½æ•°å‚æ•°ä¼ é€’çš„æ˜¯å€¼æ‹·è´ï¼Œå¿…é¡»ä¼ é€’å˜é‡åœ°å€æ‰èƒ½ä¿®æ”¹å˜é‡å€¼,è€Œåå°„ä¸­ä½¿ç”¨ä¸“æœ‰çš„Elem()æ–¹æ³•æ¥è·å–æŒ‡é’ˆå¯¹åº”çš„å€¼ã€‚</li>
</ul>
</li>
</ul>
<p><br></p>
<p>ä¾‹å¦‚ï¼Œä¸‹è¿°æˆ‘ä»¬åˆ†åˆ«é‡‡ç”¨åå°„çš„ValueOfæ–¹æ³•è·å–çš„ç›¸å…³ä¿¡æ¯è¿›è¡Œè·å–å€¼ä¸è®¾ç½®å€¼.<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡åå°„è·å–å˜é‡çš„å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reflectTypeValue</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">  t := reflect.TypeOf(x)</span><br><span class="line">  v := reflect.ValueOf(x)</span><br><span class="line">  k := v.Kind()   <span class="comment">// è·å–çš„æ˜¯å€¼çš„ç§ç±»</span></span><br><span class="line">  <span class="keyword">switch</span> k &#123;</span><br><span class="line">  <span class="keyword">case</span> reflect.Int64:</span><br><span class="line">    <span class="comment">// v.Int()ä»åå°„ä¸­è·å–æ•´å‹çš„åŸå§‹å€¼ï¼Œç„¶åé€šè¿‡int64()å¼ºåˆ¶ç±»å‹è½¬æ¢</span></span><br><span class="line">    fmt.Printf(<span class="string">"type is int64, value is %d\n"</span>, <span class="keyword">int64</span>(v.Int()))</span><br><span class="line">  <span class="keyword">case</span> reflect.Float32:</span><br><span class="line">    <span class="comment">// v.Float()ä»åå°„ä¸­è·å–æµ®ç‚¹å‹çš„åŸå§‹å€¼ï¼Œç„¶åé€šè¿‡float32()å¼ºåˆ¶ç±»å‹è½¬æ¢</span></span><br><span class="line">    fmt.Printf(<span class="string">"type is float32, value is %f\n"</span>, <span class="keyword">float32</span>(v.Float()))</span><br><span class="line">  <span class="keyword">case</span> reflect.Float64:</span><br><span class="line">    <span class="comment">// v.Float()ä»åå°„ä¸­è·å–æµ®ç‚¹å‹çš„åŸå§‹å€¼ï¼Œç„¶åé€šè¿‡float64()å¼ºåˆ¶ç±»å‹è½¬æ¢</span></span><br><span class="line">    fmt.Printf(<span class="string">"type is float64, value is %f\n"</span>, <span class="keyword">float64</span>(v.Float()))</span><br><span class="line">  <span class="keyword">case</span> reflect.Bool:</span><br><span class="line">    <span class="comment">// v.Bool()ä»åå°„ä¸­è·å–å¸ƒå°”å‹çš„åŸå§‹å€¼ï¼Œç„¶åé€šè¿‡Bool()å¼ºåˆ¶ç±»å‹è½¬æ¢</span></span><br><span class="line">    fmt.Printf(<span class="string">"type is bool, value is %v\n"</span>, <span class="keyword">bool</span>(v.Bool()))</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Printf(<span class="string">"Reflect Type = %v, Reflect Value = %v, Name : %v, Kind : %s (%d)\n\n"</span>, t, v, t.Name(), v.Kind(), v.Kind())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡åå°„è®¾ç½®å˜é‡çš„å€¼(æ­¤ç§æ–¹å¼ä¼šæŠ¥é”™)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reflectSetValue1</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">  t := reflect.TypeOf(x)</span><br><span class="line">  v := reflect.ValueOf(x)</span><br><span class="line">  <span class="comment">// ä½¿ç”¨é»˜è®¤æ–¹å¼ä¿®æ”¹çš„æ˜¯å‰¯æœ¬ï¼ŒreflectåŒ…ä¼šå¼•å‘panic</span></span><br><span class="line">  <span class="keyword">if</span> v.Kind() == reflect.Int64 &#123;</span><br><span class="line">    v.SetInt(<span class="number">200</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Printf(<span class="string">"Type %v, Value %v\n"</span>, t, v)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡åå°„è®¾ç½®å˜é‡çš„å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reflectSetValue2</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">  t := reflect.TypeOf(x)</span><br><span class="line">  v := reflect.ValueOf(x)</span><br><span class="line">  <span class="comment">// åå°„ä¸­ä½¿ç”¨ Elem()æ–¹æ³•è·å–æŒ‡é’ˆå¯¹åº”çš„å€¼</span></span><br><span class="line">  <span class="keyword">if</span> v.Elem().Kind() == reflect.Int64 &#123;</span><br><span class="line">    v.Elem().SetInt(<span class="number">200</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Printf(<span class="string">"Type %v, Value %v\n"</span>, t, v)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">demo2</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// å°†å¸¸è§„ç±»å‹åˆå§‹åŒ–å¹¶è®¾ç½®å€¼ï¼Œç„¶åé€šè¿‡åå°„è·å–å€¼</span></span><br><span class="line">  <span class="keyword">var</span> a <span class="keyword">int</span> = <span class="number">1024</span></span><br><span class="line">  <span class="keyword">var</span> b <span class="keyword">float32</span> = <span class="number">3.14</span></span><br><span class="line">  reflectTypeValue(a)</span><br><span class="line">  reflectTypeValue(b)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†intç±»å‹çš„åŸå§‹å€¼è½¬æ¢ä¸ºreflect.Valueç±»å‹</span></span><br><span class="line">  c := reflect.ValueOf(<span class="number">10</span>)</span><br><span class="line">  fmt.Printf(<span class="string">"Type c : %T, Value c : %v\n"</span>, c, c)</span><br><span class="line">  reflectTypeValue(c)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é€šè¿‡åå°„è®¾ç½®å˜é‡çš„å€¼ï¼ˆä¸¤ç§æ–¹æ³•ï¼‰</span></span><br><span class="line">  <span class="keyword">var</span> d <span class="keyword">int64</span> = <span class="number">65535</span></span><br><span class="line">  <span class="comment">// reflectSetValue1(d) //panic: reflect: reflect.Value.SetInt using unaddressable value</span></span><br><span class="line">  reflectSetValue2(&amp;d) <span class="comment">// ä¿®æ”¹æ˜¯çš„æŒ‡é’ˆæŒ‡å‘çš„å€¼</span></span><br><span class="line">  fmt.Println(<span class="string">"é€šè¿‡åå°„è®¾ç½®å˜é‡(d)çš„å€¼: "</span>, d)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"> Â demo2()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œç»“æœ:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Reflect Type = <span class="keyword">int</span>, Reflect Value = <span class="number">1024</span>, Name : <span class="keyword">int</span>, Kind : <span class="keyword">int</span> (<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> is <span class="keyword">float32</span>, value is <span class="number">3.140000</span></span><br><span class="line">Reflect Type = <span class="keyword">float32</span>, Reflect Value = <span class="number">3.14</span>, Name : <span class="keyword">float32</span>, Kind : <span class="keyword">float32</span> (<span class="number">13</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> is <span class="keyword">bool</span>, value is <span class="literal">true</span></span><br><span class="line">Reflect Type = <span class="keyword">bool</span>, Reflect Value = <span class="literal">true</span>, Name : <span class="keyword">bool</span>, Kind : <span class="keyword">bool</span> (<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">Type c : reflect.Value, Value c : <span class="number">10</span></span><br><span class="line">Reflect Type = reflect.Value, Reflect Value = &lt;<span class="keyword">int</span> Value&gt;, Name : Value, Kind : <span class="keyword">struct</span> (<span class="number">25</span>)</span><br><span class="line"></span><br><span class="line">Type *<span class="keyword">int64</span>, Value <span class="number">0xc0000ba040</span></span><br><span class="line">é€šè¿‡åå°„è®¾ç½®å˜é‡(d)çš„å€¼:  <span class="number">200</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="4-åå°„å€¼åˆ¤æ–­"><a href="#4-åå°„å€¼åˆ¤æ–­" class="headerlink" title="4.åå°„å€¼åˆ¤æ–­"></a>4.åå°„å€¼åˆ¤æ–­</h3><p>Goä¸­å¸¸ç”¨çš„åå°„å€¼æ˜¯å¦ä¸ºç©ºä»¥åŠæ˜¯å¦æœ‰æ•ˆå¸¸å¸¸ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹æ³•<code>isNil()</code>å’Œ<code>isValid()</code>ï¼š</p>
<ul>
<li><code>func (v Value) IsNil() bool</code>: å¸¸è¢«ç”¨äºåˆ¤æ–­æŒ‡é’ˆæ˜¯å¦ä¸ºç©º, è¿”å›væŒæœ‰çš„å€¼æ˜¯å¦ä¸ºnil,ä¸”åˆ†ç±»å¿…é¡»æ˜¯<code>é€šé“ã€å‡½æ•°ã€æ¥å£ã€æ˜ å°„ã€æŒ‡é’ˆã€åˆ‡ç‰‡</code>ä¹‹ä¸€ï¼›å¦åˆ™IsNilå‡½æ•°ä¼šå¯¼è‡´panicã€‚</li>
<li><code>func (v Value) IsValid() bool</code>: å¸¸è¢«ç”¨äºåˆ¤å®šè¿”å›å€¼æ˜¯å¦æœ‰æ•ˆ, è¿”å›væ˜¯å¦æŒæœ‰ä¸€ä¸ªå€¼ã€‚å¦‚æœvæ˜¯Valueé›¶å€¼ä¼šè¿”å›å‡ï¼Œæ­¤æ—¶vé™¤äº†<code>IsValidã€Stringã€Kind</code>ä¹‹å¤–çš„æ–¹æ³•éƒ½ä¼šå¯¼è‡´panicã€‚ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹æ¼”ç¤º:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> b <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *b)</span> <span class="title">Demo</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">  fmt.Print(<span class="string">"æˆ‘æ˜¯é€šè¿‡Callè°ƒç”¨çš„Demoæ–¹æ³•ï¼Œ"</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1024</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// (1) *intç±»å‹ç©ºæŒ‡é’ˆ : å¿…é¡»æ˜¯é€šé“ã€å‡½æ•°ã€æ¥å£ã€æ˜ å°„ã€æŒ‡é’ˆã€åˆ‡ç‰‡ä¹‹ä¸€</span></span><br><span class="line">  <span class="keyword">var</span> a *<span class="keyword">int</span></span><br><span class="line">  fmt.Println(<span class="string">"var a *int IsNil:"</span>, reflect.ValueOf(a).IsNil())</span><br><span class="line">  <span class="comment">// (2) nilå€¼ : é™¤äº†IsValidã€Stringã€Kindä¹‹å¤–çš„æ–¹æ³•éƒ½ä¼šå¯¼è‡´panicã€‚</span></span><br><span class="line">  fmt.Println(<span class="string">"nil IsValid:"</span>, reflect.ValueOf(<span class="literal">nil</span>).IsValid())</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (3) å®ä¾‹åŒ–ä¸€ä¸ªåŒ¿åç»“æ„ä½“</span></span><br><span class="line">  b1 := <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">  b2 := <span class="keyword">struct</span> &#123;</span><br><span class="line">    abc <span class="keyword">string</span></span><br><span class="line">  &#125;&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (4) å®ä¾‹åŒ–ä¸€ä¸ªç»“æ„ä½“</span></span><br><span class="line">  b3 := <span class="built_in">new</span>(b)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°è¯•ä»ç»“æ„ä½“ä¸­æŸ¥æ‰¾"abc"å­—æ®µ</span></span><br><span class="line">  fmt.Println(<span class="string">"b1æ˜¯å¦å­˜åœ¨çš„ç»“æ„ä½“æˆå‘˜ abc ? :"</span>, reflect.ValueOf(b1).FieldByName(<span class="string">"abc"</span>).IsValid()) <span class="comment">// ä¸å­˜åœ¨</span></span><br><span class="line">  fmt.Println(<span class="string">"b2æ˜¯å¦å­˜åœ¨çš„ç»“æ„ä½“æˆå‘˜ abc ? :"</span>, reflect.ValueOf(b2).FieldByName(<span class="string">"abc"</span>).IsValid()) <span class="comment">// å­˜åœ¨</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°è¯•ä»ç»“æ„ä½“ä¸­æŸ¥æ‰¾"demo"æ–¹æ³•</span></span><br><span class="line">  fmt.Println(<span class="string">"b1æ˜¯å¦å­˜åœ¨çš„ç»“æ„ä½“æ–¹æ³• Demo ? :"</span>, reflect.ValueOf(b1).MethodByName(<span class="string">"Demo"</span>).IsValid())            <span class="comment">//ä¸å­˜åœ¨</span></span><br><span class="line">  fmt.Println(<span class="string">"b3æ˜¯å¦å­˜åœ¨çš„ç»“æ„ä½“æ–¹æ³• Demo ? :"</span>, reflect.ValueOf(b3).MethodByName(<span class="string">"Demo"</span>).IsValid())            <span class="comment">//å­˜åœ¨</span></span><br><span class="line">  fmt.Println(<span class="string">"b3ç»“æ„ä½“Demoæ–¹æ³•è¿”å›å€¼ç±»å‹: "</span>, reflect.ValueOf(b3).MethodByName(<span class="string">"Demo"</span>).Call([]reflect.Value&#123;&#125;)) <span class="comment">//è¾“å‡ºæ‰§è¡Œå…¶æ–¹æ³•ä»¥åŠè¿”å›å€¼çš„ç±»å‹ ï¼ˆç‰¹åˆ«æ³¨æ„ï¼Œå…ˆæ‰§è¡Œè°ƒç”¨åè¿”å›ç±»å‹ï¼Œå¹¶è¾“å‡ºï¼‰</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// (4) map 	å°è¯•ä»mapä¸­æŸ¥æ‰¾ä¸€ä¸ªä¸å­˜åœ¨çš„é”®</span></span><br><span class="line">  c := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">  c[<span class="string">"WeiyiGeek"</span>] = <span class="number">1024</span></span><br><span class="line">  fmt.Println(<span class="string">"mapä¸­æ˜¯å¦å­˜åœ¨WeiyiGeekçš„é”®ï¼š"</span>, reflect.ValueOf(c).MapIndex(reflect.ValueOf(<span class="string">"WeiyiGeek"</span>)).IsValid())</span><br><span class="line">  fmt.Println(<span class="string">"mapä¸­æ˜¯å¦å­˜åœ¨Geekçš„é”®ï¼š"</span>, reflect.ValueOf(c).MapIndex(reflect.ValueOf(<span class="string">"Geek"</span>)).IsValid())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œç»“æœ:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a *<span class="keyword">int</span> IsNil: <span class="literal">true</span></span><br><span class="line"><span class="literal">nil</span> IsValid: <span class="literal">false</span></span><br><span class="line">b1æ˜¯å¦å­˜åœ¨çš„ç»“æ„ä½“æˆå‘˜ abc ? : <span class="literal">false</span></span><br><span class="line">b2æ˜¯å¦å­˜åœ¨çš„ç»“æ„ä½“æˆå‘˜ abc ? : <span class="literal">true</span></span><br><span class="line">b1æ˜¯å¦å­˜åœ¨çš„ç»“æ„ä½“æ–¹æ³• Demo ? : <span class="literal">false</span></span><br><span class="line">b3æ˜¯å¦å­˜åœ¨çš„ç»“æ„ä½“æ–¹æ³• Demo ? : <span class="literal">true</span></span><br><span class="line">æˆ‘æ˜¯é€šè¿‡Callè°ƒç”¨çš„Demoæ–¹æ³•ï¼Œb3ç»“æ„ä½“Demoæ–¹æ³•è¿”å›å€¼ç±»å‹:  [&lt;<span class="keyword">int</span> Value&gt;]</span><br><span class="line"><span class="keyword">map</span>ä¸­æ˜¯å¦å­˜åœ¨WeiyiGeekçš„é”®ï¼š <span class="literal">true</span></span><br><span class="line"><span class="keyword">map</span>ä¸­æ˜¯å¦å­˜åœ¨Geekçš„é”®ï¼š <span class="literal">false</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="5-ç»“æ„ä½“åå°„å®è·µ"><a href="#5-ç»“æ„ä½“åå°„å®è·µ" class="headerlink" title="5.ç»“æ„ä½“åå°„å®è·µ"></a>5.ç»“æ„ä½“åå°„å®è·µ</h3><p>æè¿°: ä¸‹é¢è®²è§£ä¸ç»“æ„ä½“ç›¸å…³çš„åå°„çŸ¥è¯†ï¼Œå½“ä»»æ„å€¼é€šè¿‡<code>reflect.TypeOf()</code>è·å¾—åå°„å¯¹è±¡ä¿¡æ¯åï¼Œå¦‚æœå®ƒçš„ç±»å‹æ˜¯ç»“æ„ä½“ï¼Œå¯ä»¥é€šè¿‡<code>åå°„å€¼å¯¹è±¡ï¼ˆreflect.Typeï¼‰</code>çš„<code>NumField()æ–¹æ³•</code>å’Œ<code>Field()æ–¹æ³•</code>è·å¾—ç»“æ„ä½“æˆå‘˜çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>
<p><strong>ç»“æ„ä½“æˆå‘˜ç›¸å…³ä¿¡æ¯è·å–æ–¹æ³•</strong></p>
<p>å¦‚ä¸‹è¡¨æ‰€ç¤º<code>reflect.Type</code>ä¸­ä¸è·å–ç»“æ„ä½“æˆå‘˜ç›¸å…³çš„æ–¹æ³•ã€‚</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>NumField() <code>int</code></td>
<td>è¿”å›ç»“æ„ä½“æˆå‘˜å­—æ®µæ•°é‡ã€‚</td>
</tr>
<tr>
<td>Field(i int) <code>StructField</code></td>
<td>æ ¹æ®ç´¢å¼•ï¼Œè¿”å›ç´¢å¼•å¯¹åº”çš„ç»“æ„ä½“å­—æ®µçš„ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td>FieldByName(name string) <code>(StructField, bool)</code></td>
<td>æ ¹æ®ç»™å®šå­—ç¬¦ä¸²è¿”å›å­—ç¬¦ä¸²å¯¹åº”çš„ç»“æ„ä½“å­—æ®µçš„ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td>FieldByIndex(index []int) <code>StructField</code></td>
<td>å¤šå±‚æˆå‘˜è®¿é—®æ—¶ï¼Œæ ¹æ® []int æä¾›çš„æ¯ä¸ªç»“æ„ä½“çš„å­—æ®µç´¢å¼•ï¼Œè¿”å›å­—æ®µçš„ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td>FieldByNameFunc(match func(string) bool) <code>(StructField,bool)</code></td>
<td>æ ¹æ®ä¼ å…¥çš„åŒ¹é…å‡½æ•°åŒ¹é…éœ€è¦çš„å­—æ®µã€‚</td>
</tr>
<tr>
<td>NumMethod() <code>int</code></td>
<td>è¿”å›è¯¥ç±»å‹çš„æ–¹æ³•é›†ä¸­æ–¹æ³•çš„æ•°ç›®</td>
</tr>
<tr>
<td>Method(int) <code>Method</code></td>
<td>è¿”å›è¯¥ç±»å‹æ–¹æ³•é›†ä¸­çš„ç¬¬iä¸ªæ–¹æ³•</td>
</tr>
<tr>
<td>MethodByName(string) <code>(Method, bool)</code></td>
<td>æ ¹æ®æ–¹æ³•åè¿”å›è¯¥ç±»å‹æ–¹æ³•é›†ä¸­çš„æ–¹æ³•</td>
</tr>
</tbody>
</table>
<p><br></p>
<p><strong>StructField ç±»å‹</strong><br>æè¿°: StructFieldç±»å‹ç”¨æ¥æè¿°ç»“æ„ä½“ä¸­çš„ä¸€ä¸ªå­—æ®µçš„ä¿¡æ¯,<code>StructField</code> çš„å®šä¹‰å¦‚ä¸‹ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> StructField <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name    <span class="keyword">string</span>      <span class="comment">// å­—æ®µçš„åå­—ã€‚</span></span><br><span class="line">  PkgPath <span class="keyword">string</span>      <span class="comment">// éå¯¼å‡ºå­—æ®µçš„åŒ…è·¯å¾„ï¼Œå¯¹å¯¼å‡ºå­—æ®µè¯¥å­—æ®µä¸º""ã€‚å‚è§ http://golang.org/ref/spec#Uniqueness_of_identifiers</span></span><br><span class="line">  Type      Type      <span class="comment">// å­—æ®µçš„ç±»å‹</span></span><br><span class="line">  Tag       StructTag <span class="comment">// å­—æ®µçš„æ ‡ç­¾</span></span><br><span class="line">  Offset    <span class="keyword">uintptr</span>   <span class="comment">// å­—æ®µåœ¨ç»“æ„ä½“ä¸­çš„å­—èŠ‚åç§»é‡</span></span><br><span class="line">  Index     []<span class="keyword">int</span>     <span class="comment">// ç”¨äºType.FieldByIndexæ—¶çš„ç´¢å¼•åˆ‡ç‰‡</span></span><br><span class="line">  Anonymous <span class="keyword">bool</span>      <span class="comment">// æ˜¯å¦åŒ¿åå­—æ®µ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>å®è·µæ¡ˆä¾‹:</strong><br>ç¤ºä¾‹è¯´æ˜, å½“æˆ‘ä»¬ä½¿ç”¨åå°„å¾—åˆ°ä¸€ä¸ªç»“æ„ä½“æ•°æ®ä¹‹åå¯ä»¥é€šè¿‡ç´¢å¼•ä¾æ¬¡è·å–å…¶å­—æ®µä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å­—æ®µåå»è·å–æŒ‡å®šçš„å­—æ®µä¿¡æ¯ï¼Œä»¥åŠé€šè¿‡ç´¢å¼•è·å–æ–¹æ³•ä¿¡æ¯å’Œè°ƒç”¨æ‰§è¡Œè¯¥ç´¢å¼•æŒ‡å®šçš„æ–¹æ³•ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name  <span class="keyword">string</span> <span class="string">`json:"name" person:"weiyigeek"`</span> <span class="comment">// å¯ä»¥æœ‰å¤šä¸ªTag</span></span><br><span class="line">  Score <span class="keyword">int</span>    <span class="string">`json:"score" person:"geek"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»™studentæ·»åŠ ä¸¤ä¸ªæ–¹æ³• Studyå’ŒSleep(æ³¨æ„é¦–å­—æ¯å¤§å†™)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s student)</span> <span class="title">Study</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">  msg := <span class="string">"[Study] å¥½å¥½å­¦ä¹ ï¼Œå¤©å¤©å‘ä¸Šã€‚"</span></span><br><span class="line">  fmt.Println(msg)</span><br><span class="line">  <span class="keyword">return</span> msg</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s student)</span> <span class="title">Sleep</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">  msg := <span class="string">"[Sleep] å¥½å¥½ç¡è§‰ï¼Œå¿«å¿«é•¿å¤§ã€‚"</span></span><br><span class="line">  fmt.Println(msg)</span><br><span class="line">  <span class="keyword">return</span> msg</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æ„ä½“åå°„ç¤ºä¾‹æ¼”ç¤ºæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Reflectstruct</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">  <span class="comment">// (2) è·å– stu1 å¯¹è±¡åå°„ç±»å‹ä¿¡æ¯,è¾“å‡ºå¯¹è±¡åç§°ä»¥åŠå¯¹è±¡ç§ç±»</span></span><br><span class="line">  t := reflect.TypeOf(x)</span><br><span class="line">  v := reflect.ValueOf(x)</span><br><span class="line">  fmt.Println(<span class="string">"reflect.TypeOf -&gt;"</span>, t.Name(), t.Kind()) <span class="comment">// student struct</span></span><br><span class="line">  fmt.Println(<span class="string">"reflect.ValueOf -&gt;"</span>, v, v.Kind())       <span class="comment">// &#123;WeiyiGeek 90&#125; struct</span></span><br><span class="line">  fmt.Println()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (3) é€šè¿‡forå¾ªç¯éå†ç»“æ„ä½“çš„æ‰€æœ‰å­—æ®µä¿¡æ¯(æ–¹å¼1)</span></span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; t.NumField(); i++ &#123;</span><br><span class="line">    field := t.Field(i)</span><br><span class="line">    <span class="comment">//fmt.Print(v.Field(i).Call([]reflect.Value&#123;&#125;))</span></span><br><span class="line">    fmt.Printf(<span class="string">"name:%s index:%d type:%v json tag: %v  person tag:%v , Field Anonymous: %v\n"</span>, field.Name, field.Index, field.Type, field.Tag.Get(<span class="string">"json"</span>), field.Tag.Get(<span class="string">"person"</span>), field.Anonymous)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (4) é€šè¿‡å­—æ®µåè·å–æŒ‡å®šç»“æ„ä½“å­—æ®µä¿¡æ¯(æ–¹å¼2)</span></span><br><span class="line">  <span class="keyword">if</span> scoreField, ok := t.FieldByName(<span class="string">"Score"</span>); ok &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"\nname:%s index:%d type:%v json tag:%v , Field Anonymous: %v\n"</span>, scoreField.Name, scoreField.Index, scoreField.Type, scoreField.Tag.Get(<span class="string">"json"</span>), scoreField.Anonymous)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (5) é€šè¿‡forå¾ªç¯éå†ç»“æ„ä½“çš„æ‰€æœ‰æ–¹æ³•ä¿¡æ¯</span></span><br><span class="line">  fmt.Println(<span class="string">"reflect.TypeOf NumMethod-&gt;"</span>, t.NumMethod())</span><br><span class="line">  fmt.Println(<span class="string">"reflect.ValueOf NumMethod-&gt;"</span>, v.NumMethod())</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; v.NumMethod(); i++ &#123;</span><br><span class="line">    methodType := v.Method(i).Type()</span><br><span class="line">    fmt.Printf(<span class="string">"method name:% sï¼Œmethod: %s\n"</span>, t.Method(i).Name, methodType)</span><br><span class="line">    <span class="comment">// é€šè¿‡åå°„è°ƒç”¨æ–¹æ³•ä¼ é€’çš„å‚æ•°å¿…é¡»æ˜¯ []reflect.Value ç±»å‹</span></span><br><span class="line">    <span class="keyword">var</span> args = []reflect.Value&#123;&#125;</span><br><span class="line">    <span class="comment">// ç›¸å½“äºä¾æ¬¡è°ƒç”¨ç»“æ„ä½“ä¸­çš„æ–¹æ³•</span></span><br><span class="line">    v.Method(i).Call(args)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (6) é€šè¿‡æ–¹æ³•åè·å–æŒ‡å®šçš„ç»“æ„ä½“æ–¹æ³•å¹¶æ‰§è¡Œ</span></span><br><span class="line">  methodSleep := v.MethodByName(<span class="string">"Sleep"</span>)</span><br><span class="line">  methodSleepType := methodSleep.Type()</span><br><span class="line">  fmt.Printf(<span class="string">"Reflect Method ptr:%vï¼Œmethod Type: %v\n"</span>, methodSleep, methodSleepType)</span><br><span class="line">  <span class="comment">// é€šè¿‡åå°„è°ƒç”¨æ–¹æ³•ä¼ é€’çš„å‚æ•°å¿…é¡»æ˜¯ []reflect.Value ç±»å‹</span></span><br><span class="line">  <span class="keyword">var</span> args = []reflect.Value&#123;&#125;</span><br><span class="line">  <span class="comment">// ç›¸å½“è°ƒç”¨ ç»“æ„ä½“çš„ Sleep() æ–¹æ³•</span></span><br><span class="line">  methodSleep.Call(args)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// (1) å®ä¾‹åŒ– student ç»“æ„ä½“</span></span><br><span class="line">  stu := student&#123;</span><br><span class="line">    Name:  <span class="string">"WeiyiGeek"</span>,</span><br><span class="line">    Score: <span class="number">90</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  Reflectstruct(stu)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç»“æœ:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">reflect.TypeOf -&gt; student <span class="keyword">struct</span></span><br><span class="line">reflect.ValueOf -&gt; &#123;WeiyiGeek <span class="number">90</span>&#125; <span class="keyword">struct</span></span><br><span class="line"></span><br><span class="line">name:Name index:[<span class="number">0</span>] <span class="keyword">type</span>:<span class="keyword">string</span> json tag: name  person tag:weiyigeek , Field Anonymous: <span class="literal">false</span></span><br><span class="line">name:Score index:[<span class="number">1</span>] <span class="keyword">type</span>:<span class="keyword">int</span> json tag: score  person tag:geek , Field Anonymous: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">name:Score index:[<span class="number">1</span>] <span class="keyword">type</span>:<span class="keyword">int</span> json tag:score , Field Anonymous: <span class="literal">false</span></span><br><span class="line">reflect.TypeOf NumMethod-&gt; <span class="number">2</span></span><br><span class="line">reflect.ValueOf NumMethod-&gt; <span class="number">2</span></span><br><span class="line">method name:Sleepï¼Œmethod: <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">string</span></span></span><br><span class="line"><span class="function">[<span class="title">Sleep</span>] å¥½å¥½ç¡è§‰ï¼Œå¿«å¿«é•¿å¤§ã€‚</span></span><br><span class="line"><span class="function"><span class="title">method</span> <span class="title">name</span>:<span class="title">Study</span>ï¼Œ<span class="title">method</span>: <span class="title">func</span><span class="params">()</span> <span class="title">string</span></span></span><br><span class="line"><span class="function">[<span class="title">Study</span>] å¥½å¥½å­¦ä¹ ï¼Œå¤©å¤©å‘ä¸Šã€‚</span></span><br><span class="line"><span class="function"><span class="title">Reflect</span> <span class="title">Method</span> <span class="title">ptr</span>:0<span class="title">x4ae080</span>ï¼Œ<span class="title">method</span> <span class="title">Type</span>: <span class="title">func</span><span class="params">()</span> <span class="title">string</span></span></span><br><span class="line"><span class="function">[<span class="title">Sleep</span>] å¥½å¥½ç¡è§‰ï¼Œå¿«å¿«é•¿å¤§ã€‚</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>åå°„ä½¿ç”¨æ€»ç»“:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//# (1) åå°„å¾—åˆ°ä¼ é€’å¯¹è±¡çš„ç±»å‹ (ç±»å‹ç›¸å…³ä½¿ç”¨)</span></span><br><span class="line">t := reflect.TypeOf(d)</span><br><span class="line">fmt.Println(<span class="string">"å‚æ•°æ ¡éªŒ:"</span>, t, t.Kind(), t.Elem().Kind())  <span class="comment">// # å‚æ•°æ ¡éªŒ *main.Config ptr struct</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; t.Elem().NumField(); i++ &#123; <span class="comment">// #  t.Elem() æ‹¿å–æŒ‡é’ˆä¸­çš„å…ƒç´ å±æ€§ç›¸å…³ä¿¡æ¯</span></span><br><span class="line">  field := t.Elem().Field(i)   <span class="comment">// éå†å•ä¸ªå…ƒç´ å­—æ®µä¿¡æ¯æŒ‡å®šindexã€‚</span></span><br><span class="line">  tag := field.Tag.Get(<span class="string">"ini"</span>)  <span class="comment">// è·å–å•ä¸ªå…ƒç´ å­—æ®µä¸­ ini tag å±æ€§å€¼</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//# (2) åå°„å¾—åˆ°ä¼ é€’å¯¹è±¡çš„å€¼  (å€¼ç›¸å…³ä½¿ç”¨)</span></span><br><span class="line">v := reflect.ValueOf(d)</span><br><span class="line">sValue := v.Elem().FieldByName(structName) <span class="comment">// æ­¤å¤„åå°„å¾—åˆ°åµŒå¥—ç»“æ„ä½“æŒ‡å®šå­—æ®µåç§°å€¼ä¿¡æ¯</span></span><br><span class="line">sType := sValue.Type()                     <span class="comment">// æ­¤å¤„åå°„å¾—åˆ°åµŒå¥—ç»“æ„ä½“ç±»å‹ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; sValue.NumField(); i++ &#123;   <span class="comment">// å­—æ®µåç§°å€¼ä¿¡æ¯ä¹Ÿå¯è·å–å­—æ®µæ•°é‡ï¼ŒåŒä¸Šé¢ä¸€è‡´</span></span><br><span class="line">    field := sType.Field(i) <span class="comment">// åå°„ç±»å‹ä¿¡æ¯ä¸­å­˜å‚¨äº†åµŒå¥—ç»“æ„ä½“ä¸­çš„Tagä¿¡æ¯</span></span><br><span class="line">    fieldType = field       <span class="comment">// åå°„ç±»å‹ä¿¡æ¯ä¸­å­˜å‚¨äº†åµŒå¥—ç»“æ„ä½“ä¸­çš„filedä¿¡æ¯ä»¥ä¾›åç»­å€¼ç±»å‹åˆ¤æ–­ä½¿ç”¨&#125;</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="0x01-Goè¯­è¨€åŸºç¡€ä¹‹å¹¶å‘å’Œé€šé“"><a href="#0x01-Goè¯­è¨€åŸºç¡€ä¹‹å¹¶å‘å’Œé€šé“" class="headerlink" title="0x01 Goè¯­è¨€åŸºç¡€ä¹‹å¹¶å‘å’Œé€šé“"></a>0x01 Goè¯­è¨€åŸºç¡€ä¹‹å¹¶å‘å’Œé€šé“</h2><p>æè¿°: åœ¨Goè¯­è¨€ä¸­æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å…¶åœ¨è¯­è¨€å±‚é¢å¤©ç”Ÿæ”¯æŒå¹¶å‘ï¼Œè¿™ä¹Ÿæ˜¯ä¼—å¤šå¼€å‘è€…å–œæ¬¢å®ƒçš„åŸå› ã€‚å…¶æ¬¡æ˜¯éšç€æœåŠ¡å™¨ç¡¬ä»¶è¿­ä»£å‡çº§ï¼Œé…ç½®ä¹Ÿè¶Šæ¥è¶Šé«˜ï¼Œä¸ºå……åˆ†åˆ©ç”¨æœåŠ¡å™¨èµ„æºï¼Œå¹¶å‘ç¼–ç¨‹ä¹Ÿå˜çš„è¶Šæ¥è¶Šé‡è¦ã€‚</p>
<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œéœ€è¦äº†è§£ä¸€ä¸‹<code>å¹¶å‘(concurrency)</code>å’Œ<code>å¹¶è¡Œ(parallesim)</code>ä»¥åŠ<code>è¿›ç¨‹(Process)å’Œçº¿ç¨‹(Thread)</code>çš„åŒºåˆ«ï¼ˆé‡ç‚¹ï¼‰ã€‚</p>
<h3 id="1-åŸºç¡€æ¦‚å¿µ"><a href="#1-åŸºç¡€æ¦‚å¿µ" class="headerlink" title="1.åŸºç¡€æ¦‚å¿µ"></a>1.åŸºç¡€æ¦‚å¿µ</h3><p><strong>Goè¯­è¨€çš„å¹¶å‘</strong><br>æè¿°ï¼› Goè¯­è¨€å¹¶å‘æ˜¯é€šè¿‡<code>goroutine</code> (<code>go [ruËËˆtiËn]</code>)ã€è½»é‡çº§çº¿ç¨‹ã€‘å®ç°çš„ï¼Œå…¶ç±»ä¼¼äºçº¿ç¨‹ï¼Œå±äºç”¨æˆ·æ€çš„çº¿ç¨‹ï¼ˆ<code>æ¯”å†…æ ¸æ€çº¿ç¨‹æ›´è½»é‡çº§</code>ï¼‰, æˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦åˆ›å»ºæˆåƒä¸Šä¸‡ä¸ª goroutine å¹¶å‘å·¥ä½œã€‚å®ƒæ˜¯ç”±Goè¯­è¨€çš„<code>è¿è¡Œæ—¶ï¼ˆruntimeï¼‰</code>è°ƒåº¦å®Œæˆï¼ˆè‡ªå·±ç¼–å†™çš„çº¿ç¨‹è°ƒåº¦ï¼‰ï¼Œè€Œ<code>çº¿ç¨‹</code>æ˜¯ç”±<code>æ“ä½œç³»ç»Ÿè°ƒåº¦</code>å®Œæˆã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–Goè¯­è¨€è¿˜æä¾›channelåœ¨å¤šä¸ªgoroutineé—´è¿›è¡Œé€šä¿¡ã€‚æ‰€ä»¥<code>goroutine</code>å’Œ<code>channel</code> æ˜¯ Go è¯­è¨€ç§‰æ‰¿çš„<code>CSPï¼ˆCommunicating Sequential Process-é€šä¿¡é¡ºåºè¿‡ç¨‹ï¼‰å¹¶å‘æ¨¡å¼</code>çš„é‡è¦å®ç°åŸºç¡€ã€‚</p>
<p><strong>å¹¶å‘ (concurrency):</strong> é€»è¾‘ä¸Šå…·æœ‰å¤„ç†å¤šä¸ªåŒæ—¶æ€§ä»»åŠ¡çš„èƒ½åŠ›ã€‚ï¼ˆ<code>æŸæ®µæ—¶é—´é‡Œä½ åœ¨ç”¨å¾®ä¿¡å’Œä¸¤ä¸ªå¥³æœ‹å‹èŠå¤©</code>ï¼‰</p>
<p><strong>å¹¶è¡Œ (parallesim):</strong> ç‰©ç†ä¸ŠåŒä¸€æ—¶åˆ»æ‰§è¡Œå¤šä¸ªå¹¶å‘ä»»åŠ¡ã€‚ï¼ˆ<code>è¿™ä¸€åˆ»ä½ å’Œä½ æœ‹å‹éƒ½åœ¨ç”¨å¾®ä¿¡å’Œå¥³æœ‹å‹èŠå¤©</code>ï¼‰</p>
<p><strong>è¿›ç¨‹ (Process):</strong> æ˜¯æ“ä½œç³»ç»Ÿä¸­æŸæ•°æ®é›†åˆæ“ä½œçš„ä¸€ä¸ªç¨‹åºè¿è¡Œçš„èµ„æºï¼Œè¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„æœ€å°å•ä½ã€‚(<code>è½¦è¾†ç”Ÿäº§çš„æŸä¸€æ•´æ¡æµæ°´çº¿ä½œä¸šï¼Œä¾‹å¦‚ä»é›¶ä»¶è£…é…åˆ°æ•´è½¦å®Œå¤‡</code>)</p>
<p><strong>çº¿ç¨‹ (Thread):</strong> æ˜¯è¿è¡Œçš„è¿›ç¨‹ä»»åŠ¡ä¸­çš„æŸä¸€æ¡æ‰§è¡Œæµç¨‹ï¼Œåœ¨è¿›ç¨‹ä¸­çš„æ›´å°çš„è¿è¡Œå•ä½ï¼Œçº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„æœ€å°å•ä½ã€‚(<code>æµæ°´çº¿ä¸­æŸä¸€ä¸ªæµæ°´ä½œä¸šå²—ä½ï¼Œæ¯”å¦‚å¤–è§‚åŒ…è£…å²—ä½å·¥</code>)</p>
<p><strong>ç”¨æˆ·æ€:</strong> ç”±ç¨‹åºå‘˜è‡ªå·±å®šä¹‰çš„çº¿ç¨‹è°ƒåº¦ã€‚</p>
<p><strong>å†…æ ¸æ€:</strong> ç”±æ“ä½œç³»ç»Ÿé¢„å®šä¹‰çš„çº¿ç¨‹è°ƒåº¦ã€‚</p>
<p><br></p>
<h3 id="2-Goroutine-å…¥é—¨"><a href="#2-Goroutine-å…¥é—¨" class="headerlink" title="2.Goroutine å…¥é—¨"></a>2.Goroutine å…¥é—¨</h3><p>æè¿°: åœ¨java/c++ä¸­æˆ‘ä»¬è¦å®ç°å¹¶å‘ç¼–ç¨‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦è‡ªå·±ç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå¹¶ä¸”éœ€è¦è‡ªå·±å»åŒ…è£…ä¸€ä¸ªåˆä¸€ä¸ªçš„ä»»åŠ¡ï¼ŒåŒæ—¶éœ€è¦è‡ªå·±å»è°ƒåº¦çº¿ç¨‹æ‰§è¡Œä»»åŠ¡å¹¶ç»´æŠ¤ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿™ä¸€åˆ‡é€šå¸¸ä¼šè€—è´¹ç¨‹åºå‘˜å¤§é‡çš„å¿ƒæ™ºã€‚</p>
<p>Q: é‚£ä¹ˆèƒ½ä¸èƒ½æœ‰ä¸€ç§æœºåˆ¶ï¼Œç¨‹åºå‘˜åªéœ€è¦å®šä¹‰å¾ˆå¤šä¸ªä»»åŠ¡ï¼Œè®©ç³»ç»Ÿå»å¸®åŠ©æˆ‘ä»¬æŠŠè¿™äº›ä»»åŠ¡åˆ†é…åˆ°CPUä¸Šå®ç°å¹¶å‘æ‰§è¡Œå‘¢ï¼Ÿ</p>
<blockquote>
<p>ç­”: é‚£å½“ç„¶æ˜¯æœ‰çš„ï¼Œå³Goè¯­è¨€ä¸­çš„ goroutine å°±æ˜¯è¿™æ ·ä¸€ç§æœºåˆ¶ï¼Œå…¶æ¦‚å¿µ<code>ç±»ä¼¼äº</code>çº¿ç¨‹,ä½† goroutineæ˜¯ç”±Goçš„è¿è¡Œæ—¶ï¼ˆruntimeï¼‰è°ƒåº¦å’Œç®¡ç†çš„, Goç¨‹åºä¼š<code>æ™ºèƒ½åœ°</code>å°† goroutine ä¸­çš„ä»»åŠ¡<code>åˆç†åœ°åˆ†é…</code>ç»™æ¯ä¸ªCPUã€‚<br>è¿™å°±æ˜¯ä¸ºä½•Goè¯­è¨€ä¹‹è¢«ç§°ä¸ºç°ä»£åŒ–çš„ç¼–ç¨‹è¯­è¨€ï¼Œå°±æ˜¯å› ä¸ºå®ƒåœ¨è¯­è¨€å±‚é¢å·²ç»å†…ç½®äº†è°ƒåº¦å’Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„æœºåˆ¶ã€‚</p>
</blockquote>
<p><strong>å¦‚ä½•ä½¿ç”¨ goroutineï¼ˆå¹¶å‘ï¼‰?</strong><br>æè¿°: Goè¯­è¨€ä¸­ä½¿ç”¨goroutineéå¸¸ç®€å•,å°†éœ€è¦å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡åŒ…è£…æˆä¸ºä¸€ä¸ªå‡½æ•°,å¹¶åœ¨è°ƒç”¨å‡½æ•°çš„æ—¶å€™å‰é¢åŠ ä¸Šgoå…³é”®å­—,æ­¤æ—¶ä¾¿å¯ä»¥å¼€å¯ä¸€ä¸ªGoroutineå»æ‰§è¡Œè¯¥å‡½æ•°çš„ä»»åŠ¡ã€‚<br>éå¸¸æ³¨æ„ï¼Œä¸€ä¸ªgoroutineå¿…å®šå¯¹åº”ä¸€ä¸ªå‡½æ•°ï¼Œä½†å¯ä»¥åˆ›å»ºå¤šä¸ªgoroutineå»æ‰§è¡Œç›¸åŒçš„å‡½æ•°ã€‚</p>
<p><br></p>
<h4 id="ç¤ºä¾‹1-å¯åŠ¨å•ä¸ªGoroutine"><a href="#ç¤ºä¾‹1-å¯åŠ¨å•ä¸ªGoroutine" class="headerlink" title="ç¤ºä¾‹1.å¯åŠ¨å•ä¸ªGoroutine"></a>ç¤ºä¾‹1.å¯åŠ¨å•ä¸ªGoroutine</h4><p>æè¿°ï¼šå¯åŠ¨goroutineçš„æ–¹å¼éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨è°ƒç”¨çš„å‡½æ•°ï¼ˆæ™®é€šå‡½æ•°å’ŒåŒ¿åå‡½æ•°ï¼‰å‰é¢åŠ ä¸Šä¸€ä¸ªgoå…³é”®å­—ï¼Œå³å¯ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">"Hello Goroutine!"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">go</span>	hello()               <span class="comment">// åœ¨è°ƒç”¨helloå‡½æ•°å‰é¢åŠ ä¸Šå…³é”®å­—goï¼Œå³å¯åŠ¨ä¸€ä¸ªgoroutineå»æ‰§è¡Œhelloè¿™ä¸ªå‡½æ•°ã€‚</span></span><br><span class="line">  fmt.Println(<span class="string">"main goroutine done!"</span>)</span><br><span class="line"> 	time.Sleep(time.Second) <span class="comment">// å¦‚æœä¸åŠ æ­¤å»¶æ—¶ï¼Œåˆ™æ‰§è¡Œç»“æœåªæ‰“å°äº†main goroutine done!ï¼Œå¹¶ä¸ä¼šæ‰“å°Hello Goroutine!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br/></p>
<p><em>Q: ä¸ºä»€ä¹ˆåœ¨æœªåŠ å»¶æ—¶å‡½æ•°çš„æƒ…å†µä¸‹æ‰§è¡Œç»“æœåªæ‰“å°äº†main goroutine done!ï¼Ÿ</em></p>
<blockquote>
<p>ç­”: å› ä¸ºåœ¨ç¨‹åºå¯åŠ¨æ—¶ï¼ŒGoç¨‹åºå°±ä¼šä¸º <code>main()</code> å‡½æ•°åˆ›å»ºä¸€ä¸ª<code>é»˜è®¤çš„goroutine</code>ã€‚<br>å½“ main() å‡½æ•°è¿”å›çš„æ—¶å€™è¯¥goroutineå°±ç»“æŸäº†ï¼Œæ‰€æœ‰åœ¨ main() å‡½æ•°ä¸­å¯åŠ¨çš„ goroutine ä¼šä¸€åŒç»“æŸã€‚<br>ä¾‹å¦‚ mainå‡½æ•°æ‰€åœ¨çš„goroutineå°±åƒæ˜¯æƒåˆ©çš„æ¸¸æˆä¸­çš„å¤œç‹ï¼Œå…¶ä»–çš„goroutineéƒ½æ˜¯å¼‚é¬¼ï¼Œå¤œç‹ä¸€æ­»å®ƒè½¬åŒ–çš„é‚£äº›å¼‚é¬¼ä¹Ÿå°±å…¨éƒ¨GGäº†ã€‚<br>æ‰€ä»¥ä¸ºäº†è®©mainå‡½æ•°ç­‰ä¸€ç­‰helloå‡½æ•°ï¼Œæœ€ç®€å•ç²—æš´çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨<code>time.Sleep()</code>ï¼Œä¸è¿‡åç»­è¿˜è¦æ›´å¥½çš„è§£å†³åŠæ³•é‚£å°±æ˜¯<code>é‡‡ç”¨ sync.WaitGroup</code>æ¥ç­‰å¾…goroutineä»»åŠ¡æ‰§è¡Œå®Œæ¯•ã€‚</p>
</blockquote>
<p><br></p>
<h4 id="ç¤ºä¾‹2-å¯åŠ¨å¤šä¸ªGoroutine"><a href="#ç¤ºä¾‹2-å¯åŠ¨å¤šä¸ªGoroutine" class="headerlink" title="ç¤ºä¾‹2.å¯åŠ¨å¤šä¸ªGoroutine"></a>ç¤ºä¾‹2.å¯åŠ¨å¤šä¸ªGoroutine</h4><p>æè¿°: åœ¨Goè¯­è¨€ä¸­å®ç°å¹¶å‘å°±æ˜¯è¿™æ ·ç®€å•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯åŠ¨å¤šä¸ªgoroutineã€‚</p>
<p>æ­¤å¤„æˆ‘å°†è§£å†³ç¤ºä¾‹1ä¸­çš„å»¶æ—¶é˜»å¡é—®é¢˜ï¼Œå¦‚ä½•ç›‘æµ‹ Goroutine ä»€ä¹ˆæ—¶å€™ç»“æŸ?</p>
<blockquote>
<p>1.Goroutine åœ¨å¯¹åº”è°ƒç”¨å‡½æ•°è¿è¡Œå®Œæˆæ—¶ç»“æŸï¼Œå…¶æ¬¡æ˜¯mainå‡½æ•°æ‰§è¡Œå®Œæˆæ—¶ï¼Œç”±mainå‡½æ•°åˆ›å»ºçš„é‚£äº›goroutineéƒ½ç»“æŸã€‚<br>2.æ­¤å¤„æˆ‘ä»¬è¿™é‡Œä½¿ç”¨<code>sync.WaitGroup</code>æ¥å®ç°goroutineçš„åŒæ­¥æ‰§è¡Œç»“æŸæ£€æµ‹ã€‚<br>wg.Add(1) : <code>goroutine ä»»åŠ¡æ‰§è¡Œè®¡æ•°å™¨+1</code><br>wg.Done() : <code>goroutine ä»»åŠ¡æ‰§è¡Œå®Œæ¯•è®¡æ•°å™¨-1</code><br>wg.Wait() : <code>å½“å‰ goroutine ä»»åŠ¡æ‰§è¡Œå…¨éƒ¨å®Œæ¯•åä¸”è®¡æ•°å™¨ä¸º0,ç­‰å¾…ç»“æŸé€€å‡ºMainå‡½æ•°</code></p>
</blockquote>
<p>ä»£ç ç¤ºä¾‹:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">defer</span> wg.Done() <span class="comment">// goroutineç»“æŸå°±ç™»è®°-1</span></span><br><span class="line">  fmt.Println(<span class="string">"Hello Goroutine!"</span>, i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">    wg.Add(<span class="number">1</span>) <span class="comment">// å¯åŠ¨ä¸€ä¸ªgoroutineå°±ç™»è®°+1</span></span><br><span class="line">    <span class="keyword">go</span> hello(i)</span><br><span class="line">  &#125;</span><br><span class="line">  wg.Wait() <span class="comment">// ç­‰å¾…æ‰€æœ‰ç™»è®°çš„goroutineéƒ½ç»“æŸ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Tips: æ‰§è¡Œä¸Šè¿°ä»£ç æ‚¨ä¼šå‘ç°æ¯æ¬¡æ‰“å°çš„æ•°å­—çš„é¡ºåºéƒ½ä¸ä¸€è‡´ï¼Œè¿™æ˜¯ç”±äº10ä¸ªgoroutineæ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œè€Œgoroutineçš„è°ƒåº¦æ˜¯éšæœºçš„ã€‚</p>
<p><br></p>
<p><strong>å®è·µæ¼”ç¤º(1).å¸¸è§„æ–¹å¼ä»¥åŠåŒ¿åå‡½æ•°æ–¹å¼å¹¶å‘è°ƒåº¦</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// æ–¹å¼1ï¼Œå¸¸è§„å‡½æ•°æ–¹å¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(count <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  fmt.Printf(<span class="string">"æ¬¢è¿ä½ ç¬¬ %d æ¬¡\n"</span>, count)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">demo1</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">    <span class="keyword">go</span> hello(i) <span class="comment">// å¼€å¯ä¸€ä¸ªå•ç‹¬çš„goroutineå»æ‰§è¡Œhelloå‡½æ•°(ä»»åŠ¡)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼2.åŒ¿åå‡½æ•°æ–¹å¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">demo2</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(count <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">      fmt.Printf(<span class="string">"ç¬¬ %d æ¬¡æ¬¢è¿ä½ \n"</span>, count)</span><br><span class="line">    &#125;(i)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¨‹åºå¯åŠ¨ä¹‹åä¼šåˆ›å»ºä¸€ä¸ªä¸»Goroutineå»æ‰§è¡Œã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">"[*] main start"</span>)</span><br><span class="line">  demo1()</span><br><span class="line">  demo2()</span><br><span class="line">  time.Sleep(time.Second)  <span class="comment">// æœ€æš´åŠ›ç®€å•çš„å»¶æ—¶å‡½æ•°</span></span><br><span class="line">  fmt.Println(<span class="string">"[-] main end"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¦‚æœmainå‡½æ•°ç»“æŸäº†ï¼Œåˆ™ç”±mainå¯åŠ¨çš„goroutineä¹Ÿç»“æŸäº†ã€‚</span></span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[*] main start</span><br><span class="line">ç¬¬ 4 æ¬¡æ¬¢è¿ä½ </span><br><span class="line">æ¬¢è¿ä½ ç¬¬ 0 æ¬¡</span><br><span class="line">æ¬¢è¿ä½ ç¬¬ 1 æ¬¡</span><br><span class="line">æ¬¢è¿ä½ ç¬¬ 2 æ¬¡</span><br><span class="line">æ¬¢è¿ä½ ç¬¬ 3 æ¬¡</span><br><span class="line">æ¬¢è¿ä½ ç¬¬ 4 æ¬¡</span><br><span class="line">ç¬¬ 0 æ¬¡æ¬¢è¿ä½ </span><br><span class="line">ç¬¬ 1 æ¬¡æ¬¢è¿ä½ </span><br><span class="line">ç¬¬ 2 æ¬¡æ¬¢è¿ä½ </span><br><span class="line">ç¬¬ 3 æ¬¡æ¬¢è¿ä½   <span class="comment"># ä½ ä¼šå‘ç°è¾“å‡ºå®Œæ­¤è¡Œæ—¶ï¼Œä¼šæœ‰å¡é¡¿ã€‚è¿™æ˜¯ç”±äºæœªåˆ°å»¶æ—¶æ—¶é—´ä»£ç ä¾¿æ‰§è¡Œå®Œæ¯•ï¼Œæ‰€ä»¥ç»ˆç«¯å¤„äºé˜»å¡æ¨¡å¼ï¼Œç­‰å¾…å»¶æ—¶æ—¶é—´å¾—åˆ°æ¥ã€‚</span></span><br><span class="line">[-] main end</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢çš„æ–¹å¼åœ¨å®é™…çš„å¼€å‘å·¥ä½œä¸ä¼šè¿™æ ·ä½¿ç”¨ï¼Œä¸€èˆ¬ä¼šåˆ©ç”¨sync.WaitGroupå¯¹è±¡ï¼Œåœ¨å‡½æ•°ä¸­å½“goroutineå…¨éƒ¨æ‰§è¡Œå®Œæ¯•åï¼Œå°†ä¼šè‡ªåŠ¨ç»“æŸè¿è¡Œ, å¯ä»¥å‚è€ƒä¸‹è¿°å®è·µç¤ºä¾‹2ã€‚</p>
<p><br></p>
<p><strong>å®è·µæ¼”ç¤º(2).ä½¿ç”¨sync.WaitGroupå¯¹çº¿ä¸‹ç­‰å¾…å¹¶å‘çº¿ç¨‹æ‰§è¡Œå®Œæ¯•</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼˜é›…çš„ä½¿ç”¨ goroutine å¹¶è¡Œè°ƒåº¦ã€‚</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"math/rand"</span></span><br><span class="line">  <span class="string">"sync"</span></span><br><span class="line">  <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// å®ä¾‹åŒ–ç»“æ„ä½“å¾—åˆ°å¯¹è±¡</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="comment">// goroutine å°†è°ƒç”¨çš„å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">defer</span> wg.Done() <span class="comment">// goroutineç»“æŸå°±ç™»è®°-1</span></span><br><span class="line">  fmt.Println(<span class="string">"è¾“å‡ºçš„éšæœºæ•°ï¼š"</span>, rand.Intn(<span class="number">10</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å½“mainå‡½æ•°ä»»åŠ¡ä¸­æ‰€æœ‰çš„goroutineéƒ½ç»“æŸäº†ï¼Œæ‰ç»“æŸmainå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">"Start Main"</span>)</span><br><span class="line">  <span class="comment">// goroutine è°ƒç”¨</span></span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">    rand.Seed(time.Now().Unix()) <span class="comment">// éšæœºæ•°ç§å­ä¼ å…¥çš„æ˜¯ä¸€ä¸ªint64ç±»å‹</span></span><br><span class="line">    wg.Add(<span class="number">1</span>)  <span class="comment">// å¯åŠ¨ä¸€ä¸ªgoroutineå°±ç™»è®°+1</span></span><br><span class="line">    <span class="keyword">go</span> f1()</span><br><span class="line">  &#125;</span><br><span class="line">  wg.Wait() 	<span class="comment">// ç›‘å¬å¹¶ç­‰å¾…mainä¸­çš„goroutineæ˜¯å¦éƒ½è¿è¡Œç»“æŸ(ç­‰å¾…wgç»„ä¸º0æ—¶)ã€‚</span></span><br><span class="line">  fmt.Println(<span class="string">"End Main"</span>)  <span class="comment">// è¾“å‡ºå†ä¹Ÿæ²¡æœ‰å¡é¡¿äº†</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœ:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Start Main</span><br><span class="line">è¾“å‡ºçš„éšæœºæ•°ï¼š <span class="number">2</span></span><br><span class="line">è¾“å‡ºçš„éšæœºæ•°ï¼š <span class="number">2</span></span><br><span class="line">è¾“å‡ºçš„éšæœºæ•°ï¼š <span class="number">8</span></span><br><span class="line">è¾“å‡ºçš„éšæœºæ•°ï¼š <span class="number">2</span></span><br><span class="line">è¾“å‡ºçš„éšæœºæ•°ï¼š <span class="number">1</span></span><br><span class="line">è¾“å‡ºçš„éšæœºæ•°ï¼š <span class="number">7</span></span><br><span class="line">è¾“å‡ºçš„éšæœºæ•°ï¼š <span class="number">6</span></span><br><span class="line">è¾“å‡ºçš„éšæœºæ•°ï¼š <span class="number">2</span></span><br><span class="line">è¾“å‡ºçš„éšæœºæ•°ï¼š <span class="number">7</span></span><br><span class="line">è¾“å‡ºçš„éšæœºæ•°ï¼š <span class="number">0</span></span><br><span class="line">End Main   <span class="comment">// æ­¤å¤„è¾“å‡ºå†ä¹Ÿæ²¡æœ‰å¡é¡¿äº†ã€‚</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="3-Goroutine-ç‰¹æ€§"><a href="#3-Goroutine-ç‰¹æ€§" class="headerlink" title="3.Goroutine ç‰¹æ€§"></a>3.Goroutine ç‰¹æ€§</h3><h4 id="1-Goroutine-å¯å¢é•¿çš„æ ˆ"><a href="#1-Goroutine-å¯å¢é•¿çš„æ ˆ" class="headerlink" title="(1) Goroutine å¯å¢é•¿çš„æ ˆ"></a>(1) Goroutine å¯å¢é•¿çš„æ ˆ</h4><p>æè¿°: OSçº¿ç¨‹ï¼ˆæ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼‰ä¸€èˆ¬éƒ½æœ‰å›ºå®šçš„æ ˆå†…å­˜ï¼ˆé€šå¸¸ä¸º2MBï¼‰,ä¸€ä¸ªgoroutineçš„æ ˆåœ¨å…¶ç”Ÿå‘½å‘¨æœŸå¼€å§‹æ—¶åªæœ‰å¾ˆå°çš„æ ˆï¼ˆå…¸å‹æƒ…å†µä¸‹2KBï¼‰ï¼Œgoroutineçš„æ ˆä¸æ˜¯å›ºå®šçš„ï¼Œä»–å¯ä»¥æŒ‰éœ€å¢å¤§å’Œç¼©å°ï¼Œgoroutineçš„æ ˆå¤§å°é™åˆ¶å¯ä»¥è¾¾åˆ°1GBï¼Œè™½ç„¶æå°‘ä¼šç”¨åˆ°è¿™ä¹ˆå¤§ã€‚æ‰€ä»¥åœ¨Goè¯­è¨€ä¸­ä¸€æ¬¡æ€§åˆ›å»ºåä¸‡å·¦å³çš„goroutineä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p>
<p>Tips : æ€»ç»“ goroutine åˆå§‹æ ˆå¤§å°ä¸º2kï¼Œå…¶å¤§å°å¯ä»¥æŒ‰ç…§éœ€è¦æ‰©å®¹ç¼©ã€‚</p>
<p><br/></p>
<h4 id="2-Goroutine-è°ƒåº¦æ¨¡å‹"><a href="#2-Goroutine-è°ƒåº¦æ¨¡å‹" class="headerlink" title="(2) Goroutine è°ƒåº¦æ¨¡å‹"></a>(2) Goroutine è°ƒåº¦æ¨¡å‹</h4><p>æè¿°:GPMæ˜¯Goè¯­è¨€è¿è¡Œæ—¶ï¼ˆruntimeï¼‰å±‚é¢çš„å®ç°ï¼Œæ˜¯goè¯­è¨€è‡ªå·±å®ç°çš„ä¸€å¥—è°ƒåº¦ç³»ç»Ÿã€‚åŒºåˆ«äºæ“ä½œç³»ç»Ÿè°ƒåº¦OSçº¿ç¨‹ï¼Œå®ƒæ¯”èµ·OSçš„è°ƒåº¦æ›´è½»é‡çº§äº›ã€‚</p>
<p><strong>goroutine GMPæ¨¡å‹:</strong></p>
<ul>
<li>G å…¶å°±æ˜¯ä¸ªgoroutineé‡Œé¢é™¤äº†å­˜æ”¾æœ¬goroutineä¿¡æ¯å¤–ï¼Œè¿˜å­˜æ”¾ä¸æ‰€åœ¨Pçš„ç»‘å®šç­‰ä¿¡æ¯ã€‚</li>
<li>P ç®¡ç†ç€ä¸€ç»„goroutineé˜Ÿåˆ—ï¼ŒPé‡Œé¢ä¼šå­˜å‚¨å½“å‰goroutineè¿è¡Œçš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼ˆ<code>å‡½æ•°æŒ‡é’ˆï¼Œå †æ ˆåœ°å€åŠåœ°å€è¾¹ç•Œ</code>ï¼‰ï¼ŒPä¼šå¯¹è‡ªå·±ç®¡ç†çš„goroutineé˜Ÿåˆ—åšä¸€äº›è°ƒåº¦ï¼ˆæ¯”å¦‚æŠŠå ç”¨CPUæ—¶é—´è¾ƒé•¿çš„goroutineæš‚åœã€è¿è¡Œåç»­çš„goroutineç­‰ç­‰ï¼‰å½“è‡ªå·±çš„é˜Ÿåˆ—æ¶ˆè´¹å®Œäº†å°±å»å…¨å±€é˜Ÿåˆ—é‡Œå–ï¼Œå¦‚æœå…¨å±€é˜Ÿåˆ—é‡Œä¹Ÿæ¶ˆè´¹å®Œäº†ä¼šå»å…¶ä»–Pçš„é˜Ÿåˆ—é‡ŒæŠ¢ä»»åŠ¡ã€‚</li>
<li>M (machine) æ˜¯Goè¿è¡Œæ—¶ï¼ˆruntimeï¼‰å¯¹æ“ä½œç³»ç»Ÿå†…æ ¸çº¿ç¨‹çš„è™šæ‹Ÿï¼ŒMä¸å†…æ ¸çº¿ç¨‹(Kernel Thread)ä¸€èˆ¬æ˜¯ä¸€ä¸€æ˜ å°„çš„å…³ç³»ï¼Œä¸€ä¸ªgroutineæœ€ç»ˆæ˜¯è¦æ”¾åˆ°Mä¸Šæ‰§è¡Œçš„ï¼›</li>
</ul>
<p><br/></p>
<p><strong>Pä¸Mçš„å…³ç³»</strong><br>æè¿°: Pä¸Mé€šå¸¸æ˜¯ä¸€ä¸€å¯¹åº”çš„,ä»–ä»¬å…³ç³»æ˜¯Pç®¡ç†ç€ä¸€ç»„GæŒ‚è½½åœ¨Mä¸Šè¿è¡Œã€‚å½“ä¸€ä¸ªGé•¿ä¹…é˜»å¡åœ¨ä¸€ä¸ªMä¸Šæ—¶ï¼Œruntimeä¼šæ–°å»ºä¸€ä¸ªMï¼Œé˜»å¡Gæ‰€åœ¨çš„Pä¼šæŠŠå…¶ä»–çš„GæŒ‚è½½åœ¨æ–°å»ºçš„Mä¸Šï¼Œå½“æ—§çš„Gé˜»å¡å®Œæˆæˆ–è€…è®¤ä¸ºå…¶å·²ç»æ­»æ‰æ—¶åˆ™å›æ”¶æ—§çš„Mã€‚</p>
<p>Pçš„ä¸ªæ•°æ˜¯é€šè¿‡ <code>runtime.GOMAXPROCS</code>è®¾å®šï¼ˆæœ€å¤§256 æ ¸ï¼‰ï¼ŒGo1.5ç‰ˆæœ¬ä¹‹åé»˜è®¤ä¸ºç‰©ç†çº¿ç¨‹æ•°ã€‚åœ¨å¹¶å‘é‡å¤§çš„æ—¶å€™ä¼šå¢åŠ ä¸€äº›På’ŒMï¼Œä½†ä¸ä¼šå¤ªå¤šï¼Œåˆ‡æ¢ä¸Šä¸‹æ–‡å¤ªé¢‘ç¹çš„è¯å¾—ä¸å¿å¤±ã€‚</p>
<p>å•ä»çº¿ç¨‹è°ƒåº¦è®²ï¼ŒGoè¯­è¨€ç›¸æ¯”èµ·å…¶ä»–è¯­è¨€çš„ä¼˜åŠ¿åœ¨äºOSçº¿ç¨‹æ˜¯ç”±OSå†…æ ¸æ¥è°ƒåº¦çš„ï¼Œgoroutineåˆ™æ˜¯ç”±Goè¿è¡Œæ—¶ï¼ˆruntimeï¼‰è‡ªå·±çš„è°ƒåº¦å™¨è°ƒåº¦çš„ï¼Œè¿™ä¸ªè°ƒåº¦å™¨ä½¿ç”¨ä¸€ä¸ªç§°ä¸ºm:nè°ƒåº¦çš„æŠ€æœ¯ï¼ˆå¤ç”¨/è°ƒåº¦mä¸ªgoroutineåˆ°nä¸ªOSçº¿ç¨‹ï¼‰ã€‚ å…¶ä¸€å¤§ç‰¹ç‚¹æ˜¯goroutineçš„è°ƒåº¦æ˜¯åœ¨ç”¨æˆ·æ€ä¸‹å®Œæˆçš„ï¼Œ ä¸æ¶‰åŠå†…æ ¸æ€ä¸ç”¨æˆ·æ€ä¹‹é—´çš„é¢‘ç¹åˆ‡æ¢ï¼ŒåŒ…æ‹¬å†…å­˜çš„åˆ†é…ä¸é‡Šæ”¾ï¼Œéƒ½æ˜¯åœ¨ç”¨æˆ·æ€ç»´æŠ¤ç€ä¸€å—å¤§çš„å†…å­˜æ± ï¼Œ ä¸ç›´æ¥è°ƒç”¨ç³»ç»Ÿçš„mallocå‡½æ•°ï¼ˆé™¤éå†…å­˜æ± éœ€è¦æ”¹å˜ï¼‰ï¼Œæˆæœ¬æ¯”è°ƒåº¦OSçº¿ç¨‹ä½å¾ˆå¤šã€‚ å¦ä¸€æ–¹é¢å……åˆ†åˆ©ç”¨äº†å¤šæ ¸çš„ç¡¬ä»¶èµ„æºï¼Œè¿‘ä¼¼çš„æŠŠè‹¥å¹²goroutineå‡åˆ†åœ¨ç‰©ç†çº¿ç¨‹ä¸Šï¼Œ å†åŠ ä¸Šæœ¬èº«goroutineçš„è¶…è½»é‡ï¼Œä»¥ä¸Šç§ç§ä¿è¯äº†goè°ƒåº¦æ–¹é¢çš„æ€§èƒ½ã€‚</p>
<p>Tips: goroutine ç»„æœ€ç»ˆæ˜¯è¦æ”¾åœ¨M(å†…æ ¸æ€)ä¸­æ‰§è¡Œï¼Œä¸è¿‡åœ¨æ­¤ä¹‹å‰goroutineå·²ç»å°†ä»»åŠ¡è¿›è¡Œæ’å¥½é˜Ÿåˆ—ï¼ˆåº•å±‚å®ç°çº¿ç¨‹æ± ï¼‰ï¼Œç„¶åç­‰å¾…åˆ†åˆ«åˆ°æ“ä½œç³»ç»Ÿä¹‹ä¸­ã€‚</p>
<p>è¯¾å¤–æ‰©å±•: <a href="https://www.cnblogs.com/sunsky303/p/9705727.html" target="_blank" rel="noopener">https://www.cnblogs.com/sunsky303/p/9705727.html</a></p>
<p><br></p>
<h4 id="3-Goroutine-çº¿ç¨‹æ•°"><a href="#3-Goroutine-çº¿ç¨‹æ•°" class="headerlink" title="(3) Goroutine çº¿ç¨‹æ•°"></a>(3) Goroutine çº¿ç¨‹æ•°</h4><p>æè¿°: Goè¿è¡Œæ—¶çš„è°ƒåº¦å™¨ä½¿ç”¨<code>GOMAXPROCSå‚æ•°</code>æ¥è®¾ç½®ä½¿ç”¨å¤šå°‘ä¸ªOSçº¿ç¨‹æ¥åŒæ—¶æ‰§è¡ŒGoä»£ç ï¼Œå…¶é»˜è®¤å€¼æ˜¯æœºå™¨ä¸Šçš„CPUæ ¸å¿ƒæ•°ã€‚</p>
<p>Goè¯­è¨€ä¸­å¯ä»¥é€šè¿‡<code>runtime.GOMAXPROCS(NUMBER)</code>å‡½æ•°, è®¾ç½®å½“å‰ç¨‹åºå¹¶å‘æ—¶å ç”¨çš„CPUé€»è¾‘æ ¸å¿ƒæ•°ã€‚å¹¶å¯ä»¥é€šè¿‡ <code>runtime.NumCPU()</code> ä¸ <code>runtime.NumGoroutine()</code> åˆ†åˆ«æŸ¥çœ‹æœºå™¨ä¸­çš„é€»è¾‘CPUæ•°å’Œå½“å‰å­˜åœ¨çš„goroutineæ•°ã€‚</p>
<p>Tips: Go1.5ç‰ˆæœ¬ä¹‹å‰ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯å•æ ¸å¿ƒæ‰§è¡Œã€‚<br>Tips: Go1.5ç‰ˆæœ¬ä¹‹åï¼Œé»˜è®¤ä½¿ç”¨å…¨éƒ¨çš„CPUé€»è¾‘æ ¸å¿ƒæ•°ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ª8æ ¸å¿ƒçš„æœºå™¨ä¸Šï¼Œè°ƒåº¦å™¨ä¼šæŠŠGoä»£ç åŒæ—¶è°ƒåº¦åˆ°8ä¸ªOSçº¿ç¨‹ä¸Šï¼ˆ<code>GOMAXPROCSæ˜¯m:nè°ƒåº¦ä¸­çš„n</code>ï¼‰ã€‚</p>
<p><br/></p>
<p><strong>Q: ä»€ä¹ˆæ˜¯M:N?</strong><br>ç­”: <code>M:N</code> å³æŠŠmä¸ªgoroutineä»»åŠ¡åˆ†é…ç»™nä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹å»æ‰§è¡Œã€‚</p>
<p><br/></p>
<p><strong>Goè¯­è¨€ä¸­çš„æ“ä½œç³»ç»Ÿçº¿ç¨‹å’Œgoroutineçš„å…³ç³»ï¼š</strong></p>
<ul>
<li>ä¸€ä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹å¯¹åº”ç”¨æˆ·æ€çš„å¤šä¸ªgoroutineã€‚</li>
<li>goè¯­è¨€ç¨‹åºå¯ä»¥åŒæ—¶ä½¿ç”¨å¤šä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹ã€‚</li>
<li>goè¯­è¨€ä¸­çš„goroutineä¸OSçº¿ç¨‹æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼Œå³ m:n çš„å…³ç³»ã€‚</li>
</ul>
<p><br/></p>
<p><strong>å®è·µæ¡ˆä¾‹:</strong><br>ä¾‹å¦‚: æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†ä»»åŠ¡åˆ†é…åˆ°ä¸åŒçš„CPUé€»è¾‘æ ¸å¿ƒä¸Šå®ç°å¹¶è¡Œçš„æ•ˆæœï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"runtime"</span></span><br><span class="line">  <span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">a</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">defer</span> wg.Done()</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">6</span>; i++ &#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"Func A() :"</span>, i)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">b</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">defer</span> wg.Done()</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">6</span>; i++ &#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"Func B() :"</span>, i)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">"[*] Main Start"</span>)</span><br><span class="line">  fmt.Println(<span class="string">"å½“å‰æœºå™¨çš„ CPU æ ¸å¿ƒæ•°:"</span>, runtime.NumCPU()) <span class="comment">// NumCPUè¿”å›å½“å‰è¿›ç¨‹å¯ç”¨çš„é€»è¾‘CPUæ•°é‡ã€‚</span></span><br><span class="line">  runtime.GOMAXPROCS(<span class="number">2</span>)  <span class="comment">// å ç”¨cpuçš„ä¸¤ä¸ªæ ¸</span></span><br><span class="line">  wg.Add(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">go</span> a() <span class="comment">// å¹¶å‘è°ƒç”¨aå‡½æ•°ï¼ˆåè¾“å‡ºï¼‰</span></span><br><span class="line">  wg.Add(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">go</span> b() <span class="comment">// å¹¶å‘è°ƒç”¨aå‡½æ•°ï¼ˆå…ˆè¾“å‡ºï¼‰                   </span></span><br><span class="line">  fmt.Println(<span class="string">"å½“å‰æœºå™¨çš„ goroutine æ•°:"</span>, runtime.NumGoroutine()) <span class="comment">// NumGoroutineè¿”å›å½“å‰å­˜åœ¨çš„goroutineæ•°ã€‚</span></span><br><span class="line">  wg.Wait()</span><br><span class="line">  fmt.Println(<span class="string">"[*] Main End"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœ:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[*] Main Start</span><br><span class="line">å½“å‰æœºå™¨çš„ CPU æ ¸å¿ƒæ•°: <span class="number">4</span></span><br><span class="line">å½“å‰æœºå™¨çš„ goroutine æ•°: <span class="number">3</span></span><br><span class="line">[*] Main End</span><br><span class="line">Func B() : <span class="number">0</span></span><br><span class="line">Func B() : <span class="number">1</span></span><br><span class="line">Func B() : <span class="number">2</span></span><br><span class="line">Func B() : <span class="number">3</span></span><br><span class="line">Func B() : <span class="number">4</span></span><br><span class="line">Func B() : <span class="number">5</span></span><br><span class="line">Func A() : <span class="number">0</span></span><br><span class="line">Func A() : <span class="number">1</span></span><br><span class="line">Func A() : <span class="number">2</span></span><br><span class="line">Func A() : <span class="number">3</span></span><br><span class="line">Func A() : <span class="number">4</span></span><br><span class="line">Func A() : <span class="number">5</span></span><br><span class="line"><span class="comment">// ç»“æœè¯´æ˜:  Mac å¯ä»¥å¤ç°æˆåŠŸï¼Œè€ŒLinuxä¸Windowsè¿˜æ˜¯ä¸€ä¸ªgoroutineä»»åŠ¡åšå®Œåå†åšå¦å¤–ä¸€ä¸ªgoroutineä»»åŠ¡,å…¶ç»“æœå¦‚ä¸Šã€‚</span></span><br><span class="line"><span class="comment">// å½“ä¸¤ä¸ªä»»åŠ¡åªæœ‰ä¸€ä¸ªé€»è¾‘æ ¸å¿ƒï¼Œæ­¤æ—¶æ˜¯åšå®Œä¸€ä¸ªä»»åŠ¡å†åšå¦ä¸€ä¸ªä»»åŠ¡ã€‚ </span></span><br><span class="line"><span class="comment">// å½“å°†é€»è¾‘æ ¸å¿ƒæ•°è®¾ä¸º2ï¼Œæ­¤æ—¶ä¸¤ä¸ªä»»åŠ¡å¹¶è¡Œæ‰§è¡Œï¼Œå³ç†æƒ³çš„çŠ¶æ€æ˜¯åšä¸€ä¸ªä»»åŠ¡aå†åšä¸€ä¸ªä»»åŠ¡bï¼Œè¿›è¡Œäº¤å‰æ‰§è¡Œã€‚</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="4-Channel-é€šé“"><a href="#4-Channel-é€šé“" class="headerlink" title="4.Channel é€šé“"></a>4.Channel é€šé“</h3><p>æè¿°: ä¸Šé¢ç« èŠ‚ä»‹ç»äº†Goroutineçš„åŸºæœ¬ä½¿ç”¨ï¼Œä½†æ˜¯æ‚¨ä¼šå‘ç°å•çº¯åœ°å°†å‡½æ•°å¹¶å‘æ‰§è¡Œæ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå‡½æ•°ä¸å‡½æ•°é—´éœ€è¦äº¤æ¢æ•°æ®æ‰èƒ½ä½“ç°å¹¶å‘æ‰§è¡Œå‡½æ•°çš„æ„ä¹‰ã€‚</p>
<p><strong>èƒŒæ™¯è¯´æ˜</strong><br>è™½ç„¶å¯ä»¥ä½¿ç”¨å…±äº«å†…å­˜è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œä½†æ˜¯å…±äº«å†…å­˜åœ¨ä¸åŒçš„goroutineä¸­å®¹æ˜“å‘ç”Ÿç«æ€é—®é¢˜ï¼Œæ‰€ä»¥ä¸ºäº†ä¿è¯æ•°æ®äº¤æ¢çš„æ­£ç¡®æ€§ï¼Œå°±å¿…é¡»ä½¿ç”¨äº’æ–¥é‡å¯¹å†…å­˜è¿›è¡ŒåŠ é”ï¼Œä½†æ˜¯è¿™ç§åšæ³•åŠ¿å¿…é€ æˆæ€§èƒ½æ–¹é¢çš„é—®é¢˜ã€‚</p>
<p><strong>è§£å†³åŠæ³•</strong><br>ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜,Goè¯­è¨€çš„å¹¶å‘æ¨¡å‹é‡‡ç”¨å¾—æ˜¯<code>(CSP-Communicating Sequential Processes)</code>, å®ƒæå€¡é€šè¿‡é€šä¿¡å…±äº«å†…å­˜è€Œä¸æ˜¯é€šè¿‡å…±äº«å†…å­˜è€Œå®ç°é€šä¿¡,å…¶å¼•å…¥äº†channelçš„æ¦‚å¿µã€‚</p>
<p><strong>åŸºç¡€ä»‹ç»</strong><br>å¦‚æœè¯´ goroutineæ˜¯Goç¨‹åºå¹¶å‘çš„æ‰§è¡Œä½“ï¼Œè€Œ channel (<code>è‹± [ËˆtÊƒÃ¦nl]</code>) å°±æ˜¯å®ƒä»¬ä¹‹é—´çš„è¿æ¥é€šé“, channel æ˜¯å¯ä»¥è®©ä¸€ä¸ªgoroutineå‘é€ç‰¹å®šå€¼åˆ°å¦ä¸€ä¸ªgoroutineçš„é€šä¿¡æœºåˆ¶ã€‚</p>
<p>ç®€å•çš„è¯´: å³é€šè¿‡Channelå®ç°å¤šä¸ªgoroutineä¹‹é—´çš„é€šä¿¡ã€‚</p>
<p><br></p>
<p>Go è¯­è¨€ä¸­çš„é€šé“ï¼ˆchannelï¼‰æ˜¯ä¸€ç§<code>ç‰¹æ®Šçš„ç±»å‹</code>, é€šé“åƒä¸€ä¸ªä¼ é€å¸¦æˆ–è€…é˜Ÿåˆ—ï¼Œæ€»æ˜¯<code>éµå¾ªå…ˆå…¥å…ˆå‡ºï¼ˆFirst In First Outï¼‰çš„è§„åˆ™</code>ï¼Œä¿è¯æ”¶å‘æ•°æ®çš„é¡ºåºã€‚æ¯ä¸€ä¸ªé€šé“éƒ½æ˜¯ä¸€ä¸ªå…·ä½“ç±»å‹çš„å¯¼ç®¡ï¼Œä¹Ÿå°±æ˜¯<code>å£°æ˜channelçš„æ—¶å€™éœ€è¦ä¸ºå…¶æŒ‡å®šå…ƒç´ ç±»å‹</code>ã€‚</p>
<p><br></p>
<h4 id="1-channel-ç±»å‹"><a href="#1-channel-ç±»å‹" class="headerlink" title="1.channel ç±»å‹"></a>1.channel ç±»å‹</h4><p>æè¿°: channelæ˜¯ç‰¹æ®Šç±»å‹(ä¸€ç§å¼•ç”¨ç±»å‹), å…¶å£°æ˜é€šé“ç±»å‹çš„æ ¼å¼å¦‚ä¸‹ï¼š<code>var å˜é‡ chan å…ƒç´ ç±»å‹</code></p>
<p><strong>ç¤ºä¾‹è¯´æ˜:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ch1 <span class="keyword">chan</span> <span class="keyword">int</span>   <span class="comment">// å£°æ˜ä¸€ä¸ªä¼ é€’æ•´å‹çš„é€šé“</span></span><br><span class="line"><span class="keyword">var</span> ch2 <span class="keyword">chan</span> <span class="keyword">bool</span>  <span class="comment">// å£°æ˜ä¸€ä¸ªä¼ é€’å¸ƒå°”å‹çš„é€šé“</span></span><br><span class="line"><span class="keyword">var</span> ch3 <span class="keyword">chan</span> []<span class="keyword">int</span> <span class="comment">// å£°æ˜ä¸€ä¸ªä¼ é€’intåˆ‡ç‰‡çš„é€šé“</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="2-channel-åˆ›å»º"><a href="#2-channel-åˆ›å»º" class="headerlink" title="2.channel åˆ›å»º"></a>2.channel åˆ›å»º</h4><p>æè¿°: åˆ›å»º channel çš„æ ¼å¼å¦‚ä¸‹ï¼š<code>make(chan å…ƒç´ ç±»å‹, [ç¼“å†²å¤§å°])</code>, channelçš„ç¼“å†²å¤§å°æ˜¯å¯é€‰çš„ã€‚</p>
<p>Tips: ç”±äºé€šé“æ˜¯å¼•ç”¨ç±»å‹, å£°æ˜çš„é€šé“åéœ€è¦ä½¿ç”¨makeå‡½æ•°åˆå§‹åŒ–ä¹‹åæ‰èƒ½ä½¿ç”¨ï¼Œå¹¶ä¸”éœ€è¦æ³¨æ„<code>é€šé“ç±»å‹çš„ç©ºå€¼æ˜¯nil</code>ã€‚<br>Tips: Sliceã€Mapã€Channel éœ€è¦makeå‡½æ•°åˆå§‹åŒ–åæ–¹èƒ½ä½¿ç”¨ã€‚</p>
<p><strong>ç¤ºä¾‹è¯´æ˜:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ch <span class="keyword">chan</span> <span class="keyword">int</span></span><br><span class="line">fmt.Println(ch)   <span class="comment">// æœªåˆå§‹è¿”å› &lt;nil&gt;</span></span><br><span class="line"></span><br><span class="line">ch4 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>) <span class="comment">// å¿…é¡»ç”¨makeå‡½æ•°åˆå§‹åŒ–ä¹‹åæ‰èƒ½ä½¿ç”¨</span></span><br><span class="line">ch5 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>)</span><br><span class="line">ch6 := <span class="built_in">make</span>(<span class="keyword">chan</span> []<span class="keyword">int</span>,<span class="number">10</span>)  <span class="comment">// å¸¦ç¼“å†²åŒºçš„</span></span><br></pre></td></tr></table></figure></p>
<p>Tips: å£°æ˜æ—¶æŒ‡å®šé€šé“ä¸­å…ƒç´ ç±»å‹,å®šä¹‰ä½¿ç”¨æ—¶é€šé“å¿…é¡»ä½¿ç”¨makeå‡½æ•°åˆå§‹åŒ–æ‰èƒ½ä½¿ç”¨ã€‚</p>
<p><br></p>
<h4 id="3-channel-æ“ä½œ"><a href="#3-channel-æ“ä½œ" class="headerlink" title="3.channel æ“ä½œ"></a>3.channel æ“ä½œ</h4><p>æè¿°: é€šé“æœ‰<code>å‘é€(send) ã€æ¥æ”¶ (receive) å’Œ å…³é—­(close)</code> ä¸‰ç§æ“ä½œ, ä½†å€¼å¾—æ³¨æ„çš„æ˜¯å‘é€å’Œæ¥æ”¶éƒ½ä½¿ç”¨<code>&lt;-</code>ç¬¦å·ã€‚</p>
<ul>
<li>send ï¼šå°†ä¸€ä¸ªå€¼å‘é€åˆ°é€šé“ä¸­ã€‚</li>
<li>receive : ä»ä¸€ä¸ªé€šé“ä¸­æ¥æ”¶å€¼ã€‚</li>
<li>close : æˆ‘ä»¬é€šè¿‡è°ƒç”¨å†…ç½®çš„closeå‡½æ•°æ¥å…³é—­é€šé“,ä¹Ÿå¯ä»¥ä¸ç”¨å…³é—­é€šé“,å› ä¸ºé€šé“æ˜¯å¼•ç”¨ç±»å‹çš„å˜é‡,æ‰€ä»¥å®ƒä¼šåœ¨ç¨‹åºç»“æŸåè‡ªåŠ¨ç»™GC(<code>åƒåœ¾å›æ”¶</code>)ã€‚</li>
</ul>
<p><br/></p>
<p><strong>ç¤ºä¾‹è¯´æ˜</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªé€šé“(åˆå§‹åŒ–é€šé“)</span></span><br><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘é€ send</span></span><br><span class="line">ch &lt;- <span class="number">10</span> <span class="comment">// æŠŠ10å‘é€åˆ°chä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥æ”¶ receive</span></span><br><span class="line">x := &lt;-ch  <span class="comment">// ä»chä¸­æ¥æ”¶å€¼å¹¶èµ‹å€¼ç»™å˜é‡x</span></span><br><span class="line">&lt;-ch       <span class="comment">// ä»chä¸­æ¥æ”¶å€¼ï¼Œå¿½ç•¥ç»“æœ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…³é—­ close</span></span><br><span class="line"><span class="built_in">close</span>(x)</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>æ¸©é¦¨æç¤º:</strong></p>
<ul>
<li>å…³äºå…³é—­é€šé“éœ€è¦æ³¨æ„çš„äº‹æƒ…æ˜¯ï¼Œåªæœ‰åœ¨é€šçŸ¥æ¥æ”¶æ–¹goroutineæ‰€æœ‰çš„æ•°æ®éƒ½å‘é€å®Œæ¯•çš„æ—¶å€™æ‰éœ€è¦å…³é—­é€šé“ã€‚</li>
<li>é€šé“æ˜¯å¯ä»¥è¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶çš„ï¼Œå®ƒå’Œå…³é—­æ–‡ä»¶æ˜¯ä¸ä¸€æ ·çš„ï¼Œåœ¨ç»“æŸæ“ä½œä¹‹åå…³é—­æ–‡ä»¶æ˜¯å¿…é¡»è¦åšçš„ï¼Œä½†å…³é—­é€šé“ä¸æ˜¯å¿…é¡»çš„ã€‚</li>
<li>é€šé“å…³é—­åçš„ç‰¹ç‚¹å¦‚ä¸‹<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* å¯¹ä¸€ä¸ªå…³é—­çš„é€šé“å†å‘é€å€¼å°±ä¼šå¯¼è‡´panicã€‚</span><br><span class="line">* å¯¹ä¸€ä¸ªå…³é—­çš„é€šé“è¿›è¡Œæ¥æ”¶ä¼šä¸€ç›´è·å–å€¼ç›´åˆ°é€šé“ä¸ºç©ºã€‚</span><br><span class="line">* å¯¹ä¸€ä¸ªå…³é—­çš„å¹¶ä¸”æ²¡æœ‰å€¼çš„é€šé“æ‰§è¡Œæ¥æ”¶æ“ä½œä¼šå¾—åˆ°å¯¹åº”ç±»å‹çš„é›¶å€¼ã€‚</span><br><span class="line">* å…³é—­ä¸€ä¸ªå·²ç»å…³é—­çš„é€šé“ä¼šå¯¼è‡´panicã€‚</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<h4 id="4-channel-ç¼“å†²"><a href="#4-channel-ç¼“å†²" class="headerlink" title="4.channel ç¼“å†²"></a>4.channel ç¼“å†²</h4><p>æè¿°: æˆ‘ä»¬å¯ä»¥ä¸º channel è®¾ç½®ç¼“å†²æˆ–è€…ä¸è®¾ç½®ç¼“å†²åŒºï¼Œå…¶ä¸¤è€…æ¦‚å¿µå’ŒåŒºåˆ«å¦‚ä¸‹ã€‚</p>
<ul>
<li>æ— ç¼“å†²çš„é€šé“: åˆç§°ä¸ºé˜»å¡çš„é€šé“(å¿…é¡»æœ‰æ¥æ”¶æ‰èƒ½å‘é€)ã€‚</li>
<li>æœ‰ç¼“å†²çš„é€šé“: ä¸ºè§£å†³æ— ç¼“å†²çš„é€šé“å­˜åœ¨çš„é—®é¢˜å­•è‚²è€Œç”Ÿã€‚</li>
</ul>
<p><br/></p>
<p><strong>æ— ç¼“å†²çš„é€šé“</strong></p>
<p>æè¿°: ä½¿ç”¨æ— ç¼“å†²é€šé“è¿›è¡Œé€šä¿¡å°†å¯¼è‡´å‘é€å’Œæ¥æ”¶çš„<code>goroutine</code>åŒæ­¥åŒ–,å› æ­¤æ— ç¼“å†²é€šé“ä¹Ÿè¢«ç§°ä¸º<code>åŒæ­¥é€šé“</code>ã€‚</p>
<p>åºŸè¯ä¸å¤šè¯´,å…ˆçœ‹å¼•å…¥çš„ç¤ºä¾‹ä»£ç ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">  ch &lt;- <span class="number">10</span>  <span class="comment">// ä»£ç ä¼šé˜»å¡åœ¨ ch &lt;- 10è¿™ä¸€è¡Œä»£ç å½¢æˆæ­»é”</span></span><br><span class="line">  fmt.Println(<span class="string">"å‘é€æˆåŠŸ"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ä¸Šé¢è¿™æ®µä»£ç èƒ½å¤Ÿé€šè¿‡ç¼–è¯‘ï¼Œä½†æ˜¯æ‰§è¡Œçš„æ—¶å€™ä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fatal error: all goroutines are asleep - deadlock!</span><br><span class="line">goroutine <span class="number">1</span> [<span class="keyword">chan</span> send]:</span><br><span class="line">main.main()</span><br><span class="line">.../src/github.com/main.<span class="keyword">go</span>:<span class="number">8</span> +<span class="number">0x50</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>Q: ä¸ºä»€ä¹ˆä¼šå‡ºç°deadlocké”™è¯¯å‘¢ï¼Ÿ</p>
<blockquote>
<p>ç­”: å› ä¸ºæˆ‘ä»¬ä½¿ç”¨<code>ch := make(chan int)</code>åˆ›å»ºçš„æ˜¯æ— ç¼“å†²çš„é€šé“ï¼Œæ— ç¼“å†²çš„é€šé“åªæœ‰åœ¨æœ‰äººæ¥æ”¶å€¼çš„æ—¶å€™æ‰èƒ½å‘é€å€¼ã€‚<br>ä¾‹å¦‚: å°±åƒä½ ä½çš„å°åŒºå¦‚æœæ²¡æœ‰å¿«é€’æŸœå’Œä»£æ”¶ç‚¹ï¼Œå¿«é€’å‘˜ç»™ä½ æ‰“ç”µè¯å¿…é¡»è¦æŠŠè¿™ä¸ªç‰©å“é€åˆ°ä½ çš„æ‰‹ä¸­ï¼Œç®€å•æ¥è¯´å°±æ˜¯<code>æ— ç¼“å†²çš„é€šé“å¿…é¡»æœ‰æ¥æ”¶æ‰èƒ½å‘é€</code>ã€‚</p>
</blockquote>
<p><br/></p>
<p>Q: é‚£å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p>
<blockquote>
<p>ç­”: ä¸€ç§æ–¹æ³•æ˜¯å¯ç”¨ä¸€ä¸ªgoroutineå»æ¥æ”¶å€¼ï¼Œå¦å¤–ä¸€ç§æ–¹å¼å°±æ˜¯é‡‡ç”¨å¸¦ç¼“å†²çš„é€šé“ï¼ˆåç»­ä»‹ç»ï¼‰ã€‚</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">recv</span><span class="params">(c <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  ret := &lt;-c</span><br><span class="line">  fmt.Println(<span class="string">"æ¥æ”¶æˆåŠŸ"</span>, ret)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">  <span class="keyword">go</span> recv(ch) <span class="comment">// å¯ç”¨goroutineä»é€šé“æ¥æ”¶å€¼</span></span><br><span class="line">  ch &lt;- <span class="number">10</span></span><br><span class="line">  fmt.Println(<span class="string">"å‘é€æˆåŠŸ"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Tips: åœ¨æ— ç¼“å†²é€šé“ä¸Šçš„å‘é€æ“ä½œä¼šé˜»å¡ï¼Œç›´åˆ°å¦ä¸€ä¸ªgoroutineåœ¨è¯¥é€šé“ä¸Šæ‰§è¡Œæ¥æ”¶æ“ä½œï¼Œè¿™æ—¶å€¼æ‰èƒ½å‘é€æˆåŠŸï¼Œä¸¤ä¸ªgoroutineå°†ç»§ç»­æ‰§è¡Œã€‚<br>Tips: åœ¨æ— ç¼“å†²é€šé“ä¸Šçš„å¦‚æœæ¥æ”¶æ“ä½œå…ˆæ‰§è¡Œï¼Œæ¥æ”¶æ–¹çš„goroutineå°†é˜»å¡ï¼Œç›´åˆ°å¦ä¸€ä¸ªgoroutineåœ¨è¯¥é€šé“ä¸Šå‘é€ä¸€ä¸ªå€¼ã€‚</p>
<p><br></p>
<p><strong>æœ‰ç¼“å†²çš„é€šé“</strong><br>æè¿°: ä½¿ç”¨æœ‰ç¼“å†²åŒºçš„é€šé“å¯ä»¥è§£å†³æ— ç¼“å†²çš„é€šé“é˜»å¡é—®é¢˜, æˆ‘ä»¬å¯ä»¥åœ¨ä½¿ç”¨makeå‡½æ•°åˆå§‹åŒ–é€šé“çš„æ—¶å€™ä¸ºå…¶æŒ‡å®šé€šé“çš„å®¹é‡ï¼Œä¾‹å¦‚ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">1</span>) <span class="comment">// åˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º1çš„æœ‰ç¼“å†²åŒºé€šé“</span></span><br><span class="line">  ch &lt;- <span class="number">10</span></span><br><span class="line">  fmt.Println(<span class="string">"å‘é€æˆåŠŸ"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åªè¦é€šé“çš„å®¹é‡å¤§äºé›¶ï¼Œé‚£ä¹ˆè¯¥é€šé“å°±æ˜¯æœ‰ç¼“å†²çš„é€šé“ï¼Œé€šé“çš„å®¹é‡è¡¨ç¤ºé€šé“ä¸­èƒ½å­˜æ”¾å…ƒç´ çš„æ•°é‡, å°±åƒä½ å°åŒºçš„å¿«é€’æŸœåªæœ‰é‚£ä¹ˆä¸ªå¤šæ ¼å­ï¼Œæ ¼å­æ»¡äº†å°±è£…ä¸ä¸‹äº†å°±é˜»å¡äº†ï¼Œç­‰åˆ°åˆ«äººå–èµ°ä¸€ä¸ªå¿«é€’å‘˜å°±èƒ½å¾€é‡Œé¢æ”¾ä¸€ä¸ªã€‚</p>
<p>åŒæ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å†…ç½®çš„lenå‡½æ•°è·å–é€šé“å†…å…ƒç´ çš„æ•°é‡ï¼Œä½¿ç”¨capå‡½æ•°è·å–é€šé“çš„å®¹é‡ï¼Œè™½ç„¶æˆ‘ä»¬å¾ˆå°‘ä¼šè¿™ä¹ˆåšã€‚</p>
<p><br/></p>
<p><strong>å®è·µæ¡ˆä¾‹:</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// make å‡½æ•°ç”³è¯·å†…å­˜ç©ºé—´çš„ä¼ å…¥å¯¹è±¡ï¼ˆå®ä¾‹åŒ–ä¸‰ç§ç±»å‹ï¼‰</span></span><br><span class="line"><span class="keyword">var</span> s []<span class="keyword">int</span>          <span class="comment">// slice åˆ‡ç‰‡</span></span><br><span class="line"><span class="keyword">var</span> m <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span> <span class="comment">// map å­—å…¸æ˜ å°„</span></span><br><span class="line"><span class="keyword">var</span> c <span class="keyword">chan</span> <span class="keyword">int</span>       <span class="comment">// æŒ‡å®šé€šé“ä¸­å…ƒç´ çš„ç±»å‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰å…¨å±€çš„waitGroup</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ— ç¼“å†²çš„é€šé“ç¤ºä¾‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">noBuffer</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(c)      <span class="comment">// æœªåˆå§‹åŒ–çš„é€šé“è¿”å› nil ï¼ˆæœªå‘å†…å­˜ä¸­ç”³è¯·ç©ºé—´ï¼‰</span></span><br><span class="line">  c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>) <span class="comment">// ä¸å¸¦ç¼“å†²åŒºé€šé“çš„åˆå§‹åŒ– ï¼ˆä½†å¿…é¡»æœ‰å¯¹åº”çš„æ¥æ”¶ï¼‰</span></span><br><span class="line">  fmt.Println(<span class="string">"å°† 10 å‘ç”Ÿåˆ° channel c ä¹‹ä¸­"</span>)</span><br><span class="line">  wg.Add(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; <span class="comment">// å¹¶è¡Œä»»åŠ¡çš„é¡ºåºéå¸¸é‡è¦ï¼Œæ­¤å¤„ä¸èƒ½æ”¾åœ¨ c &lt;- 10 åå¦åˆ™ç»ˆç«¯å°†ä¼šä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">defer</span> wg.Done()</span><br><span class="line">    x := &lt;-c</span><br><span class="line">    fmt.Printf(<span class="string">"Backgroup Goroutine ä» channel c ä¸­å–å¾— %v \n\n"</span>, x)</span><br><span class="line">  &#125;()</span><br><span class="line">  c &lt;- <span class="number">10</span> <span class="comment">// å°† 10 å‘ç”Ÿåˆ° channel c ä¹‹ä¸­ï¼ˆæ³¨æ„æ­¤è¡Œæ”¾çš„é¡ºåºï¼‰</span></span><br><span class="line">  wg.Wait()</span><br><span class="line">  <span class="keyword">defer</span> <span class="built_in">close</span>(c) <span class="comment">// å…³é—­é€šé“</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ‰ç¼“å†²çš„é€šé“ç¤ºä¾‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">useBuffer</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(c)        <span class="comment">// æœªåˆå§‹åŒ–çš„é€šé“è¿”å› nil ï¼ˆæœªå‘å†…å­˜ä¸­ç”³è¯·ç©ºé—´ï¼‰</span></span><br><span class="line">  c = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">2</span>) <span class="comment">// å¸¦ç¼“å†²åŒºé€šé“çš„åˆå§‹åŒ–</span></span><br><span class="line">  fmt.Println(<span class="string">"é€šé“ç¼“å†²æ•°é‡ï¼ˆå‘é€å‰ï¼‰:"</span>, <span class="built_in">len</span>(c))</span><br><span class="line">  c &lt;- <span class="number">10</span>                                <span class="comment">// å°† 10 å‘ç”Ÿåˆ° channel c ä¹‹ä¸­</span></span><br><span class="line">  fmt.Println(<span class="string">"åŒæ ·å°† 10 å‘ç”Ÿåˆ° channel c ä¹‹ä¸­"</span>) <span class="comment">// æ­¤å¤„å°†ä¸ä¼šé˜»å¡</span></span><br><span class="line">  c &lt;- <span class="number">20</span>                                <span class="comment">// å°† 10 å‘ç”Ÿåˆ° channel c ä¹‹ä¸­</span></span><br><span class="line">  fmt.Println(<span class="string">"ç„¶åå°† 20 å‘ç”Ÿåˆ° channel c ä¹‹ä¸­"</span>) <span class="comment">// å¦‚ä½•ç¼“å†²åŒºé€šé“åˆå§‹åŒ–ä¸º1ï¼Œåˆ™æ­¤å¤„å°†é˜»å¡,å¦‚æœåˆå§‹åŒ–é€šé“ç¼“å†²åŒºå¤§äºç­‰äº2å°†ä¼šä¸é˜»å¡</span></span><br><span class="line">  fmt.Println(<span class="string">"é€šé“ç¼“å†²æ•°é‡ï¼ˆå‘é€åï¼‰:"</span>, <span class="built_in">len</span>(c))</span><br><span class="line">  x := &lt;-c</span><br><span class="line">  fmt.Printf(<span class="string">"ç¬¬ä¸€æ¬¡ï¼Œä»channel cä¸­å–åˆ°äº† %v\n"</span>, x)</span><br><span class="line">  x = &lt;-c</span><br><span class="line">  fmt.Printf(<span class="string">"ç¬¬äºŒæ¬¡ï¼Œä»channel cä¸­å–åˆ°äº† %v\n"</span>, x)</span><br><span class="line">  fmt.Printf(<span class="string">"channel c ptr = %p \n"</span>, c)</span><br><span class="line">  <span class="keyword">defer</span> <span class="built_in">close</span>(c) <span class="comment">// å…³é—­é€šé“</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  noBuffer()</span><br><span class="line">  useBuffer()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç»“æœ:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="literal">nil</span>&gt;</span><br><span class="line">å°† <span class="number">10</span> å‘ç”Ÿåˆ° channel c ä¹‹ä¸­</span><br><span class="line">Backgroup Goroutine ä» channel c ä¸­å–å¾— <span class="number">10</span> </span><br><span class="line"></span><br><span class="line">&lt;<span class="literal">nil</span>&gt;</span><br><span class="line">é€šé“ç¼“å†²æ•°é‡: <span class="number">0</span></span><br><span class="line">åŒæ ·å°† <span class="number">10</span> å‘ç”Ÿåˆ° channel c ä¹‹ä¸­</span><br><span class="line">ç„¶åå°† <span class="number">20</span> å‘ç”Ÿåˆ° channel c ä¹‹ä¸­</span><br><span class="line">é€šé“ç¼“å†²æ•°é‡: <span class="number">2</span></span><br><span class="line">ç¬¬ä¸€æ¬¡ï¼Œä»channel cä¸­å–åˆ°äº† <span class="number">10</span></span><br><span class="line">ç¬¬äºŒæ¬¡ï¼Œä»channel cä¸­å–åˆ°äº† <span class="number">20</span></span><br><span class="line">channel c ptr = <span class="number">0xc0000240e0</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h4 id="5-channel-éå†"><a href="#5-channel-éå†" class="headerlink" title="5.channel éå†"></a>5.channel éå†</h4><p>æè¿°: å½“ä¸€ä¸ªé€šé“å‘é€åˆ°é€šé“é˜Ÿåˆ—é‡Œæœ‰å¤šä¸ªå€¼æ—¶, æ­¤æ—¶æˆ‘ä»¬æƒ³å–å‡ºé€šé“é˜Ÿåˆ—çš„æ‰€æœ‰å€¼æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>for range</code> éå†é€šé“ï¼Œå¹¶ä¸”å½“é€šé“è¢«å…³é—­çš„æ—¶å€™å°±ä¼šé€€å‡º<code>for range</code>éå†ã€‚</p>
<p>å½“å‘é€šé“ä¸­å‘é€å®Œæ•°æ®æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡closeå‡½æ•°æ¥å…³é—­é€šé“ï¼Œå¦‚æœæ­¤æ—¶å†å¾€è¯¥é€šé“å‘é€å€¼ä¼šå¼•å‘panicï¼Œä»è¯¥é€šé“å–å€¼çš„æ“ä½œä¼šå…ˆå–å®Œé€šé“ä¸­çš„å€¼ï¼Œå†ç„¶åå–åˆ°çš„å€¼ä¸€ç›´éƒ½æ˜¯å¯¹åº”ç±»å‹çš„é›¶å€¼ã€‚</p>
<p><br></p>
<p><strong>Q: é‚£å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªé€šé“æ˜¯å¦è¢«å…³é—­äº†å‘¢ï¼Ÿ</strong></p>
<blockquote>
<p>ç¬¬ä¸€ç§æ–¹æ³•<code>&lt;-ch</code>, ç¬¬äºŒç§æ–¹æ³•<code>for range</code>éå†é€šé“ã€‚</p>
</blockquote>
<p><strong>å®è·µæ¡ˆä¾‹:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// channel éå†å®è·µæ“ä½œ</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼1</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">method1</span><span class="params">()</span></span> &#123;</span><br><span class="line">  ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>) <span class="comment">// ä¸å¸¦ç¼“å†²åŒº</span></span><br><span class="line">  ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">  <span class="comment">// å¼€å¯goroutineå°†1~9çš„æ•°å‘é€åˆ°ch1ä¸­</span></span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">      ch1 &lt;- i</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(ch1) <span class="comment">// å…³é—­é€šé“ ch2 ï¼ˆæ­¤æ—¶åªèƒ½è¯»ä¸èƒ½å†™ï¼‰</span></span><br><span class="line">  &#125;()</span><br><span class="line">  <span class="comment">// å¼€å¯goroutineä»ch1ä¸­æ¥æ”¶å€¼ï¼Œå¹¶å°†è¯¥å€¼çš„å¹³æ–¹å‘é€åˆ°ch2ä¸­</span></span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">      i, ok := &lt;-ch1 <span class="comment">// é€šé“å…³é—­åå†å–å€¼åˆ°æœ«å°¾æ—¶ï¼Œok=false ã€å…³é”®ç‚¹å€¼å¾—å­¦ä¹ ã€‘</span></span><br><span class="line">      <span class="keyword">if</span> !ok &#123;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">      ch2 &lt;- i * i <span class="comment">// åŒæ ·æ±‚å–é€šé“çš„å¹³æ–¹</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(ch2) <span class="comment">// å…³é—­é€šé“ ch2 ï¼ˆæ­¤æ—¶åªèƒ½è¯»ä¸èƒ½å†™ï¼‰</span></span><br><span class="line">  &#125;()</span><br><span class="line">  <span class="comment">// åœ¨ä¸»goroutineä¸­ä»ch2ä¸­æ¥æ”¶å€¼æ‰“å°</span></span><br><span class="line">  fmt.Println(<span class="string">"æ–¹å¼1:"</span>)</span><br><span class="line">  <span class="keyword">for</span> i := <span class="keyword">range</span> ch2 &#123; <span class="comment">// é€šé“å…³é—­åä¼šé€€å‡ºfor rangeå¾ªç¯</span></span><br><span class="line">    fmt.Printf(<span class="string">"%d "</span>, i)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è´Ÿè´£å°†10ï½19å‘é€åˆ°ch1ä¸­</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span><span class="params">(ch1 <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">defer</span> wg.Done()</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">10</span>; i &lt; <span class="number">20</span>; i++ &#123;</span><br><span class="line">    ch1 &lt;- i</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">close</span>(ch1) <span class="comment">// å…³é—­é€šé“ ch1 ï¼ˆæ­¤æ—¶åªèƒ½è¯»ä¸èƒ½å†™ï¼‰</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è´Ÿè´£å°†æ¥æ”¶ch1å€¼çš„å€¼è¿›è¡Œå¹³æ–¹è¿ç®—</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span><span class="params">(ch1, ch2 <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">defer</span> wg.Done()</span><br><span class="line">  <span class="keyword">for</span> num := <span class="keyword">range</span> ch1 &#123;   ã€å…³é”®ç‚¹ã€‘</span><br><span class="line">    ch2 &lt;- num * num</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">close</span>(ch2) <span class="comment">// å…³é—­é€šé“ ch2 ï¼ˆæ­¤æ—¶åªèƒ½è¯»ä¸èƒ½å†™ï¼‰</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼2</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">method2</span><span class="params">()</span></span> &#123;</span><br><span class="line">  ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">10</span>) <span class="comment">// å¸¦ç¼“å†²åŒº</span></span><br><span class="line">  ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line">  <span class="comment">// goroutine ç­‰å¾…ç»„æ•°é‡è®¾ç½®</span></span><br><span class="line">  wg.Add(<span class="number">2</span>)</span><br><span class="line">  <span class="comment">// å¼€å¯ goroutine</span></span><br><span class="line">  <span class="keyword">go</span> f1(ch1)</span><br><span class="line">  <span class="keyword">go</span> f2(ch1, ch2)</span><br><span class="line">  <span class="comment">// ç­‰å¾…å…¨éƒ¨ goroutine ä»»åŠ¡æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">  wg.Wait()</span><br><span class="line">  fmt.Println(<span class="string">"æ–¹å¼2:"</span>)</span><br><span class="line">  <span class="comment">// é€šé“å…³é—­åä¼šé€€å‡ºfor rangeå¾ªç¯</span></span><br><span class="line">  <span class="keyword">for</span> ret := <span class="keyword">range</span> ch2 &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"%d "</span>, ret)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// åŒ¿åå‡½æ•°</span></span><br><span class="line">  method1()</span><br><span class="line">  fmt.Println()</span><br><span class="line">  <span class="comment">// å¸¸è§„å‡½æ•°</span></span><br><span class="line">  method2()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Tips: ä»ä¸Šé¢çš„ä¾‹å­ä¸­æˆ‘ä»¬çœ‹åˆ°æœ‰ä¸¤ç§æ–¹å¼åœ¨æ¥æ”¶å€¼çš„æ—¶å€™åˆ¤æ–­è¯¥é€šé“æ˜¯å¦è¢«å…³é—­.</p>
<p><br></p>
<h4 id="6-å•å‘é€šé“"><a href="#6-å•å‘é€šé“" class="headerlink" title="6.å•å‘é€šé“"></a>6.å•å‘é€šé“</h4><p>æè¿°: æœ‰çš„æ—¶å€™æˆ‘ä»¬ä¼šå°†é€šé“ä½œä¸ºå‚æ•°åœ¨å¤šä¸ªä»»åŠ¡å‡½æ•°é—´ä¼ é€’ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬åœ¨ä¸åŒçš„ä»»åŠ¡å‡½æ•°ä¸­ä½¿ç”¨é€šé“éƒ½ä¼šå¯¹å…¶è¿›è¡Œé™åˆ¶ï¼Œæ¯”å¦‚<code>é™åˆ¶é€šé“åœ¨å‡½æ•°ä¸­åªèƒ½å‘é€æˆ–åªèƒ½æ¥æ”¶</code>ã€‚</p>
<p>æ‰€ä»¥åœ¨è¿™æ ·åœºæ™¯ä¸‹Goè¯­è¨€ä¸­æä¾›äº†å•å‘é€šé“æ¥å¤„ç†è¿™ç§æƒ…å†µã€‚</p>
<ul>
<li><code>out chan&lt;- int</code> æ˜¯ä¸€ä¸ªåªå†™å•å‘é€šé“ï¼ˆåªèƒ½å¯¹å…¶å†™å…¥intç±»å‹å€¼ï¼‰ï¼Œå¯ä»¥å¯¹å…¶æ‰§è¡Œå‘é€æ“ä½œä½†æ˜¯ä¸èƒ½æ‰§è¡Œæ¥æ”¶æ“ä½œ;</li>
<li><code>in  &lt;-chan int</code> æ˜¯ä¸€ä¸ªåªè¯»å•å‘é€šé“ï¼ˆåªèƒ½ä»å…¶è¯»å–intç±»å‹å€¼ï¼‰ï¼Œå¯ä»¥å¯¹å…¶æ‰§è¡Œæ¥æ”¶æ“ä½œä½†æ˜¯ä¸èƒ½æ‰§è¡Œå‘é€æ“ä½œ;</li>
</ul>
<p>Tips: åœ¨å‡½æ•°ä¼ å‚åŠä»»ä½•èµ‹å€¼æ“ä½œä¸­å¯ä»¥å°†åŒå‘é€šé“è½¬æ¢ä¸ºå•å‘é€šé“ï¼Œä½†åè¿‡æ¥æ˜¯ä¸å¯ä»¥çš„ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æŠŠä¸Šé¢çš„ä¾‹å­æ”¹é€ å¦‚ä¸‹ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡½æ•°å‚æ•° outï¼š ä¸€ä¸ªåªå†™å•å‘é€šé“ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">counter</span><span class="params">(out <span class="keyword">chan</span>&lt;- <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">    out &lt;- i</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">close</span>(out)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°å‚æ•° outï¼š ä¸€ä¸ªåªå†™å•å‘é€šé“,å‡½æ•°å‚æ•° in: ä¸€ä¸ªåªè¯»å•å‘é€šé“ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">squarer</span><span class="params">(out <span class="keyword">chan</span>&lt;- <span class="keyword">int</span>, in &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="keyword">range</span> in &#123;</span><br><span class="line">    out &lt;- i * i</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">close</span>(out)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°å‚æ•° in : ä¸€ä¸ªåªè¯»å•å‘é€šé“ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printer</span><span class="params">(in &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="keyword">range</span> in &#123;</span><br><span class="line">    fmt.Println(i)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">  ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">  <span class="keyword">go</span> counter(ch1) <span class="comment">// ch1 æ­¤æ—¶åªå†™</span></span><br><span class="line">  <span class="keyword">go</span> squarer(ch2, ch1) <span class="comment">// ch2 æ­¤æ—¶åªå†™ï¼Œch1 æ­¤æ—¶åªè¯»</span></span><br><span class="line">  printer(ch2) <span class="comment">// ch2 æ­¤æ—¶åªè¯»</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>å®è·µæ¡ˆä¾‹</strong><br>æè¿°: è¯·ä¼ å…¥é€šé“ä¸­æµ®ç‚¹æ•°ç±»å‹çš„ä¸‰æ¬¡æ–¹ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Unidirectional channel</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> once sync.Once</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šé“åªå†™æ“ä½œ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span><span class="params">(ch1 <span class="keyword">chan</span>&lt;- <span class="keyword">float64</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">defer</span> wg.Done()</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">    ch1 &lt;- <span class="keyword">float64</span>(i)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">close</span>(ch1)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šé“åªå†™ä¸åªè¯»æ“ä½œ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span><span class="params">(ch2 <span class="keyword">chan</span>&lt;- <span class="keyword">float64</span>, ch1 &lt;-<span class="keyword">chan</span> <span class="keyword">float64</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">defer</span> wg.Done()</span><br><span class="line">  <span class="keyword">for</span> i := <span class="keyword">range</span> ch1 &#123;</span><br><span class="line">    ch2 &lt;- math.Pow(i, <span class="number">3</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç¡®ä¿æŸä¸ªæ“ä½œåªæ‰§è¡Œä¸€æ¬¡ï¼Œé˜²æ­¢å› ä¸ºé€šé“å…³é—­è€Œå…¶ä»–å¹¶å‘(è¿›ç¨‹)ä¸èƒ½è¯»å–</span></span><br><span class="line">  anonymousefun := (<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="built_in">close</span>(ch2)</span><br><span class="line">  &#125;)</span><br><span class="line">  once.Do(anonymousefun)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">float64</span>, <span class="number">10</span>) <span class="comment">// å¸¦ç¼“å†²åŒºçš„é€šé“</span></span><br><span class="line">  ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">float64</span>, <span class="number">10</span>) <span class="comment">// å¸¦ç¼“å†²åŒºçš„é€šé“</span></span><br><span class="line">  wg.Add(<span class="number">3</span>)</span><br><span class="line">  <span class="keyword">go</span> f1(ch1)</span><br><span class="line">  <span class="keyword">go</span> f2(ch2, ch1) <span class="comment">// å¤šæ¬¡ goroutine åŒä¸€ä¸ªå‡½æ•°</span></span><br><span class="line">  <span class="keyword">go</span> f2(ch2, ch1)</span><br><span class="line">  wg.Wait()</span><br><span class="line">  <span class="comment">// å¾ªç¯éå†ï¼Œç›´åˆ°è¯»å–åˆ°æœ«å°¾</span></span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    x, ok := &lt;-ch2</span><br><span class="line">    <span class="keyword">if</span> !ok &#123;</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Printf(<span class="string">"%.0f "</span>, x)</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœ: <code>0 1 8 27 64 125 216 343 512 729</code></p>
<p><br></p>
<h4 id="7-é€šé“æ€»ç»“"><a href="#7-é€šé“æ€»ç»“" class="headerlink" title="7.é€šé“æ€»ç»“"></a>7.é€šé“æ€»ç»“</h4><p>æè¿°: channel å¸¸è§çš„å¼‚å¸¸æ€»ç»“,éå¸¸æ³¨æ„<code>å…³é—­å·²ç»å…³é—­çš„channelä¹Ÿä¼šå¼•å‘panic</code>ï¼Œå¦‚ä¸‹è¡¨ï¼š</p>
<table>
<thead>
<tr>
<th>Channel</th>
<th>Nil</th>
<th>éç©º</th>
<th>ç©ºçš„</th>
<th>æ»¡äº†</th>
<th>æ²¡æ»¡</th>
</tr>
</thead>
<tbody>
<tr>
<td>å‘é€(Send)</td>
<td>é˜»å¡</td>
<td>å‘é€å€¼</td>
<td>å‘é€å€¼</td>
<td>é˜»å¡</td>
<td>å‘é€å€¼</td>
<td></td>
</tr>
<tr>
<td>æ¥æ”¶(Receive)</td>
<td>é˜»å¡</td>
<td>æ¥æ”¶å€¼</td>
<td>é˜»å¡</td>
<td>æ¥æ”¶å€¼</td>
<td>æ¥æ”¶å€¼</td>
<td></td>
</tr>
<tr>
<td>å…³é—­(Close)</td>
<td>panic</td>
<td>å…³é—­æˆåŠŸ,è¯»å®Œæ•°æ®åè¿”å›é›¶å€¼</td>
<td>å…³é—­æˆåŠŸ,è¿”å›é›¶å€¼</td>
<td>å…³é—­æˆåŠŸ,è¯»å®Œæ•°æ®åè¿”å›é›¶å€¼</td>
<td>å…³é—­æˆåŠŸ,è¿”å›é›¶å€¼</td>
<td>å…³é—­æˆåŠŸ,è¯»å®Œæ•°æ®åè¿”å›é›¶å€¼</td>
<td></td>
</tr>
</tbody>
</table>
<p><br></p>
<h3 id="5-Goroutine-æ± "><a href="#5-Goroutine-æ± " class="headerlink" title="5.Goroutine æ± "></a>5.Goroutine æ± </h3><p>æè¿°: åœ¨å·¥ä½œä¸­æˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨å¯ä»¥æŒ‡å®šå¯åŠ¨çš„<code>goroutine</code>æ•°é‡ä»¥<code>worker poolæ¨¡å¼</code>,å¹¶ä¸”åˆ©ç”¨æ§åˆ¶ goroutineçš„æ•°é‡ï¼Œæ¥é˜²æ­¢goroutineæ³„æ¼å’Œæš´æ¶¨ç­‰é—®é¢˜ã€‚</p>
<p>ç®€å•æè¿°ï¼šå°±æ˜¯é¢„å®šä¹‰ä¸€å®šæ•°é‡çš„Goroutineå»æ‰§è¡Œä»»åŠ¡(å‡½æ•°)ã€‚</p>
<p><strong>å®è·µæ¡ˆä¾‹1:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// goroutine åŒæ­¥ç­‰å¾…ç»„</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> one sync.Once</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(id <span class="keyword">int</span>, jobs &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>, results <span class="keyword">chan</span>&lt;- <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">defer</span> wg.Done()</span><br><span class="line">  <span class="keyword">for</span> j := <span class="keyword">range</span> jobs &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"worker:%d start job:%d\n"</span>, id, j)  <span class="comment">// start</span></span><br><span class="line">    time.Sleep(time.Millisecond * <span class="number">500</span>)            <span class="comment">// å»¶æ—¶500sæŸ¥çœ‹æ•ˆæœæ¯”è¾ƒæ˜æ˜¾</span></span><br><span class="line">    fmt.Printf(<span class="string">"worker:%d end job:%d\n"</span>, id, j)    <span class="comment">// end</span></span><br><span class="line">    results &lt;- j * <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ä¿è¯è°ƒç”¨çš„å‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ (å…³é”®ç‚¹)</span></span><br><span class="line">  one.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="built_in">close</span>(results)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// äº”ä¸ªä»»åŠ¡ç»™3ç»™goroutineæ± æ‰§è¡Œ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  jobs := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">100</span>)</span><br><span class="line">  results := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">100</span>)</span><br><span class="line">  <span class="comment">// goroutine æ± (æ­¤å¤„3ä¸ªgoroutineç»„æˆ)</span></span><br><span class="line">  wg.Add(<span class="number">3</span>)</span><br><span class="line">  <span class="keyword">for</span> w := <span class="number">1</span>; w &lt;= <span class="number">3</span>; w++ &#123;</span><br><span class="line">    <span class="keyword">go</span> worker(w, jobs, results) <span class="comment">// å½“æ‰§è¡Œåˆ°ç¬¬äº”çš„ä¸€ä¸ªä»»åŠ¡åå°†ä»‹ç»ï¼ˆæ‰€ä»¥ä¸€å…±ä¼šæ‰“å°10æ¬¡ï¼‰</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è®¾ç½®5ä¸ªä»»åŠ¡</span></span><br><span class="line">  <span class="keyword">for</span> j := <span class="number">1</span>; j &lt;= <span class="number">5</span>; j++ &#123;</span><br><span class="line">    jobs &lt;- j</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ä¿è¯è°ƒç”¨çš„å‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ (å…³é”®ç‚¹)</span></span><br><span class="line">  one.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="built_in">close</span>(jobs)</span><br><span class="line">  &#125;)</span><br><span class="line">  wg.Wait()</span><br><span class="line">  <span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line">  fmt.Println(<span class="string">"results channle length: "</span>, <span class="built_in">len</span>(results)) <span class="comment">// é•¿åº¦ä¸º 5</span></span><br><span class="line">  <span class="comment">// æ–¹å¼1,æ‰“å°åé˜»å¡(ä¼šä¸€ç›´ä»channelä¸­å–æ•°)</span></span><br><span class="line">  <span class="comment">// for &#123;</span></span><br><span class="line">  <span class="comment">// 	x, ok := &lt;-results  // results é€šé“è¢«å…³é—­æ—¶ok=Falseã€‚</span></span><br><span class="line">  <span class="comment">// 	if !ok &#123;</span></span><br><span class="line">  <span class="comment">// 		fmt.Println(ok)</span></span><br><span class="line">  <span class="comment">// 		break</span></span><br><span class="line">  <span class="comment">// 	&#125;</span></span><br><span class="line">  <span class="comment">// 	fmt.Println(ok, x)</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ–¹å¼2,æ‰“å°åé˜»å¡(ä¼šä¸€ç›´ä»channelä¸­å–æ•°)</span></span><br><span class="line">  <span class="comment">// for i := range results &#123;</span></span><br><span class="line">  <span class="comment">// 	fmt.Println(i)</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ­¤ç§æ–¹å¼ä¸ä¼šé˜»å¡</span></span><br><span class="line">  <span class="keyword">for</span> a := <span class="number">1</span>; a &lt;= <span class="number">5</span>; a++ &#123;</span><br><span class="line">    &lt;-results</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœ:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">worker:<span class="number">3</span> start job:<span class="number">1</span></span><br><span class="line">worker:<span class="number">2</span> start job:<span class="number">3</span></span><br><span class="line">worker:<span class="number">1</span> start job:<span class="number">2</span></span><br><span class="line">worker:<span class="number">1</span> end job:<span class="number">2</span></span><br><span class="line">worker:<span class="number">1</span> start job:<span class="number">4</span></span><br><span class="line">worker:<span class="number">2</span> end job:<span class="number">3</span></span><br><span class="line">worker:<span class="number">2</span> start job:<span class="number">5</span></span><br><span class="line">worker:<span class="number">3</span> end job:<span class="number">1</span></span><br><span class="line">worker:<span class="number">1</span> end job:<span class="number">4</span></span><br><span class="line">worker:<span class="number">2</span> end job:<span class="number">5</span></span><br><span class="line">results channle length:  <span class="number">5</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>å®è·µæ¡ˆä¾‹2:é’ˆå¯¹ä¸Šè¿°ç¤ºä¾‹è¿›è¡Œä¼˜åŒ–ï¼Œä¼˜åŒ–å¹¶å‘æµç¨‹,åˆ©ç”¨ä¿¡å·å˜é‡é€šçŸ¥goroutineä»»åŠ¡ç»“æŸå…³é—­é€šé“.</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(id <span class="keyword">int</span>, jobs &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>, results <span class="keyword">chan</span>&lt;- <span class="keyword">int</span>, notify <span class="keyword">chan</span>&lt;- <span class="keyword">struct</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> j := <span class="keyword">range</span> jobs &#123;</span><br><span class="line">    time.Sleep(time.Millisecond * <span class="number">500</span>)          <span class="comment">// å»¶æ—¶500sæŸ¥çœ‹æ•ˆæœæ¯”è¾ƒæ˜æ˜¾</span></span><br><span class="line">    fmt.Printf(<span class="string">"worker:%d end job:%d\n"</span>, id, j) <span class="comment">// end</span></span><br><span class="line">    results &lt;- j * <span class="number">2</span></span><br><span class="line">    notify &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125; <span class="comment">// ä»»åŠ¡æ‰§è¡Œä¿¡å·æ ‡è¯†,å®ä¾‹åŒ–åŒ¿åç»“æ„ä½“,å¦‚æ­¤ä½¿ç”¨éå¸¸èŠ‚çœç©ºé—´.</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 1.åˆå§‹åŒ–é€šé“</span></span><br><span class="line">  jobs := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">100</span>)</span><br><span class="line">  results := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">100</span>)</span><br><span class="line">  notify := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;, <span class="number">5</span>) <span class="comment">// ä½œä¸ºä¿¡å·ä½¿ç”¨,é€šé“ç±»å‹é‡‡ç”¨åŒ¿åç»“æ„ä½“,å ç”¨çš„ç³»ç»Ÿèµ„æºè¾ƒå°‘(å¸¸ç”¨å€¼å¾—å­¦ä¹ ),æ­¤å¤„ä½œä¸ºå¹¶å‘ä»»åŠ¡æ‰§è¡Œå®Œæ¯•é€šçŸ¥.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.ç”Ÿæˆäº”ä¸ªä»»åŠ¡</span></span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++ &#123;</span><br><span class="line">      jobs &lt;- i</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(jobs) <span class="comment">// ç»™é€šé“ä¼ é€’å®Œå€¼åå…³é—­</span></span><br><span class="line">  &#125;()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.å¼€å¯ä¸‰ä¸ªGoroutine (å¹¶å‘æ± )</span></span><br><span class="line">  <span class="keyword">for</span> w := <span class="number">1</span>; w &lt;= <span class="number">3</span>; w++ &#123;</span><br><span class="line">    <span class="keyword">go</span> worker(w, jobs, results, notify)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4.é€šè¿‡ä¿¡å·å˜é‡,éªŒè¯äº”ä¸ªä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæ¯•,å¦‚æœæ™šæŠ¥åˆ™å…³é—­resultsé€šé“</span></span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// å¾ªç¯äº”æ¬¡</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">      &lt;-notify</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å…³é—­é€šé“ï¼Œå¦‚æœä¸å…³é—­å°†ä¸€ç›´é˜»å¡</span></span><br><span class="line">    <span class="built_in">close</span>(results)</span><br><span class="line">  &#125;()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 5.éå†å·²å…³é—­çš„é€šé“å€¼</span></span><br><span class="line">  <span class="keyword">for</span> res := <span class="keyword">range</span> results &#123;</span><br><span class="line">    fmt.Println(res)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœ:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">worker:<span class="number">2</span> end job:<span class="number">2</span></span><br><span class="line">worker:<span class="number">3</span> end job:<span class="number">3</span></span><br><span class="line">worker:<span class="number">1</span> end job:<span class="number">1</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line">worker:<span class="number">2</span> end job:<span class="number">4</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line">worker:<span class="number">3</span> end job:<span class="number">5</span></span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="6-Goroutine-å¤šè·¯å¤ç”¨"><a href="#6-Goroutine-å¤šè·¯å¤ç”¨" class="headerlink" title="6.Goroutine å¤šè·¯å¤ç”¨"></a>6.Goroutine å¤šè·¯å¤ç”¨</h3><p>æè¿°: åœ¨æŸäº›åœºæ™¯ä¸‹æˆ‘ä»¬éœ€è¦åŒæ—¶ä»å¤šä¸ªé€šé“æ¥æ”¶æ•°æ®, é€šé“åœ¨æ¥æ”¶æ•°æ®æ—¶, å¦‚æœæ²¡æœ‰æ•°æ®å¯ä»¥æ¥æ”¶å°†ä¼šå‘ç”Ÿé˜»å¡ã€‚</p>
<p>ä½ ä¹Ÿè®¸ä¼šå†™å‡ºå¦‚ä¸‹ä»£ç ä½¿ç”¨éå†çš„æ–¹å¼æ¥å®ç°, ä½†æ­¤ç§æ–¹å¼è™½ç„¶å¯ä»¥å®ç°ä»å¤šä¸ªé€šé“æ¥æ”¶å€¼çš„éœ€æ±‚ï¼Œä½†æ˜¯è¿è¡Œæ€§èƒ½ä¼šå·®å¾ˆå¤šã€‚æ‰€ä»¥ä¸ºäº†åº”å¯¹è¿™ç§åœºæ™¯ï¼Œ<code>Goå†…ç½®äº†selectå…³é”®å­—</code>ï¼Œå¯ä»¥åŒæ—¶å“åº”å¤šä¸ªé€šé“çš„æ“ä½œã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>&#123;</span><br><span class="line">  <span class="comment">// å°è¯•ä»ch1æ¥æ”¶å€¼</span></span><br><span class="line">  data, ok := &lt;-ch1</span><br><span class="line">  <span class="comment">// å°è¯•ä»ch2æ¥æ”¶å€¼</span></span><br><span class="line">  data, ok := &lt;-ch2</span><br><span class="line">  â€¦</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>select å…³é”®å­—</code>ä½¿ç”¨ç±»ä¼¼äºswitchè¯­å¥ï¼Œå®ƒæœ‰ä¸€ç³»åˆ—caseåˆ†æ”¯å’Œä¸€ä¸ªé»˜è®¤çš„åˆ†æ”¯ã€‚æ¯ä¸ªcaseä¼šå¯¹åº”ä¸€ä¸ªé€šé“çš„é€šä¿¡ï¼ˆæ¥æ”¶æˆ–å‘é€ï¼‰è¿‡ç¨‹ã€‚selectä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°æŸä¸ªcaseçš„é€šä¿¡æ“ä½œå®Œæˆæ—¶ï¼Œå°±ä¼šæ‰§è¡Œcaseåˆ†æ”¯å¯¹åº”çš„è¯­å¥ã€‚</p>
<p><strong>è¯­æ³•æ ¼å¼ï¼š</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>&#123;</span><br><span class="line">  <span class="keyword">case</span> &lt;-ch1:</span><br><span class="line">      ...</span><br><span class="line">  <span class="keyword">case</span> data := &lt;-ch2:</span><br><span class="line">      ...</span><br><span class="line">  <span class="keyword">case</span> ch3&lt;-data:</span><br><span class="line">      ...</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">      é»˜è®¤æ“ä½œ</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br/></p>
<p><strong>ç¤ºä¾‹æ¼”ç¤º:</strong><br>Goroutine Select å¤šè·¯å¤ç”¨<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// ç¤ºä¾‹1</span></span><br><span class="line">  ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">1</span>)</span><br><span class="line">  fmt.Println(<span class="string">"// ç¤ºä¾‹ 1	"</span>)</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> x := &lt;-ch1:</span><br><span class="line">        fmt.Printf(<span class="string">"index : %d , x = %d\n"</span>, i, x) <span class="comment">// é€šé“ç¼“å†²åŒºä¸º1æ—¶,ç»“æœæ—¶å¯ä»¥é¢„æµ‹çš„.</span></span><br><span class="line">      <span class="keyword">case</span> ch1 &lt;- i: <span class="comment">// å°†ä¼šæŠŠ(å˜é‡i)å¶æ•°å€¼ä¼ ç»™ch1é€šé“</span></span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        fmt.Printf(<span class="string">"index : %d , default\n"</span>, i)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç¤ºä¾‹2</span></span><br><span class="line">  ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">2</span>)</span><br><span class="line">  fmt.Println(<span class="string">"// ç¤ºä¾‹ 2"</span>)</span><br><span class="line">  wg.Add(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    wg.Done()</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++ &#123;</span><br><span class="line">      ch2 &lt;- i + i</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(ch2)</span><br><span class="line">  &#125;()</span><br><span class="line">  wg.Wait()</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++ &#123;</span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> j := &lt;-ch2:</span><br><span class="line">        fmt.Println(<span class="string">"case 1: "</span>, i, j) <span class="comment">// é€šé“ç¼“å†²åŒºä¸ºå¤§äº1æ—¶,ç»“æœæ˜¯ä¸å¯ä»¥é¢„æµ‹çš„.</span></span><br><span class="line">      <span class="keyword">case</span> ch2 &lt;- i:</span><br><span class="line">        fmt.Println(<span class="string">"case 2: ch2 &lt;- i"</span>, i)</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        fmt.Println(<span class="string">"é»˜è®¤æ‰§è¡Œ"</span>, i)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœ:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¤ºä¾‹ 1	</span></span><br><span class="line">index : <span class="number">1</span> , x = <span class="number">0</span></span><br><span class="line">index : <span class="number">3</span> , x = <span class="number">2</span></span><br><span class="line">index : <span class="number">5</span> , x = <span class="number">4</span></span><br><span class="line">index : <span class="number">7</span> , x = <span class="number">6</span></span><br><span class="line">index : <span class="number">9</span> , x = <span class="number">8</span></span><br><span class="line"><span class="comment">// ç¤ºä¾‹ 2</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:  <span class="number">1</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:  <span class="number">2</span> <span class="number">4</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>: ch2 &lt;- i <span class="number">3</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:  <span class="number">4</span> <span class="number">6</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:  <span class="number">5</span> <span class="number">3</span>  <span class="comment">// æ³¨æ„é€šé“æ˜¯å…ˆè¿›å…ˆå‡ºç±»ä¼¼äºé˜Ÿåˆ—ç»“æ„ã€‚</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>æ€»ç»“è¯´æ˜</strong><br>ä½¿ç”¨selectè¯­å¥èƒ½æé«˜ä»£ç çš„å¯è¯»æ€§ã€‚</p>
<ul>
<li>å¯å¤„ç†<code>ä¸€ä¸ªæˆ–å¤šä¸ªchannel</code>çš„å‘é€/æ¥æ”¶æ“ä½œã€‚</li>
<li>å¦‚æœå¤šä¸ªcaseåŒæ—¶æ»¡è¶³ï¼Œselectä¼šéšæœºé€‰æ‹©ä¸€ä¸ªã€‚</li>
<li>å¯¹äºæ²¡æœ‰caseçš„<code>select{}</code>ä¼šä¸€ç›´ç­‰å¾…ï¼Œå¯ç”¨äº<code>é˜»å¡mainå‡½æ•°</code>ã€‚</li>
</ul>
<p><br></p>
<h3 id="7-Goroutine-å¹¶å‘å®‰å…¨-é”"><a href="#7-Goroutine-å¹¶å‘å®‰å…¨-é”" class="headerlink" title="7.Goroutine å¹¶å‘å®‰å…¨(é”)"></a>7.Goroutine å¹¶å‘å®‰å…¨(é”)</h3><p>æè¿°: æœ‰æ—¶å€™åœ¨Goä»£ç ä¸­å¯èƒ½ä¼šå­˜åœ¨å¤šä¸ª<code>goroutine</code>åŒæ—¶æ“ä½œä¸€ä¸ªèµ„æºï¼ˆä¸´ç•ŒåŒºï¼‰ï¼Œè¿™ç§æƒ…å†µä¼šå‘ç”Ÿ<code>ç«æ€é—®é¢˜</code>ï¼ˆæ•°æ®ç«æ€ï¼‰ã€‚</p>
<p>ç±»æ¯”ç°å®ç”Ÿæ´»ä¸­çš„ä¾‹å­æœ‰åå­—è·¯å£è¢«å„ä¸ªæ–¹å‘çš„çš„æ±½è½¦ç«äº‰, è¿˜æœ‰ç«è½¦ä¸Šçš„å«ç”Ÿé—´è¢«è½¦å¢é‡Œçš„äººç«äº‰, é’ˆå¯¹åå­—è·¯å£æˆ‘ä»¬å¯ä»¥é‡‡ç”¨çº¢ç»¿ç¯è¿›è¡Œå„ä¸ªæ–¹å‘ä¾æ¬¡æ”¾è¡Œï¼Œé’ˆå¯¹ç«è½¦ä¸Šçš„å«ç”Ÿé—´æˆ‘ä»¬å¯ä»¥ä¸Šé”è®©å¤–éƒ¨äººå‘˜çŸ¥é“å•æ‰€æœ‰äººä¸”æ— æ³•è¿›å…¥ã€‚</p>
<p>æ‰€ä»¥é’ˆå¯¹äºGoè¯­è¨€ä¸­å¹¶å‘æ—¶èµ„æºç«æ€é—®é¢˜ï¼Œå…¶é‡‡ç”¨é”Lockæœºåˆ¶è¿›è¡Œè§£å†³ï¼Œä¿è¯åœ¨çº¿ç¨‹åœ¨å¹¶å‘æ‰§è¡Œæ—¶çš„å®‰å…¨(ä¸è¢«å…¶å®ƒçº¿ç¨‹å¹²æ‰°)ã€‚</p>
<p><strong>ä¸¾ä¸ªä¾‹å­:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x <span class="keyword">int64</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++ &#123;</span><br><span class="line">    x = x + <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  wg.Add(<span class="number">2</span>)</span><br><span class="line">  <span class="keyword">go</span> add()  <span class="comment">// ä¸¤ä¸ª goroutine æ‰§è¡Œaddä»»åŠ¡</span></span><br><span class="line">  <span class="keyword">go</span> add() </span><br><span class="line">  wg.Wait()</span><br><span class="line">  fmt.Println(x) <span class="comment">// ç”±äºæ•°æ®ç«äº‰çš„å½±å“ï¼Œå¯èƒ½å¯¼è‡´æœ€åçš„ç»“æœä¸æœŸå¾…çš„ä¸ç¬¦ã€‚è¾“å‡º: 5702 ç†æƒ³ä¸º10000</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬å¼€å¯äº†ä¸¤ä¸ª<code>goroutine</code>å»ç´¯åŠ å˜é‡xçš„å€¼ï¼Œè¿™ä¸¤ä¸ªgoroutineåœ¨è®¿é—®å’Œä¿®æ”¹xå˜é‡çš„æ—¶å€™å°±ä¼šå­˜åœ¨æ•°æ®ç«äº‰ï¼Œå¯¼è‡´æœ€åçš„ç»“æœä¸æœŸå¾…çš„ä¸ç¬¦ã€‚</p>
<p><br></p>
<h4 id="1-äº’æ–¥é”"><a href="#1-äº’æ–¥é”" class="headerlink" title="1.äº’æ–¥é”"></a>1.äº’æ–¥é”</h4><p>æè¿°: äº’æ–¥é”æ˜¯ä¸€ç§å¸¸ç”¨çš„æ§åˆ¶å…±äº«èµ„æºè®¿é—®çš„æ–¹æ³•ï¼Œå®ƒèƒ½å¤Ÿä¿è¯åŒæ—¶åªæœ‰ä¸€ä¸ªgoroutineå¯ä»¥è®¿é—®å…±äº«èµ„æºã€‚</p>
<p>Tips: Goè¯­è¨€ä¸­ä½¿ç”¨<code>syncåŒ…</code>çš„<code>Mutexç±»å‹</code>æ¥å®ç°äº’æ–¥é”ã€‚</p>
<p>æ­¤å¤„æˆ‘ä»¬ä½¿ç”¨äº’æ–¥é”æ¥ä¿®å¤ä¸Šé¢ä»£ç çš„é—®é¢˜ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x <span class="keyword">int64</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> lock sync.Mutex</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++ &#123;</span><br><span class="line">    lock.Lock() <span class="comment">// åŠ é”</span></span><br><span class="line">    x = x + <span class="number">1</span></span><br><span class="line">    lock.Unlock() <span class="comment">// è§£é”</span></span><br><span class="line">  &#125;</span><br><span class="line">  wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// è®¾ç½®ä¸¤ä¸ªgoroutineæ± è¿›è¡Œæ‰§è¡Œaddä»»åŠ¡</span></span><br><span class="line">  poolCount := <span class="number">2</span></span><br><span class="line">  wg.Add(poolCount)</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; poolCount; i++ &#123;</span><br><span class="line">    <span class="keyword">go</span> add()</span><br><span class="line">  &#125;</span><br><span class="line">  wg.Wait()</span><br><span class="line">  fmt.Println(x)  <span class="comment">// è¾“å‡ºå€¼ä¸ºé¢„æœŸç›¸åŒ 10000</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ä½¿ç”¨äº’æ–¥é”èƒ½å¤Ÿä¿è¯åŒä¸€æ—¶é—´æœ‰ä¸”åªæœ‰ä¸€ä¸ª<code>goroutine</code>è¿›å…¥ä¸´ç•ŒåŒºï¼Œå…¶ä»–çš„<code>goroutine</code>åˆ™åœ¨ç­‰å¾…é”ï¼›å½“äº’æ–¥é”é‡Šæ”¾åï¼Œç­‰å¾…çš„<code>goroutine</code>æ‰å¯ä»¥è·å–é”è¿›å…¥ä¸´ç•ŒåŒºï¼Œå¤šä¸ª<code>goroutine</code>åŒæ—¶ç­‰å¾…ä¸€ä¸ªé”æ—¶ï¼Œå”¤é†’çš„ç­–ç•¥æ˜¯éšæœºçš„ã€‚</p>
<p><br/></p>
<h4 id="2-è¯»å†™äº’æ–¥é”"><a href="#2-è¯»å†™äº’æ–¥é”" class="headerlink" title="2.è¯»å†™äº’æ–¥é”"></a>2.è¯»å†™äº’æ–¥é”</h4><p>æè¿°: äº’æ–¥é”æ˜¯å®Œå…¨äº’æ–¥çš„ï¼Œä½†æ˜¯æœ‰å¾ˆå¤šå®é™…çš„åœºæ™¯ä¸‹æ˜¯è¯»å¤šå†™å°‘çš„ï¼Œå½“æˆ‘ä»¬å¹¶å‘çš„å»è¯»å–ä¸€ä¸ªèµ„æºä¸æ¶‰åŠèµ„æºä¿®æ”¹çš„æ—¶å€™æ˜¯æ²¡æœ‰å¿…è¦åŠ é”çš„ï¼Œæ‰€ä»¥åœ¨è¿™ç§åœºæ™¯ä¸‹ä½¿ç”¨è¯»å†™é”æ˜¯æ›´å¥½çš„ä¸€ç§é€‰æ‹©ã€‚</p>
<p>Tips: Goè¯­è¨€ä¸­ä½¿ç”¨<code>syncåŒ…</code>çš„<code>RWMutexç±»å‹</code>æ¥å®ç°è¯»å†™äº’æ–¥é”ï¼Œæ‰€ä»¥è¯»å†™é”åˆ†ä¸ºä¸¤ç§<code>è¯»é”</code>å’Œ<code>å†™é”</code>ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŠ ã€è§£ è¯»é”</span></span><br><span class="line">rwlock.RLock()       <span class="comment"># å¯¹è¯»æ“ä½œè¿›è¡Œé”å®š        </span></span><br><span class="line">rwlock.RUnlock()     <span class="comment"># å¯¹è¯»é”å®šè¿›è¡Œè§£é”</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ ã€è§£ å†™é”</span></span><br><span class="line">sync.RWMutex.Lock()   <span class="comment"># å¯¹å†™æ“ä½œè¿›è¡Œé”å®š</span></span><br><span class="line">sync.RWMutex.Unlock() <span class="comment"># å¯¹å†™é”å®šè¿›è¡Œè§£é”</span></span><br></pre></td></tr></table></figure></p>
<p>Tips: å½“ä¸€ä¸ª<code>goroutine</code>è·å–è¯»é”ä¹‹åï¼Œå…¶ä»–çš„<code>goroutine</code>å¦‚æœæ˜¯è·å–è¯»é”ä¼šç»§ç»­è·å¾—é”ï¼Œå¦‚æœæ˜¯è·å–å†™é”å°±ä¼šç­‰å¾…ï¼›å½“ä¸€ä¸ª<code>goroutine</code>è·å–å†™é”ä¹‹åï¼Œå…¶ä»–çš„<code>goroutine</code>æ— è®ºæ˜¯è·å–è¯»é”è¿˜æ˜¯å†™é”éƒ½ä¼šç­‰å¾…ã€‚</p>
<p><strong>è¯»å†™é”ä½¿ç”¨ç¤ºä¾‹:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">  x      <span class="keyword">int64</span></span><br><span class="line">  wg     sync.WaitGroup</span><br><span class="line">  rwlock sync.RWMutex</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">write</span><span class="params">()</span></span> &#123;</span><br><span class="line">  rwlock.Lock() <span class="comment">// åŠ å†™é”</span></span><br><span class="line">  x = x + <span class="number">1</span></span><br><span class="line">  time.Sleep(<span class="number">10</span> * time.Millisecond) <span class="comment">// å‡è®¾å†™æ“ä½œè€—æ—¶10æ¯«ç§’</span></span><br><span class="line">  rwlock.Unlock()                   <span class="comment">// è§£å†™é”</span></span><br><span class="line">  wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">read</span><span class="params">()</span></span> &#123;</span><br><span class="line">  rwlock.RLock()               <span class="comment">// åŠ è¯»é”</span></span><br><span class="line">  time.Sleep(time.Millisecond) <span class="comment">// å‡è®¾è¯»æ“ä½œè€—æ—¶1æ¯«ç§’</span></span><br><span class="line">  rwlock.RUnlock()             <span class="comment">// è§£è¯»é”</span></span><br><span class="line">  wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  start := time.Now()</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">    wg.Add(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">go</span> write()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line">    wg.Add(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">go</span> read()</span><br><span class="line">  &#125;</span><br><span class="line">  wg.Wait()</span><br><span class="line">  end := time.Now()</span><br><span class="line">  fmt.Printf(<span class="string">"è€—è´¹æ—¶é—´ ï¼š%v, x = %d \n"</span>, end.Sub(start), x) </span><br><span class="line">  <span class="comment">// æ‰§è¡Œç»“æœ =&gt; è€—è´¹æ—¶é—´ ï¼š104.906297ms, x = 10 </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Tips: éœ€è¦æ³¨æ„çš„æ˜¯è¯»å†™é”éå¸¸é€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œå¦‚æœè¯»å’Œå†™çš„æ“ä½œå·®åˆ«ä¸å¤§ï¼Œè¯»å†™é”çš„ä¼˜åŠ¿å°±å‘æŒ¥ä¸å‡ºæ¥ã€‚<br>Tips: åœ¨æŸäº›åœºæ™¯ä¸­ä¹Ÿå¯èƒ½ä½¿ç”¨syncåŒ…ä¸­Map,å®ƒæ˜¯ä¸€ä¸ªå¼€ç®±å³ç”¨(ä¸éœ€è¦Makeåˆå§‹åŒ–)çš„å¹¶å‘å®‰å…¨çš„Mapã€‚å¦‚:<code>Sync.Map.Store(key,value)ã€Ssync.Map.Load(Key)ã€sync.Map.LoadOrstoreã€sync.Map.Delete()ã€sync.Map.Range()</code></p>
<p><br></p>
<h4 id="3-åŸå­æ“ä½œ"><a href="#3-åŸå­æ“ä½œ" class="headerlink" title="3.åŸå­æ“ä½œ"></a>3.åŸå­æ“ä½œ</h4><p>æè¿°: åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­æˆ‘ä»¬é€šè¿‡é”æ“ä½œæ¥å®ç°çº¿ç¨‹<code>(åç¨‹)</code>åŒæ­¥,è€Œå®é™…ä¸Šé”æœºåˆ¶çš„åº•å±‚æ˜¯åŸºäºåŸå­æ“ä½œçš„ï¼Œå…¶ä¸€èˆ¬ç›´æ¥é€šè¿‡CPUæŒ‡ä»¤å®ç°ã€‚</p>
<p>åœ¨Goè¯­è¨€ä¸­å†…ç½®äº†å¯¹åŸºæœ¬æ•°æ®ç±»å‹çš„ä¸€äº›å¹¶å‘å®‰å…¨æ“ä½œï¼Œä¾‹å¦‚<code>atomic</code>åŒ…ä¸­çš„æ–¹æ³•æ¥å®ç°åç¨‹åŒæ­¥ï¼Œå®ƒæä¾›äº†åº•å±‚çš„åŸå­çº§å†…å­˜æ“ä½œã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¿®æ”¹å†…å­˜åœ°å€ä¸­å€¼ä¸ºdeltaå¹¶è¿”å›æ–°å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AddInt64</span><span class="params">(addr *<span class="keyword">int64</span>, delta <span class="keyword">int64</span>)</span> <span class="params">(<span class="built_in">new</span> <span class="keyword">int64</span>)</span></span></span><br><span class="line"><span class="function">// è¯»å–å†…å­˜åœ°å€ä¸­çš„å€¼å¹¶è¿”å›</span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">LoadInt64</span><span class="params">(addr *<span class="keyword">int64</span>)</span> <span class="params">(val <span class="keyword">int64</span>)</span></span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>å®è·µç¤ºä¾‹:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¥å£å£°æ˜</span></span><br><span class="line"><span class="keyword">type</span> Counter <span class="keyword">interface</span> &#123;</span><br><span class="line">  Inc()</span><br><span class="line">  Load() <span class="keyword">int64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ™®é€šç‰ˆ</span></span><br><span class="line"><span class="keyword">type</span> CommonCounter <span class="keyword">struct</span> &#123;</span><br><span class="line">  counter <span class="keyword">int64</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *CommonCounter)</span> <span class="title">Inc</span><span class="params">()</span></span> &#123;</span><br><span class="line">  c.counter++ <span class="comment">// å†™</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *CommonCounter)</span> <span class="title">Load</span><span class="params">()</span> <span class="title">int64</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> c.counter <span class="comment">// è¯»</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// äº’æ–¥é”ç‰ˆ</span></span><br><span class="line"><span class="keyword">type</span> MutexCounter <span class="keyword">struct</span> &#123;</span><br><span class="line">  counter <span class="keyword">int64</span></span><br><span class="line">  lock    sync.Mutex</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *MutexCounter)</span> <span class="title">Inc</span><span class="params">()</span></span> &#123;</span><br><span class="line">  m.lock.Lock()</span><br><span class="line">  <span class="keyword">defer</span> m.lock.Unlock()</span><br><span class="line">  m.counter++  <span class="comment">// å†™</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *MutexCounter)</span> <span class="title">Load</span><span class="params">()</span> <span class="title">int64</span></span> &#123;</span><br><span class="line">  m.lock.Lock()</span><br><span class="line">  <span class="keyword">defer</span> m.lock.Unlock() </span><br><span class="line">  <span class="keyword">return</span> m.counter  <span class="comment">// è¯»</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŸå­æ“ä½œç‰ˆ</span></span><br><span class="line"><span class="keyword">type</span> AtomicCounter <span class="keyword">struct</span> &#123;</span><br><span class="line">  counter <span class="keyword">int64</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *AtomicCounter)</span> <span class="title">Inc</span><span class="params">()</span></span> &#123;</span><br><span class="line">  atomic.AddInt64(&amp;a.counter, <span class="number">1</span>) <span class="comment">// å†™</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *AtomicCounter)</span> <span class="title">Load</span><span class="params">()</span> <span class="title">int64</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> atomic.LoadInt64(&amp;a.counter) <span class="comment">// è¯»</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(c Counter)</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">  start := time.Now()</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line">    wg.Add(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      c.Inc()</span><br><span class="line">      wg.Done()</span><br><span class="line">    &#125;()</span><br><span class="line">  &#125;</span><br><span class="line">  wg.Wait()</span><br><span class="line">  end := time.Now()</span><br><span class="line">  fmt.Println(c.Load(), end.Sub(start))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  c1 := CommonCounter&#123;&#125; <span class="comment">// éå¹¶å‘å®‰å…¨</span></span><br><span class="line">  test(&amp;c1)</span><br><span class="line">  c2 := MutexCounter&#123;&#125;  <span class="comment">// ä½¿ç”¨äº’æ–¥é”å®ç°å¹¶å‘å®‰å…¨</span></span><br><span class="line">  test(&amp;c2)</span><br><span class="line">  c3 := AtomicCounter&#123;&#125; <span class="comment">// å¹¶å‘å®‰å…¨ä¸”æ¯”äº’æ–¥é”æ•ˆç‡æ›´é«˜</span></span><br><span class="line">  test(&amp;c3)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœ:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">943</span> <span class="number">1.240583</span>ms</span><br><span class="line"><span class="number">1000</span> <span class="number">1.514732</span>ms</span><br><span class="line"><span class="number">1000</span> <span class="number">421.618</span>Âµs  <span class="comment">// å¯ä»¥çœ‹å‡ºå…¶æ€§èƒ½æ•ˆç‡æ˜¯æœ€é«˜çš„ã€‚</span></span><br></pre></td></tr></table></figure><br>Tips: atomicåŒ…å¯¹äºåŒæ­¥ç®—æ³•çš„å®ç°å¾ˆæœ‰ç”¨, ä½†æ˜¯è¿™äº›å‡½æ•°å¿…é¡»è°¨æ…åœ°ä¿è¯æ­£ç¡®ä½¿ç”¨ï¼Œé™¤äº†æŸäº›ç‰¹æ®Šçš„åº•å±‚åº”ç”¨ï¼Œä½¿ç”¨é€šé“æˆ–è€…syncåŒ…çš„å‡½æ•°/ç±»å‹å®ç°åŒæ­¥æ›´å¥½ã€‚</p>

        </div>
        <!-- Google å¹¿å‘Š -->
        
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-9134434519967436" data-ad-slot="7905848205"></ins>
  

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>
  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·ä¸Visit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº" >
    <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ã€è½¬ä¸ªå‘ã€èµä¸ªåŠ©ã€‘</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°†æŒç»­æ•´ç†å‘å¸ƒæ›´å¤šä¼˜è´¨åŸåˆ›æ–‡ç« ï¼ã€‚</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-03-11T03:22:01.612Z" itemprop="dateUpdated">2022-03-11 11:22:01</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/ç¼–ç¨‹ä¸–ç•Œ/Go/7.Goç¼–ç¨‹å¿«é€Ÿå…¥é—¨å­¦ä¹ .md" target="_blank" rel="noopener noreferrer">_posts/ç¼–ç¨‹ä¸–ç•Œ/Go/7.Goç¼–ç¨‹å¿«é€Ÿå…¥é—¨å­¦ä¹ .md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2020/4-24-596.html" target="_blank" rel="external">https://blog.weiyigeek.top/2020/4-24-596.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">â˜•ï¸ è¯·ä½œè€…å–æ¯å’–å•¡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Go/" rel="tag">Go</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/4-24-596.html&title=ã€Š7.Goç¼–ç¨‹å¿«é€Ÿå…¥é—¨å­¦ä¹ ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/4-24-596.html&title=ã€Š7.Goç¼–ç¨‹å¿«é€Ÿå…¥é—¨å­¦ä¹ ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/4-24-596.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š7.Goç¼–ç¨‹å¿«é€Ÿå…¥é—¨å­¦ä¹ ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/4-24-596.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/4-24-596.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2020/4-25-603.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">1.Goè¯­è¨€ç¼–ç¨‹å­¦ä¹ è¯¾åå®è·µ</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2020/4-24-598.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">9.Goç¼–ç¨‹å¿«é€Ÿå…¥é—¨å­¦ä¹ </h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0X00-Goè¯­è¨€åŸºç¡€ä¹‹åå°„"><span class="post-toc-number">1.</span> <span class="post-toc-text">0X00 Goè¯­è¨€åŸºç¡€ä¹‹åå°„</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-åŸºç¡€ä»‹ç»"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">1.åŸºç¡€ä»‹ç»</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-ç±»å‹å¯¹è±¡-reflect-Type"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">2.ç±»å‹å¯¹è±¡-reflect.Type</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-ç±»å‹å¯¹è±¡å€¼-reflect-Value"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">3.ç±»å‹å¯¹è±¡å€¼-reflect.Value</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-åå°„å€¼åˆ¤æ–­"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">4.åå°„å€¼åˆ¤æ–­</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-ç»“æ„ä½“åå°„å®è·µ"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">5.ç»“æ„ä½“åå°„å®è·µ</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-Goè¯­è¨€åŸºç¡€ä¹‹å¹¶å‘å’Œé€šé“"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 Goè¯­è¨€åŸºç¡€ä¹‹å¹¶å‘å’Œé€šé“</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-åŸºç¡€æ¦‚å¿µ"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">1.åŸºç¡€æ¦‚å¿µ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-Goroutine-å…¥é—¨"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">2.Goroutine å…¥é—¨</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ç¤ºä¾‹1-å¯åŠ¨å•ä¸ªGoroutine"><span class="post-toc-number">2.2.1.</span> <span class="post-toc-text">ç¤ºä¾‹1.å¯åŠ¨å•ä¸ªGoroutine</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ç¤ºä¾‹2-å¯åŠ¨å¤šä¸ªGoroutine"><span class="post-toc-number">2.2.2.</span> <span class="post-toc-text">ç¤ºä¾‹2.å¯åŠ¨å¤šä¸ªGoroutine</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-Goroutine-ç‰¹æ€§"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">3.Goroutine ç‰¹æ€§</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-Goroutine-å¯å¢é•¿çš„æ ˆ"><span class="post-toc-number">2.3.1.</span> <span class="post-toc-text">(1) Goroutine å¯å¢é•¿çš„æ ˆ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-Goroutine-è°ƒåº¦æ¨¡å‹"><span class="post-toc-number">2.3.2.</span> <span class="post-toc-text">(2) Goroutine è°ƒåº¦æ¨¡å‹</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-Goroutine-çº¿ç¨‹æ•°"><span class="post-toc-number">2.3.3.</span> <span class="post-toc-text">(3) Goroutine çº¿ç¨‹æ•°</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-Channel-é€šé“"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">4.Channel é€šé“</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-channel-ç±»å‹"><span class="post-toc-number">2.4.1.</span> <span class="post-toc-text">1.channel ç±»å‹</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-channel-åˆ›å»º"><span class="post-toc-number">2.4.2.</span> <span class="post-toc-text">2.channel åˆ›å»º</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-channel-æ“ä½œ"><span class="post-toc-number">2.4.3.</span> <span class="post-toc-text">3.channel æ“ä½œ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#4-channel-ç¼“å†²"><span class="post-toc-number">2.4.4.</span> <span class="post-toc-text">4.channel ç¼“å†²</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#5-channel-éå†"><span class="post-toc-number">2.4.5.</span> <span class="post-toc-text">5.channel éå†</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#6-å•å‘é€šé“"><span class="post-toc-number">2.4.6.</span> <span class="post-toc-text">6.å•å‘é€šé“</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#7-é€šé“æ€»ç»“"><span class="post-toc-number">2.4.7.</span> <span class="post-toc-text">7.é€šé“æ€»ç»“</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-Goroutine-æ± "><span class="post-toc-number">2.5.</span> <span class="post-toc-text">5.Goroutine æ± </span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#6-Goroutine-å¤šè·¯å¤ç”¨"><span class="post-toc-number">2.6.</span> <span class="post-toc-text">6.Goroutine å¤šè·¯å¤ç”¨</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-Goroutine-å¹¶å‘å®‰å…¨-é”"><span class="post-toc-number">2.7.</span> <span class="post-toc-text">7.Goroutine å¹¶å‘å®‰å…¨(é”)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-äº’æ–¥é”"><span class="post-toc-number">2.7.1.</span> <span class="post-toc-text">1.äº’æ–¥é”</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-è¯»å†™äº’æ–¥é”"><span class="post-toc-number">2.7.2.</span> <span class="post-toc-text">2.è¯»å†™äº’æ–¥é”</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-åŸå­æ“ä½œ"><span class="post-toc-number">2.7.3.</span> <span class="post-toc-text">3.åŸå­æ“ä½œ</span></a></li></ol></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    


    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå°±è¯·ä½œè€…å–æ¯ Coffee â˜•ï¸â˜•ï¸!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      

    <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
    
      <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½çœ‹å‹,æ¬¢è¿å…³æ³¨åšä¸»å¾®ä¿¡å…¬ä¼—å·å“Ÿ! â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘å³å¯å…³é—­ç»§ç»­æµè§ˆæ–‡ç« .<br>  <b style="color:red;"> æ¸©é¦¨æç¤º: æœªè§£é”çš„ç”¨æˆ·ä¸èƒ½ç²˜è´´å¤åˆ¶æ–‡ç« å†…å®¹å“Ÿ!</b> <br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
        
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/search-wechat.jpg" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">åšä¸»Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">åšä¸»Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">çŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.modb.pro/u/506690" target="_blank">å¢¨å¤©è½®</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.ixigua.com/home/3984243135350727" target="_blank">è¥¿ç“œè§†é¢‘</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/><a id="SiteRunTime"></a>
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener">
            <img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto">
          </a>
        </div>
      </p>
    </div>
</footer>



    <div class="mask" id="mask"></div>

<div id="go" class="waves-effect waves-light">
  <a href="javascript:;" id="goqrcode"> <span class="icon icon-lg icon-qrcode"></span> </a>
  <a href="javascript:;" id="gotop"> <span class="icon icon-lg icon-chevron-up"></span></a>
</div>





<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/4-24-596.html&title=ã€Š7.Goç¼–ç¨‹å¿«é€Ÿå…¥é—¨å­¦ä¹ ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/4-24-596.html&title=ã€Š7.Goç¼–ç¨‹å¿«é€Ÿå…¥é—¨å­¦ä¹ ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/4-24-596.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š7.Goç¼–ç¨‹å¿«é€Ÿå…¥é—¨å­¦ä¹ ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/4-24-596.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/4-24-596.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACOklEQVR42u3a0WrDMAxG4b7/S2ewq43i5PxSMxb5+Kp0berPAyFZer3wOr7X++uf77x/5v391TNXz/nwkiFDxmMZx+la/eT5dgmsdhxLqgwZMjZgkCC7+uE0QN/yXRkyZMg4fV0Lu+cJogwZMmTcEXBJWpmmoTJkyJCRPpoz+uXujbW4DBkyHsjoNAbufv1H/Q0ZMmT8Y8YRrk+1HtPQfLErGTJkjGaQCy/SYqwlefwJKBzLkCFjS0Y61JWGYN4WRQctQ4aMjRmdsMuv7Tq/LkOGjNmMNC2rvZ9eovGm5q9aXIYMGUMZ8UADbh50Es3zz8uQIWM3xtFY6dbPAzoppJckGTJkjGaQGjC9IOPDW7WRL9TClCFDxiAGD4VpYndHYbx8jgwZMjZg8JK10wzgjc/4gGTIkDGawTfUKWtrpLi9KkOGjNGMtHGYthPIc2rHsfyfyJAhYxAjDbW1FmZ/sOziWzJkyBjN4Ola2m4km+YFLQr3MmTIGM3gQ1q1wjJN/vhByJAhYwdGLQlLU8A0QYzDqwwZMjZg8IKzM2zBRzrIHpbXbTJkyBjH4FddaaqX/pWvi+alDBkyxjE64xQkceTla+tqT4YMGaMZtTBXax7wAFoL4jJkyJjN4EE2PRUSLmshdVnEypAhYzSjVtx2BinSqH9xcDJkyJARXv3zhI+3EIJbQxkyZGzPqA1GcB4fCyumhjJkyHgso9MMSDfE2wNBWilDhozRjFoB2Slledr34XENGTJkPI/xBfn/Qc9nXgTWAAAAAElFTkSuQmCC" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<script> (adsbygoogle = window.adsbygoogle || []).push({});</script>    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
<script type="text/javascript">
// ç«™ç‚¹è¿è¡Œæ—¶é—´
var BootDate = new Date("2018/01/01 00:00:00");
function ShowRunTime(id) {
  var NowDate = new Date();
  var RunDateM = parseInt(NowDate - BootDate);
  var RunDays = Math.floor(RunDateM/(24*3600*1000));
  var RunHours = Math.floor(RunDateM%(24*3600*1000)/(3600*1000));
  var RunMinutes = Math.floor(RunDateM%(24*3600*1000)%(3600*1000)/(60*1000));
  var RunSeconds = Math.round(RunDateM%(24*3600*1000)%(3600*1000)%(60*1000)/1000);
  var RunTime = RunDays + "å¤©" + RunHours + "æ—¶" + RunMinutes + "åˆ†" + RunSeconds + "ç§’";
  document.getElementById(id).innerHTML = "ç½‘ç«™å·²åœ¨é£é›¨ä¸­å‹‰å‹‰å¼ºå¼ºè¿è¡Œäº†ã€" + RunTime + "ã€‘";
}
setInterval("ShowRunTime('SiteRunTime')", 1000);
</script>
</body>
</html>