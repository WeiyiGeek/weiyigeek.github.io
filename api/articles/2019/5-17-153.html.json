{"title":"yum 快速入门与基础","slug":"系统运维/Linux/常用命令/安装软件类命令/yum快速入门与基础","date":"2019-05-17T11:35:30.000Z","updated":"2022-03-29T05:39:06.307Z","url":"2019/5-17-153.html","path":"api/articles/2019/5-17-153.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190517143147.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190517143217.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190517144804.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190517150403.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190517150816.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190517163925.png"],"content":"<p>[TOC]<br><a id=\"more\"></a></p>\n<h2 id=\"0x00-Linux中软件安装的几种方式\"><a href=\"#0x00-Linux中软件安装的几种方式\" class=\"headerlink\" title=\"0x00 Linux中软件安装的几种方式\"></a>0x00 Linux中软件安装的几种方式</h2><p><em>Q:Linux中的如何进行安装、卸载、升级软件和管理?</em><br>答：回答这个问题前需要了解Linux的多个发行版本,不同版本之间安装软件方式和命令不一样,且同一个版本之间安装软件也有不同的方法;</p>\n<p><em>但是大体来说Linux有两大派系:</em></p>\n<ul>\n<li>红帽派系，包含Redhat、Centos、Fedora等<ul>\n<li>源码包安装：</li>\n<li>rpm包安装：</li>\n<li>yum源安装：</li>\n</ul>\n</li>\n<li>Debian派系，包含Kali、Ubuntu等。<ul>\n<li>Deb包安装：</li>\n<li>apt-get源安装：</li>\n</ul>\n</li>\n</ul>\n<p>基本采用rpm/deb包管理、yum/apt-get在线管理、源码包编译安装管理和二进制安装包(解压就可用-类似于绿色安装)等等;</p>\n<p><em>线下的安装方式</em>:<br>也就是说你要把软件下载到本地去安装。一般我们下载的文件后缀名都是zip、tar.gz等压缩包，解压后会看到rpm、bin、deb、run之类扩展名文件,你可以根据自己的系统下载不同扩展名的软件。<br>1、rpm安装包：这时一款老牌的安装格式,是红帽创建的安装格式，现在已成为一种标准，常用在opensuse/turbo/redhat版本），安装方法rpm -ivh 软件名.rpm （如果只是安装一个i参数就够了，如果还要看安装进度和软件信息就加个vh)<br>2、deb安装包：DEB是Debian软件包格式的文件扩展名，常用在centos/ubuntu,在苹果系统里也常见此安装方式。安装方法：dpkg -i 软件名.deb<br>3、run安装包：以QT（一种编程工具）的安装文件为例，</p>\n<ul>\n<li>1）授权： chmod x qt-unified-linux-x64-2.0.2-2-online.run</li>\n<li>2）执行：./qt-unified-linux-x64-2.0.2-2-online.run即可安装。<br>4、bin安装包：bin包是一个自解压格式的安装包，要想执行它，需要先赋予它可执行的权限。<br>（以安装jdk为例）# chmod x jdk-6u21-linux-i586.bin# ./jdk-6u21-linux-i586.bin</li>\n</ul>\n<p><em>对比源码包编译安装的优缺点</em>：<br>优点：</p>\n<ul>\n<li>开源对于业务需要更改源代码</li>\n<li>编译安装时可选择所需要的功能,进行最优化安装以便更加稳定和高效</li>\n<li>卸载方便</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>安装过程较多,安装较大的软件组合时候容易出错</li>\n<li>编译过程时间较长,安装比二进制安装时间长</li>\n</ul>\n<h2 id=\"0x01-源码包安装过程及make命令\"><a href=\"#0x01-源码包安装过程及make命令\" class=\"headerlink\" title=\"0x01 源码包安装过程及make命令\"></a>0x01 源码包安装过程及make命令</h2><p>安装注意事项:</p>\n<ul>\n<li>源代码标准保存位置 /usr/local/src/</li>\n<li>软件标准安装位置 /usr/local/</li>\n</ul>\n<p>源码包编译安装需要下载安装编译工具:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$yum</span> -y install gcc gcc-c++ make</span><br><span class=\"line\"><span class=\"comment\">#  下载源码包，解压缩下载的源码包，进入解压缩目录</span></span><br><span class=\"line\">./configure --prefix=&lt;dir&gt;    <span class=\"comment\"># 指定安装路径</span></span><br><span class=\"line\">－定义需要的功能选项</span><br><span class=\"line\">－监测系统环境是否符合安装要求</span><br><span class=\"line\">－把定义好的功能选项和监测系统环境的信息都写入Makefile文件，用于后续的编辑</span><br><span class=\"line\"></span><br><span class=\"line\">make <span class=\"comment\">#编译</span></span><br><span class=\"line\">make install <span class=\"comment\">#安装编译后二进制可执行文件</span></span><br><span class=\"line\">make clean  <span class=\"comment\"># 译安装这步出错 则执行make clean 删除/usr/local源文件</span></span><br><span class=\"line\">make uninstall  <span class=\"comment\"># 删除源码包编译安装</span></span><br></pre></td></tr></table></figure>\n<p>编译原理：<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190517143147.png\" alt=\"WeiyiGeek.编译原理\" title=\"\" class=\"\">\n                <p>WeiyiGeek.编译原理</p>\n            </figure></p>\n<p>编译过程：<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190517143217.png\" alt=\"WeiyiGeek.编译过程\" title=\"\" class=\"\">\n                <p>WeiyiGeek.编译过程</p>\n            </figure></p>\n<p><br><br>以Redhat下安装apache为例:</p>\n<ul>\n<li>先网站下载源代码包 <a href=\"http://mirror.bit.edu.cn/apache/httpd/httpd-2.2.15.tar.gz\" target=\"_blank\" rel=\"noopener\">http://mirror.bit.edu.cn/apache/httpd/httpd-2.2.15.tar.gz</a></li>\n<li>tar -xvf  httpd-2.2.15.tar.gz  -C /usr/src将其解压到 /usr/src/ 目录下</li>\n<li>到其解压目录 /usr/src/httpd-2.2.15/ 下， ./configure  运行configure配置文件,设置安装目录，安装模块等，不设置的话，软件默认安装在 /usr/local/apache2/目录下。<br>如果  ./configure  –prefix=/usr/local/https/  则是将其安装在/usr/local/https/目录下。此时还并未安装只是配置安装路径</li>\n<li>make 编译，生成可执行的二进制文件Makefile</li>\n<li>make install 安装。此时，软件安装在 /usr/local/https/ 目录下</li>\n<li>最后在目录中启动httpd:/usr/local/apache2/bin/apachectl start</li>\n</ul>\n<p>安装完成之后对安装包的清理:</p>\n<ul>\n<li>进入其解压目录  /usr/src/httpd-2.2.15/下make  uninstall 者make clean 用于清除上一次的编译</li>\n<li>然后返回到上一级目录，把 httpd-2.2.15 删除 </li>\n<li>如果要卸载软件的话，把 /usr/local/apache2 这个软件删除就可以</li>\n</ul>\n<p><em>安装HTTPD服务使用rmp与源码包区别</em>：</p>\n<ul>\n<li>源码包卸载软件简单,rpm删除卸载软件较为麻烦(文件分散到各个目录)</li>\n<li>源码包安装的服务默认是不能被服务管理命令管理，只能由绝对路径进行服务的管理除非手动添加</li>\n<li>通过源码安装的目录在安装路径中存放网页的在htdocs/www中，而通过rpm安装的则在系统默认的/var/html/www中</li>\n</ul>\n<h2 id=\"0x02-yum介绍与命令\"><a href=\"#0x02-yum介绍与命令\" class=\"headerlink\" title=\"0x02 yum介绍与命令\"></a>0x02 yum介绍与命令</h2><p>yum（全称为Yellowdog Updater Modified）是一个在CentOS、RedHat和Fedora操作系统中使用的Shell前端软件包管理器。<br>yum主要管理基于rpm的软件包，它可以自动升级、安装、删除rpm软件包，同时它还能够自动查找并解决rpm包之间的依赖关系，并且无需管理员逐个、手工的去安装每一个rpm包，使管理员在维护Linux主机时更加轻松自如。</p>\n<p>yum可以从一个或多个repo文件中配置的repo仓库，通过http或ftp协议从repo仓库获得必要的信息，然后下载相关的软件包。</p>\n<ul>\n<li>yum 安装不仅可以在连通网络中适用, 可以使用光盘进行yum安装</li>\n<li><p>yum 在redhat 中,将其视为售后服务, 定位收费才可使用 （缺点）,所以我们常常需要安装第三方源epel装上了它之后，就相当于添加了一个第三方源。</p>\n<ul>\n<li>优势：</li>\n<li>1.不替换本身的yum源，安装后会产生新的repo</li>\n<li>2.epel有很多源地址，如果一个下不到，会自动去另外一个下</li>\n<li>3.如果更新的包不全，就不会进行安装，依赖关系可以保全</li>\n</ul>\n</li>\n<li><p>repo仓库可以通过createrepo或yum-arch命令进行创建，也能够用别人已经创建好的repo仓库作为yum源</p>\n</li>\n</ul>\n<p>YUM 安装</p>\n<ul>\n<li>优点：简单，便捷，解决源码包安装依赖问题，全自动化安装</li>\n<li>缺点：没有办法定制，需要网络，网络环境差的情况话，下载速度慢</li>\n</ul>\n<hr>\n\n<h3 id=\"1-yum-命令\"><a href=\"#1-yum-命令\" class=\"headerlink\" title=\"1.yum 命令\"></a>1.yum 命令</h3><h3 id=\"yumdownloader-子命令\"><a href=\"#yumdownloader-子命令\" class=\"headerlink\" title=\"yumdownloader 子命令\"></a>yumdownloader 子命令</h3><p>常用命令：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">命令说明:</span><br><span class=\"line\">list <span class=\"comment\">#表示列出所有的软件包</span></span><br><span class=\"line\">search [关键字]  <span class=\"comment\">#搜索服务器上所有和关键字相关的包</span></span><br><span class=\"line\">clean all  <span class=\"comment\">#表示清除yum源缓存，</span></span><br><span class=\"line\">makecache  <span class=\"comment\">#表示生成yum源缓存metadata</span></span><br><span class=\"line\">yum -y install [包名] <span class=\"comment\">#安装指定的软件可使用通配符</span></span><br><span class=\"line\">yum -y remove [包名]  <span class=\"comment\">#卸载</span></span><br><span class=\"line\">yum -y update [包名]  <span class=\"comment\">#特别注意：没有指定包名则升级所有</span></span><br><span class=\"line\">yum -y upgrade  <span class=\"comment\">#升级依赖</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 参数说明</span></span><br><span class=\"line\">yum --enablerepo=localyum --disablerepo=base,extras,updates,epel list  <span class=\"comment\">#指定使用localyum库，并且是临时使用内网yum源，服务器重启后失效。</span></span><br><span class=\"line\">yum --downloadonly install tftp    <span class=\"comment\">#仅仅下载不安装</span></span><br><span class=\"line\">yumdownloader pcre-devel openssl-devel  <span class=\"comment\">#仅仅下载不安装</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#yum软件组管理命令 </span></span><br><span class=\"line\">yum grouplist  <span class=\"comment\">#列出所有可用的软件组列表  显示中文则执行(LANG=en-vs)</span></span><br><span class=\"line\">yum group install 软件组名  <span class=\"comment\">#安装指定软件组 组名可以由grouplist查看</span></span><br><span class=\"line\">yum group remove 软件组名  <span class=\"comment\">#卸载指定软件组</span></span><br><span class=\"line\"></span><br><span class=\"line\">yum whatprovides 动态链接库.so  <span class=\"comment\">#查找动态链接库在哪一个rpm包里</span></span><br></pre></td></tr></table></figure></p>\n<p>补充示例:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#示例0.检查更新</span></span><br><span class=\"line\">yum check-update <span class=\"comment\">#该命令将更新存储库，并为您提供可以更新的所有软件包的列表</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例1.查询so动态连接文件提供它的来源包</span></span><br><span class=\"line\">yum whatprovides libgcc_s.so.1</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">yum load-transaction /tmp/yum_save_tx.2016-09-09.22-26.wxYVRg.yumtx  <span class=\"comment\"># 当yum中断更新后，重新执行该事务</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例2.在指定repo库中安装指定的软件</span></span><br><span class=\"line\">yum --enablerepo=remi-php73 install -y php php-mysqli</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例3.重新执行未完成的事务</span></span><br><span class=\"line\">yum load-transaction /tmp/yum_save_tx.2020-04-30.15-11.S54r3n.yumtx </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例4.禁用repo的时候不禁用kubernetes的yum仓库</span></span><br><span class=\"line\">yum install docker-ce-19.03.3-3.el7 kubelet-1.17.4-0 kubeadm-1.17.4-0 kubectl-1.17.4-0 --disableexcludes=kubernetes</span><br></pre></td></tr></table></figure></p>\n<hr>\n\n<h3 id=\"2-createrepo-命令\"><a href=\"#2-createrepo-命令\" class=\"headerlink\" title=\"2.createrepo 命令\"></a>2.createrepo 命令</h3><p>createrepo用以创建yum源（软件仓库），即为存放于本地特定位置的众多rpm包建立索引，描述各包所需依赖信息，并形成元数据。<br>参考网站：<a href=\"http://linux.51yip.com/search/createrepo\" target=\"_blank\" rel=\"noopener\">http://linux.51yip.com/search/createrepo</a><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">基本语法：createrepo [option] &lt;directory&gt;</span><br><span class=\"line\">-u --baseurl &lt;url&gt;  <span class=\"comment\">#指定Base URL的地址</span></span><br><span class=\"line\">-o --outputdir &lt;url&gt; <span class=\"comment\">#指定元数据的输出位置</span></span><br><span class=\"line\">-x --excludes &lt;packages&gt; <span class=\"comment\">#指定在形成元数据时需要排除的包</span></span><br><span class=\"line\">-i --pkglist &lt;filename&gt;  <span class=\"comment\">#指定一个文件，该文件内的包信息将被包含在即将生成的元数据中，格式为每个包信息独占一行，不含通配符、正则，以及范围表达式。</span></span><br><span class=\"line\">-n --includepkg <span class=\"comment\">#通过命令行指定要纳入本地库中的包信息，需要提供URL或本地路径。</span></span><br><span class=\"line\">-q --quiet  <span class=\"comment\">#安静模式执行操作，不输出任何信息。</span></span><br><span class=\"line\"></span><br><span class=\"line\">-g --groupfile &lt;groupfile&gt; <span class=\"comment\">#指定本地软件仓库的组划分，范例如下：</span></span><br><span class=\"line\">     createrepo -g comps.xml /path/to/rpms  <span class=\"comment\">#注意：组文件需要和rpm包放置于同一路径下。</span></span><br><span class=\"line\"></span><br><span class=\"line\">-v --verbose   <span class=\"comment\">#输出详细信息。</span></span><br><span class=\"line\">-c --cachedir &lt;path&gt;  <span class=\"comment\">#指定一个目录，用作存放软件仓库中软件包的校验和信息。当createrepo在未发生明显改变的相同仓库文件上持续多次运行时，指定cachedir会明显提高其性能。</span></span><br><span class=\"line\">--update  <span class=\"comment\">#如果元数据已经存在，且软件仓库中只有部分软件发生了改变或增减，则可用update参数直接对原有元数据进行升级，效率比重新分析rpm包依赖并生成新的元数据要高很多。</span></span><br><span class=\"line\">-p --pretty <span class=\"comment\">#以整洁的格式输出xml文件。</span></span><br><span class=\"line\">-d --database  <span class=\"comment\">#该选项指定使用SQLite来存储生成的元数据，默认项。</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">$ mkdir -p /yum/centos/6/      <span class=\"comment\">#创建本地源目录</span></span><br><span class=\"line\">$ createrepo -pdo /yum/centos/6/ix86_64 /yum/centos/6/ix86_64   <span class=\"comment\">#初始化源目录，产生repodata</span></span><br><span class=\"line\">$ createrepo --update /yum_source/　　　　　　//更新域名仓库</span><br></pre></td></tr></table></figure></p>\n<hr>\n\n<h3 id=\"3-yum仓库配置\"><a href=\"#3-yum仓库配置\" class=\"headerlink\" title=\"3.yum仓库配置\"></a>3.yum仓库配置</h3><p>我们知道repo文件是CentOS、RedHat和Fedora操作系统中yum源（软件仓库）的配置文件，通常一个repo文件定义了一个或者多个软件源。<br>其作用：我们将从哪里下载需要安装或者升级的软件包，repo文件中都进行了相关的配置，而这些配置将会被yum读取和应用。</p>\n<p><strong>repo文件内容详解</strong><br>目录：/etc/yum.repo.d/<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/yum.repos.d/CentOS-Base.repo</span><br><span class=\"line\"></span><br><span class=\"line\">[base]</span><br><span class=\"line\"><span class=\"comment\">#该选项是定义软件源的名称，该名称是可以自定义，同时在该服务器上所有repo文件中是唯一的。注意：方括号里面不能有空格。</span></span><br><span class=\"line\">name=CentOS-<span class=\"variable\">$releasever</span>–Base</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#该选项是定义软件仓库的名称，$releasever变量定义了发行版本，通常是5，6，7等数字。</span></span><br><span class=\"line\"><span class=\"comment\">#这是指定镜像服务器的地址列表，通常是开启的它会选择最优或者第一个镜像服务器地址</span></span><br><span class=\"line\"><span class=\"comment\">#选择自己访问速度较快的镜像服务器地址复制并粘贴到repo文件中的baseurl选项中，我们就能获得较快的更新速度了。</span></span><br><span class=\"line\">mirrorlist=http://mirrorlist.centos.org/?release=<span class=\"variable\">$releasever</span>&amp;arch=<span class=\"variable\">$basearch</span>&amp;repo=os</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#下面表示该行已经被注释，将不会被读取，这一行的意思是指定一个baseurl（源的镜像服务器地址）。</span></span><br><span class=\"line\"><span class=\"comment\">#baseurl=http://mirror.centos.org/centos/$releasever/os/$basearch/</span></span><br><span class=\"line\"><span class=\"comment\">#baseurl通常有以下四种格式，注意：一个repo文件中可以定义多个软件源如下：</span></span><br><span class=\"line\">baseurl= http://mirrors.aliyun.com/centos/6.6/os/x86_64/  <span class=\"comment\">#使用http协议镜像服务器地址(使用最多)</span></span><br><span class=\"line\">baseurl= ftp://ftp.sjtu.edu.cn/centos/6.6/os/x86_64/  <span class=\"comment\">#使用ftp协议镜像服务器地址</span></span><br><span class=\"line\">baseurl= rsync://mirror.zol.co.zw/centos/  <span class=\"comment\">#使用rsync镜像服务器地址</span></span><br><span class=\"line\">baseurl= file:///ilanni/yum/   <span class=\"comment\">#使用本机的镜像服务器地址</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#该选项表示在这个repo文件中启用这个软件源默认该选项可以不写。但是如果enabled的值为0，则表示禁用这个软件源。</span></span><br><span class=\"line\">enabled=1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#该选项表示对通过该软件源下载的rpm包进行gpg校验，如果gpgcheck的值为0表示不进行gpg校验。</span></span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#该选项定义用于校验的gpg密钥文件。</span></span><br><span class=\"line\">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190517144804.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p>文件：/etc/yum.conf<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#们使用yum进行安装软件时，安装完毕后会自动把软件包删除如果需要保存把keepcache修改为1即可</span></span><br><span class=\"line\">cat /etc/yum.conf</span><br><span class=\"line\">[main]</span><br><span class=\"line\"><span class=\"comment\">#cachedir表示rpm包的缓存位置。</span></span><br><span class=\"line\">cachedir=/var/cache/yum/<span class=\"variable\">$basearch</span>/<span class=\"variable\">$releasever</span> <span class=\"comment\">#安装包存储目录</span></span><br><span class=\"line\"><span class=\"comment\">#是否保存下载的rpm包 1为保存</span></span><br><span class=\"line\">keepcache=0</span><br><span class=\"line\"></span><br><span class=\"line\">debuglevel=2</span><br><span class=\"line\">logfile=/var/<span class=\"built_in\">log</span>/yum.log</span><br><span class=\"line\">exactarch=1</span><br><span class=\"line\">obsoletes=1</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">plugins=1</span><br><span class=\"line\">installonly_limit=5</span><br><span class=\"line\">bugtracker_url=http://bugs.centos.org/set_project.php?project_id=23&amp;ref=http://bugs.centos.org/bug_report_page.php?category=yum</span><br><span class=\"line\">distroverpkg=centos-release</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"4-yum仓库实战\"><a href=\"#4-yum仓库实战\" class=\"headerlink\" title=\"4.yum仓库实战\"></a>4.yum仓库实战</h3><p><strong>(1)yum企业内部光盘源搭建</strong><br>项目需求：该yum源需要配置两个源：一个是centos的光盘镜像源，一个是特殊rpm软件的镜像源并且该yum源是通过http进行访问。<br>实验环境：yum服务器192.168.1.247 centos，客户端192.168.1.248 centos</p>\n<p><em>服务端操作流程与步骤</em>：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#0. 安装createrepo</span></span><br><span class=\"line\">Q:createrepo是什么？</span><br><span class=\"line\">A:createrepo是linux下创建仓库的软件包。create是创建的意思，repo是repository的缩写是仓库的意思。</span><br><span class=\"line\">yum -y install createrepo  <span class=\"comment\">#只有安装createrepo这个软件，才能在yum服务器创建软件仓库。</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#1. 安装web应用比如apache中httpd或者nginx都可以还可python -m SimpleHTTPServer模块</span></span><br><span class=\"line\">yum -y install httpd  <span class=\"comment\">#你也可以通过源码包安装</span></span><br><span class=\"line\">/etc/init.d/httpd start  <span class=\"comment\">#apache安装完毕后我们来启动apache</span></span><br><span class=\"line\">wget http://192.168.1.247</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2. 挂载光盘镜像到服务器中或者复制光盘镜像到yum服务器中</span></span><br><span class=\"line\"><span class=\"comment\"># mkdir /mnt/cdrom</span></span><br><span class=\"line\"><span class=\"comment\"># mount /dev/cdrom /mnt/cdrom/</span></span><br><span class=\"line\"><span class=\"comment\">#修改CentOS-Media.repo  光盘源</span></span><br><span class=\"line\"><span class=\"comment\"># vim CentOS-Media.repo</span></span><br><span class=\"line\"><span class=\"comment\"># － ［c6-media］</span></span><br><span class=\"line\"><span class=\"comment\"># －  name=CentOS-$releasever - Media</span></span><br><span class=\"line\"><span class=\"comment\"># －  baseurl=file:///mnt/cdrom     #光盘挂载目录  注释掉下面没用的</span></span><br><span class=\"line\"><span class=\"comment\"># －          file:///media/cdrom</span></span><br><span class=\"line\"><span class=\"comment\"># －          file:///media/cdrecorder</span></span><br><span class=\"line\"><span class=\"comment\"># －  gpgcheck=1</span></span><br><span class=\"line\"><span class=\"comment\"># －  enabled=1</span></span><br><span class=\"line\"><span class=\"comment\"># －  gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6</span></span><br><span class=\"line\"><span class=\"comment\">#---------------------------------</span></span><br><span class=\"line\"></span><br><span class=\"line\">mkdir -p /var/www/html/yum</span><br><span class=\"line\">ll /var/www/html/yum/</span><br><span class=\"line\">mkdir /iso</span><br><span class=\"line\">mount -o loop CentOS-6.6-x86_64-minimal.iso /iso/  <span class=\"comment\">#创建光盘挂载</span></span><br><span class=\"line\">cp -rv /iso/* /var/www/html/yum/  <span class=\"comment\">#复制到光盘下的所有文件到/var/www/html/yum/目录下</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3. 现在我们访问下该目录，看看能不能正常显示</span></span><br><span class=\"line\">wget http://192.168.1.247/yum</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#注意：在此我们没有创建yum数据库和信息索引文件，是因为光盘已经有yum数据库和信息索引文件，我们不需要再通过createrepo命令在进行。其实yum的数据库和信息索引文件，都在repodata文件夹下。如下：</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#4. 为了光盘镜像实验的效果，我们在此以光盘镜像软件包中curl软件为例。如下：</span></span><br><span class=\"line\">ll /var/www/html/yum/Packages |grep curl</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190517150403.png\" alt=\"WeiyiGeek.repodata\" title=\"\" class=\"\">\n                <p>WeiyiGeek.repodata</p>\n            </figure></p>\n<p>特殊软件镜像配置,在前面我们还要求一个特殊的yum源用来存放特殊软件的，在此我们以lrzsz这个软件为例。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1. 该yum源存放的位置/var/www/html/ilanni/目录下，然后把lrzsz这个软件的rpm包放在/var/www/html/ilanni/目录下，如下：</span></span><br><span class=\"line\">mkdir -p /var/www/html/ilanni</span><br><span class=\"line\">cp /var/cache/yum/x86_64/6/base/packages/lrzsz-0.12.20-27.1.el6.x86_64.rpm /var/www/html/ilanni/</span><br><span class=\"line\">ll /var/www/html/ilanni/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2. 创建该特殊源的yum数据库和信息索引文件</span></span><br><span class=\"line\">createrepo ./</span><br><span class=\"line\">tree repodata/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3. 现在我们访问下该目录，看看能不能正常显示，如下：</span></span><br><span class=\"line\">wget http://192.168.1.247/ilanni</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190517150816.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p><em>客户端的配置</em>：<br>yum客户端的操作就简单了很多，我们只需要修改客户端的repo文件即可。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1. 进入/etc/yum.repos.d/目录，备份原有的repo文件，如下：</span></span><br><span class=\"line\">rename .repo .repo.bak *.repo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2.然后在该目录下，创建一个新的repo文件ilanni.repo，该文件名可以变但是后缀一定是.repo。</span></span><br><span class=\"line\"><span class=\"comment\">#基本软件</span></span><br><span class=\"line\">[centos6]</span><br><span class=\"line\">name=centos6</span><br><span class=\"line\">baseurl=http://192.168.1.247/yum/</span><br><span class=\"line\">enabled=1</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#特殊软件安装</span></span><br><span class=\"line\">[ilanni]</span><br><span class=\"line\">name=ilanni</span><br><span class=\"line\">baseurl=http://192.168.1.247/ilanni/</span><br><span class=\"line\">enabled=1</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3. 测试安装软件安装curl软件，如下：</span></span><br><span class=\"line\">yum clean all </span><br><span class=\"line\">yum makecache</span><br><span class=\"line\"><span class=\"comment\">#yum -y update &amp; yum -y upgrade  #常常一起执行</span></span><br><span class=\"line\"></span><br><span class=\"line\">yum -y install curl</span><br><span class=\"line\">yum -y install lrzsz <span class=\"comment\">#安装lrzsz软</span></span><br><span class=\"line\"></span><br><span class=\"line\">注意：如果客户端yum安装软件包时，提示找不到该软件。强烈建议在客户端上执行</span><br><span class=\"line\">yum clean all</span><br><span class=\"line\">yum list</span><br></pre></td></tr></table></figure><br>以上就是我们在内网搭建yum源的步骤。</p>\n<p>补充：更新rpm包<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#在我们搭建完毕内网yum源后，会经常遇到这两种情况。一是软件版本的更新，二是新增软件。</span></span><br><span class=\"line\"><span class=\"comment\">#无论遇到以上那种情况，我们都需要先删除原来的yum服务器的yum数据库和信息索引文件，然后通过createrepo命令重新创建yum数据库和信息索引文件。</span></span><br><span class=\"line\">cp /var/cache/yum/x86_64/6/base/packages/lftp-4.0.9-1.el6_5.1.x86_64.rpm /var/www/html/ilanni/</span><br><span class=\"line\">ll /var/www/html/ilanni/</span><br><span class=\"line\">rm -fr /var/www/html/ilanni/repodata/</span><br><span class=\"line\">createrepo /var/www/html/ilanni/   <span class=\"comment\">#必须重新建立yum数据和信息索引文件</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#请看缓存数据执行安装</span></span><br><span class=\"line\">yum clean all</span><br><span class=\"line\">yum list |grep lftp</span><br><span class=\"line\">yum -y install lftp</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>(2)企业内部yum源搭建</strong></p>\n<p><em>yum仓库服务端配置如下：</em><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1. 创建yum仓库目录</span></span><br><span class=\"line\">mkdir -p /data/yum_data/</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /data/yum_data/  <span class=\"comment\">#可以上传rpm包到此目录，此目录下面还可以包括文件夹</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2. 安装httpd与 createrepo 并且将httpd配置文件指向设置为/data/yum_data目录中</span></span><br><span class=\"line\"><span class=\"comment\">#h或者使用 python -m SimpleHTTPServer 80 &amp;&gt; /dev/null &amp;</span></span><br><span class=\"line\">createrepo -pdo /data/yum_data/ /data/yum_data/ <span class=\"comment\">#初始化repodata索引文件</span></span><br><span class=\"line\"></span><br><span class=\"line\">[root@yum conf]<span class=\"variable\">$vi</span> httpd.conf</span><br><span class=\"line\">DocumentRoot <span class=\"string\">\"/data/yum_data/\"</span>  <span class=\"comment\">#用搜索 /DocumentRoot 的方法</span></span><br><span class=\"line\">&lt;Directory <span class=\"string\">\"/data/yum_data/\"</span>&gt;     <span class=\"comment\">#317行</span></span><br><span class=\"line\"><span class=\"comment\">#把默认主页配置移到tmp目录下，少用rm命令。</span></span><br><span class=\"line\">[root@yum httpd]$ mv conf.d/welcome.conf /tmp</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3.修改/usr/local/yumrepo目录的属主和属组为apache</span></span><br><span class=\"line\">[root@yum conf]<span class=\"comment\"># chown -R apache.apache /data/yum_data/</span></span><br><span class=\"line\">[root@yum conf]<span class=\"comment\"># ll -l /data/yum_data/</span></span><br><span class=\"line\">drwxr-xr-x. 3 apache apache 4096 11月 19 16:49 centos</span><br><span class=\"line\">drwxr-xr-x. 3 apache apache 4096 11月 19 16:50 epel</span><br><span class=\"line\">drwxr-xr-x. 2 apache apache 4096 11月 19 17:50 repodata</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#4. 根据自己服务器ip地址进行配置</span></span><br><span class=\"line\">[root@yum yum_data]<span class=\"variable\">$echo</span> <span class=\"string\">\"192.168.30.130 yum.weiyigeek.com\"</span> &gt;&gt;/etc/hosts</span><br><span class=\"line\">[root@yum yum_data]<span class=\"variable\">$tail</span> -1 /etc/hosts  <span class=\"comment\">#添加hosts解析</span></span><br><span class=\"line\">192.168.30.130 yum.weiyigeek.com</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#5. 启动httpd服务(并且测试是否可以进行正常访问)</span></span><br><span class=\"line\">service httpd restart</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#6. 保留yum安装软件时不删除安装包,只下载不安装软件并移动到httpd网页目录中</span></span><br><span class=\"line\">sed -i <span class=\"string\">\"s#keepcache=0#keepcache=1#g\"</span> /etc/yum.conf</span><br><span class=\"line\"><span class=\"comment\"># 安装包存储目录</span></span><br><span class=\"line\">cachedir=/var/cache/yum/<span class=\"variable\">$basearch</span>/<span class=\"variable\">$releasever</span></span><br><span class=\"line\">ll /var/cache/yum/x86_64/6/base/packages</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#下载需要的rpm包不安装</span></span><br><span class=\"line\">yum --downloadonly install tftp</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#把下载的rpm包，移到yum服务器目录中</span></span><br><span class=\"line\">[root@yum x86_64]<span class=\"comment\">#cd /var/cache/yum/x86_64/6/base/packages</span></span><br><span class=\"line\">[root@yum packages]<span class=\"comment\"># mv * /data/yum_data/centos/6/os/x86_64</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#7. 每加入一个rpm包就要更新一下（每次发布新的内容都需要更新）</span></span><br><span class=\"line\">createrepo -pdo  /data/yum_data/ /data/yum_data/  <span class=\"comment\">#初始化</span></span><br><span class=\"line\">createrepo --update /data/yum_data/</span><br></pre></td></tr></table></figure></p>\n<p><em>客户端配置：</em><br>备注：注意更改为自己的域名地址<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1. centos7 系统yum源配置方法 (centos6只是配置一哈路径而已)</span></span><br><span class=\"line\">[root@B yum.repos.d]$ vi localyum.repo</span><br><span class=\"line\">[localyum]</span><br><span class=\"line\">name=centos7</span><br><span class=\"line\">baseurl=http://yum.weiyigeek.com/centos/7/os/x86_64/</span><br><span class=\"line\"><span class=\"built_in\">enable</span>=1</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\"></span><br><span class=\"line\">[localepel]</span><br><span class=\"line\">name=epel</span><br><span class=\"line\">baseurl=http://yum.weiyigeek.com/epel/7/x86_64/</span><br><span class=\"line\"><span class=\"built_in\">enable</span>=1</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\"></span><br><span class=\"line\">[localextra]</span><br><span class=\"line\">name=extra</span><br><span class=\"line\">baseurl=http://yum.weiyigeek.com/centos/7/extras/x86_64/</span><br><span class=\"line\"><span class=\"built_in\">enable</span>=1</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2. 指定使用localyum库，并且是临时使用内网yum源，服务器重启后失效。</span></span><br><span class=\"line\"><span class=\"comment\">#如果需要永久使用，需要修改配置repo文件源，设置enabled=0即可(打开设置为1)</span></span><br><span class=\"line\">yum --enablerepo=localyum --disablerepo=base,extras,updates,epel list</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>(3) 同步镜公网镜像yum源配置方法</strong><br>在我们自己搭建的yum镜像站由于yum软件的数据库文件repodata不一致就会导致问题,因此我想到的解决方法就是直接使用公网yum源的repodata。<br>在公司里搭建一个内网yum服务器进行实时同步公网镜像流程步骤如下：</p>\n<p>镜像同步公网yum源:</p>\n<ul>\n<li>上游yum源必须要支持rsync协议，否则不能使用rsync进行同步。<a href=\"http://mirrors.ustc.edu.cn/status/\" target=\"_blank\" rel=\"noopener\">http://mirrors.ustc.edu.cn/status/</a><br>CentOS官方标准源：rsync://mirrors.ustc.edu.cn/centos/<br>epel源：rsync://mirrors.ustc.edu.cn/epel/</li>\n<li>正对于Centos6</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 使用rsync同步yum源为了节省带宽、磁盘和下载时间，我只同步了CentOS6的rpm包，这样所有的rpm包只占用了21G，全部同步需要300G左右。</span></span><br><span class=\"line\"><span class=\"comment\"># 同步base源，小技巧，我们安装系统的光盘镜像含有部分rpm包，大概3G，这些就不用重新下载。</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#1. 创建四个目录，用于同步公网yum源</span></span><br><span class=\"line\">mkdir -p /data/yum_data/centos/6/os/x86_64/</span><br><span class=\"line\">mkdir -p /data/yum_data/centos/6/extras/x86_64/</span><br><span class=\"line\">mkdir -p /data/yum_data/centos/6/updates/x86_64/</span><br><span class=\"line\">mkdir -p /data/yum_data/epel/6/x86_64/</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2. 下面四条命令，同时复制执行，就会开始同步官网yum源到本地。</span></span><br><span class=\"line\">/usr/bin/rsync -av rsync://mirrors.ustc.edu.cn/centos/6/os/x86_64/ /data/yum_data/centos/6/os/x86_64/</span><br><span class=\"line\">/usr/bin/rsync -av rsync://mirrors.ustc.edu.cn/centos/6/extras/x86_64/ /data/yum_data/centos/6/extras/x86_64/</span><br><span class=\"line\">/usr/bin/rsync -av rsync://mirrors.ustc.edu.cn/centos/6/updates/x86_64/ /data/yum_data/centos/6/updates/x86_64/</span><br><span class=\"line\">/usr/bin/rsync -av --exclude=debug rsync://mirrors.ustc.edu.cn/epel/6/x86_64/ /data/yum_data/epel/6/x86_64/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3. 查看同步完成后yum源的大小：</span></span><br><span class=\"line\"><span class=\"variable\">$du</span> -sh yum_data</span><br><span class=\"line\">12G     yum_data</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$tree</span> -L 3 yum_data/</span><br><span class=\"line\">yum_data/</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190517163925.png\" alt=\"WeiyiGeek.公网镜像repo\" title=\"\" class=\"\">\n                <p>WeiyiGeek.公网镜像repo</p>\n            </figure>\n<p><em>补充常见的错误处理</em>：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#问题1 Error1:</span><br><span class=\"line\">@ERROR: max connections (20) reached -- try again later</span><br><span class=\"line\">rsync error: error starting client-server protocol (code 5) at main.c(1503) [receiver&#x3D;3.0.6]</span><br><span class=\"line\">解决方法：</span><br><span class=\"line\">yum源服务器超过最大连接数，请过会再试。（多试几次，就成功啦）</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">#问题2：Error：</span><br><span class=\"line\">rsync: getaddrinfo: mirrors.ustc.edu.cn 873: Name or service not known</span><br><span class=\"line\">解决方法：</span><br><span class=\"line\">DNS无法解析，添加移动DNS</span><br><span class=\"line\">[root@node5 ~]#echo &quot;nameserver 120.196.165.7&quot; &gt;&gt; &#x2F;etc&#x2F;resolv.conf </span><br><span class=\"line\">[root@node5 ~]# cat &#x2F;etc&#x2F;resolv.conf </span><br><span class=\"line\">nameserver 120.196.165.7</span><br></pre></td></tr></table></figure></p>\n<hr>\n<h2 id=\"0x03-附录脚本\"><a href=\"#0x03-附录脚本\" class=\"headerlink\" title=\"0x03 附录脚本\"></a>0x03 附录脚本</h2><p><strong>(1) RHEL7系列快速配置本地yum源光盘</strong><br>vim rhel7.repo.sh<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\">mkdir -p /media/cdrom</span><br><span class=\"line\">mount /dev/cdrom /media/cdrom</span><br><span class=\"line\"><span class=\"comment\">#自动挂载</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"/dev/cdrom /media/cdrom iso9660 defaults 0 0\"</span> &gt;&gt; /etc/fstab</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /etc/yum.repos.d</span><br><span class=\"line\">cat &gt; rhel7.repo &lt;&lt;END</span><br><span class=\"line\">[rhel7]</span><br><span class=\"line\">name=rhel7</span><br><span class=\"line\">baseurl=file:///media/cdrom</span><br><span class=\"line\">enabled=1</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\">END</span><br><span class=\"line\"></span><br><span class=\"line\">yum clean all</span><br><span class=\"line\">yum makecach</span><br></pre></td></tr></table></figure></p>\n<p>测试安装:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install httpd -y</span><br><span class=\"line\"><span class=\"comment\">#最后出现Complete!说明httpd安装成功，同时也说明了yum仓库配置成功！</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>(2) RHEL7系列快速配置本地yum源之文件</strong></p>\n<p>vim fileyum.sh</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#创建光盘镜像挂载目录以及创建软件包存放目录</span></span><br><span class=\"line\">mkdir /mnt/media /root/123</span><br><span class=\"line\">mount /dev/cdrom /mnt/media</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /mnt/media &amp;&amp; <span class=\"built_in\">cd</span> Packages</span><br><span class=\"line\">rpm -ivh deltarpm-3.6-3.el7.x86_64.rpm</span><br><span class=\"line\">rpm -ivh python-deltarpm-3.6-3.el7.x86_64.rpm</span><br><span class=\"line\">rpm -ivh createrepo-0.9.9-28.el7.noarch.rpm</span><br><span class=\"line\"><span class=\"built_in\">cd</span> .. &amp;&amp; cp -r * /root/123</span><br><span class=\"line\"></span><br><span class=\"line\">cat &gt; /etc/yum.repos.d/123.repo &lt;&lt;END</span><br><span class=\"line\">[REPO123]</span><br><span class=\"line\">name=123</span><br><span class=\"line\">baseurl=file:///root/123</span><br><span class=\"line\">enabled=1</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\">END</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#镜像制作</span></span><br><span class=\"line\">createrepo /root/123</span><br><span class=\"line\"><span class=\"comment\">#至此如此本地yum源文件仓库就制作</span></span><br></pre></td></tr></table></figure>\n<hr>\n<h2 id=\"0x04-补充扩展\"><a href=\"#0x04-补充扩展\" class=\"headerlink\" title=\"0x04 补充扩展\"></a>0x04 补充扩展</h2><h3 id=\"1-CentOS下yum配置Proxy方法\"><a href=\"#1-CentOS下yum配置Proxy方法\" class=\"headerlink\" title=\"1.CentOS下yum配置Proxy方法\"></a>1.CentOS下yum配置Proxy方法</h3><p>在 <code>/etc/yum.conf</code> 文件中通常增加一行 <code>proxy=http://xxx.xxx.xxx:xxxx</code> 即可。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 例如 vim /etc/yum.conf</span></span><br><span class=\"line\"><span class=\"comment\"># 代理无账号密码认证</span></span><br><span class=\"line\">proxy=http://xxx.xxx.xxx:xxxx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 代理有账号密码认证</span></span><br><span class=\"line\">proxy_username=用户名</span><br><span class=\"line\">proxy_password=密码</span><br></pre></td></tr></table></figure></p>\n<hr>\n<h2 id=\"0x05-入坑出坑\"><a href=\"#0x05-入坑出坑\" class=\"headerlink\" title=\"0x05 入坑出坑\"></a>0x05 入坑出坑</h2><p>问题1.yum -y install 时出现<code>This system is not registered with an entitlement server. You can use subscription-manager to register.</code>问题;<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">已加载插件：fastestmirror, product-id, search-disabled-repos, subscription-manager</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># This system is not registered with an entitlement server. You can use subscription-manager to register.</span></span><br></pre></td></tr></table></figure><br>问题原因: 由于yum没有 -y 这个命令该命令是install的子命令所以会报错，还有一种情况是Redhat的操作系统默认yum是需要收费的我们需要切换到免费的CentOS yum上即可<br>解决办法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># (0) 安装命令参数错误导致修正</span></span><br><span class=\"line\">yum install -y </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (1) 关闭子管理器</span></span><br><span class=\"line\">cat /etc/yum/pluginconf.d/subscription-manager.conf</span><br><span class=\"line\">[main]</span><br><span class=\"line\">enabled=0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (3)</span></span><br></pre></td></tr></table></figure></p>\n","comments":true,"excerpt":"[TOC]<br>","categories":[{"name":"Linux命令","path":"api/categories/Linux命令.json"}],"tags":[{"name":"系统命令","path":"api/tags/系统命令.json"}]}