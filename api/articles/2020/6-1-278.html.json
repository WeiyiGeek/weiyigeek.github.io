{"title":"火狐扩展开发入门实践","slug":"编程世界/插件开发/FirefoxExtensions/火狐扩展开发入门实践","date":"2020-06-01T05:34:30.000Z","updated":"2023-01-31T02:29:10.670Z","url":"2020/6-1-278.html","path":"api/articles/2020/6-1-278.html.json","covers":["https://img.weiyigeek.top/2020/1/20200613201755.png","https://img.weiyigeek.top/2020/1/20200613101807.png","https://img.weiyigeek.top/2020/1/20200613103740.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x01-前言简述\"><a href=\"#0x01-前言简述\" class=\"headerlink\" title=\"0x01 前言简述\"></a>0x01 前言简述</h4><p>题外话: 由于公司内部系统不只支持将后台网页中的数据进行导出为docx或者html而只能打印成PDF，所以为了丰衣足食选择了自己进行开发一个浏览器插件来提取网页中的代码片段与提前设置好的html模板将获取的html进行插入，但是我们需要从基础学习开始一步一步的接触Firefox扩展软件的开发；</p>\n<p><em>此时可能您会问我为何不选择使用Chriome进行扩展开发?</em><br>答:要科学上网找官网资料(受限于学习环境)，同时Firefox  与 Google Chrome、Opera 和 W3C 草案社区组织 所支持的 扩展(Extensions) API 在很大程度上兼容。大多数情况下为这些浏览器编写的扩展只需少许修改即可在 Firefox 或 Microsoft Edge 中运行，并且这种 API 与也完全兼容 多进程 Firefox。</p>\n<p><br></p>\n<h5 id=\"1-Firefox扩展开发简述\"><a href=\"#1-Firefox扩展开发简述\" class=\"headerlink\" title=\"1.Firefox扩展开发简述\"></a>1.Firefox扩展开发简述</h5><p>描述:Firefox 开发者工具可以帮助我们在 PC 和移动设备上检查，编辑，调试 HTML、CSS 及 JavaScript。</p>\n<p>官方开发参考地址:</p>\n<ul>\n<li>开发工具概述:<a href=\"https://developer.mozilla.org/zh-CN/docs/Tools\" target=\"_blank\" rel=\"noopener\">https://developer.mozilla.org/zh-CN/docs/Tools</a></li>\n<li>扩展开发教程:<a href=\"https://developer.mozilla.org/zh-CN/docs/Mozilla/Add-ons/WebExtensions\" target=\"_blank\" rel=\"noopener\">https://developer.mozilla.org/zh-CN/docs/Mozilla/Add-ons/WebExtensions</a></li>\n</ul>\n<p>说明:以下都是引用官方文档中一些介绍与关键点；</p>\n<p>Q:扩展是什么？<br>A:扩展为浏览器添加特性与功能它通过熟悉的 web 技术——HTML,CSS 还有 JavaScript 来创建,利用网页上的 JavaScript 使用同一批 API，但扩展也可以访问扩展自己专用的 JavaScript API，所以进行插件开发您需要对Javascript有一定的了解;</p>\n<p>Q:扩展有什么用处？</p>\n<ul>\n<li>为浏览器添加特性与功能,和在网页里编码相比他能帮助您处理页面上的数据按照开发者的流程进行，实际上扩展是用来提升或补充网站功能；</li>\n<li>让用户展现他们的个性：浏览器扩展可以操控网页的内容；</li>\n<li>从网页中添加或删除内容：你可能想要帮助用户从网页中阻止一些侵扰的广告;</li>\n<li>添加工具和新的浏览特性：给任务面板添加新特性，或者从URL地址，超链接，或者页面文字生成二维码。</li>\n<li>游戏开发：通过线下游戏的特性，或者探索新游戏的可能性来提供传统计算机游戏功能;</li>\n<li>添加开发工具：你可以提供网站开发工具给你的公司或者开发一个有用的技术或者你想分享的网站开发技术。</li>\n</ul>\n<p><br></p>\n<h5 id=\"2-扩展关键字解释\"><a href=\"#2-扩展关键字解释\" class=\"headerlink\" title=\"2.扩展关键字解释\"></a>2.扩展关键字解释</h5><p>描述:扩展是指一个包含若干文件的安装包，可直接分发至用户,根据下部分的第一个实例来做为参考，一个插件基本的框架如下;<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; ToolsDir</span><br><span class=\"line\">  &gt; popup</span><br><span class=\"line\">    - index.html</span><br><span class=\"line\">    - index.js</span><br><span class=\"line\">    - style.css</span><br><span class=\"line\">  &gt; images </span><br><span class=\"line\">    - demo.png</span><br><span class=\"line\">  &gt; context_script</span><br><span class=\"line\">    - Tools_demo1.js</span><br><span class=\"line\">    - Tools_demo2.js</span><br><span class=\"line\">    - style.css</span><br><span class=\"line\">  &gt; icons</span><br><span class=\"line\">    - logo-16.png</span><br><span class=\"line\">  - manifest.json</span><br><span class=\"line\">  - main.js</span><br></pre></td></tr></table></figure></p>\n<p><strong>manifest.json</strong><br>该文件是每个 WebExtension 里面必须存在的文件，它包含了关于这个扩展插件基本的元数据（metadata），比如它的名字、版本和所需扩展API权限和资源路径。并且它也对 WebExtension 中其他资源文件进行了链接。</p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200613201755.png\" alt=\"WeiyiGeek.manifest.json\" title=\"\" class=\"\">\n                <p>WeiyiGeek.manifest.json</p>\n            </figure>\n<p>基础示例:<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  //(1) 版本 名称 软件版本号 必不可少，author可选</span><br><span class=\"line\">  \"manifest_version\": 2,</span><br><span class=\"line\">  \"name\": \"WeiyiGeekTools\",</span><br><span class=\"line\">  \"short_name\": \"WTools\",</span><br><span class=\"line\">  \"version\": \"1.0\",</span><br><span class=\"line\">  \"author\": \"WeiyiGeek\",</span><br><span class=\"line\"></span><br><span class=\"line\">  //(2) Firefox 扩展插件描述以及插件说明连接设置</span><br><span class=\"line\">  \"description\": \"Adds Borwser plug-in with WeiyiGeek.\",</span><br><span class=\"line\">  \"homepage_url\": \"https://blog.weiyigeek.top\",</span><br><span class=\"line\"></span><br><span class=\"line\">  //(3) 扩展图标 (16~96)像素，将显示在附加组件管理器上.</span><br><span class=\"line\">  \"icons\":&#123;</span><br><span class=\"line\">    \"16\": \"icons/logo-16.png\",</span><br><span class=\"line\">    \"32\": \"icons/logo-32.png\",</span><br><span class=\"line\">    \"48\": \"icons/logo-48.png\"</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  //(4) 特定于浏览器的设置，指定一个附加组件 ID ,浏览器最小版本以及更新的manifest.json地址</span><br><span class=\"line\">  \"browser_specific_settings\": &#123;</span><br><span class=\"line\">    \"gecko\": &#123;</span><br><span class=\"line\">      \"id\": \"master@weiyigeek.top\",</span><br><span class=\"line\">      \"strict_min_version\": \"42.0\",</span><br><span class=\"line\">      \"update_url\": \"https://example.com/updates.json\"</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  //(5) URL 匹配特定模式的网页才进行加载脚本,比如放访问weiyigeek.top域名时候执行main.js中的操作;</span><br><span class=\"line\">  // 匹配和排除匹配</span><br><span class=\"line\">  \"content_scripts\": [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"exclude_matches\"</span>: [<span class=\"string\">\"*://developer.mozilla.org/*\"</span>],</span><br><span class=\"line\">      <span class=\"attr\">\"matches\"</span>: [<span class=\"string\">\"*://*.weiyigeek.top/*\"</span>],</span><br><span class=\"line\">      <span class=\"attr\">\"js\"</span>: [<span class=\"string\">\"main.js\"</span>]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ],</span><br><span class=\"line\"></span><br><span class=\"line\">  //(6) 后台脚本（background scripts）的职责，由于扩展常常需要独立于任何浏览器窗口或特定网页来维持一种长期的状态或者执行长期的操作，</span><br><span class=\"line\">  // 可以添加多个后台脚本或者你也可以先引入一个后台页面，再在后台页面中引入脚本优势是ES 6 模块支持;</span><br><span class=\"line\">  \"background\": &#123;</span><br><span class=\"line\">    \"scripts\": [\"background-script.js\"],</span><br><span class=\"line\">    \"page\": \"background-page.html\"</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  </span><br><span class=\"line\">  //(7) 使用指定WebExtension API名称权限才能调用</span><br><span class=\"line\">  \"permissions\": [</span><br><span class=\"line\">    <span class=\"string\">\"activeTab\"</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  </span><br><span class=\"line\">  //(8) 在工具栏中添加按钮</span><br><span class=\"line\">  \"browser_action\": &#123;</span><br><span class=\"line\">    \"default_icon\": \"icons/logo-48.png\",</span><br><span class=\"line\">    \"default_title\": \"Tools\",</span><br><span class=\"line\">    \"default_popup\": \"popup/index.html\"</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  //(9) 地址栏添加按钮与工具栏按钮(或 browser action)非常相似。</span><br><span class=\"line\">  // 仅default_icon是强制（必需）的</span><br><span class=\"line\">  \"page_action\": &#123;</span><br><span class=\"line\">    \"browser_style\": true,</span><br><span class=\"line\">    \"default_icon\": &#123;</span><br><span class=\"line\">      \"16\": \"icons/logo-16.png\",</span><br><span class=\"line\">      \"32\": \"icons/logo-32.png\"</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    \"default_title\": \"WeiyiGeekTools\",</span><br><span class=\"line\">    \"default_popup\": \"popup/index.html\",</span><br><span class=\"line\">    \"show_matches\": [\"*://*/*\"]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  //(10) 使打包好的内容可用于网页与目录脚本</span><br><span class=\"line\">  \"web_accessible_resources\": [</span><br><span class=\"line\">    <span class=\"string\">\"images/test.jpg\"</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\"></span><br><span class=\"line\">  //(11) 国际化设置如果扩展名包含_locales目录，则该key必须存在，否则不得存在</span><br><span class=\"line\">  \"default_locale\": \"zh\",</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  //(12) 快捷键触发事件</span><br><span class=\"line\">  \"commands\": &#123;</span><br><span class=\"line\">    \"toggle-feature\": &#123;</span><br><span class=\"line\">      \"suggested_key\": &#123;</span><br><span class=\"line\">        \"default\": \"Ctrl+Shift+Y\",</span><br><span class=\"line\">        \"linux\": \"Ctrl+Shift+U\"</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      \"description\": \"Send a 'toggle-feature' event\"</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  //(13) 内容安全策略</span><br><span class=\"line\">  \"content_security_policy\": \"script-src 'self' https://example.com; object-src 'self'\",</span><br><span class=\"line\">  </span><br><span class=\"line\">  //(14) 用户脚本</span><br><span class=\"line\">  \"user_scripts\": &#123;</span><br><span class=\"line\">    \"api_script\": \"apiscript.js\",</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>在运行时访问 manifest.json 键:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#通过 runtime.getManifest() 函数访问拓展的 manifest 数据：</span></span><br><span class=\"line\">browser.runtime.getManifest().version;</span><br></pre></td></tr></table></figure></p>\n<p><em>关键说明:</em></p>\n<ul>\n<li>1.background pages:后台脚本(background scripts)在拓展加载完毕后开始运行(<code>执行一个长时间运行的逻辑</code>)，直到拓展被禁用或卸载。并且可以添加多份脚本就像同一个网页中的多个脚本一样，它们将会运行在同一上下文环境中。<ul>\n<li>后台脚本的运行环境:DOM API,WebExtension API, 跨域访问, 网页内容(通过 message-passing API 与内容脚本通信),内容安全策略(Content Security Policy)。<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//#支持多个脚本和引入一个后台页面，再在后台页面中引入脚本这样做的优势是ES6 模块的支持;</span><br><span class=\"line\">// manifest.json</span><br><span class=\"line\">\"background\": &#123;</span><br><span class=\"line\">  \"page\": \"background-page.html\"</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// background-page.html</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang=\"zh-CN\"&gt;</span><br><span class=\"line\">  &lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=\"utf-8\"&gt;</span><br><span class=\"line\">    &lt;script type=\"module\" src=\"background-script.js\"&gt;&lt;/script&gt;</span><br><span class=\"line\">  &lt;/head&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li>2.content scripts:与网页进行交互注意它与JavaScript在页面中的 <code>&lt;script&gt;</code>元素不一样。</li>\n<li>3.browser action files: 在工具栏中添加按钮。</li>\n<li>4.page action files: 添加到浏览器地址栏中的按钮,用户通过点击这个按钮与你的扩展进行交互。<a href=\"https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/page_action\" target=\"_blank\" rel=\"noopener\">参考</a></li>\n<li>5.options pages: 为用户定义一个可浏览的UI界面，可以改变插件的设置。</li>\n<li>6.web-accessible resources: 使打包好的内容可用于网页与目录脚本。</li>\n</ul>\n<p>补充工具:</p>\n<ul>\n<li>阿里的icofont:<a href=\"https://www.iconfont.cn/\" target=\"_blank\" rel=\"noopener\">https://www.iconfont.cn/</a></li>\n</ul>\n<hr>\n<h4 id=\"0x02-扩展编写\"><a href=\"#0x02-扩展编写\" class=\"headerlink\" title=\"0x02 扩展编写\"></a>0x02 扩展编写</h4><h5 id=\"1-第一个扩展实例\"><a href=\"#1-第一个扩展实例\" class=\"headerlink\" title=\"1.第一个扩展实例\"></a>1.第一个扩展实例</h5><p>目录结构:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/mnt/f/WeiyiGeekTools</span><br><span class=\"line\">❯ tree</span><br><span class=\"line\">|____icons</span><br><span class=\"line\">| |____logo-16.png</span><br><span class=\"line\">| |____logo-32.png</span><br><span class=\"line\">| |____logo-48.png</span><br><span class=\"line\">|____main.js</span><br><span class=\"line\">|____manifest.json</span><br></pre></td></tr></table></figure></p>\n<p>扩展描述文件:manifest.json<br><figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"manifest_version\"</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"WeiyiGeekTools\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"version\"</span>: <span class=\"string\">\"1.0\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"Adds Borwser plug-in with WeiyiGeek.\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"icons\"</span>:&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"16\"</span>: <span class=\"string\">\"icons/logo-16.png\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"32\"</span>: <span class=\"string\">\"icons/logo-32.png\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"48\"</span>: <span class=\"string\">\"icons/logo-48.png\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">\"content_scripts\"</span>: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"matches\"</span>: [<span class=\"string\">\"*://*.WeiyiGeek.top/*\"</span>],</span><br><span class=\"line\">      <span class=\"attr\">\"js\"</span>: [<span class=\"string\">\"main.js\"</span>]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">\"browser_specific_settings\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"gecko\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"id\"</span>: <span class=\"string\">\"master@weiyigeek.top\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>JS操作地址:main.js<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">document</span>.body.style.border = <span class=\"string\">\"5px solid blue\"</span>;</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>安装与测试</strong></p>\n<ul>\n<li>1.打开 Firefox 的 about:debugging 页面，点击”This Firefox” (在新版本的Firefox里），点击 “临时加载附加组件（Load Temporary Add-on）” 按钮，并选择你的附加组件目录(<code>附加组件将会被安装，直到下次重启浏览器失效。</code>):</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200613101807.png\" alt=\"WeiyiGeek.临时加载\" title=\"\" class=\"\">\n                <p>WeiyiGeek.临时加载</p>\n            </figure>\n<ul>\n<li>2.现在尝试访问访问，你将会在页面上看到有个红色的边框，与此同时修改main之后需要重新点击临时插件中的加载页面马上就会有变化</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200613103740.png\" alt=\"WeiyiGeek.执行效果\" title=\"\" class=\"\">\n                <p>WeiyiGeek.执行效果</p>\n            </figure>\n<p><br></p>\n<h5 id=\"2-第二个扩展实例\"><a href=\"#2-第二个扩展实例\" class=\"headerlink\" title=\"2.第二个扩展实例\"></a>2.第二个扩展实例</h5><p>描述:实现将扩展添加一个新按钮到 Firefox 的工具栏，并在用户点击该按钮时，我们会显示一个弹出窗（popup）来让他们选择操作;</p>\n<p>实现要点:</p>\n<ul>\n<li>1.定义Browser Action设置相应的图标， 将我们的插件附加到Firefix工具栏之中;</li>\n<li>2.绑定一个popup弹出页面设置相应的操作按钮;</li>\n<li>3.建立一个main.js内容脚本实现，修改页面的代码;</li>\n<li>4.向页面插入图片和还原网页显示;</li>\n</ul>\n<p>基础架构:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/mnt/f/WeiyiGeekTools</span><br><span class=\"line\">❯ tree</span><br><span class=\"line\">|____content_script</span><br><span class=\"line\">| |____backgroud.js</span><br><span class=\"line\">|____icons   <span class=\"comment\"># Icons</span></span><br><span class=\"line\">| |____logo-16.png</span><br><span class=\"line\">| |____logo-32.png</span><br><span class=\"line\">| |____logo-48.png</span><br><span class=\"line\">|____images  <span class=\"comment\"># Web Accessible Resources</span></span><br><span class=\"line\">| |____test.jpg</span><br><span class=\"line\">|____main.js <span class=\"comment\"># content script</span></span><br><span class=\"line\">|____manifest.json</span><br><span class=\"line\">|____popup   <span class=\"comment\"># Browser Action 引用了 icons 下的图标</span></span><br><span class=\"line\">| |____index.html <span class=\"comment\">#界面的主面板</span></span><br><span class=\"line\">| |____index.js  <span class=\"comment\">#通过在当前活跃的标签页中运行内容脚本（content script）处理用户的选择</span></span><br><span class=\"line\">| |____style.css  <span class=\"comment\">#美化内容</span></span><br></pre></td></tr></table></figure></p>\n<p><strong>主要代码:</strong></p>\n<ul>\n<li><p>manifest.json : 以下关键字不多介绍，不懂的看上文;</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"manifest_version\"</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"WeiyiGeekTools\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"version\"</span>: <span class=\"string\">\"1.0\"</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"Adds Borwser plug-in with WeiyiGeek.\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"homepage_url\"</span>: <span class=\"string\">\"https://blog.weiyigeek.top\"</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">\"icons\"</span>:&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"16\"</span>: <span class=\"string\">\"icons/logo-16.png\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"32\"</span>: <span class=\"string\">\"icons/logo-32.png\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"48\"</span>: <span class=\"string\">\"icons/logo-48.png\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">\"content_scripts\"</span>: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"matches\"</span>: [<span class=\"string\">\"*://*.weiyigeek.top/*\"</span>],</span><br><span class=\"line\">      <span class=\"attr\">\"js\"</span>: [<span class=\"string\">\"main.js\"</span>]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ],</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">\"browser_specific_settings\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"gecko\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"id\"</span>: <span class=\"string\">\"master@weiyigeek.top\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">\"permissions\"</span>: [</span><br><span class=\"line\">    <span class=\"string\">\"activeTab\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"alarms\"</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">\"browser_action\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"default_icon\"</span>: <span class=\"string\">\"icons/logo-48.png\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"default_title\"</span>: <span class=\"string\">\"Tools\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"default_popup\"</span>: <span class=\"string\">\"popup/index.html\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">\"page_action\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"browser_style\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"default_icon\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"16\"</span>: <span class=\"string\">\"icons/logo-16.png\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"32\"</span>: <span class=\"string\">\"icons/logo-32.png\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">\"default_title\"</span>: <span class=\"string\">\"WeiyiGeekTools\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"default_popup\"</span>: <span class=\"string\">\"popup/index.html\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"show_matches\"</span>: [<span class=\"string\">\"*://*/*\"</span>]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">\"web_accessible_resources\"</span>: [</span><br><span class=\"line\">    <span class=\"string\">\"images/test.jpg\"</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">\"background\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"scripts\"</span>: [<span class=\"string\">\"context_script/background.js\"</span>]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>popup/index.html</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width, initial-scale=1.0\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"./style.css\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"popup-content\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"button beast\"</span>&gt;</span>Frog<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"button reset\"</span>&gt;</span>Reset<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"button reget\"</span>&gt;</span>网页内容更改<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"title\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"title\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"请输入标题\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"error-content\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"hidden\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Can't beastify this web page.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Try a different page.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"./index.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>popup/index.js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">用CSS隐藏页面上的所有内容，拥有“beastify-image”类的元素除外。</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> hidePage = <span class=\"string\">`body &gt; :not(.beastify-image) &#123;</span></span><br><span class=\"line\"><span class=\"string\">  display: none;</span></span><br><span class=\"line\"><span class=\"string\">&#125;`</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> hidePage1 = <span class=\"string\">`div#container &gt; :not(.main) &#123;</span></span><br><span class=\"line\"><span class=\"string\">  display: none;</span></span><br><span class=\"line\"><span class=\"string\">&#125;;`</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">浏览器插件监听单击按钮,并将相应的消息发送到脚本的页面内容。</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">listenForClicks</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//监听器是重点(JS 精髓)</span></span><br><span class=\"line\"><span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">\"click\"</span>, (e) =&gt; &#123;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* 给定一个的名字，获取对应图像的URL.</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">beastNameToURL</span>(<span class=\"params\">beastName</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (beastName) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">case</span> <span class=\"string\">\"Frog\"</span>:</span><br><span class=\"line\">  <span class=\"keyword\">return</span> browser.extension.getURL(<span class=\"string\">\"../images/test.jpg\"</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">浏览器插件监听单击按钮,并将相应的消息发送到脚本的页面内容。</span></span><br><span class=\"line\"><span class=\"comment\">*插入隐藏页面的CSS到活动标签，然后获得野兽的URL和发送“beastify”消息到活动标签的内容脚本。</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">beastify</span>(<span class=\"params\">tabs</span>) </span>&#123;</span><br><span class=\"line\">  browser.tabs.insertCSS(&#123;<span class=\"attr\">code</span>: hidePage&#125;).then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> url = beastNameToURL(e.target.textContent);</span><br><span class=\"line\">    browser.tabs.sendMessage(tabs[<span class=\"number\">0</span>].id, &#123;</span><br><span class=\"line\">    command: <span class=\"string\">\"beastify\"</span>,</span><br><span class=\"line\">    beastURL: url</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">发送一个“重置”消息到活动标签的内容脚本,将删除页面隐藏CSS从活动标签，</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reset</span>(<span class=\"params\">tabs</span>) </span>&#123;</span><br><span class=\"line\">  browser.tabs.removeCSS(&#123;<span class=\"attr\">code</span>: hidePage&#125;).then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    browser.tabs.sendMessage(tabs[<span class=\"number\">0</span>].id, &#123;</span><br><span class=\"line\">    command: <span class=\"string\">\"reset\"</span>,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* 自定义get方法设置网站标题 */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reget</span>(<span class=\"params\">tabs</span>)</span>&#123;</span><br><span class=\"line\">  browser.tabs.removeCSS(&#123;<span class=\"attr\">code</span>: hidePage&#125;).then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> context = <span class=\"string\">\"测试测试\"</span>;</span><br><span class=\"line\">    browser.tabs.sendMessage(tabs[<span class=\"number\">0</span>].id, &#123;</span><br><span class=\"line\">    command: <span class=\"string\">\"reget\"</span>,</span><br><span class=\"line\">    title: context</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* 只需将错误记录到控制台。</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reportError</span>(<span class=\"params\">error</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.error(<span class=\"string\">`[Error]: <span class=\"subst\">$&#123;error&#125;</span>`</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">*获取活动标签，然后调用“beastify()”或“reset()”或者reget()方法。</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (e.target.classList.contains(<span class=\"string\">\"beast\"</span>)) &#123;</span><br><span class=\"line\">  browser.tabs.query(&#123;<span class=\"attr\">active</span>: <span class=\"literal\">true</span>, <span class=\"attr\">currentWindow</span>: <span class=\"literal\">true</span>&#125;)</span><br><span class=\"line\">  .then(beastify)</span><br><span class=\"line\">  .catch(reportError);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (e.target.classList.contains(<span class=\"string\">\"reset\"</span>)) &#123;</span><br><span class=\"line\">  browser.tabs.query(&#123;<span class=\"attr\">active</span>: <span class=\"literal\">true</span>, <span class=\"attr\">currentWindow</span>: <span class=\"literal\">true</span>&#125;)</span><br><span class=\"line\">  .then(reset)</span><br><span class=\"line\">  .catch(reportError);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (e.target.classList.contains(<span class=\"string\">\"reget\"</span>)) &#123;</span><br><span class=\"line\">  browser.tabs.query(&#123;<span class=\"attr\">active</span>: <span class=\"literal\">true</span>, <span class=\"attr\">currentWindow</span>: <span class=\"literal\">true</span>&#125;)</span><br><span class=\"line\">  .then(reget)</span><br><span class=\"line\">  .catch(reportError);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">执行脚本时出错。</span></span><br><span class=\"line\"><span class=\"comment\">*显示弹出窗口的错误信息，隐藏正常UI。</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reportExecuteScriptError</span>(<span class=\"params\">error</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">\"#popup-content\"</span>).classList.add(<span class=\"string\">\"hidden\"</span>);</span><br><span class=\"line\">  <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">\"#error-content\"</span>).classList.remove(<span class=\"string\">\"hidden\"</span>);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.error(<span class=\"string\">`Failed to execute beastify content script: <span class=\"subst\">$&#123;error.message&#125;</span>`</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">*当弹出窗口加载时，将内容脚本注入活动标签页，</span></span><br><span class=\"line\"><span class=\"comment\">*并添加一个单击处理程序。</span></span><br><span class=\"line\"><span class=\"comment\">*如果我们不能注入脚本，处理错误。</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\">browser.tabs.executeScript(&#123;<span class=\"attr\">file</span>: <span class=\"string\">\"/main.js\"</span>&#125;)</span><br><span class=\"line\">.then(listenForClicks)</span><br><span class=\"line\">.catch(reportExecuteScriptError);</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>main.js</p>\n</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">\"use strict\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   *检查并设置一个全局保护变量。</span></span><br><span class=\"line\"><span class=\"comment\">   *如果该内容脚本再次注入到同一页面，(下次它什么也做不了。)</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.hasRun) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.hasRun = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *给一个野兽图片的URL，删除所有现有的野兽，然后</span></span><br><span class=\"line\"><span class=\"comment\">创建和样式的IMG节点指向</span></span><br><span class=\"line\"><span class=\"comment\">*该图像，然后插入节点到文档中。</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">insertBeast</span>(<span class=\"params\">beastURL</span>) </span>&#123;</span><br><span class=\"line\">    removeExistingBeasts();</span><br><span class=\"line\">    <span class=\"keyword\">let</span> beastImage = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"img\"</span>);</span><br><span class=\"line\">    beastImage.setAttribute(<span class=\"string\">\"src\"</span>, beastURL);</span><br><span class=\"line\">    beastImage.style.height = <span class=\"string\">\"100vh\"</span>;</span><br><span class=\"line\">    beastImage.className = <span class=\"string\">\"beastify-image\"</span>;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild(beastImage);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   *从页面上删除所有野兽。</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">removeExistingBeasts</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> existingBeasts = <span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">\".beastify-image\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> beast <span class=\"keyword\">of</span> existingBeasts) &#123;</span><br><span class=\"line\">      beast.remove();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 自定义方法</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">settingTitle</span>(<span class=\"params\">title</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">document</span>.getElementsByTagName(<span class=\"string\">\"title\"</span>)[<span class=\"number\">0</span>].innerText=<span class=\"string\">\"网页修改测试\"</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 监听来自后台脚本的消息，调用“beastify()”或“reset()”</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\">  browser.runtime.onMessage.addListener(<span class=\"function\">(<span class=\"params\">message</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (message.command === <span class=\"string\">\"beastify\"</span>) &#123;</span><br><span class=\"line\">      insertBeast(message.beastURL);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (message.command === <span class=\"string\">\"reset\"</span>) &#123;</span><br><span class=\"line\">      removeExistingBeasts();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (message.command === <span class=\"string\">\"reget\"</span>) &#123;</span><br><span class=\"line\">      settingTitle(message.title)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n<hr>\n<h4 id=\"0x03-扩展API记录\"><a href=\"#0x03-扩展API记录\" class=\"headerlink\" title=\"0x03 扩展API记录\"></a>0x03 扩展API记录</h4><h5 id=\"extension\"><a href=\"#extension\" class=\"headerlink\" title=\"extension\"></a>extension</h5><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.返回资源给对象</span></span><br><span class=\"line\">browser.extension.getURL(<span class=\"string\">\"beasts/frog.jpg\"</span>);</span><br></pre></td></tr></table></figure>\n<p><br/></p>\n<h5 id=\"runtime\"><a href=\"#runtime\" class=\"headerlink\" title=\"runtime\"></a>runtime</h5><p><strong>Function</strong></p>\n<ul>\n<li>1.browser.runtime.onMessage: 监听监听来自弹出窗的信息即接收Tabs发送的Message信息并根据所发送的信息进行判断;<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//addListener() 监听</span></span><br><span class=\"line\">browser.runtime.onMessage.addListener(<span class=\"function\">(<span class=\"params\">message</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (message.command === <span class=\"string\">\"beastify\"</span>) &#123;</span><br><span class=\"line\">      insertBeast(message.beastURL);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (message.command === <span class=\"string\">\"reset\"</span>) &#123;</span><br><span class=\"line\">      removeExistingBeasts();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h5 id=\"tabs\"><a href=\"#tabs\" class=\"headerlink\" title=\"tabs\"></a>tabs</h5><p>描述:该Webextend API与浏览器标签系统进行交互。你可以使用该API获取一个已打开标签的列表并且使用各种标准过滤标签，并进行 打开， 刷新，移动，重载，移除操作;</p>\n<p>该API不能直接访问标签中的主机内容，但是你可以使用 tabs.executeScript() 或者 tabs.insertCSS() APIs，来插入javascript和CSS。</p>\n<p>参考地址:<a href=\"https://developer.mozilla.org/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/tabs\" target=\"_blank\" rel=\"noopener\">https://developer.mozilla.org/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/tabs</a></p>\n<p>基础引入:<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// # manifest.json</span><br><span class=\"line\">\"permissions\": [\"tabs\"]</span><br><span class=\"line\">\"permissions\": [\"*://developer.mozilla.org/*\", \"tabs\"]</span><br></pre></td></tr></table></figure></p>\n<p><strong>Enums Value:</strong></p>\n<ul>\n<li>tabs.Tab : 该值包含了一个标签的信息 如 Tab.url, Tab.title, Tab.favIconUrl;<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">logTabs</span>(<span class=\"params\">tabs</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> tab <span class=\"keyword\">of</span> tabs) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(tab.url);   <span class=\"comment\">// tab.url requires the `tabs` permission</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> querying = browser.tabs.query(&#123;&#125;);</span><br><span class=\"line\">querying.then(logTabs, onError);</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<p><strong>Function:</strong></p>\n<ul>\n<li>1.browser.tabs.executeScript():要弹出窗加载完 popup scrpit 就会使用该API在活跃标签页执行 content script，如果执行 content scrpit成功，content script会在页面中一直保持，直到标签被关闭或者用户导航到其他页面；<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">browser.tabs.executeScript(&#123;<span class=\"attr\">file</span>: <span class=\"string\">\"/content_scripts/beastify.js\"</span>&#125;) <span class=\"comment\">// 调用执行内容脚本</span></span><br><span class=\"line\">.then(listenForClicks)            <span class=\"comment\">//#如果成功执行就会调用 listenForClicks()。</span></span><br><span class=\"line\">.catch(reportExecuteScriptError); <span class=\"comment\">//#如果调用失败就会调用 reportExecuteScriptError()方法，然后隐藏\"popup-content\" &lt;div&gt;，并展示\"error-content\" &lt;div&gt;, 然后打印一个错误到控制台。</span></span><br></pre></td></tr></table></figure></li>\n<li>2.browser.tabs.insertCSS() : 向页面插入CSS样式<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// # CSS 过滤器</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> hidePage = <span class=\"string\">`body &gt; :not(.beastify-image) &#123;</span></span><br><span class=\"line\"><span class=\"string\">                  display: none;</span></span><br><span class=\"line\"><span class=\"string\">                  &#125;`</span>;</span><br><span class=\"line\">browser.tabs.insertCSS(</span><br><span class=\"line\">  &#123;<span class=\"attr\">code</span>: hidePage&#125;).then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> </span><br><span class=\"line\">  ..... <span class=\"comment\">//# js ES6</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li>3.browser.tabs.removeCSS(): API 向页面移除某CSS样式</li>\n<li>4.browser.tabs.sendMessage(): API 向 content script 发送“retrunValue”信息，这个消息将被content scripts中 <code>runtime.onMessage</code> 事件的所有监听者收到，然后它们可以选择通过使用 <code>sendResponse</code> 这个方法<code>发送一个response到background scripts</code>。<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">browser.tabs.removeCSS(&#123;<span class=\"attr\">code</span>: hidePage&#125;).then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">        browser.tabs.sendMessage(tabs[<span class=\"number\">0</span>].id, &#123;</span><br><span class=\"line\">          command: <span class=\"string\">\"reset\"</span>,</span><br><span class=\"line\">          retrunValue: <span class=\"string\">\"返回值给内容脚本\"</span>,  <span class=\"comment\">//可以返回文本或者json</span></span><br><span class=\"line\">          &#123;<span class=\"attr\">greeting</span>: <span class=\"string\">\"Hi from background script\"</span>&#125;</span><br><span class=\"line\">        &#125;.then(<span class=\"function\"><span class=\"params\">response</span> =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Message from the content script:\"</span>);</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(response.response); <span class=\"comment\">//来之内容脚本:Promise.resolve(&#123;response: \"Hi from content script\"&#125;);</span></span><br><span class=\"line\">          &#125;).catch(onError);  <span class=\"comment\">//异常捕捉</span></span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><ol start=\"5\">\n<li>browser.tabs.query():获取所有包含指定属性的标签，如果没有属性则获取所有标签。<br><code>js\n// # 选项卡在其窗口中是否处于活动状态。\n// # 选项卡是否在当前窗口中\n// # 父窗口或窗口的id。当前窗口的WINDOW_ID_CURRENT。\nbrowser.tabs.query({active: true, currentWindow: true})\n.then(beastify)\n.catch(reportError);</code><a href=\"https://developer.mozilla.org/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/tabs/query\" target=\"_blank\" rel=\"noopener\">https://developer.mozilla.org/zh-CN/docs/Mozilla/Add-ons/WebExtensions/API/tabs/query</a></li>\n</ol>\n</li>\n</ul>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"BrowserExtension","path":"api/categories/BrowserExtension.json"}],"tags":[{"name":"firefox","path":"api/tags/firefox.json"}]}