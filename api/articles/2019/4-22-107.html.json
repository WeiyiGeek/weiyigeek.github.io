{"title":"Linux下Email安装配置与发信","slug":"系统运维/Application/Email/Linux下Email安装配置与发信","date":"2019-04-22T11:35:30.000Z","updated":"2022-03-29T05:39:06.309Z","url":"2019/4-22-107.html","path":"api/articles/2019/4-22-107.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190423224610.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"1-email-邮件命令\"><a href=\"#1-email-邮件命令\" class=\"headerlink\" title=\"1. email 邮件命令\"></a>1. email 邮件命令</h4><p>CentOS/RHEL安装命令：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install mailx</span><br></pre></td></tr></table></figure></p>\n<p><strong>mail 配置：</strong><br>vim /etc/mail.rc<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#配置参数</span><br><span class=\"line\">from: 对方收到邮件时显示的发件人</span><br><span class=\"line\">smtp: 指定第三方发送邮件的smtp服务器地址</span><br><span class=\"line\">smtp-auth: SMTP的认证方式。默认是LOGIN，也可改为CRAM-MD5或PLAIN方式</span><br><span class=\"line\">smtp-auth-user: 第三方发邮件的用户名</span><br><span class=\"line\">smtp-auth-password: 用户名对应密码</span><br><span class=\"line\"></span><br><span class=\"line\">#配置详情</span><br><span class=\"line\">set from&#x3D;&quot;12123@qq.com&quot; </span><br><span class=\"line\">set smtp&#x3D;&quot;smtp.qq.com&quot;</span><br><span class=\"line\">set smtp-auth-user&#x3D;&quot;12123@qq.com&quot; </span><br><span class=\"line\">set smtp-auth-password&#x3D;&quot;aawbubhyfhuucbdd&quot;</span><br><span class=\"line\">set smtp-auth&#x3D;login</span><br></pre></td></tr></table></figure></p>\n<p><strong>mail 命令：</strong><br>mail –h<br>-s &lt;邮件主题&gt;：指定邮件的主题；<br>-c &lt;地址&gt;：添加邮件抄送人，多个人时用逗号隔开；<br>-b &lt;地址&gt;：添加邮件暗送人；<br>-a &lt;附件&gt;: 添加附件。<br>注：部分系统参数稍有差异，最好看帮助</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 语法：</span></span><br><span class=\"line\">mail -s <span class=\"string\">\"主题\"</span>  收件地址                       <span class=\"comment\"># 无邮件正文</span></span><br><span class=\"line\">mail -s <span class=\"string\">\"主题\"</span>  收件地址&lt; 文件(邮件正文.txt)   <span class=\"comment\"># 有邮件正文</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"邮件正文\"</span> | mail -s 邮件主题  收件地址</span><br><span class=\"line\">cat 邮件正文.txt | mail -s 邮件主题  收件地址</span><br><span class=\"line\">mail -s <span class=\"string\">\"主题\"</span> -a 附件 收件地址 &lt; 文件(邮件正文.txt) <span class=\"comment\"># 带附件</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#案例：</span></span><br><span class=\"line\">% mail -s <span class=\"string\">\"测试\"</span>  12123@foxmail.com</span><br><span class=\"line\">% mail -s <span class=\"string\">\"邮件主题\"</span>  12123@foxmail.com &lt; /data/findyou.txt</span><br><span class=\"line\">% <span class=\"built_in\">echo</span> <span class=\"string\">\"邮件正文内容\"</span> | mail -s <span class=\"string\">\"邮件主题\"</span>  291238737@qq.com</span><br><span class=\"line\">% cat  /data/findyou.txt | mail -s <span class=\"string\">\"邮件主题\"</span>  12123@foxmail.com</span><br><span class=\"line\">% mail -s <span class=\"string\">\"邮件主题\"</span>  -a /data/findyou.tar.gz  12123@foxmail.com  &lt; /data/findyou.txt  <span class=\"comment\">#注意发信地址放在后面</span></span><br><span class=\"line\"></span><br><span class=\"line\">[root@WeiyiGeek ~]$ <span class=\"built_in\">echo</span> <span class=\"string\">\"邮件正文内容\"</span> | mail -s <span class=\"string\">\"mail测试发信\"</span>  291828737@qq.com</span><br><span class=\"line\">[root@WeiyiGeek ~]$ <span class=\"built_in\">echo</span> <span class=\"string\">\"test test\"</span> | mail -s <span class=\"string\">\"测试附件\"</span> -a <span class=\"string\">\"/var/log/yum.log\"</span> 291828737@qq.com</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190423224610.png\" alt=\"WeiyiGeek.测试发信\" title=\"\" class=\"\">\n                <p>WeiyiGeek.测试发信</p>\n            </figure>\n<p>脚本：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">help</span></span>()&#123;</span><br><span class=\"line\">   <span class=\"built_in\">echo</span> <span class=\"string\">\"eg: <span class=\"variable\">$0</span> [Subject] [address] [content_file] [file]\"</span></span><br><span class=\"line\">   <span class=\"built_in\">echo</span> <span class=\"string\">\"\"</span></span><br><span class=\"line\">   <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! -n <span class=\"string\">\"<span class=\"variable\">$1</span>\"</span> ] ; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">help</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">cDate=`date +%Y%m%d`</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! -n <span class=\"string\">\"<span class=\"variable\">$2</span>\"</span> ] ; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">help</span></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">    mail_to=<span class=\"variable\">$2</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"      Send Mail to <span class=\"variable\">$&#123;mail_to&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! -n <span class=\"string\">\"<span class=\"variable\">$4</span>\"</span> ] ; <span class=\"keyword\">then</span></span><br><span class=\"line\">    mail -s <span class=\"variable\">$1</span> <span class=\"variable\">$&#123;mail_to&#125;</span>&lt;<span class=\"variable\">$3</span></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">    mail -s <span class=\"variable\">$1</span> -a <span class=\"variable\">$4</span> <span class=\"variable\">$&#123;mail_to&#125;</span>&lt;<span class=\"variable\">$3</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">[root@123]$ ./sendmail.sh  <span class=\"built_in\">test</span>  xxxx@qq.com  abc.txt</span><br><span class=\"line\">Send Mail to xxx@qq.com</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h4 id=\"F-amp-Q\"><a href=\"#F-amp-Q\" class=\"headerlink\" title=\"F&amp;Q\"></a>F&amp;Q</h4><p>邮件服务启动:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl status postfix</span><br></pre></td></tr></table></figure></p>\n<p><em>问题1:sendmail重启报libmysqlclient.so.18不存在</em><br>问题描述:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sendmail restart</span><br><span class=\"line\">sendmail: error <span class=\"keyword\">while</span> loading shared libraries: libmysqlclient.so.18: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure><br>问题原因:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@node2 ld.so.conf.d]<span class=\"comment\"># ldd /usr/sbin/sendmail</span></span><br><span class=\"line\">    linux-vdso.so.1 =&gt;  (0x00007ffce43fa000)</span><br><span class=\"line\">    libldap-2.4.so.2 =&gt; /lib64/libldap-2.4.so.2 (0x00007f97fc570000)</span><br><span class=\"line\">    liblber-2.4.so.2 =&gt; /lib64/liblber-2.4.so.2 (0x00007f97fc361000)</span><br><span class=\"line\">    libpcre.so.1 =&gt; /lib64/libpcre.so.1 (0x00007f97fc0ff000)</span><br><span class=\"line\">    libmysqlclient.so.18 =&gt; not found  <span class=\"comment\">#发现缺少该库</span></span><br></pre></td></tr></table></figure><br>问题解决:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#下载该动态链接库和重新刷新加载lib</span></span><br><span class=\"line\">sudo wget -O /usr/lib/libmysqlclient.so.18 http://files.directadmin.com/services/es_7.0_64/libmysqlclient.so.18</span><br><span class=\"line\"><span class=\"comment\">#echo \"/usr/lib/\" &gt;&gt;/etc/ld.so.conf</span></span><br><span class=\"line\">ldconfig</span><br></pre></td></tr></table></figure></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"应用安装","path":"api/categories/应用安装.json"}],"tags":[{"name":"Email","path":"api/tags/Email.json"}]}