{"title":"PS网络管理与配置常用命令","slug":"编程世界/Powershell/Cmdlet/网络管理类命令/PS命令之网络查看管理和配置","date":"2019-12-23T07:36:30.000Z","updated":"2021-07-20T15:11:38.495Z","url":"2019/12-23-546.html","path":"api/articles/2019/12-23-546.html.json","covers":null,"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h2 id=\"0x00-网络连接测试\"><a href=\"#0x00-网络连接测试\" class=\"headerlink\" title=\"0x00 网络连接测试\"></a>0x00 网络连接测试</h2><h3 id=\"Test-Connection-命令-向一台或多台计算机发送ICMP回显请求数据包或ping\"><a href=\"#Test-Connection-命令-向一台或多台计算机发送ICMP回显请求数据包或ping\" class=\"headerlink\" title=\"Test-Connection 命令 - 向一台或多台计算机发送ICMP回显请求数据包或ping\"></a>Test-Connection 命令 - 向一台或多台计算机发送ICMP回显请求数据包或ping</h3><p>描述:可以类比于cmd中的nbtstat明进行获取局域网中的指定计算机名的IPv4/6地址信息以及MAC地址;</p>\n<p><strong>基础语法:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS &gt; (Get-Command *-Connection).Name</span><br><span class=\"line\">Test-Connection</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 语法</span></span><br><span class=\"line\">Test-Connection [-ComputerName] &lt;System.String[]&gt; [-AsJob] [-BufferSize &lt;System.Int32&gt;] [-Count &lt;System.Int32&gt;] [-DcomAuthentication &#123;Default | None | Connect | Call | Packet | PacketIntegrity | PacketPrivacy | Unchanged&#125;] [-Delay &lt;System.Int32&gt;] [-Impersonation &#123;Default | Anonymous | Identify | Impersonate | Delegate&#125;] [-Protocol &#123;DCOM | WSMan&#125;] [-ThrottleLimit &lt;System.Int32&gt;] [-TimeToLive &lt;System.Int32&gt;] [-WsmanAuthentication &#123;Default | Basic | Negotiate | CredSSP | Digest | Kerberos&#125;] [&lt;CommonParameters&gt;]</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p><strong>基础示例:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.获取本机计算机名相关信息</span></span><br><span class=\"line\">PS C:\\Users\\WeiyiGeek&gt; Test-Connection -ComputerName WeiyiGeek</span><br><span class=\"line\">  <span class=\"comment\"># Source        Destination     IPV4Address      IPV6Address                 Bytes    Time(ms)</span></span><br><span class=\"line\">  <span class=\"comment\"># ------        -----------     -----------      -----------                 -----    --------</span></span><br><span class=\"line\">  <span class=\"comment\"># WEIYIGEEK     WeiyiGeek       10.10.10.107    fe80:::fe6c:10bf:4244%15         32       0</span></span><br><span class=\"line\"><span class=\"comment\"># 获取指定的计算机名称相关信息  </span></span><br><span class=\"line\">Test-Connection -ComputerName Server01, Server02, Server12</span><br><span class=\"line\">  <span class=\"comment\"># Source        Destination     IPV4Address      IPV6Address                              Bytes    Time(ms)</span></span><br><span class=\"line\">  <span class=\"comment\"># ------        -----------     -----------      -----------                              -----    --------</span></span><br><span class=\"line\">  <span class=\"comment\"># WEIYIGEEK     Server01         10.20.172.102    fe80::f5d4:6342:8038:f1b9%12             32       0</span></span><br><span class=\"line\">  <span class=\"comment\"># WEIYIGEEK     Server01         10.20.172.102    fe80::f5d4:6342:8038:f1b9%12             32       1</span></span><br><span class=\"line\">  <span class=\"comment\"># WEIYIGEEK     Server01         10.20.172.102    fe80::f5d4:6342:8038:f1b9%12             32       0</span></span><br><span class=\"line\">  <span class=\"comment\"># WEIYIGEEK     Server01         10.20.172.102    fe80::f5d4:6342:8038:f1b9%12             32       0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.测试连接指定IP地址信息</span></span><br><span class=\"line\">Test-Connection 10.20.172.106</span><br><span class=\"line\">  <span class=\"comment\"># Source        Destination     IPV4Address      IPV6Address                              Bytes    Time(ms)</span></span><br><span class=\"line\">  <span class=\"comment\"># ------        -----------     -----------      -----------                              -----    --------</span></span><br><span class=\"line\">  <span class=\"comment\"># WEIYIGEEK     10.10.10.107    10.10.10.107    fe80::88cc:5b4:9dde:3e4d%12              32       1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.从多台计算机向一台计算机发送回显请求</span></span><br><span class=\"line\">Test-Connection -Source Server02, Server12, localhost -ComputerName Server01 -Credential Domain01\\Admin01</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4.使用参数自定义测试命令(发送 256 字节, 32字节 节流阀)</span></span><br><span class=\"line\">Test-Connection -ComputerName WeiyiGeek -Count 3 -Delay 2 -TTL 255 -BufferSize 256 -ThrottleLimit 32</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5.ComputerName参数的值是一个“Get Content”命令，它从`服务器.txt文件“”。该命令使用AsJob参数将命令作为后台作业运行，并将作业保存在“$job”变量中。</span></span><br><span class=\"line\"><span class=\"variable\">$job</span> = Test-Connection -ComputerName (Get-Content Servers.txt) -AsJob</span><br><span class=\"line\"><span class=\"comment\"># “if”命令检查作业是否仍在运行。如果作业没有运行，“Receive job”获取结果并将其存储在“$results”变量中。</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"variable\">$job</span>.JobStateInfo.State -ne <span class=\"string\">\"Running\"</span>) &#123;<span class=\"variable\">$Results</span> = Receive-Job <span class=\"variable\">$job</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\"># 6.用凭据Ping远程计算机</span></span><br><span class=\"line\"><span class=\"comment\"># 该命令使用Credential参数指定有权ping远程计算机的用户帐户，并使用Impersonation参数更改要标识的模拟级别。</span></span><br><span class=\"line\">Test-Connection Server55 -Credential Domain55\\User01 -Impersonation Identify</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 7.仅当连接测试成功时才创建会话</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (Test-Connection -ComputerName Server01 -Quiet) &#123;New-PSSession Server01&#125;</span><br></pre></td></tr></table></figure></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Development","path":"api/categories/Development.json"}],"tags":[{"name":"Powershell","path":"api/tags/Powershell.json"}]}