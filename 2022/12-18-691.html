<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ 23-Kubernetesä¹‹ä¼ä¸šè¿ç»´å®è·µæ“ä½œç¬”è®°|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="k8s">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9134434519967436" crossorigin="anonymous"></script>    
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/2018/1-1-1.html"  >
                <i class="icon icon-lg icon-mortar-board"></i>
                å­¦ä¹ ä¹‹è·¯
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/sites"  >
                <i class="icon icon-lg icon-globe"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="/img/video-account.jpg" target="_blank" >
                <i class="icon icon-lg icon-video-camera"></i>
                è§†é¢‘å·
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                å‹æƒ…é“¾æ¥
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>23-Kubernetesä¹‹ä¼ä¸šè¿ç»´å®è·µæ“ä½œç¬”è®°</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">23-Kubernetesä¹‹ä¼ä¸šè¿ç»´å®è·µæ“ä½œç¬”è®°</h1>
        <h5 class="subtitle">
            
                <time datetime="2022-12-18T02:37:47.000Z" itemprop="datePublished" class="page-time">
  2022-12-18
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/OperationTools/">OperationTools</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap" style="display: none;">
  <article id="post-è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/23-Kubernetesæ‰©å±•å­¦ä¹ å®è·µç¬”è®°"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">23-Kubernetesä¹‹ä¼ä¸šè¿ç»´å®è·µæ“ä½œç¬”è®°</h1>
        <div class="post-meta">
            <time class="post-time" title="2022-12-18 10:37:47" datetime="2022-12-18T02:37:47.000Z"  itemprop="datePublished">2022-12-18</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/OperationTools/">OperationTools</a></li></ul></li></ul>



            

            


            
        </div>
        <span class="post-href" style="display: none;">|</span> 
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h2 id="0x00-å®æ“1-è®°ä¸€æ¬¡-Kubernetes-V1-23-x-é›†ç¾¤è¯ä¹¦è¿‡æœŸæˆ–è€…å»¶æœŸå¤„ç†æ“ä½œå®è·µæ¡ˆä¾‹"><a href="#0x00-å®æ“1-è®°ä¸€æ¬¡-Kubernetes-V1-23-x-é›†ç¾¤è¯ä¹¦è¿‡æœŸæˆ–è€…å»¶æœŸå¤„ç†æ“ä½œå®è·µæ¡ˆä¾‹" class="headerlink" title="0x00 å®æ“1.è®°ä¸€æ¬¡ Kubernetes V1.23.x é›†ç¾¤è¯ä¹¦è¿‡æœŸæˆ–è€…å»¶æœŸå¤„ç†æ“ä½œå®è·µæ¡ˆä¾‹"></a>0x00 å®æ“1.è®°ä¸€æ¬¡ Kubernetes V1.23.x é›†ç¾¤è¯ä¹¦è¿‡æœŸæˆ–è€…å»¶æœŸå¤„ç†æ“ä½œå®è·µæ¡ˆä¾‹</h2><p>æè¿°: ä¸‹è¿°æ“ä½œä¸»è¦ç”¨äºå¤„ç†K8Sè¯ä¹¦<code>å·²è¿‡æœŸ</code>æˆ–è€…<code>å³å°†è¿‡æœŸçš„kubernetesé›†ç¾¤</code>å®è·µæ¡ˆä¾‹ï¼Œå½“ç„¶ç½‘ä¸Šç™¾åº¦ã€CSDNï¼ˆæ¡åƒåœ¾ï¼‰å¤§å¤šæ•°æ–¹æ³•å‡æ˜¯ä¸€çŸ¥åŠè§£ï¼Œä¸åŒçš„K8Sç‰ˆæœ¬æ“ä½œæœ‰äº›è®¸ä¸åŒï¼Œè‹¥å…¨éƒ¨æŒ‰ç…§å…¶æ“ä½œï¼Œæœ‰å¯èƒ½ä½ éœ€è¦é‡å»ºK8Säº†ï¼Œåˆ«é—®æˆ‘æ€ä¹ˆçŸ¥é“çš„ï¼Œå› ä¸ºæˆ‘è¸©è¿‡å‘( Ä¬ ^ Ä¬ )ï¼Œæ‰€ä»¥å»ºè®®åœ¨é‡åˆ°é—®é¢˜æ—¶å…ˆæŸ¥è¯¢K8Så®˜æ–¹æ–‡æ¡£ã€‚</p>
<h3 id="1-å‰è¨€ç®€è¿°"><a href="#1-å‰è¨€ç®€è¿°" class="headerlink" title="1.å‰è¨€ç®€è¿°"></a>1.å‰è¨€ç®€è¿°</h3><p>åœ¨å¹´åä¸Šç­çš„ç¬¬ä¸€å¤©ï¼Œæˆ‘åƒå¾€å¸¸ä¸€æ ·ï¼Œç™»å½•åˆ°K8Sé›†ç¾¤ä¹‹ä¸­ä¾æ¬¡æ£€æŸ¥åº”ç”¨ï¼Œåœ¨æ£€æŸ¥å¼€å‘æµ‹è¯•ç¯å¢ƒçš„k8sé›†ç¾¤æ—¶ï¼Œå‘ç°æ‰§è¡Œkubectlå‘½ä»¤æŠ¥è¯ä¹¦è¿‡æœŸé”™è¯¯ï¼Œé¡¿æ—¶å¿ƒæƒ…éƒ½ä¸å¥½äº†ï¼Œå´ä¹Ÿæ— å¯å¥ˆä½•ï¼Œåªèƒ½è¿›è¡Œè¯ä¹¦ç»­ç­¾äº†ï¼Œç”±äºæ˜¯é«˜å¯ç”¨é›†ç¾¤é‡åˆ°äº†è®¸å¤šå‘ï¼Œä¸ºäº†æ–¹ä¾¿è‡ªå·±ä»¥åŠå¹¿å¤§çš„è¿ç»´å·¥ä½œè€…ï¼Œè§£å†³ç›¸å…³é—®é¢˜ï¼Œé‚æ•´ç†äº†æ­¤ç¯‡æ–‡ç« ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿æ¥ Api-server å¤±è´¥ï¼ŒæŠ¥è¯ä¹¦å·²è¿‡æœŸä¸å¯ç”¨ã€‚</span></span><br><span class="line">$ kubectl get node,pod</span><br><span class="line">Unable to connect to the server: x509: certificate has expired or is not yet valid: current time 2023-01-31T16:55:27+08:00 is after 2023-01-16T04:47:34Z</span><br></pre></td></tr></table></figure>
<p><br/></p>
<h3 id="2-å®è·µç¯å¢ƒ"><a href="#2-å®è·µç¯å¢ƒ" class="headerlink" title="2.å®è·µç¯å¢ƒ"></a>2.å®è·µç¯å¢ƒ</h3><p><strong>é›†ç¾¤ç‰ˆæœ¬åŠå…¶èŠ‚ç‚¹æè¿°:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é›†ç¾¤ç‰ˆæœ¬</span></span><br><span class="line">$ kubeadm version</span><br><span class="line">kubeadm version: &amp;version.Info&#123;Major:<span class="string">"1"</span>, Minor:<span class="string">"23"</span>, GitVersion:<span class="string">"v1.23.1"</span>, GitCommit:<span class="string">"86ec240af8cbd1b60bcc4c03c20da9b98005b92e"</span>, GitTreeState:<span class="string">"clean"</span>, BuildDate:<span class="string">"2021-12-16T11:39:51Z"</span>, GoVersion:<span class="string">"go1.17.5"</span>, Compiler:<span class="string">"gc"</span>, Platform:<span class="string">"linux/amd64"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># é›†ç¾¤èŠ‚ç‚¹</span></span><br><span class="line">$ data -s <span class="string">"2023-01-01"</span></span><br><span class="line">$ kubectl get node</span><br><span class="line">NAME       STATUS   ROLES                  AGE    VERSION</span><br><span class="line">weiyigeek-107   Ready    control-plane,master   381d   v1.23.1</span><br><span class="line">weiyigeek-108   Ready    control-plane,master   380d   v1.23.1</span><br><span class="line">weiyigeek-109   Ready    control-plane,master   380d   v1.23.1</span><br><span class="line">weiyigeek-223   Ready    work                   380d   v1.23.1</span><br><span class="line">weiyigeek-224   Ready    work                   380d   v1.23.1</span><br><span class="line">weiyigeek-225   Ready    work                   381d   v1.23.1</span><br><span class="line">weiyigeek-226   Ready    work                   220d   v1.23.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®ºä¿å­˜è¿‡ç¨‹é…ç½®æ–‡ä»¶çš„é‡è¦æ€§ï¼Œåœ¨æ­å»ºk8sé›†ç¾¤æ—¶å»ºè®®å¤‡ä»½èµ„æºæ¸…å•ã€‚</span></span><br><span class="line">kubectl -n kube-system get cm kubeadm-config -o yaml &gt; kubeadm-config-v1.23.1.yaml</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="3-è¯ä¹¦ç»­ç­¾"><a href="#3-è¯ä¹¦ç»­ç­¾" class="headerlink" title="3.è¯ä¹¦ç»­ç­¾"></a>3.è¯ä¹¦ç»­ç­¾</h3><p><strong>é«˜å¯ç”¨K8Sé›†ç¾¤ï¼Œè¯ä¹¦ç»­ç­¾æ“ä½œæµç¨‹æ­¥éª¤å¦‚ä¸‹:</strong><br>0.åœ¨è¿›è¡Œæ“ä½œå‰ä¸€å®šè¦è¿›è¡Œå¤‡ä»½ï¼Œä¾¿äºå›é€€å¤„ç†ï¼Œæ­¤å¤„æˆ‘åœ¨ä¸‰å°masterèŠ‚ç‚¹ä¹‹ä¸€çš„<code>weiyigeek-107</code>æœºå™¨ä¸Šæ“ä½œï¼Œåç»­é»˜è®¤ä¹Ÿåœ¨æ­¤æœºå™¨ä¸Šæ“ä½œï¼Œè‹¥éœ€åœ¨å…¶ä»–æœºå™¨ä¸Šæ“ä½œæˆ‘ä¼šè¿›è¡Œè¯´æ˜<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¤‡ä»½æ—§çš„é…ç½®æ–‡ä»¶ã€‚</span></span><br><span class="line">cp -a /etc/kubernetes&#123;,.bak&#125;</span><br><span class="line">cp -a /var/lib/kubelet&#123;,.bak&#125;</span><br><span class="line">cp -a /var/lib/etcd /var/lib/etcd.bak</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤‡ä»½é›†ç¾¤é…ç½® (å½“è¯ä¹¦åˆ°æœŸæ—¶æ˜¯æ— æ³•æ‰§è¡Œçš„æ­¤æ­¥éª¤å¯è·³è¿‡)ä½†å¯ä»¥åˆ©ç”¨dateå‘½ä»¤å°†ç³»ç»Ÿæ—¶é—´è®¾ç½®åˆ°è¿‡æœŸå‰ã€‚</span></span><br><span class="line">data -s <span class="string">"2023-01-01"</span> || timedatectl <span class="built_in">set</span>-time <span class="string">"2023-01-01"</span></span><br><span class="line">kubectl -n kube-system get cm kubeadm-config -o yaml &gt; kubeadm-init-config.yaml     <span class="comment"># åç»­ä¼šç”¨åˆ°æ­¤åŸå§‹é…ç½®æ–‡ä»¶ã€‚</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>1.ä½¿ç”¨opensslå‘½ä»¤æŸ¥è¯¢å•ä¸ªè¯ä¹¦å¯ç”¨æ—¶é—´åŠå…¶ç›¸å…³ä¿¡æ¯<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># k8s é›†ç¾¤çš„ ca.crt è¯ä¹¦æœ‰æ•ˆæœŸä¸º åå¹´</span></span><br><span class="line"><span class="comment"># k8s é›†ç¾¤çš„ apiserver.crt ã€kubelet.crtã€etcd.crt è¯ä¹¦é»˜è®¤æœ‰æ•ˆæœŸä¸º ä¸€å¹´ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥è‡ªè¡Œä¿®æ”¹ä¸ºåå¹´ï¼ˆåç»­æœ‰æ–‡ç« è¿›è¡Œè®²è§£ï¼‰</span></span><br><span class="line">$ <span class="keyword">for</span> i <span class="keyword">in</span> $(ls /etc/kubernetes/pki/*.crt /etc/kubernetes/pki/etcd/*.crt); <span class="keyword">do</span> <span class="built_in">echo</span> <span class="string">"===== <span class="variable">$i</span> ====="</span>; openssl x509 -<span class="keyword">in</span> <span class="variable">$i</span> -text -noout | grep -A 3 <span class="string">'Validity'</span> ; <span class="keyword">done</span></span><br><span class="line"><span class="comment"># for item in `find /etc/kubernetes/pki -maxdepth 2 -name "*.crt"`;do echo ======================$item===============;openssl x509 -in $item -text -noout| grep -A 3 Not;done</span></span><br><span class="line">===== /etc/kubernetes/pki/apiserver.crt =====</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Jan 15 10:42:56 2022 GMT  <span class="comment"># é¢å‘æ—¶é—´</span></span><br><span class="line">            Not After : Jan 15 10:42:57 2023 GMT  <span class="comment"># åˆ°æœŸæ—¶é—´</span></span><br><span class="line">        Subject: CN = kube-apiserver              <span class="comment"># é€šç”¨åç§°</span></span><br><span class="line">===== /etc/kubernetes/pki/apiserver-etcd-client.crt =====</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Jan 15 10:42:58 2022 GMT</span><br><span class="line">            Not After : Jan 15 10:42:59 2023 GMT</span><br><span class="line">        Subject: O = system:masters, CN = kube-apiserver-etcd-client</span><br><span class="line">===== /etc/kubernetes/pki/apiserver-kubelet-client.crt =====</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Jan 15 10:42:56 2022 GMT</span><br><span class="line">            Not After : Jan 15 10:42:57 2023 GMT</span><br><span class="line">        Subject: O = system:masters, CN = kube-apiserver-kubelet-client</span><br><span class="line">===== /etc/kubernetes/pki/ca.crt =====</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Jan 15 10:42:56 2022 GMT</span><br><span class="line">            Not After : Jan 13 10:42:56 2032 GMT</span><br><span class="line">        Subject: CN = kubernetes</span><br><span class="line">===== /etc/kubernetes/pki/etcd/ca.crt =====</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Jan 15 10:42:58 2022 GMT</span><br><span class="line">            Not After : Jan 13 10:42:58 2032 GMT</span><br><span class="line">        Subject: CN = etcd-ca</span><br><span class="line">===== /etc/kubernetes/pki/etcd/healthcheck-client.crt =====</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Jan 15 10:42:58 2022 GMT</span><br><span class="line">            Not After : Jan 15 10:42:59 2023 GMT</span><br><span class="line">        Subject: O = system:masters, CN = kube-etcd-healthcheck-client</span><br><span class="line">===== /etc/kubernetes/pki/etcd/peer.crt =====</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Jan 15 10:42:58 2022 GMT</span><br><span class="line">            Not After : Jan 15 10:42:59 2023 GMT</span><br><span class="line">        Subject: CN = weiyigeek-107</span><br><span class="line">===== /etc/kubernetes/pki/etcd/server.crt =====</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Jan 15 10:42:58 2022 GMT</span><br><span class="line">            Not After : Jan 15 10:42:59 2023 GMT</span><br><span class="line">        Subject: CN = weiyigeek-107</span><br><span class="line">===== /etc/kubernetes/pki/front-proxy-ca.crt =====</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Jan 15 10:42:58 2022 GMT</span><br><span class="line">            Not After : Jan 13 10:42:58 2032 GMT</span><br><span class="line">        Subject: CN = front-proxy-ca</span><br><span class="line">===== /etc/kubernetes/pki/front-proxy-client.crt =====</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Jan 15 10:42:58 2022 GMT</span><br><span class="line">            Not After : Jan 15 10:42:58 2023 GMT</span><br><span class="line">        Subject: CN = front-proxy-client</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>2.æŸ¥çœ‹å½“å‰é›†ç¾¤è¯ä¹¦ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…å«æ‰€æœ‰è¯ä¹¦åç§°ä»¥åŠè¯ä¹¦é¢å‘æœºæ„ã€åˆ°æœŸæ—¶é—´ç­‰, æ­¤å¤„å¯ä»¥çœ‹åˆ°å‡å·²ç»åˆ°æœŸã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ sudo kubeadm certs check-expiration</span><br><span class="line">  <span class="comment"># [check-expiration] Reading configuration from the cluster...</span></span><br><span class="line">  <span class="comment"># [check-expiration] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'</span></span><br><span class="line">  <span class="comment"># [check-expiration] Error reading configuration from the Cluster. Falling back to default configuration</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># CERTIFICATE                EXPIRES(è¿‡æœŸæ—¶é—´)         RESIDUAL TIME(å‰©ä½™æ—¶é—´)   CERTIFICATE AUTHORITY   EXTERNALLY MANAGED(æ˜¯å¦æ˜¯å¤–éƒ¨ç®¡ç†)</span></span><br><span class="line">  <span class="comment"># admin.conf                 Jan 15, 2023 10:43 UTC   &lt;invalid&gt;       ca                      no</span></span><br><span class="line">  <span class="comment"># apiserver                  Jan 15, 2023 10:42 UTC   &lt;invalid&gt;       ca                      no</span></span><br><span class="line">  <span class="comment"># apiserver-etcd-client      Jan 15, 2023 10:42 UTC   &lt;invalid&gt;       etcd-ca                 no</span></span><br><span class="line">  <span class="comment"># apiserver-kubelet-client   Jan 15, 2023 10:42 UTC   &lt;invalid&gt;       ca                      no</span></span><br><span class="line">  <span class="comment"># controller-manager.conf    Jan 15, 2023 10:43 UTC   &lt;invalid&gt;       ca                      no</span></span><br><span class="line">  <span class="comment"># etcd-healthcheck-client    Jan 15, 2023 10:42 UTC   &lt;invalid&gt;       etcd-ca                 no</span></span><br><span class="line">  <span class="comment"># etcd-peer                  Jan 15, 2023 10:42 UTC   &lt;invalid&gt;       etcd-ca                 no</span></span><br><span class="line">  <span class="comment"># etcd-server                Jan 15, 2023 10:42 UTC   &lt;invalid&gt;       etcd-ca                 no</span></span><br><span class="line">  <span class="comment"># front-proxy-client         Jan 15, 2023 10:42 UTC   &lt;invalid&gt;       front-proxy-ca          no</span></span><br><span class="line">  <span class="comment"># scheduler.conf             Jan 15, 2023 10:43 UTC   &lt;invalid&gt;       ca                      no</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># CERTIFICATE AUTHORITY   EXPIRES                  RESIDUAL TIME   EXTERNALLY MANAGED</span></span><br><span class="line">  <span class="comment"># ca                      Jan 13, 2032 10:42 UTC   8y              no</span></span><br><span class="line">  <span class="comment"># etcd-ca                 Jan 13, 2032 10:42 UTC   8y              no</span></span><br><span class="line">  <span class="comment"># front-proxy-ca          Jan 13, 2032 10:42 UTC   8y              no</span></span><br></pre></td></tr></table></figure></p>
<p>æ¸©é¦¨æç¤º: å¦‚æœ Etcd æ˜¯ç”±Kubeadmåˆ›å»ºå’Œæ‰˜ç®¡çš„æ­¤æ—¶ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼è¿›è¡Œè¯ä¹¦çš„ç»­æœŸ, å¦‚æœæ˜¯å¤–éƒ¨é«˜å¯ç”¨ç¯å¢ƒç®¡ç†éœ€è¦åˆ™æ‰‹åŠ¨è¿›è¡Œæ›´æ–°è¯ä¹¦é…ç½®;</p>
<p><br/></p>
<p>3.ä½¿ç”¨ certs çš„ renew å­å‘½ä»¤åˆ·æ–°é›†ç¾¤æ‰€æœ‰è¯ä¹¦çš„åˆ°æœŸæ—¶é—´è¿›è¡Œå†ç»­æœŸä¸€å¹´, æ­¤å¤„ â€“config å‚æ•°æŒ‡å®šçš„æ˜¯æˆ‘å½“åˆåˆ›å»ºé›†ç¾¤çš„åˆå§‹åŒ–é…ç½®æ¸…å•ï¼Œè‹¥æ²¡æœ‰å¯ä»¥å®‰è£…æ­¥éª¤0è¿›è¡Œç”Ÿæˆã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">~/.k8s$ sudo kubeadm certs renew all --config=./kubeadm-init-config.yaml</span><br><span class="line">  <span class="comment"># W1212 17:17:16.721037 1306627 configset.go:348] WARNING: kubeadm cannot validate component configs for API groups [kubelet.config.k8s.io kubeproxy.config.k8s.io]</span></span><br><span class="line">  <span class="comment"># certificate embedded in the kubeconfig file for the admin to use and for kubeadm itself renewed  # åµŒå…¥åœ¨kubeconfigæ–‡ä»¶ä¸­çš„è¯ä¹¦ï¼Œä¾›ç®¡ç†å‘˜ä½¿ç”¨ï¼Œå¹¶å¯¹kubeadmæœ¬èº«è¿›è¡Œæ›´æ–° (admin.conf )</span></span><br><span class="line">  <span class="comment"># certificate for serving the Kubernetes API renewed               # æ›´æ–°Kubernetes APIæœåŠ¡è¯ä¹¦</span></span><br><span class="line">  <span class="comment"># certificate the apiserver uses to access etcd renewed            # æœåŠ¡å™¨è®¿é—®etcdæ‰€ä½¿ç”¨çš„è¯ä¹¦å·²æ›´æ–°</span></span><br><span class="line">  <span class="comment"># certificate for the API server to connect to kubelet renewed     # APIæœåŠ¡å™¨è¿æ¥åˆ°kubeletçš„è¯ä¹¦å·²æ›´æ–°</span></span><br><span class="line">  <span class="comment"># certificate embedded in the kubeconfig file for the controller manager to use renewed  # è¯ä¹¦åµŒå…¥åœ¨kubeconfigæ–‡ä»¶ä¸­ï¼Œä¾›æ§åˆ¶å™¨ç®¡ç†å™¨ä½¿ç”¨æ›´æ–° (controller-manager.conf)</span></span><br><span class="line">  <span class="comment"># certificate for liveness probes to healthcheck etcd renewed        # å¥åº·æ£€æŸ¥etcdæ¿€æ´»æ¢é’ˆè¯ä¹¦ç»­æœŸ</span></span><br><span class="line">  <span class="comment"># certificate for etcd nodes to communicate with each other renewed  # ç”¨äºetcdèŠ‚ç‚¹ä¹‹é—´é€šä¿¡çš„è¯ä¹¦æ›´æ–°</span></span><br><span class="line">  <span class="comment"># certificate for serving etcd renewed                               # ç»­æœŸetcdâ€œæœåŠ¡è¯ä¹¦â€</span></span><br><span class="line">  <span class="comment"># certificate for the front proxy client renewed                     # å‰ä»£ç†å®¢æˆ·ç«¯çš„è¯ä¹¦æ›´æ–°</span></span><br><span class="line">  <span class="comment"># certificate embedded in the kubeconfig file for the scheduler manager to use renewed # è¯ä¹¦åµŒå…¥åœ¨kubeconfigæ–‡ä»¶ä¸­ï¼Œä¾›è°ƒåº¦å™¨ç®¡ç†å™¨ä½¿ç”¨æ›´æ–° (scheduler.conf  )</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è‹¥çœ‹åˆ°å·²å®Œæˆç»­è®¢è¯ä¹¦ï¼Œæ‚¨å¿…é¡»é‡æ–°å¯åŠ¨kube apiserverã€kubeæ§åˆ¶å™¨ç®¡ç†å™¨ã€kubeè°ƒåº¦å™¨ç­‰ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥ä½¿ç”¨æ–°è¯ä¹¦ï¼Œè¡¨ç¤ºè¯ä¹¦ç»­æœŸæˆåŠŸ</span></span><br><span class="line">Done renewing certificates. You must restart the kube-apiserver, kube-controller-manager, kube-scheduler and etcd, so that they can use the new certificates.</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥è¯ä¹¦ç»­ç­¾ä»¥åŠåˆ°æœŸæ—¶é—´</span></span><br><span class="line">~/.k8s$ kubeadm certs check-expiration</span><br><span class="line">  <span class="comment"># [check-expiration] Reading configuration from the cluster...</span></span><br><span class="line">  <span class="comment"># [check-expiration] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># CERTIFICATE                EXPIRES                  RESIDUAL TIME   CERTIFICATE AUTHORITY   EXTERNALLY MANAGED</span></span><br><span class="line">  <span class="comment"># admin.conf                 Jan 31, 2024 09:26 UTC   364d            ca                      no</span></span><br><span class="line">  <span class="comment"># apiserver                  Jan 31, 2024 09:26 UTC   364d            ca                      no</span></span><br><span class="line">  <span class="comment"># apiserver-etcd-client      Jan 31, 2024 09:26 UTC   364d            etcd-ca                 no</span></span><br><span class="line">  <span class="comment"># apiserver-kubelet-client   Jan 31, 2024 09:26 UTC   364d            ca                      no</span></span><br><span class="line">  <span class="comment"># controller-manager.conf    Jan 31, 2024 09:26 UTC   364d            ca                      no</span></span><br><span class="line">  <span class="comment"># etcd-healthcheck-client    Jan 31, 2024 09:26 UTC   364d            etcd-ca                 no</span></span><br><span class="line">  <span class="comment"># etcd-peer                  Jan 31, 2024 09:26 UTC   364d            etcd-ca                 no</span></span><br><span class="line">  <span class="comment"># etcd-server                Jan 31, 2024 09:26 UTC   364d            etcd-ca                 no</span></span><br><span class="line">  <span class="comment"># front-proxy-client         Jan 31, 2024 09:26 UTC   364d            front-proxy-ca          no</span></span><br><span class="line">  <span class="comment"># scheduler.conf             Jan 31, 2024 09:26 UTC   364d            ca                      no</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># CERTIFICATE AUTHORITY   EXPIRES                  RESIDUAL TIME   EXTERNALLY MANAGED</span></span><br><span class="line">  <span class="comment"># ca                      Jan 13, 2032 10:42 UTC   8y              no</span></span><br><span class="line">  <span class="comment"># etcd-ca                 Jan 13, 2032 10:42 UTC   8y              no</span></span><br><span class="line">  <span class="comment"># front-proxy-ca          Jan 13, 2032 10:42 UTC   8y              no</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨statå‘½ä»¤æŸ¥çœ‹ apiserver.key ä¸ apiserver.crt è¯ä¹¦ä¿®æ”¹æ—¶é—´</span></span><br><span class="line">/etc/kubernetes/pki$ <span class="built_in">stat</span> apiserver.key  apiserver.crt</span><br><span class="line">  <span class="comment">#   File: apiserver.key</span></span><br><span class="line">  <span class="comment">#   Size: 1675            Blocks: 8          IO Block: 4096   regular file</span></span><br><span class="line">  <span class="comment"># Device: fd00h/64768d    Inode: 3670556     Links: 1</span></span><br><span class="line">  <span class="comment"># Access: (0600/-rw-------)  Uid: (    0/    root)   Gid: (    0/    root)</span></span><br><span class="line">  <span class="comment"># Access: 2022-04-28 12:55:13.456040564 +0800 æœ€è¿‘è®¿é—®ï¼š</span></span><br><span class="line">  <span class="comment"># Modify: 2023-01-31 17:26:51.108767670 +0800 æœ€è¿‘æ›´æ”¹ï¼š</span></span><br><span class="line">  <span class="comment"># Change: 2023-01-31 17:26:51.108767670 +0800 æœ€è¿‘æ”¹åŠ¨ï¼š</span></span><br><span class="line">  <span class="comment">#   Birth: -</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">#   File: apiserver.crt</span></span><br><span class="line">  <span class="comment">#   Size: 1338            Blocks: 8          IO Block: 4096   regular file</span></span><br><span class="line">  <span class="comment"># Device: fd00h/64768d    Inode: 3670557     Links: 1</span></span><br><span class="line">  <span class="comment"># Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)</span></span><br><span class="line">  <span class="comment"># Access: 2023-01-31 17:28:58.104917185 +0800</span></span><br><span class="line">  <span class="comment"># Modify: 2023-01-31 17:26:51.108767670 +0800</span></span><br><span class="line">  <span class="comment"># Change: 2023-01-31 17:26:51.108767670 +0800</span></span><br><span class="line">  <span class="comment">#   Birth: -</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>4.å®Œæˆè¯ä¹¦æ›´æ–°åï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦é‡æ–°ç”Ÿæˆæ–°çš„K8Sé›†ç¾¤masterèŠ‚ç‚¹æ‰€éœ€çš„ç›¸å…³é…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚ <code>/etc/kubernetes</code> ç›®å½•ä¸‹çš„ <code>admin.conf / controller-manager.conf / kubelet.conf / scheduler.conf</code> ç›¸å…³æ–‡ä»¶ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆå§‹åŒ–æ‰€éœ€é…ç½®æ–‡ä»¶ </span></span><br><span class="line">$ rm -rf /etc/kubernetes/*.conf</span><br><span class="line">$ kubeadm init phase kubeconfig all --config=kubeadm-init-config.yaml</span><br><span class="line">  <span class="comment"># [kubeconfig] Using kubeconfig folder "/etc/kubernetes"</span></span><br><span class="line">  <span class="comment"># [kubeconfig] Writing "admin.conf" kubeconfig file</span></span><br><span class="line">  <span class="comment"># [kubeconfig] Writing "kubelet.conf" kubeconfig file</span></span><br><span class="line">  <span class="comment"># [kubeconfig] Writing "controller-manager.conf" kubeconfig file</span></span><br><span class="line">  <span class="comment"># [kubeconfig] Writing "scheduler.conf" kubeconfig file</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ä»¥çœ‹åˆ°æ–‡ä»¶æ—¶é—´å·²ç»å‘ç”Ÿå˜åŒ–</span></span><br><span class="line">$ ls -alh /etc/kubernetes/*.conf</span><br><span class="line">-rw------- 1 root root 5.6K Jan 31 21:53 /etc/kubernetes/admin.conf</span><br><span class="line">-rw------- 1 root root 5.6K Jan 31 21:53 /etc/kubernetes/controller-manager.conf</span><br><span class="line">-rw------- 1 root root 5.6K Jan 31 21:53 /etc/kubernetes/kubelet.conf</span><br><span class="line">-rw------- 1 root root 5.5K Jan 31 21:53 /etc/kubernetes/scheduler.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºé˜²æ­¢ kubelet å®¢æˆ·ç«¯è¯ä¹¦è½®æ¢å¤±è´¥ï¼Œæˆ‘ä»¬éœ€è¦å°†ï¼ˆæ­¤å¤„å‘æœ‰ç‚¹å¤§ï¼‰kubelet-client-* è¿›è¡Œåˆ é™¤ï¼Œåœ¨kubeletæœåŠ¡é‡å¯æ—¶åˆä¼šè‡ªåŠ¨ç”Ÿæˆ</span></span><br><span class="line"><span class="comment"># å¦‚æœæ­¤è½®æ¢è¿‡ç¨‹å¤±è´¥ï¼Œä½ å¯èƒ½ä¼šåœ¨ kube-apiserver æ—¥å¿—ä¸­çœ‹åˆ°è¯¸å¦‚ x509: certificate has expired or is not yet valid ä¹‹ç±»çš„é”™è¯¯</span></span><br><span class="line"><span class="comment"># https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/troubleshooting-kubeadm/#kubelet-client-cert</span></span><br><span class="line">rm -rf /var/lib/kubelet/pki/kubelet-client-*</span><br></pre></td></tr></table></figure></p>
<p>è¡¥å……: è‹¥è¦ç”Ÿæˆå…¶ä»–masterèŠ‚ç‚¹çš„K8Sé…ç½®æ–‡ä»¶è¯·å‚è€ƒå¦‚ä¸‹ï¼Œä¾‹å¦‚ï¼Œæ­¤å¤„æ˜¯ weiyigeek-108 æ§åˆ¶å¹³é¢èŠ‚ç‚¹çš„confé…ç½®æ–‡ä»¶ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $ mkdir -vp /tmp/kubernetes/</span></span><br><span class="line"><span class="comment"># $ kubeadm init phase kubeconfig all --node-name weiyigeek-108 --kubeconfig-dir /tmp/kubernetes/</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>5.æŒ‰ç…§æç¤ºå°†å½“å‰æ“ä½œé›†ç¾¤ masterï¼ˆweiyigeek-107ï¼‰ èŠ‚ç‚¹ä¸Šé‡å¯ kube-apiserver, kube-controller-manager, kube-scheduler ä»¥åŠ etcd ç­‰ç›¸å…³æœåŠ¡ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†æ–°ç”Ÿæˆçš„é›†ç¾¤è¿æ¥é…ç½®æ–‡ä»¶è¦†ç›–åˆ° ~/.kube/config </span></span><br><span class="line">mkdir -p <span class="variable">$HOME</span>/.kube</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'yes'</span> |  sudo cp -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">sudo chown $(id -u):$(id -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯ kube-apiserver, kube-controller-manager, kube-scheduler åŠ etcd ç­‰ç›¸å…³æœåŠ¡ï¼ˆå»ºè®®ä¸€ä¸ªä¸€ä¸ªpodåˆ é™¤ï¼Œå¯åŠ¨åå†è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼‰</span></span><br><span class="line">kubectl -n kube-system delete pod -l <span class="string">'component=kube-apiserver'</span></span><br><span class="line">kubectl -n kube-system delete pod -l <span class="string">'component=kube-controller-manager'</span></span><br><span class="line">kubectl -n kube-system delete pod -l <span class="string">'component=kube-scheduler'</span></span><br><span class="line">kubectl -n kube-system delete pod -l <span class="string">'component=etcd'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯èŠ‚ç‚¹ä¸Š kubelet æœåŠ¡</span></span><br><span class="line">systemctl restart kubelet.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ kubelet æœåŠ¡çŠ¶æ€</span></span><br><span class="line">systemctl status -l kubelet.service </span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ kubelet æœåŠ¡è¿è¡Œæ—¥å¿—æœ‰æ— å¼‚å¸¸ï¼ˆæœ‰å¼‚å¸¸è¯·ä¾æ¬¡è§£å†³ï¼‰</span></span><br><span class="line">journalctl -xefu kubelet</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯ kubelet å kubelet å®¢æˆ·ç«¯è¯ä¹¦è½®æ¢è‡ªåŠ¨ç”Ÿæˆæ–°çš„ pem è¯ä¹¦</span></span><br><span class="line">ls -alh /var/lib/kubelet/pki/kubelet-client-current.pem</span><br><span class="line">  <span class="comment"># lrwxrwxrwx 1 root root 59 Jan 31 22:29 /var/lib/kubelet/pki/kubelet-client-current.pem -&gt; /var/lib/kubelet/pki/kubelet-client-2023-01-31-22-29-20.pem</span></span><br></pre></td></tr></table></figure>
<p><br/></p>
<p>6.æ­¤æ—¶åœ¨ï¼ˆweiyigeek-107ï¼‰ èŠ‚ç‚¹ä¸Šè¿è¡Œkubectlç›¸å…³å‘½ä»¤ï¼Œåˆ™ä¸ä¼šæŠ¥è¯ä¹¦åˆ°æœŸäº†ï¼Œæˆ‘ä»¬å¯æ­£å¸¸ä½¿ç”¨ç›¸å…³å‘½ä»¤.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get nodes</span><br><span class="line">  <span class="comment"># NAME       STATUS   ROLES                  AGE     VERSION   INTERNAL-IP      EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION      CONTAINER-RUNTIME</span></span><br><span class="line">  <span class="comment"># weiyigeek-107   Ready    control-plane,master   381d    v1.23.1   192.168.12.107   &lt;none&gt;        Ubuntu 20.04.1 LTS   5.4.0-137-generic   containerd://1.4.12</span></span><br><span class="line">  <span class="comment"># weiyigeek-108   Ready    control-plane,master   57m     v1.23.1   192.168.12.108   &lt;none&gt;        Ubuntu 20.04.3 LTS   5.4.0-137-generic   containerd://1.4.12</span></span><br><span class="line">  <span class="comment"># weiyigeek-109   Ready    control-plane,master   2m19s   v1.23.1   192.168.12.109   &lt;none&gt;        Ubuntu 20.04.3 LTS   5.4.0-137-generic   containerd://1.4.12</span></span><br><span class="line">  <span class="comment"># weiyigeek-223   Ready    work                   380d    v1.23.1   192.168.12.223   &lt;none&gt;        Ubuntu 20.04.3 LTS   5.4.0-94-generic    containerd://1.4.12</span></span><br><span class="line">  <span class="comment"># weiyigeek-224   Ready    work                   380d    v1.23.1   192.168.12.224   &lt;none&gt;        Ubuntu 20.04.3 LTS   5.4.0-42-generic    containerd://1.4.12</span></span><br><span class="line">  <span class="comment"># weiyigeek-225   Ready    work                   381d    v1.23.1   192.168.12.225   &lt;none&gt;        Ubuntu 20.04.3 LTS   5.4.0-94-generic    containerd://1.4.12</span></span><br><span class="line">  <span class="comment"># weiyigeek-226   Ready    work                   220d    v1.23.1   192.168.12.226   &lt;none&gt;        Ubuntu 20.04.3 LTS   5.4.0-80-generic    containerd://1.4.12</span></span><br><span class="line"></span><br><span class="line">$ kubectl get pod -n kube-system  | egrep <span class="string">"kube-apiserver|kube-controller-manager|kube-scheduler|etcd"</span></span><br><span class="line">  <span class="comment"># etcd-weiyigeek-107                             1/1     Running   1              380d</span></span><br><span class="line">  <span class="comment"># etcd-weiyigeek-108                             1/1     Running   0              96d</span></span><br><span class="line">  <span class="comment"># etcd-weiyigeek-109                             1/1     Running   0              380d</span></span><br><span class="line">  <span class="comment"># kube-apiserver-weiyigeek-107                   1/1     Running   0              380d</span></span><br><span class="line">  <span class="comment"># kube-apiserver-weiyigeek-108                   1/1     Running   0              380d</span></span><br><span class="line">  <span class="comment"># kube-apiserver-weiyigeek-109                   1/1     Running   0              380d</span></span><br><span class="line">  <span class="comment"># kube-controller-manager-weiyigeek-107          1/1     Running   2 (380d ago)   380d</span></span><br><span class="line">  <span class="comment"># kube-controller-manager-weiyigeek-108          1/1     Running   1 (15d ago)    380d</span></span><br><span class="line">  <span class="comment"># kube-controller-manager-weiyigeek-109          1/1     Running   1 (380d ago)   380d</span></span><br><span class="line">  <span class="comment"># kube-scheduler-weiyigeek-107                   1/1     Running   3 (15d ago)    380d</span></span><br><span class="line">  <span class="comment"># kube-scheduler-weiyigeek-108                   1/1     Running   2 (15d ago)    380d</span></span><br><span class="line">  <span class="comment"># kube-scheduler-weiyigeek-109                   1/1     Running   1 (380d ago)   380d</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>7.æŸ¥çœ‹é›†ç¾¤çš„å¥åº·çŠ¶æ€ï¼Œå³è°ƒåº¦å™¨ã€æ§åˆ¶å™¨ä»¥åŠetcdæ•°æ®åº“æ˜¯å¦æ­£å¸¸ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get cs</span><br><span class="line">Warning: v1 ComponentStatus is deprecated <span class="keyword">in</span> v1.19+</span><br><span class="line">NAME                 STATUS    MESSAGE                         ERROR</span><br><span class="line">scheduler            Healthy   ok</span><br><span class="line">controller-manager   Healthy   ok</span><br><span class="line">etcd-0               Healthy   &#123;<span class="string">"health"</span>:<span class="string">"true"</span>,<span class="string">"reason"</span>:<span class="string">""</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä½ æ˜¯å¦è®¤ä¸ºï¼Œå®è·µåˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå½“ç„¶ä¸æ˜¯ç”±äºæ­¤å¤„æ˜¯é«˜å¯ç”¨K8Sé›†ç¾¤ï¼Œæ›´æ–°è¯ä¹¦åå‘ï¼Œè¿œä¸æ­¢äºæ­¤ã€‚</p>
<p>æœ‰å…´è¶£çš„ï¼Œè¯·ç»§ç»­çœ‹ä¸‹èŠ‚ã€‚</p>
<hr>
<h3 id="4-é›†ç¾¤è¯ä¹¦æ›´æ–°å-calico-amp-amp-kube-proxy-ç›¸å…³æ“ä½œ"><a href="#4-é›†ç¾¤è¯ä¹¦æ›´æ–°å-calico-amp-amp-kube-proxy-ç›¸å…³æ“ä½œ" class="headerlink" title="4.é›†ç¾¤è¯ä¹¦æ›´æ–°å calico &amp;&amp; kube-proxy ç›¸å…³æ“ä½œ"></a>4.é›†ç¾¤è¯ä¹¦æ›´æ–°å calico &amp;&amp; kube-proxy ç›¸å…³æ“ä½œ</h3><p>æè¿°ï¼šåœ¨è¿›è¡Œè¯¥K8Sé«˜å¯ç”¨é›†ç¾¤å®‰è£…æ—¶ï¼Œå‚ç…§äº†æˆ‘åšå®¢ä¸­çš„ã€Šåœ¨Ubuntuå®‰è£…éƒ¨ç½²K8Sé«˜å¯ç”¨é›†ç¾¤ä½¿ç”¨åˆä½“éªŒã€‹æ–‡ç« ï¼Œæˆ‘å°†æ–‡ç« é“¾æ¥åœ°å€( <a href="https://blog.weiyigeek.top/2020/4-27-470.html#0x04-é«˜å¯ç”¨é›†ç¾¤ä½¿ç”¨åˆä½“éªŒ">https://blog.weiyigeek.top/2020/4-27-470.html#0x04-é«˜å¯ç”¨é›†ç¾¤ä½¿ç”¨åˆä½“éªŒ</a> ), å…¶ä¸­åœ¨ä½¿ç”¨calicoç½‘ç»œæ’ä»¶æ—¶é€‰æ‹©å°† Calico æ•°æ®å­˜å‚¨åœ¨ etcd datastore ä¹‹ä¸­ï¼Œæ‰€ä»¥åœ¨è¿›è¡Œcalicoå®‰è£…æˆ–è€…ä½¿ç”¨æ—¶éœ€è¦å°†æ•°æ®å­˜å‚¨åˆ°etcdä¸­ï¼Œåˆ™è‚¯å®šéœ€è¦é“¾æ¥åˆ°etcdæ•°æ®ä¸­ï¼Œæ­¤å¤„ calico-etcd.yaml é…ç½®æ¸…å•ä¸­çš„etcd-caã€etcd-certã€etcd-key å­—æ®µçš„å€¼ä»ç„¶ä¸ºåŸè¯ä¹¦ï¼Œç”±äºæˆ‘ä»¬å‰é¢å·²ç»æ›´æ–°äº†æ‰€æœ‰ç»„ä»¶è¯ä¹¦ï¼Œæ‰€ä»¥å†è¿›è¡Œæ•°æ®çš„CURDè‚¯å®šæ˜¯æ— æ³•é“¾æ¥åˆ°etcdï¼Œåˆ™æ­¤æ—¶æˆ‘ä»¬éœ€è¦é‡æ–°è¯¥ <code>calico-etcd.yaml</code> èµ„æºé…ç½®æ–‡ä»¶ã€‚</p>
<p>åœ¨æ›´æ–°é›†ç¾¤è¯ä¹¦åå‘ç°çš„calicoä»¥åŠä¸šåŠ¡åº”ç”¨çš„å¼‚å¸¸æƒ…å†µï¼Œå…¶ä¸­æœ€æ˜æ˜¾çš„å°±æ˜¯calicæ— æ³•æ­£å¸¸å¯åŠ¨ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pod -n kube-system</span><br><span class="line">  NAME                                      READY   STATUS              RESTARTS        AGE</span><br><span class="line">  calico-kube-controllers-6cf9b574f-zlrjn   0/1     Running             0               3s</span><br><span class="line">  calico-node-5q8lq                         0/1     CrashLoopBackOff    11 (6s ago)     25m</span><br><span class="line">  calico-node-62zd9                         0/1     CrashLoopBackOff    9 (5m6s ago)    25m</span><br><span class="line">  calico-node-85b7k                         0/1     Running             11 (66s ago)    25m</span><br><span class="line">  calico-node-8mt8q                         0/1     Running             3 (66s ago)     4m43s</span><br><span class="line">  calico-node-cdkf8                         0/1     CrashLoopBackOff    9 (5m6s ago)    25m</span><br><span class="line">  calico-node-jgm6q                         0/1     CrashLoopBackOff    9 (4m56s ago)   25m</span><br><span class="line">  calico-node-x2b9q                         0/1     CrashLoopBackOff    9 (5m6s ago)    25m</span><br><span class="line">  coredns-65c54cc984-7vt8m                  0/1     ContainerCreating   0               7m5s</span><br><span class="line">  coredns-65c54cc984-hf774                  0/1     ContainerCreating   0               25m</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>æ“ä½œæ­¥éª¤:</strong><br>æ­¥éª¤ 01.æ­¤å¤„å‚è€ƒä¸Šé¢çš„æ–‡ç« è¿›è¡Œæ›´æ”¹etcdæ•°æ®åº“è¯ä¹¦é“¾æ¥å­—æ®µã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) Install Calico with etcd datastore (ä½¿ç”¨etcdæ•°æ®å­˜å‚¨å®‰è£…Calico) </span></span><br><span class="line">curl https://docs.projectcalico.org/manifests/calico-etcd.yaml -O</span><br><span class="line"></span><br><span class="line"><span class="comment"># calico-etcd ç½‘ç»œä¸etcé›†ç¾¤è¿æ¥ä¿®æ”¹(æ­¤å¤„æŒ‡å®špodå­ç½‘åœ°å€)</span></span><br><span class="line">ETCD_CA=`cat /etc/kubernetes/pki/etcd/ca.crt | base64 | tr -d <span class="string">'\n'</span>`</span><br><span class="line">ETCD_CERT=`cat /etc/kubernetes/pki/etcd/server.crt | base64 | tr -d <span class="string">'\n'</span>`</span><br><span class="line">ETCD_KEY=`sudo cat /etc/kubernetes/pki/etcd/server.key | base64 | tr -d <span class="string">'\n'</span>`</span><br><span class="line">POD_SUBNET=`sudo cat /etc/kubernetes/manifests/kube-controller-manager.yaml | grep cluster-cidr= | awk -F= <span class="string">'&#123;print $NF&#125;'</span>`</span><br><span class="line">sed -i <span class="string">"s@# etcd-key: null@etcd-key: <span class="variable">$&#123;ETCD_KEY&#125;</span>@g; s@# etcd-cert: null@etcd-cert: <span class="variable">$&#123;ETCD_CERT&#125;</span>@g; s@# etcd-ca: null@etcd-ca: <span class="variable">$&#123;ETCD_CA&#125;</span>@g"</span> calico-etcd.yaml</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">'s#etcd_ca: ""#etcd_ca: "/calico-secrets/etcd-ca"#g; s#etcd_cert: ""#etcd_cert: "/calico-secrets/etcd-cert"#g; s#etcd_key: "" #etcd_key: "/calico-secrets/etcd-key" #g'</span> calico-etcd.yaml</span><br><span class="line">sed -i <span class="string">'s#etcd_endpoints: "http://&lt;ETCD_IP&gt;:&lt;ETCD_PORT&gt;"#etcd_endpoints: "https://192.168.12.107:2379,https://192.168.12.108:2379,https://192.168.12.109:2379"#g'</span> calico-etcd.yaml</span><br><span class="line">sed -i <span class="string">'s@# - name: CALICO_IPV4POOL_CIDR@- name: CALICO_IPV4POOL_CIDR@g; s@#   value: "192.168.0.0/16"@  value: '</span><span class="string">"<span class="variable">$&#123;POD_SUBNET&#125;</span>"</span><span class="string">'@g'</span> calico-etcd.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) è¦†ç›–éƒ¨ç½²calicoåˆ°K8Sé›†ç¾¤ä¸­</span></span><br><span class="line">kubectl apply -f calico-etcd.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) æ­¤å¤„å¯¹æ¯”ä¸¤ä¸ªé…ç½®æ¸…å•æ–‡ä»¶å³å¯å‘ç°è¯ä¹¦çš„ä¸åŒã€‚</span></span><br><span class="line">diff calico-etcd.yaml calico-etcd.yaml.bak</span><br><span class="line">17,18c17,18</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>æ­¥éª¤ 02.åœ¨masterèŠ‚ç‚¹(weiyigeek-107)èŠ‚ç‚¹ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œé‡å¯ calico ä»¥åŠå„èŠ‚ç‚¹ä¸­çš„ kube-proxy Pod å®¹å™¨ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># calico-node</span></span><br><span class="line">kubectl delete pod -n kube-system -l k8s-app=calico-node</span><br><span class="line"></span><br><span class="line"><span class="comment"># kube-proxy</span></span><br><span class="line">kubectl delete pod -n kube-system -l k8s-app=calico-node</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>æ­¥éª¤ 03.ç­‰å¾…ä¸€æ®µæ—¶é—´åï¼ŒéªŒè¯ calico-node ã€kube-proxyæœåŠ¡å¯åŠ¨æƒ…å†µ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pod -n kube-system  | egrep <span class="string">"calico|kube-proxy"</span></span><br><span class="line">calico-kube-controllers-6cf9b574f-42jnz   1/1     Running   0               98m</span><br><span class="line">calico-node-dvvxk                         1/1     Running   0               98m</span><br><span class="line">calico-node-g9svc                         1/1     Running   0               98m</span><br><span class="line">calico-node-ggxqp                         1/1     Running   0               98m</span><br><span class="line">calico-node-jps97                         1/1     Running   0               98m</span><br><span class="line">calico-node-qf7cj                         1/1     Running   0               92m</span><br><span class="line">calico-node-vvw9f                         1/1     Running   0               98m</span><br><span class="line">calico-node-zvz8r                         1/1     Running   0               98m</span><br><span class="line">kube-proxy-25p5s                          1/1     Running   0               220d</span><br><span class="line">kube-proxy-8bl7f                          1/1     Running   0               94m</span><br><span class="line">kube-proxy-8jxvr                          1/1     Running   0               93m</span><br><span class="line">kube-proxy-d79mp                          1/1     Running   0               381d</span><br><span class="line">kube-proxy-dtdtm                          1/1     Running   0               108m</span><br><span class="line">kube-proxy-l7jxp                          1/1     Running   0               93m</span><br><span class="line">kube-proxy-nlgln                          1/1     Running   0               381d</span><br></pre></td></tr></table></figure></p>
<p>æ­¥éª¤ 04.è®¿é—®é€šè¿‡nodePortæš´éœ²çš„ä¸šåŠ¡ç³»ç»ŸéªŒè¯æ˜¯å¦å¯ä»¥ä»ä»»æ„èŠ‚ç‚¹ä»£ç†è½¬å‘è®¿é—®ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get svc,pod -n devops -l app=jenkins</span><br><span class="line">  <span class="comment"># NAME              TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)                          AGE</span></span><br><span class="line">  <span class="comment"># service/jenkins   NodePort   10.109.163.223   &lt;none&gt;        8080:30001/TCP,50000:30634/TCP   380d</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># NAME                           READY   STATUS    RESTARTS   AGE</span></span><br><span class="line">  <span class="comment"># pod/jenkins-7fc6f4fcf6-glqxj   1/1     Running   0          118m</span></span><br><span class="line"></span><br><span class="line">$ curl -sI 10.109.163.223:8080 | head -n 1</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line"></span><br><span class="line">$ curl -s 10.109.163.223:8080  | grep -oP <span class="string">"&lt;title&gt;\S.+&lt;/title&gt;"</span></span><br><span class="line">$ curl -s 192.168.12.107:30001  | grep -oP <span class="string">"&lt;title&gt;\S.+&lt;/title&gt;"</span></span><br><span class="line">&lt;title&gt;Dashboard [Jenkins]&lt;/title&gt;</span><br></pre></td></tr></table></figure></p>
<p>å¥½çš„ï¼Œæ­¤é—®é¢˜ä¹Ÿå·²ç»è§£å†³äº†ã€‚</p>
<p>ä¸‹é¢ç»§ç»­æ¥çœ‹ï¼Œå¦‚ä½•åœ¨æ›´æ–°è¯ä¹¦å<code>åˆ é™¤æˆ–è€…æ–°å¢</code>æ§åˆ¶é¢æ¿èŠ‚ç‚¹ä»¥åŠå·¥ä½œèŠ‚ç‚¹ã€‚</p>
<hr>
<h3 id="5-æ§åˆ¶å¹³é¢-Master-èŠ‚ç‚¹çš„ç§»é™¤-amp-amp-æ·»åŠ "><a href="#5-æ§åˆ¶å¹³é¢-Master-èŠ‚ç‚¹çš„ç§»é™¤-amp-amp-æ·»åŠ " class="headerlink" title="5.æ§åˆ¶å¹³é¢(Master)èŠ‚ç‚¹çš„ç§»é™¤&amp;&amp;æ·»åŠ "></a>5.æ§åˆ¶å¹³é¢(Master)èŠ‚ç‚¹çš„ç§»é™¤&amp;&amp;æ·»åŠ </h3><p>æè¿°: æœ‰æ—¶åœ¨æ›´æ–°é›†ç¾¤è¯ä¹¦åï¼ŒæŸä¸€ä¸ªæ§åˆ¶å¹³é¢çš„èŠ‚ç‚¹å¯èƒ½ä¸€è‡´ä¸æ­£å¸¸ï¼Œæˆ‘ä»¬ä¹Ÿæ‰¾ä¸åˆ°è§£å†³åŠæ³•æ—¶ï¼Œæœ€ç»ˆè§£å†³æ–¹æ¡ˆå°±æ˜¯é‡ç½®è¯¥masterèŠ‚ç‚¹å¹¶é‡æ–°åŠ å…¥åˆ°K8Sé›†ç¾¤ä¸­ã€‚</p>
<p> <br/></p>
<p><strong>æ“ä½œæµç¨‹</strong></p>
<p>æ­¥éª¤ 01.å°†éœ€è¦masterèŠ‚ç‚¹ï¼Œä¾‹å¦‚æ­¤å¤„(weiyigeek-108)èŠ‚ç‚¹è®¾ç½®ä¸å¯è°ƒåº¦ï¼Œæ¸©é¦¨æç¤ºæ“ä½œå‰è¯·æ³¨æ„å¤‡ä»½è¯¥èŠ‚ç‚¹ä¸Šçš„ç›¸å…³æ•°æ®ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨ weiyigeek-107 èŠ‚ç‚¹ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œè®¾ç½®èŠ‚ç‚¹è®¾ç½®ä¸å¯è°ƒåº¦ï¼Œæ­¤æ—¶èŠ‚ç‚¹çŠ¶æ€å˜æˆï¼šReady,SchedulingDisabled</span></span><br><span class="line">kubectl drain weiyigeek-108 --delete-local-data  --delete-emptydir-data --force --ignore-daemonsets</span><br><span class="line">  <span class="comment"># node/weiyigeek-108 cordoned</span></span><br><span class="line">  <span class="comment"># WARNING: ignoring DaemonSet-managed Pods: kube-system/calico-node-qf7cj, kube-system/kube-proxy-8jxvr</span></span><br><span class="line">  <span class="comment"># node/weiyigeek-108 drained</span></span><br><span class="line"></span><br><span class="line">kubectl get node  weiyigeek-108</span><br><span class="line">  NAME       STATUS                     ROLES                  AGE     VERSION</span><br><span class="line">  weiyigeek-108   Ready,SchedulingDisabled   control-plane,master   3h50m   v1.23.1</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»é›†ç¾¤ä¸­ç§»é™¤ weiyigeek-108 èŠ‚ç‚¹</span></span><br><span class="line">kubectl delete node weiyigeek-109</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>æ­¥éª¤ 02.ç”ŸæˆmasterèŠ‚ç‚¹ä»¥åŠå·¥ä½œèŠ‚ç‚¹åŠ å…¥åˆ°K8Sé›†ç¾¤çš„è®¤è¯TokenåŠå…¶å‘½ä»¤ç¤ºä¾‹ï¼ˆå€¼å¾—å­¦ä¹ å€Ÿé‰´ï¼‰ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) æŸ¥çœ‹tokenæ˜¯å¦å¤±æ•ˆé»˜è®¤æ˜¯24Hï¼Œå¦‚æœå¤±æ•ˆè¿‡æœŸå¯ä»¥é‡æ–°è¿›è¡Œç”Ÿæˆtokenå¹¶æ‰“å°åŠ å…¥å‘½ä»¤</span></span><br><span class="line">kubeadm token list</span><br><span class="line">kubeadm token create --<span class="built_in">print</span>-join-command</span><br><span class="line">  <span class="comment"># kubeadm join slb-vip.k8s:16443 --token vkhqa1.t3gtrbowlalt8um5 --discovery-token-ca-cert-hash sha256:bfc86e13da79a1ec5f53cef99661e4e3f51adda59c525cb9377cfe59956b1e59 # æ³¨æ„ï¼Œé…ç½®æ¸…å•ä¸­ä¼šä½¿ç”¨åˆ°</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2)ä»èŠ‚ç‚¹çš„ kubeadm åŠ å…¥åˆ°k8sé›†ç¾¤ä¹‹ä¸­ (æ¨è)ï¼Œä½¿ç”¨æ­¤å‘½ä»¤è°ƒç”¨initå·¥ä½œæµçš„å•ä¸ªé˜¶æ®µ</span></span><br><span class="line">kubeadm init phase upload-certs --upload-certs</span><br><span class="line">  <span class="comment"># [upload-certs] Using certificate key:</span></span><br><span class="line">  <span class="comment"># c6a084cb06aaae2f4581145dbbe6057ce111c88fdac4ff4405a0a2db58882d76     # æ³¨æ„ï¼Œé…ç½®æ¸…å•ä¸­ä¼šä½¿ç”¨åˆ°</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3) è·å–CAï¼ˆè¯ä¹¦ï¼‰å…¬é’¥å“ˆå¸Œå€¼</span></span><br><span class="line">openssl x509 -pubkey -<span class="keyword">in</span> /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2&gt;/dev/null | openssl dgst -sha256 -hex | sed <span class="string">'s/^ .* //'</span></span><br><span class="line"><span class="comment"># (stdin)= bfc86e13da79a1ec5f53cef99661e4e3f51adda59c525cb9377cfe59956b1e59  </span></span><br><span class="line"><span class="comment"># æ­¤å¤„æ˜¯å…¬é’¥å“ˆå¸Œå€¼(ä¸€å°æœºå™¨ä¸Šcaè¯ä¹¦ä¸å˜å°±ä¸€ç›´æ˜¯è¯¥sha256çš„å€¼)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) è¿›è¡Œæ”¶åˆ°ç»„åˆåŠ å…¥é›†ç¾¤çš„ master èŠ‚ç‚¹çš„ join å‘½ä»¤å¦‚ä¸‹:</span></span><br><span class="line">kubeadm join slb-vip.k8s:16443 --token ejwx62.vqwog6il5p83uk7y \</span><br><span class="line">--discovery-token-ca-cert-hash sha256:bfc86e13da79a1ec5f53cef99661e4e3f51adda59c525cb9377cfe59956b1e59 \</span><br><span class="line">--control-plane --certificate-key c6a084cb06aaae2f4581145dbbe6057ce111c88fdac4ff4405a0a2db58882d76</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>æ­¥éª¤ 03.é€šè¿‡sshè¿œç¨‹ç™»å½•<code>weiyigeek-108</code>èŠ‚ç‚¹é‡ç½®è¯¥èŠ‚ç‚¹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop kubelet</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> y | kubeadm reset</span><br><span class="line">sudo rm -rf <span class="variable">$HOME</span>/.kube </span><br><span class="line">sudo rm -rf /var/lib/cni/ /etc/cni/ /var/lib/kubelet/* </span><br><span class="line">ipvsadm --clear</span><br><span class="line">iptables -F &amp;&amp; iptables -t nat -F &amp;&amp; iptables -t mangle -F &amp;&amp; iptables -X</span><br><span class="line"></span><br><span class="line">systemctl start kubelet; systemctl status kubelet</span><br></pre></td></tr></table></figure>
<p>æ¸©é¦¨æç¤º: å¦‚æœä¸»MasterèŠ‚ç‚¹åœ¨åˆå§‹åŒ–æ—¶å€™å‡ºé”™éœ€è¦é‡æ–°é…ç½®æ—¶å€™,è¯·æ‰§è¡Œä»¥ä¸Šè¿°å‘½ä»¤è¿›è¡Œé‡ç½®;</p>
<p><br/></p>
<p>æ­¥éª¤ 04.å‡†å¤‡æ§åˆ¶å¹³é¢èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤çš„JoinConfigurationèµ„æºé…ç½®æ¸…å•<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$</span> <span class="string">vim</span> <span class="string">join-k8s.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kubeadm.k8s.io/v1beta3</span></span><br><span class="line"><span class="attr">caCertPath:</span> <span class="string">/etc/kubernetes/pki/ca.crt</span></span><br><span class="line"><span class="attr">discovery:</span></span><br><span class="line"><span class="attr">  bootstrapToken:</span></span><br><span class="line"><span class="attr">    apiServerEndpoint:</span> <span class="string">slb-vip.k8s:16443</span>   <span class="comment"># é«˜å¯ç”¨çš„APIServeråœ°å€</span></span><br><span class="line"><span class="attr">    token:</span> <span class="string">vkhqa1.t3gtrbowlalt8um5</span>         <span class="comment"># ä¸Šè¿°æ­¥éª¤ç”ŸæˆToken</span></span><br><span class="line"><span class="attr">    caCertHashes:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">"sha256:bfc86e13da79a1ec5f53cef99661e4e3f51adda59c525cb9377cfe59956b1e59"</span>   <span class="comment"># ä¸Šè¿°æ­¥éª¤è·å–åˆ°çš„CAï¼ˆè¯ä¹¦ï¼‰å…¬é’¥å“ˆå¸Œå€¼</span></span><br><span class="line"><span class="attr">  timeout:</span> <span class="number">5</span><span class="string">m0s</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">JoinConfiguration</span></span><br><span class="line"><span class="attr">controlPlane:</span></span><br><span class="line"><span class="attr">  certificateKey:</span> <span class="string">"c6a084cb06aaae2f4581145dbbe6057ce111c88fdac4ff4405a0a2db58882d76"</span>  <span class="comment"># ä¸Šè¿°æ­¥éª¤è·å–åˆ° certificate key</span></span><br><span class="line"><span class="attr">  localAPIEndpoint:</span></span><br><span class="line"><span class="attr">    advertiseAddress:</span> <span class="number">192.168</span><span class="number">.12</span><span class="number">.108</span>      <span class="comment"># æœ¬åœ°APIServerèŠ‚ç‚¹åœ°å€(å³weiyigeek-108èŠ‚ç‚¹æœºå™¨åœ°å€)</span></span><br><span class="line"><span class="attr">    bindPort:</span> <span class="number">6443</span>                        <span class="comment"># æœ¬åœ°APIServerèŠ‚ç‚¹ç«¯å£</span></span><br><span class="line"><span class="attr">nodeRegistration:</span></span><br><span class="line"><span class="attr">  criSocket:</span> <span class="string">/run/containerd/containerd.sock</span>  <span class="comment"># é‡ç‚¹ï¼Œåœ¨1.24.xä¹‹å‰é»˜è®¤æ˜¯ä½¿ç”¨docker-shimï¼Œæ­¤å¤„æˆ‘ä»¬æŒ‡å®šä½¿ç”¨containerd</span></span><br><span class="line"><span class="attr">  imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">weiyigeek-108</span>                              <span class="comment"># é‡ç‚¹ï¼ŒèŠ‚ç‚¹åç§°</span></span><br><span class="line"><span class="attr">  taints:</span></span><br><span class="line"><span class="attr">  - effect:</span> <span class="string">NoSchedule</span></span><br><span class="line"><span class="attr">    key:</span> <span class="string">node-role.kubernetes.io/master</span></span><br></pre></td></tr></table></figure></p>
<p>æ¸©é¦¨æç¤º: åœ¨ bootstrapToken å­—æ®µä¸­ä¹Ÿå¯è·³è¿‡ caCertHashes è®¤è¯ï¼Œè¯·é”®å€¼ä¸º<code>unsafeSkipCAVerification: true</code>ã€‚</p>
<p><br/></p>
<p>æ­¥éª¤ 05.è¯ä¹¦æ›´æ–°ååŸæœ‰çš„masterèŠ‚ç‚¹ç§»é™¤åŠ å…¥å‰ï¼Œéœ€è¦é’ˆå¯¹ä¹…çš„etcdæ•°æ®åº“è¿›è¡Œå¤„ç†æ“ä½œã€‚</p>
<p>æ­¤å¤„æœ‰ä¸ªå°æ’æ›²ï¼Œç”±äºå„masterèŠ‚ç‚¹ç»„æˆäº†ä¸€ä¸ªé«˜å¯ç”¨é›†ç¾¤ï¼Œæ¯ä¸ªmasterèŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œäº†etcdæœåŠ¡ï¼Œä»¥å®ç°etcdæ•°æ®åº“çš„é«˜å¯ç”¨ï¼Œæœ‰</p>
<p>Kubernetes ä¸ Etcd ç‰ˆæœ¬ä¸è¯ä¹¦å…³è”è¯´æ˜:</p>
<ul>
<li>ETCD ç‰ˆæœ¬å°äºç­‰äºv1.9ç‰ˆæœ¬ï¼Œetcdé»˜è®¤æ˜¯ä¸ä½¿ç”¨TLSè¿æ¥ï¼Œæ²¡æœ‰etcdç›¸å…³è¯ä¹¦ï¼Œåªéœ€è¦æ›´æ–°masterè¯ä¹¦å³å¯ã€‚</li>
<li>ETCD ç‰ˆæœ¬å¤§äºç­‰äºv1.10ç‰ˆæœ¬ï¼Œetcdé»˜è®¤å¼€å¯TLSï¼Œéœ€è¦æ›´æ–°etcdè¯ä¹¦å’Œmasterè¯ä¹¦ã€‚</li>
</ul>
<p>æ­¤å¤„æˆ‘ä»¬çš„etcdç‰ˆæœ¬æ˜¯v3.5.xæ˜¯å¼€å¯TLSçš„ï¼Œå‰é¢æˆ‘ä»¬é‡å¯åœ¨masterèŠ‚ç‚¹çš„etcdçš„ç›¸å…³podåå°†ä¼šè‡ªåŠ¨ä½¿ç”¨æœ€æ–°çš„è¯ä¹¦ï¼Œè€Œåœ¨å°†masterèŠ‚ç‚¹ç§»é™¤é‡æ–°åŠ å…¥éœ€è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼Œå¦åˆ™å°†ä¼šæŠ¥é”™ï¼ˆæŸ¥çœ‹å°¾éƒ¨çš„é”™è¯¯å®ä¾‹ï¼‰:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">exec</span> -n kube-system -it etcd-weiyigeek-107 /bin/sh</span><br><span class="line"><span class="comment"># etcd é›†ç¾¤æˆå‘˜åˆ—è¡¨</span></span><br><span class="line">$ etcdctl --endpoints 127.0.0.1:2379 --cacert /etc/kubernetes/pki/etcd/ca.crt --cert /etc/kubernetes/pki/etcd/server.crt --key /etc/kubernetes/pki/etcd/server.key member list</span><br><span class="line">  <span class="comment"># 2db31a5d67ec1034, started, weiyigeek-108, https://192.168.12.108:2380, https://192.168.12.108:2379, false</span></span><br><span class="line">  <span class="comment"># 42efe7cca897d765, started, weiyigeek-109, https://192.168.12.109:2380, https://192.168.12.109:2379, false</span></span><br><span class="line">  <span class="comment"># 471323846709334f, started, weiyigeek-107, https://192.168.12.107:2380, https://192.168.12.107:2379, false</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># etcd é›†ç¾¤èŠ‚ç‚¹æ•°æ®çŠ¶æ€</span></span><br><span class="line">$ etcdctl --endpoints https://192.168.12.107:2379,https://192.168.12.108:2379,https://192.168.12.109:2379 --cacert /etc/kubernetes/pki/etcd/ca.crt --cert /etc/kubernetes/pki/etcd/server.crt --key /etc/kubernetes/pki/etcd/server.key endpoint status</span><br><span class="line">  <span class="comment"># https://192.168.12.107:2379, 471323846709334f, 3.5.1, 324 MB, true, false, 8, 109396908, 109396908,</span></span><br><span class="line">  <span class="comment"># https://192.168.12.108:2379, 2db31a5d67ec1034, 3.5.1, 324 MB, false, false, 8, 109396916, 109396916,</span></span><br><span class="line">  <span class="comment"># https://192.168.12.109:2379, 42efe7cca897d765, 3.5.1, 324 MB, false, false, 8, 109396922, 109396922,</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  ç§»é™¤ 2db31a5d67ec1034 æˆå‘˜ï¼ˆweiyigeek-108 æ—§èŠ‚ç‚¹ï¼‰</span></span><br><span class="line">$ etcdctl --endpoints 127.0.0.1:2379 --cacert /etc/kubernetes/pki/etcd/ca.crt --cert /etc/kubernetes/pki/etcd/server.crt --key /etc/kubernetes/pki/etcd/server.key member remove 7e66da9dd902d557</span><br><span class="line">Member 2db31a5d67ec1034 removed from cluster 3a7f4f11f646b97b</span><br></pre></td></tr></table></figure>
<p><br/></p>
<p>æ­¥éª¤ 06.åœ¨ weiyigeek-108 èŠ‚ç‚¹ä¸Šæ‰§è¡ŒåŠ å…¥é›†ç¾¤å‘½ä»¤, è‹¥åŠ å…¥æˆæœå¯ä»¥é€šè¿‡<code>kubectl get nods</code>å‘½ä»¤æŸ¥çœ‹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœæ­¢è¯¥èŠ‚ç‚¹ä¸Šæ‰€æœ‰ Pod é˜²æ­¢ç«¯å£å ç”¨</span></span><br><span class="line">crictl stop $(crictl ps -a -q)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‰ç…§ JoinConfiguration èµ„æºé…ç½®æ¸…å•åŠ å…¥åˆ°é›†ç¾¤ä¸­ï¼Œ--v=5æ˜¾ç¤ºæ›´å®Œæ•´çš„æ“ä½œè¿‡ç¨‹æ—¥å¿—ï¼Œæ’é”™å¿…å¤‡ã€‚</span></span><br><span class="line">kubeadm join --config=join-k8s.yaml --v=5</span><br><span class="line">  <span class="comment"># è‹¥æ˜¾ç¤ºå¦‚ä¸‹æç¤ºåˆ™åŠ å…¥æˆåŠŸï¼Œå¦åˆ™è¯·æ’æŸ¥å¼‚å¸¸æƒ…å†µã€‚</span></span><br><span class="line">  <span class="comment"># This node has joined the cluster and a new control plane instance was created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># To start administering your cluster from this node, you need to run the following as a regular user:</span></span><br><span class="line">mkdir -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">sudo cp -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">sudo chown $(id -u):$(id -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line">$ kubectl get node weiyigeek-108</span><br><span class="line">  <span class="comment"># NAME       STATUS     ROLES                  AGE     VERSION</span></span><br><span class="line">  <span class="comment"># weiyigeek-108   Ready      control-plane,master   3m9s    v1.23.1</span></span><br></pre></td></tr></table></figure></p>
<p>æ¸©é¦¨æç¤º: å¦‚æœåŠ å…¥ä¸»masterèŠ‚ç‚¹æ—¶ä¸€ç›´åœç•™åœ¨ pre-flight çŠ¶æ€ï¼Œè¯·åœ¨ç¬¬é¢å¤–çš„å‡ ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤æ£€æŸ¥ï¼š<code>curl -ik https://è®¾ç½®APISERVERåœ°å€:6443/version</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ curl -ik https://slb-vip.k8s:16443/version</span><br><span class="line"><span class="comment"># æ­£å¸¸çŠ¶æ€ä¸‹çš„è¾“å‡º</span></span><br><span class="line">HTTP/2 200</span><br><span class="line">audit-id: 77c614cb-0c27-42f5-a852-b5ef8415361f</span><br><span class="line">cache-control: no-cache, private</span><br><span class="line">content-type: application/json</span><br><span class="line">x-kubernetes-pf-flowschema-uid: 41a01a35-c480-4cfd-8854-494261622406</span><br><span class="line">x-kubernetes-pf-prioritylevel-uid: 4cfd380c-d39c-490f-96b0-dd4ed07be4e0</span><br><span class="line">content-length: 263</span><br><span class="line">date: Wed, 01 Feb 2023 07:34:01 GMT</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"major"</span>: <span class="string">"1"</span>,</span><br><span class="line">  <span class="string">"minor"</span>: <span class="string">"23"</span>,</span><br><span class="line">  <span class="string">"gitVersion"</span>: <span class="string">"v1.23.0"</span>,</span><br><span class="line">  <span class="string">"gitCommit"</span>: <span class="string">"ab69524f795c42094a6630298ff53f3c3ebab7f4"</span>,</span><br><span class="line">  <span class="string">"gitTreeState"</span>: <span class="string">"clean"</span>,</span><br><span class="line">  <span class="string">"buildDate"</span>: <span class="string">"2021-12-07T18:09:57Z"</span>,</span><br><span class="line">  <span class="string">"goVersion"</span>: <span class="string">"go1.17.3"</span>,</span><br><span class="line">  <span class="string">"compiler"</span>: <span class="string">"gc"</span>,</span><br><span class="line">  <span class="string">"platform"</span>: <span class="string">"linux/amd64"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>è‡³æ­¤ï¼Œå®è·µå®Œæ¯•!</p>
<hr>
<h3 id="6-å·¥ä½œå¹³é¢-Work-èŠ‚ç‚¹çš„ç§»é™¤-amp-amp-æ·»åŠ "><a href="#6-å·¥ä½œå¹³é¢-Work-èŠ‚ç‚¹çš„ç§»é™¤-amp-amp-æ·»åŠ " class="headerlink" title="6.å·¥ä½œå¹³é¢(Work)èŠ‚ç‚¹çš„ç§»é™¤&amp;&amp;æ·»åŠ "></a>6.å·¥ä½œå¹³é¢(Work)èŠ‚ç‚¹çš„ç§»é™¤&amp;&amp;æ·»åŠ </h3><p>æè¿°: k8sé›†ç¾¤ä¸­å·¥ä½œèŠ‚ç‚¹çš„æ·»åŠ ä¸ç§»é™¤ï¼Œå’ŒmasterèŠ‚ç‚¹ç§»é™¤æ·»åŠ æ–¹æ³•åŸºæœ¬ä¸€è‡´ï¼Œä¸åŒä¹‹å¤„åœ¨äºåŠ å…¥é›†ç¾¤çš„é…ç½®æ¸…å•ï¼Œä½ å¯ä»¥å¯¹ç…§ä¸€ä¸‹masterèŠ‚ç‚¹ä¸nodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ—¶çš„é…ç½®æ¸…å•ã€‚</p>
<p>æ­¤å¤„ï¼Œä¹Ÿä¸åœ¨ç´¯è¿°ç›´æ¥å¿«é€Ÿä¸Šè„šæœ¬ã€‚</p>
<p>æ­¥éª¤ 01.åœ¨masterèŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼Œå°†è®¾weiyigeek-226èŠ‚ç‚¹ç½®ä¸å¯è°ƒåº¦,å³ä¸åˆ†é…æ–°çš„èµ„æºåˆ°è¯¥èŠ‚ç‚¹ä¸Šï¼Œå¹¶ä¸”é©±é€podåˆ°å…¶ä»–å·¥ä½œèŠ‚ç‚¹ä¸Šã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¸©é¦¨æç¤º: drainå‘½ä»¤ä¼šè‡ªåŠ¨æŠŠnodeè®¾ç½®ä¸ºä¸å¯è°ƒåº¦ï¼Œæ‰€ä»¥å¯ä»¥çœç•¥ä¸Šé¢æ‰§è¡Œçš„cordonå‘½ä»¤</span></span><br><span class="line">kubectl cordon weiyigeek-226</span><br><span class="line">kubectl drain weiyigeek-226 --delete-emptydir-data --force --ignore-daemonsets</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>æ­¥éª¤ 02.åœ¨weiyigeek-226å·¥ä½œèŠ‚ç‚¹ä¸Šæ‰§è¡Œé‡ç½®èŠ‚ç‚¹å‘½ä»¤<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop kubelet</span><br><span class="line"><span class="built_in">echo</span> y | kubeadm reset</span><br><span class="line">sudo rm -rf <span class="variable">$HOME</span>/.kube; sudo rm -rf /var/lib/cni/ /etc/cni/ /var/lib/kubelet/* </span><br><span class="line">ipvsadm --clear; iptables -F &amp;&amp; iptables -t nat -F &amp;&amp; iptables -t mangle -F &amp;&amp; iptables -X</span><br><span class="line">systemctl start kubelet; systemctl status kubelet</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>æ­¥éª¤ 03.ä¸¤ç§æ–¹å¼å°†å·¥ä½œèŠ‚ç‚¹åŠ å…¥K8Sé›†ç¾¤ä¸­ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.å‘½ä»¤è¡Œæ¨¡å¼</span></span><br><span class="line">kubeadm join 192.168.80.137:6443 --token æ–°ç”Ÿæˆçš„Tokenå¡«å†™æ­¤å¤„ --discovery-token-ca-cert-hash sha256:è·å–çš„å…¬é’¥å“ˆå¸Œå€¼å¡«å†™æ­¤å¤„</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.é…ç½®æ¸…å•æ¨¡å¼</span></span><br><span class="line">tee &gt; join-k8s.yaml &lt;&lt;EOF</span><br><span class="line">cat join-k8s.yaml</span><br><span class="line">apiVersion: kubeadm.k8s.io/v1beta3</span><br><span class="line">caCertPath: /etc/kubernetes/pki/ca.crt</span><br><span class="line">discovery:</span><br><span class="line">  bootstrapToken:</span><br><span class="line">    apiServerEndpoint: slb-vip.k8s:16443</span><br><span class="line">    token: vkhqa1.t3gtrbowlalt8um5</span><br><span class="line">    unsafeSkipCAVerification: <span class="literal">true</span></span><br><span class="line">  timeout: 5m0s</span><br><span class="line">  tlsBootstrapToken: vkhqa1.t3gtrbowlalt8um5</span><br><span class="line">kind: JoinConfiguration</span><br><span class="line">nodeRegistration:</span><br><span class="line">  criSocket: /run/containerd/containerd.sock</span><br><span class="line">  imagePullPolicy: IfNotPresent</span><br><span class="line">  name: weiyigeek-226</span><br><span class="line">  taints: null</span><br><span class="line">EOF</span><br><span class="line">kubeadm join --config=join-k8s.yaml --v=5</span><br></pre></td></tr></table></figure>
<p><br/></p>
<p>æ­¥éª¤ 04.åœ¨masterèŠ‚ç‚¹æŸ¥çœ‹åŠ å…¥çš„å·¥ä½œçš„èŠ‚ç‚¹ï¼Œæ­¤å¤„è®¾ç½®å…¶workæ ‡ç­¾ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl label nodes weiyigeek-226 node-role.kubernetes.io/work=<span class="built_in">test</span></span><br><span class="line">kubectl get nodes weiyigeek-226</span><br><span class="line">  <span class="comment"># NAME       STATUS   ROLES   AGE    VERSION</span></span><br><span class="line">  <span class="comment"># weiyigeek-226   Ready    work    10m   v1.23.1</span></span><br></pre></td></tr></table></figure></p>
<p>è‡³æ­¤ï¼Œå®Œæ¯•!</p>
<p><br/></p>
<h3 id="n-å®è·µæ‰€é‡é—®é¢˜"><a href="#n-å®è·µæ‰€é‡é—®é¢˜" class="headerlink" title="n.å®è·µæ‰€é‡é—®é¢˜"></a>n.å®è·µæ‰€é‡é—®é¢˜</h3><h4 id="é—®é¢˜1-åœ¨masterèŠ‚ç‚¹ä¸Šæˆ–è€…émasterèŠ‚ç‚¹ä¸Šæ‰§è¡Œkubectlå‘½ä»¤æŠ¥-The-connection-to-the-server-localhost-8080-was-refused-é”™è¯¯"><a href="#é—®é¢˜1-åœ¨masterèŠ‚ç‚¹ä¸Šæˆ–è€…émasterèŠ‚ç‚¹ä¸Šæ‰§è¡Œkubectlå‘½ä»¤æŠ¥-The-connection-to-the-server-localhost-8080-was-refused-é”™è¯¯" class="headerlink" title="é—®é¢˜1.åœ¨masterèŠ‚ç‚¹ä¸Šæˆ–è€…émasterèŠ‚ç‚¹ä¸Šæ‰§è¡Œkubectlå‘½ä»¤æŠ¥ The connection to the server localhost:8080 was refused -é”™è¯¯"></a>é—®é¢˜1.åœ¨masterèŠ‚ç‚¹ä¸Šæˆ–è€…émasterèŠ‚ç‚¹ä¸Šæ‰§è¡Œkubectlå‘½ä»¤æŠ¥ <code>The connection to the server localhost:8080 was refused -</code>é”™è¯¯</h4><p>é”™è¯¯ä¿¡æ¯:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get cs</span><br><span class="line">The connection to the server localhost:8080 was refused - did you specify the right host or port?</span><br></pre></td></tr></table></figure></p>
<p>é”™è¯¯åŸå› : é€šå¸¸æƒ…å†µä¸‹æ˜¯å½“å‰ç”¨æˆ·ä¸‹æ²¡æœ‰<code>~/.kube/config</code>æˆ–è€…ä¸å­˜åœ¨ç¯å¢ƒå˜é‡<br>è§£å†³åŠæ³•:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹å¼1.å¤åˆ¶ /etc/kubernetes ç›®å½•ä¸‹ admin.conf æ–‡ä»¶åˆ° å½“å‰ç”¨æˆ·å®¶ç›®å½•ä¸‹ /.kube/config</span></span><br><span class="line">mkdir -p <span class="variable">$HOME</span>/.kube</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'yes'</span> |  sudo cp -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">sudo chown $(id -u):$(id -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼2.ä½¿ç”¨ KUBECONFIG ç¯å¢ƒå˜é‡åŒ…å«ä¸€ä¸ª kubeconfig æ–‡ä»¶åˆ—è¡¨ã€‚</span></span><br><span class="line"><span class="built_in">export</span>  KUBECONFIG=/etc/kubernetes/admin.conf:~/.kube/devops.kubeconfig</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼3.åœ¨å‘½ä»¤æ‰§è¡Œæ—¶ä½¿ç”¨--kubeconfigå‚æ•°æŒ‡å®šé…ç½®æ–‡ä»¶</span></span><br><span class="line">kubectl config --kubeconfig=/etc/kubernetes/admin.conf</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h4 id="é—®é¢˜2-åœ¨æŸmasterèŠ‚ç‚¹ä¸Šcalico-nodeå‡†å¤‡çŠ¶æ€ä¸€ç›´ä¸º0-1å¹¶æç¤º-connect-connection-refusedcalico-node-is-not-ready-é”™è¯¯"><a href="#é—®é¢˜2-åœ¨æŸmasterèŠ‚ç‚¹ä¸Šcalico-nodeå‡†å¤‡çŠ¶æ€ä¸€ç›´ä¸º0-1å¹¶æç¤º-connect-connection-refusedcalico-node-is-not-ready-é”™è¯¯" class="headerlink" title="é—®é¢˜2.åœ¨æŸmasterèŠ‚ç‚¹ä¸Šcalico-nodeå‡†å¤‡çŠ¶æ€ä¸€ç›´ä¸º0/1å¹¶æç¤º connect: connection refusedcalico/node is not ready: é”™è¯¯"></a>é—®é¢˜2.åœ¨æŸmasterèŠ‚ç‚¹ä¸Šcalico-nodeå‡†å¤‡çŠ¶æ€ä¸€ç›´ä¸º0/1å¹¶æç¤º <code>connect: connection refusedcalico/node is not ready:</code> é”™è¯¯</h4><p>é”™è¯¯ä¿¡æ¯:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pod -n kube-system calico-node-v52sv</span><br><span class="line">  <span class="comment"># NAME                READY   STATUS    RESTARTS   AGE</span></span><br><span class="line">  <span class="comment"># calico-node-v52sv   0/1     Running   0          31m</span></span><br><span class="line"></span><br><span class="line">$ kubectl describe pod -n kube-system calico-node-v52sv | grep <span class="string">"not ready"</span></span><br><span class="line">  <span class="comment"># Warning  Unhealthy    33m (x2 over 33m)  kubelet  Readiness probe failed: calico/node is not ready: BIRD is not ready: Error querying BIRD: unable to connect to BIRDv4 socket: dial unix /var/run/calico/bird.ctl: connect: connection refused</span></span><br><span class="line">  <span class="comment"># calico/node is not ready: BIRD is not ready: BGP not established with 192.168.12.107,192.168.12.109,192.168.12.223,192.168.12.224,192.168.12.225,192.168.12.226</span></span><br><span class="line"></span><br><span class="line">$ kubectl logs -f --tail 50  -n kube-system calico-node-v52sv | grep <span class="string">"interface"</span></span><br><span class="line">  <span class="comment"># 2023-02-01 08:40:57.583 [INFO][69] monitor-addresses/startup.go 714: Using autodetected IPv4 address on interface br-b92e9270f33c: 172.22.0.1/16</span></span><br><span class="line">  <span class="comment"># calico å¯¹åº”çš„ Pod å¯åŠ¨å¤±è´¥ï¼ŒæŠ¥é”™ï¼š</span></span><br><span class="line">  <span class="comment"># Number of node(s) with BGP peering established = 0</span></span><br></pre></td></tr></table></figure></p>
<p>é”™è¯¯åŸå› : ç”±äºè¯¥èŠ‚ç‚¹ä¸Šå®‰è£…äº†dockerå¹¶åˆ›å»ºäº†å®¹å™¨ï¼ŒCalico é€‰æ‹©äº†æœ‰é—®é¢˜çš„brç½‘å¡ï¼Œå¯¼è‡´ calico-node çš„ Pod ä¸èƒ½å¯åŠ¨ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Calico æä¾›äº† IP è‡ªåŠ¨æ£€æµ‹çš„æ–¹æ³•ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨ç¬¬ä¸€ä¸ªæœ‰æ•ˆç½‘å¡ä¸Šçš„ç¬¬ä¸€ä¸ªæœ‰æ•ˆçš„ IP åœ°å€ï¼š</span></span><br><span class="line">IP_AUTODETECTION_METHOD=first-found</span><br><span class="line"></span><br><span class="line"><span class="comment"># èŠ‚ç‚¹ä¸Šåº”è¯¥æ˜¯å‡ºç°äº†æœ‰é—®é¢˜çš„ç½‘å¡ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š</span></span><br><span class="line">ip link | grep br</span><br></pre></td></tr></table></figure><br>çŸ¥è¯†æ‰©å±•: calico-node daemonset é»˜è®¤çš„ç­–ç•¥æ˜¯è·å–ç¬¬ä¸€ä¸ªå–åˆ°çš„ç½‘å¡çš„ ip ä½œä¸º calico node çš„ip, ç”±äºé›†ç¾¤ä¸­ç½‘å¡åç§°ä¸ç»Ÿä¸€æ‰€ä»¥å¯èƒ½å¯¼è‡´calicoè·å–çš„ç½‘å¡IPä¸å¯¹, æ‰€ä»¥å‡ºç°æ­¤ç§æƒ…å†µä¸‹å°±åªèƒ½ IP_AUTODETECTION_METHOD å­—æ®µæŒ‡å®šé€šé…ç¬¦ç½‘å¡åç§°æˆ–è€…IPåœ°å€ã€‚</p>
<p>è§£å†³åŠæ³•:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹æ³•1.ä¿®æ”¹ yaml é…ç½®æ¸…å•ä¸­ IP è‡ªåŠ¨æ£€æµ‹æ–¹æ³•ï¼Œåœ¨ spec.containers.env ä¸‹æ·»åŠ ä»¥ä¸‹ä¸¤è¡Œã€‚ï¼ˆæ¨èï¼‰</span></span><br><span class="line">  - name: IP_AUTODETECTION_METHOD</span><br><span class="line">    value: <span class="string">"interface=ens.*"</span>  <span class="comment"># ens æ ¹æ®å®é™…ç½‘å¡å¼€å¤´é…ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•2.åˆ é™¤æœ‰é—®é¢˜çš„ç½‘å¡ï¼ˆæ¨èï¼‰ï¼Œå³æŒ‡å®šç½‘å¡åç§°ï¼ˆbr å¼€å¤´çš„é—®é¢˜ç½‘å¡ï¼‰åˆ é™¤ã€‚</span></span><br><span class="line">ifconfig br-b92e9270f33c down</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•3.å‡å¦‚ç¯å¢ƒä¸ä¾èµ–dockeræƒ…å†µä¸‹ï¼Œå¯ä»¥å¸è½½docker, ç„¶åé‡å¯ç³»ç»Ÿå³å¯ã€‚</span></span><br><span class="line">sudo apt-get autoremove docker docker-ce docker-engine docker.io</span><br></pre></td></tr></table></figure></p>
<p>æœ€åé‡æ–°å¯åŠ¨å¼‚å¸¸Podå³å¯:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pod -n kube-system calico-node-v52sv</span><br><span class="line">kubectl get nodes weiyigeek-108</span><br><span class="line">  <span class="comment"># NAME       STATUS   ROLES                  AGE   VERSION</span></span><br><span class="line">  <span class="comment"># weiyigeek-108   Ready    control-plane,master   66m   v1.23.1</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h4 id="é—®é¢˜3-åœ¨èŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ—¶æŠ¥-bridge-nf-call-iptables-does-not-existé”™è¯¯é—®é¢˜è§£å†³"><a href="#é—®é¢˜3-åœ¨èŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ—¶æŠ¥-bridge-nf-call-iptables-does-not-existé”™è¯¯é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜3.åœ¨èŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ—¶æŠ¥ bridge-nf-call-iptables does not existé”™è¯¯é—®é¢˜è§£å†³"></a>é—®é¢˜3.åœ¨èŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ—¶æŠ¥ <code>bridge-nf-call-iptables does not exist</code>é”™è¯¯é—®é¢˜è§£å†³</h4><p>é”™è¯¯ä¿¡æ¯:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[preflight] Some fatal errors occurred:</span><br><span class="line">  [ERROR FileContent--proc-sys-net-bridge-bridge-nf-call-iptables]: /proc/sys/net/bridge/bridge-nf-call-iptables does not exist</span><br><span class="line">[preflight] If you know what you are doing, you can make a check non-fatal with `--ignore-preflight-errors=...`</span><br><span class="line">error execution phase preflight</span><br></pre></td></tr></table></figure><br>è§£å†³åŠæ³•:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®</span></span><br><span class="line">$ cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf</span><br><span class="line">br_netfilter</span><br><span class="line">EOF</span><br><span class="line">$ cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">EOF</span><br><span class="line">$ modprobe br_netfilter &amp;&amp; sudo sysctl --system</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h4 id="é—®é¢˜4-åœ¨å¯åŠ¨æŸä¸ªèŠ‚ç‚¹çš„kubeletæŠ¥Unable-to-read-config-path-quot-err-quot-path-does-not-exist-ignoringé”™è¯¯è§£å†³åŠæ³•"><a href="#é—®é¢˜4-åœ¨å¯åŠ¨æŸä¸ªèŠ‚ç‚¹çš„kubeletæŠ¥Unable-to-read-config-path-quot-err-quot-path-does-not-exist-ignoringé”™è¯¯è§£å†³åŠæ³•" class="headerlink" title="é—®é¢˜4.åœ¨å¯åŠ¨æŸä¸ªèŠ‚ç‚¹çš„kubeletæŠ¥Unable to read config path&quot; err=&quot;path does not exist, ignoringé”™è¯¯è§£å†³åŠæ³•"></a>é—®é¢˜4.åœ¨å¯åŠ¨æŸä¸ªèŠ‚ç‚¹çš„kubeletæŠ¥<code>Unable to read config path&quot; err=&quot;path does not exist, ignoring</code>é”™è¯¯è§£å†³åŠæ³•</h4><p>é”™è¯¯ä¿¡æ¯:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Jan 16 14:27:25 weiyigeek-226 kubelet[882231]: E0116 14:27:25.496423  882231 kubelet.go:2347] <span class="string">"Container runtime network not ready"</span> networkReady=<span class="string">"NetworkReady=false reason:NetworkPluginNotReady message:Network plugin returns e&gt;</span></span><br><span class="line"><span class="string">Jan 16 14:27:26 weiyigeek-226 kubelet[882231]: E0116 14:27:26.482369  882231 file_linux.go:61] "</span>Unable to <span class="built_in">read</span> config path<span class="string">" err="</span>path does not exist, ignoring<span class="string">" path="</span>/etc/kubernetes/manifests<span class="string">"</span></span><br><span class="line"><span class="string">J</span></span><br></pre></td></tr></table></figure><br>è§£å†³åŠæ³•: æ£€æŸ¥ /etc/kubernetes/manifests ç›®å½•æ˜¯å¦å­˜å‚¨åŠå…¶æƒé™<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -vp /etc/kubernetes/manifests</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h4 id="é—®é¢˜5-åœ¨èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­æ—¶æŠ¥the-namespace-quot-kube-system-quot-error-downloading-the-secret-é”™è¯¯è§£å†³åŠæ³•"><a href="#é—®é¢˜5-åœ¨èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­æ—¶æŠ¥the-namespace-quot-kube-system-quot-error-downloading-the-secret-é”™è¯¯è§£å†³åŠæ³•" class="headerlink" title="é—®é¢˜5.åœ¨èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­æ—¶æŠ¥the namespace &quot;kube-system&quot; error downloading the secret é”™è¯¯è§£å†³åŠæ³•"></a>é—®é¢˜5.åœ¨èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­æ—¶æŠ¥<code>the namespace &quot;kube-system&quot; error downloading the secret</code> é”™è¯¯è§£å†³åŠæ³•</h4><p>é”™è¯¯ä¿¡æ¯:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">I0116 04:39:41.428788  184219 checks.go:246] validating the existence and emptiness of directory /var/lib/etcd</span><br><span class="line">[preflight] Would pull the required images (like <span class="string">'kubeadm config images pull'</span>)</span><br><span class="line">[download-certs] Downloading the certificates <span class="keyword">in</span> Secret <span class="string">"kubeadm-certs"</span> <span class="keyword">in</span> the <span class="string">"kube-system"</span> Namespace</span><br><span class="line">secrets <span class="string">"kubeadm-certs"</span> is forbidden: User <span class="string">"system:bootstrap:20w21w"</span> cannot get resource <span class="string">"secrets"</span> <span class="keyword">in</span> API group <span class="string">""</span> <span class="keyword">in</span> the namespace <span class="string">"kube-system"</span></span><br><span class="line">error downloading the secret</span><br></pre></td></tr></table></figure><br>è§£å†³åŠæ³•: å°†è¯ä¹¦ä¸Šè½½åˆ°kubeadmè¯ä¹¦ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init phase upload-certs --upload-certs</span><br><span class="line">  <span class="comment"># [upload-certs] Storing the certificates in Secret "kubeadm-certs" in the "kube-system" Namespace</span></span><br><span class="line">  <span class="comment"># [upload-certs] Using certificate key:</span></span><br><span class="line">  <span class="comment"># 3a3d7610038c9d14edf377d92b9c6b44e049566ddd25b0e69bf571af58227ae7</span></span><br></pre></td></tr></table></figure></p>

        </div>
        
        <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
        
        <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½çœ‹å‹,æ¬¢è¿å…³æ³¨åšä¸»å¾®ä¿¡å…¬ä¼—å·å“Ÿ! â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘å³å¯å…³é—­ç»§ç»­æµè§ˆæ–‡ç« .<br>  <b style="color:red;"> æ¸©é¦¨æç¤º: æœªè§£é”çš„ç”¨æˆ·ä¸èƒ½ç²˜è´´å¤åˆ¶æ–‡ç« å†…å®¹å“Ÿ!</b> <br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
           

        <!-- Google å¹¿å‘Š -->
        
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-9134434519967436" data-ad-slot="7905848205"></ins>
  

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>
  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·ä¸Visit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº" >
    <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ã€è½¬ä¸ªå‘ã€èµä¸ªåŠ©ã€‘</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°†æŒç»­æ•´ç†å‘å¸ƒæ›´å¤šä¼˜è´¨åŸåˆ›æ–‡ç« ï¼ã€‚</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2023-02-06T14:03:37.756Z" itemprop="dateUpdated">2023-02-06 22:03:37</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/23-Kubernetesæ‰©å±•å­¦ä¹ å®è·µç¬”è®°.md" target="_blank" rel="noopener noreferrer">_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/23-Kubernetesæ‰©å±•å­¦ä¹ å®è·µç¬”è®°.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2022/12-18-691.html" target="_blank" rel="external">https://blog.weiyigeek.top/2022/12-18-691.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">â˜•ï¸ è¯·ä½œè€…å–æ¯å’–å•¡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2022/12-18-691.html&title=ã€Š23-Kubernetesä¹‹ä¼ä¸šè¿ç»´å®è·µæ“ä½œç¬”è®°ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2022/12-18-691.html&title=ã€Š23-Kubernetesä¹‹ä¼ä¸šè¿ç»´å®è·µæ“ä½œç¬”è®°ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2022/12-18-691.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š23-Kubernetesä¹‹ä¼ä¸šè¿ç»´å®è·µæ“ä½œç¬”è®°ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2022/12-18-691.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2022/12-18-691.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2023/1-1-706.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">15.è®¡ç®—æœºç§‘å­¦å¯¼è®ºä¹‹æ•°æ®å‹ç¼©å­¦ä¹ ç¬”è®°</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2022/10-15-690.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">22-kubernetesé›†ç¾¤ä¸­è¿›è¡Œetcdæ•°æ®å¿«ç…§çš„å¤‡ä»½æ¢å¤</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-å®æ“1-è®°ä¸€æ¬¡-Kubernetes-V1-23-x-é›†ç¾¤è¯ä¹¦è¿‡æœŸæˆ–è€…å»¶æœŸå¤„ç†æ“ä½œå®è·µæ¡ˆä¾‹"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 å®æ“1.è®°ä¸€æ¬¡ Kubernetes V1.23.x é›†ç¾¤è¯ä¹¦è¿‡æœŸæˆ–è€…å»¶æœŸå¤„ç†æ“ä½œå®è·µæ¡ˆä¾‹</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-å‰è¨€ç®€è¿°"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">1.å‰è¨€ç®€è¿°</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-å®è·µç¯å¢ƒ"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">2.å®è·µç¯å¢ƒ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-è¯ä¹¦ç»­ç­¾"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">3.è¯ä¹¦ç»­ç­¾</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-é›†ç¾¤è¯ä¹¦æ›´æ–°å-calico-amp-amp-kube-proxy-ç›¸å…³æ“ä½œ"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">4.é›†ç¾¤è¯ä¹¦æ›´æ–°å calico &amp;&amp; kube-proxy ç›¸å…³æ“ä½œ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-æ§åˆ¶å¹³é¢-Master-èŠ‚ç‚¹çš„ç§»é™¤-amp-amp-æ·»åŠ "><span class="post-toc-number">1.5.</span> <span class="post-toc-text">5.æ§åˆ¶å¹³é¢(Master)èŠ‚ç‚¹çš„ç§»é™¤&amp;&amp;æ·»åŠ </span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#6-å·¥ä½œå¹³é¢-Work-èŠ‚ç‚¹çš„ç§»é™¤-amp-amp-æ·»åŠ "><span class="post-toc-number">1.6.</span> <span class="post-toc-text">6.å·¥ä½œå¹³é¢(Work)èŠ‚ç‚¹çš„ç§»é™¤&amp;&amp;æ·»åŠ </span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#n-å®è·µæ‰€é‡é—®é¢˜"><span class="post-toc-number">1.7.</span> <span class="post-toc-text">n.å®è·µæ‰€é‡é—®é¢˜</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#é—®é¢˜1-åœ¨masterèŠ‚ç‚¹ä¸Šæˆ–è€…émasterèŠ‚ç‚¹ä¸Šæ‰§è¡Œkubectlå‘½ä»¤æŠ¥-The-connection-to-the-server-localhost-8080-was-refused-é”™è¯¯"><span class="post-toc-number">1.7.1.</span> <span class="post-toc-text">é—®é¢˜1.åœ¨masterèŠ‚ç‚¹ä¸Šæˆ–è€…émasterèŠ‚ç‚¹ä¸Šæ‰§è¡Œkubectlå‘½ä»¤æŠ¥ The connection to the server localhost:8080 was refused -é”™è¯¯</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#é—®é¢˜2-åœ¨æŸmasterèŠ‚ç‚¹ä¸Šcalico-nodeå‡†å¤‡çŠ¶æ€ä¸€ç›´ä¸º0-1å¹¶æç¤º-connect-connection-refusedcalico-node-is-not-ready-é”™è¯¯"><span class="post-toc-number">1.7.2.</span> <span class="post-toc-text">é—®é¢˜2.åœ¨æŸmasterèŠ‚ç‚¹ä¸Šcalico-nodeå‡†å¤‡çŠ¶æ€ä¸€ç›´ä¸º0&#x2F;1å¹¶æç¤º connect: connection refusedcalico&#x2F;node is not ready: é”™è¯¯</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#é—®é¢˜3-åœ¨èŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ—¶æŠ¥-bridge-nf-call-iptables-does-not-existé”™è¯¯é—®é¢˜è§£å†³"><span class="post-toc-number">1.7.3.</span> <span class="post-toc-text">é—®é¢˜3.åœ¨èŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ—¶æŠ¥ bridge-nf-call-iptables does not existé”™è¯¯é—®é¢˜è§£å†³</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#é—®é¢˜4-åœ¨å¯åŠ¨æŸä¸ªèŠ‚ç‚¹çš„kubeletæŠ¥Unable-to-read-config-path-quot-err-quot-path-does-not-exist-ignoringé”™è¯¯è§£å†³åŠæ³•"><span class="post-toc-number">1.7.4.</span> <span class="post-toc-text">é—®é¢˜4.åœ¨å¯åŠ¨æŸä¸ªèŠ‚ç‚¹çš„kubeletæŠ¥Unable to read config path&quot; err&#x3D;&quot;path does not exist, ignoringé”™è¯¯è§£å†³åŠæ³•</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#é—®é¢˜5-åœ¨èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­æ—¶æŠ¥the-namespace-quot-kube-system-quot-error-downloading-the-secret-é”™è¯¯è§£å†³åŠæ³•"><span class="post-toc-number">1.7.5.</span> <span class="post-toc-text">é—®é¢˜5.åœ¨èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­æ—¶æŠ¥the namespace &quot;kube-system&quot; error downloading the secret é”™è¯¯è§£å†³åŠæ³•</span></a></li></ol></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
    <!-- 
  <div id="post-wechat" class="post-wechat" style="position:fixed;top: 360px;bottom: 500px;right: 3%;width: 190px;text-align: center; z-index: 9999">
    <p><b>å…³æ³¨ã€å…¨æ ˆå·¥ç¨‹å¸ˆä¿®ç‚¼æŒ‡å—ã€‘</b></p>
    <img src="/img/wechat-gzh.jpg" class="img-responsive" alt="weiyigeek">
    <p><b>æ¬¢è¿æ·»åŠ ã€ä½œè€…ã€‘å¾®ä¿¡</b></p>
    <img src="/img/wehat.jpg" class="img-responsive" alt="weiyigeek">
  </div>


 -->

    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå°±è¯·ä½œè€…å–æ¯ Coffee â˜•ï¸â˜•ï¸!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="/img/share-wechat.jpg" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">åšä¸»Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">åšä¸»Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">çŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.modb.pro/u/506690" target="_blank">å¢¨å¤©è½®</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.ixigua.com/home/3984243135350727" target="_blank">è¥¿ç“œè§†é¢‘</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2023 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/><a id="SiteRunTime"></a>
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div>
        <div id="blog-wormhole-id" >
          <a href="https://www.foreverblog.cn/go.html" target="_blank"> 
            <img src="https://img.foreverblog.cn/wormhole_2_tp.gif" alt="åå¹´ä¹‹çº¦è™«æ´" style="height:32px;max-height:50px;display:block;margin:0 auto;" title="ç©¿æ¢­è™«æ´-éšæœºè®¿é—®åå¹´ä¹‹çº¦å‹é“¾åšå®¢">
          </a>
        </div>
        <div id="cc-myssl-id" >
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank">
            <img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto">
          </a>
        </div>
      </p>
    </div>
</footer>



    <div class="mask" id="mask"></div>

<div id="go" class="waves-effect waves-light">
  <a href="javascript:;" id="goqrcode"> <span class="icon icon-lg icon-qrcode"></span> </a>
  <a href="javascript:;" id="gotop"> <span class="icon icon-lg icon-chevron-up"></span></a>
</div>





<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2022/12-18-691.html&title=ã€Š23-Kubernetesä¹‹ä¼ä¸šè¿ç»´å®è·µæ“ä½œç¬”è®°ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2022/12-18-691.html&title=ã€Š23-Kubernetesä¹‹ä¼ä¸šè¿ç»´å®è·µæ“ä½œç¬”è®°ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2022/12-18-691.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š23-Kubernetesä¹‹ä¼ä¸šè¿ç»´å®è·µæ“ä½œç¬”è®°ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2022/12-18-691.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2022/12-18-691.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACMElEQVR42u3a0U7DMAwFUP7/p4fEEwi63etsSEtOntBW2pwiGTv2x0e8bl8r+eT758k1+bdPWBgYGG/LuN1dV9fk9/lNSr7N94aBgXEO436QTYJpEmTbMJ0/BQMDAyNJ1/L0sQ30GBgYGDPGSrF6P9RiYGBgrBSx91O9PEDnL+UltTgGBsYbMtrGwH/+/ML+BgYGxpswbuXK79Omg0u7wsDA2JqRp3p5xJsFzZVnYWBgnMB4VnDMG5/5gVre+MTAwNiV0Q5MtAMZyftrGZcZLgYGxgGM5DH5yFfRehw1Bn5ciYGBsTWjTfjWw2VyrDYsdzEwMA5gJOVikqjlgbu924PXioGBcQzjWSE4uVueekbBFwMD4xjGLHSuNDVXXh8GBsYJjFkBOeuOzsrUqP2JgYFxDKP4tbh5mReu+fWXwxYYGBibMoZH8OUgxQq+5WFgYOzKyJsBbfNgpRiu/wIYGBgHMPLRh/XydWW0YnhqiIGBsRFjffyizUPb0Y3LMI2BgbEpY9ZobMvUdniiLokxMDAOY6yMgs3an8mrfLAHDAyMrRmzg/58o0kob1fR38DAwNiCcSvXemszL02LQIyBgbE1ow1zs8I1T0PzMrhIEDEwMLZg5EG2bW3OCuPhHjAwMA5gzILgSno3+w9QTLdhYGAcyVjZVnv0n+zzj9QQAwMDI358e0zWlsGXRSwGBsbWjLaIza9pU71hOY2BgbE1Y1Y6zrY7K5iHY2EYGBg7MD4BjXfWLOCYBZoAAAAASUVORK5CYII=" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<script> (adsbygoogle = window.adsbygoogle || []).push({});</script>    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å”¯ä¸€æå®¢-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
<script type="text/javascript">
// ç«™ç‚¹è¿è¡Œæ—¶é—´
var BootDate = new Date("2018/01/01 00:00:00");
function ShowRunTime(id) {
  var NowDate = new Date();
  var RunDateM = parseInt(NowDate - BootDate);
  var RunDays = Math.floor(RunDateM/(24*3600*1000));
  var RunHours = Math.floor(RunDateM%(24*3600*1000)/(3600*1000));
  var RunMinutes = Math.floor(RunDateM%(24*3600*1000)%(3600*1000)/(60*1000));
  var RunSeconds = Math.round(RunDateM%(24*3600*1000)%(3600*1000)%(60*1000)/1000);
  var RunTime = RunDays + " å¤© " + RunHours + " æ—¶ " + RunMinutes + " åˆ† " + RunSeconds + " ç§’";
  document.getElementById(id).innerHTML = "ç½‘ç«™å·²åœ¨é£é›¨ä¸­å‹‰å‹‰å¼ºå¼ºè¿è¡Œäº†ã€ " + RunTime + " ã€‘";
}
setInterval("ShowRunTime('SiteRunTime')", 1000);
</script>
    
  <div id="post-wechat" class="post-wechat" style="position:fixed;top: 360px;bottom: 500px;right: 3%;width: 190px;text-align: center; z-index: 9999">
    <p><b>å…³æ³¨ã€å…¨æ ˆå·¥ç¨‹å¸ˆä¿®ç‚¼æŒ‡å—ã€‘</b></p>
    <img src="/img/wechat-gzh.jpg" class="img-responsive" alt="weiyigeek">
    <p><b>æ¬¢è¿æ·»åŠ ã€ä½œè€…ã€‘å¾®ä¿¡</b></p>
    <img src="/img/wehat.jpg" class="img-responsive" alt="weiyigeek">
  </div>



</body>
</html>