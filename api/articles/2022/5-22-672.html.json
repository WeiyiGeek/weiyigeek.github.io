{"title":"K3s之快速搭建精简版本K8S集群环境","slug":"虚拟云容/云容器/Rancher/K3s之快速搭建精简版本K8S集群环境","date":"2022-05-22T06:36:30.000Z","updated":"2022-07-18T09:38:26.322Z","url":"2022/5-22-672.html","path":"api/articles/2022/5-22-672.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220614220140.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<p><strong>Q: 什么是 K3S?</strong></p>\n<blockquote>\n<p>描述: 它是一个轻量级K8S(Lightweight Kubernetes)同时它也是一个云原生计算基金会(CNCF)沙盒项目, 为物联网和边缘计算构建的经过认证的 Kubernetes 发行版, 减少了kubernetes云供应商相关插件所以其更加精简, 部署也更加简单。</p>\n</blockquote>\n<p><strong>Q: 为什么使用 K3S?</strong></p>\n<blockquote>\n<p>1) 简化和安全 : K3s 单个二进制文件小于50MB，可减少安装、运行和自动更新生产 Kubernetes 集群所需的依赖关系和步骤。<br>2) 边缘的完美选择: 高度可用、经过认证的 Kubernetes 发行版，专为无人值守、资源受限的远程位置或 IoT 设备内部的生产工作负载而设计。<br>3) 支持ARM优化 : K3S 提供了 ARM64 和 ARMv7 都支持二进制文件和多架构映像, 所以可以运行在嵌入式设备之中。</p>\n</blockquote>\n<p><strong>K3S 体系架构图</strong></p>\n<blockquote>\n<p>描述: K3S 它由 Server 与 Agent 两大节点组成, 从下图中可以看出</p>\n</blockquote>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220614220140.png\" alt=\"WeiyiGeek.K3S-How it Works\" title=\"\" class=\"\">\n                <p>WeiyiGeek.K3S-How it Works</p>\n            </figure>\n<p>官方地址: <a href=\"https://k3s.io/\" target=\"_blank\" rel=\"noopener\">https://k3s.io/</a> &amp;&amp; <a href=\"https://www.rancher.cn/k3s/\" target=\"_blank\" rel=\"noopener\">https://www.rancher.cn/k3s/</a><br>官方文档: <a href=\"https://rancher.com/docs/k3s/latest/en/\" target=\"_blank\" rel=\"noopener\">https://rancher.com/docs/k3s/latest/en/</a><br>项目地址: <a href=\"https://github.com/rancher/k3s/releases/latest\" target=\"_blank\" rel=\"noopener\">https://github.com/rancher/k3s/releases/latest</a> &amp;&amp; <a href=\"https://github.com/k3s-io/k3s/\" target=\"_blank\" rel=\"noopener\">https://github.com/k3s-io/k3s/</a></p>\n<p>当前【2022年6月14日 22:04:49】节点最新版本为 v1.24.1+k3s1 (<a href=\"https://github.com/k3s-io/k3s/releases/tag/v1.24.1+k3s1\" target=\"_blank\" rel=\"noopener\">https://github.com/k3s-io/k3s/releases/tag/v1.24.1+k3s1</a>)</p>\n<h3 id=\"安装要求\"><a href=\"#安装要求\" class=\"headerlink\" title=\"安装要求\"></a>安装要求</h3><p>无论您是将 K3s 集群配置为在 Docker 还是 Kubernetes 设置中运行，运行 K3 的每个节点都应满足以下最低要求。您可能需要更多资源来满足您的需求。</p>\n<ul>\n<li>硬件: 内存最少512MB（建议至少1GB）, CPU 最少一个, 磁盘最好使用SSD。</li>\n<li>软件: 选择常用的操作系统例如Ubuntu、、Debian、CentOS等, </li>\n<li>先决条件：<ul>\n<li>节点不能具有相同的主机名</li>\n<li>防火墙需要对k3s Server 的 6443端口 放行，因为 K3s服务器需要端口 6443 才能被所有节点访问。</li>\n</ul>\n</li>\n</ul>\n<p>K3s服务器节点的入站规则(Inbound Rules for K3s Server Nodes)</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">PROTOCOL</th>\n<th style=\"text-align:left\">PORT</th>\n<th style=\"text-align:left\">SOURCE</th>\n<th style=\"text-align:left\">DESCRIPTION</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">TCP</td>\n<td style=\"text-align:left\">6443</td>\n<td style=\"text-align:left\">K3s agent nodes</td>\n<td style=\"text-align:left\">Kubernetes API Server</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">UDP</td>\n<td style=\"text-align:left\">8472</td>\n<td style=\"text-align:left\">K3s server and agent nodes</td>\n<td style=\"text-align:left\">Required only for Flannel VXLAN</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">UDP</td>\n<td style=\"text-align:left\">51820</td>\n<td style=\"text-align:left\">K3s server and agent nodes</td>\n<td style=\"text-align:left\">Required only for Flannel Wireguard backend</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">UDP</td>\n<td style=\"text-align:left\">51821</td>\n<td style=\"text-align:left\">K3s server and agent nodes</td>\n<td style=\"text-align:left\">Required only for Flannel Wireguard backend with IPv6</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">TCP</td>\n<td style=\"text-align:left\">10250</td>\n<td style=\"text-align:left\">K3s server and agent nodes</td>\n<td style=\"text-align:left\">Kubelet metrics</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">TCP</td>\n<td style=\"text-align:left\">2379-2380</td>\n<td style=\"text-align:left\">K3s server nodes</td>\n<td style=\"text-align:left\">Required only for HA with embedded etcd</td>\n</tr>\n</tbody>\n</table>\n<p>对于生产环境中的外部数据库，建议使用以下数据库<code>MySQL （常用）/ PostgreSQL / etcd</code>，并且硬件要求取决于 K3s 集群的大小以下是高可用性K3s服务器中节点的最低CPU和内存要求：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">DEPLOYMENT SIZE</th>\n<th style=\"text-align:left\">NODES</th>\n<th style=\"text-align:left\">VCPUS</th>\n<th style=\"text-align:left\">RAM</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Small</td>\n<td style=\"text-align:left\">Up to 10</td>\n<td style=\"text-align:left\">2</td>\n<td style=\"text-align:left\">4 GB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Medium</td>\n<td style=\"text-align:left\">Up to 100</td>\n<td style=\"text-align:left\">4</td>\n<td style=\"text-align:left\">8 GB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Large</td>\n<td style=\"text-align:left\">Up to 250</td>\n<td style=\"text-align:left\">8</td>\n<td style=\"text-align:left\">16 GB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">X-Large</td>\n<td style=\"text-align:left\">Up to 500</td>\n<td style=\"text-align:left\">16</td>\n<td style=\"text-align:left\">32 GB</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">XX-Large</td>\n<td style=\"text-align:left\">500+</td>\n<td style=\"text-align:left\">32</td>\n<td style=\"text-align:left\">64 GB</td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget -c https://github.com/k3s-io/k3s/releases/download/v1.24.1%2Bk3s1/k3s</span><br><span class=\"line\"></span><br><span class=\"line\">cp k3s /usr/<span class=\"built_in\">local</span>/bin/k3s &amp;&amp;  chmod +x /usr/<span class=\"built_in\">local</span>/bin/k3s</span><br><span class=\"line\"></span><br><span class=\"line\">k3s --version</span><br><span class=\"line\">k3s version v1.24.1+k3s1 (0581808f)</span><br><span class=\"line\">go version go1.18.1</span><br></pre></td></tr></table></figure>","comments":true,"excerpt":"[TOC]","categories":[{"name":"Containers","path":"api/categories/Containers.json"},{"name":"OperationTools","path":"api/categories/OperationTools.json"}],"tags":[{"name":"K3S","path":"api/tags/K3S.json"}]}