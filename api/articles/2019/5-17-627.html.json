{"title":"Win2022基础配置实践指南","slug":"系统运维/Windows/系统配置/Server/Win2022/Win2022基础配置实践指南","date":"2019-05-17T09:34:30.000Z","updated":"2022-09-16T06:38:53.173Z","url":"2019/5-17-627.html","path":"api/articles/2019/5-17-627.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211127195908.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211127201540.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211127202611.png","https://docs.microsoft.com/zh-cn/windows/wsl/media/windows-file-explorer.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h2 id=\"0x01-基础配置\"><a href=\"#0x01-基础配置\" class=\"headerlink\" title=\"0x01 基础配置\"></a>0x01 基础配置</h2><h3 id=\"1-WSL之Linux系统安装\"><a href=\"#1-WSL之Linux系统安装\" class=\"headerlink\" title=\"1.WSL之Linux系统安装\"></a>1.WSL之Linux系统安装</h3><p><strong>Q: 什么是适用于 Linux 的 Windows 子系统？</strong></p>\n<blockquote>\n<p>答: 适用于 Linux 的 Windows 子系统(<code>简称WSL</code>-Windows Subsystem for Linux)可让开发人员直接在 Windows 上按原样运行 GNU/Linux 环境（包括大多数命令行工具、实用工具和应用程序），且不会产生传统虚拟机或双启动设置开销。</p>\n</blockquote>\n<p><strong>Linux 的 Windows 子系统(<code>简称WSL</code>)拥有如下功能:</strong></p>\n<ul>\n<li><p>运行常用的命令行软件工具（例如 grep、sed、awk）或其他 ELF-64 二进制文件。</p>\n</li>\n<li><p>运行 Bash shell 脚本和 GNU/Linux 命令行应用程序，包括：<br>工具：vim、emacs、tmux<br>语言：NodeJS、Javascript、Python、Ruby、C/ C++、C# 与 F#、Rust、Go 等。<br>服务：SSHD、MySQL、Apache、lighttpd、MongoDB、PostgreSQL。</p>\n</li>\n<li><p>使用自己的 GNU/Linux 分发包管理器安装其他软件。</p>\n</li>\n<li><p>使用类似于 Unix 的命令行 shell 调用 Windows 应用程序。</p>\n</li>\n<li><p>在 Windows 上调用 GNU/Linux 应用程序。</p>\n</li>\n</ul>\n<p><strong>Q: 什么是 WSL 2？</strong></p>\n<blockquote>\n<p>答: WSL 2 是适用于 Linux 的 Windows 子系统体系结构的一个新版本，它支持适用于 Linux 的 Windows 子系统在 Windows 上运行 <code>ELF64</code> Linux 二进制文件。 它的主要目标是提高文件系统性能，以及添加完全的系统调用兼容性。<br>WSL 2 使用最新、最强大的虚拟化技术在轻量级实用工具虚拟机 (VM) 中运行 Linux 内核。 但是，WSL 2 不是传统的 VM 体验。</p>\n</blockquote>\n<p>Tips: 单个 Linux 分发版可以在 WSL 1 或 WSL 2 体系结构中运行。 每个分发版可随时升级或降级，并且你可以并行运行 WSL 1 和 WSL 2 分发版。</p>\n<p><strong>比较 WSL 1 和 WSL 2</strong><br>从 WSL 1 升级到 WSL 2 的主要区别和优势是：完整的 Linux 内核、提高文件系统(IO)性能、支持完全的系统调用兼容性。</p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211127195908.png\" alt=\"WeiyiGeek.WSL1与WSL2功能比较\" title=\"\" class=\"\">\n                <p>WeiyiGeek.WSL1与WSL2功能比较</p>\n            </figure>\n<p>Tips: WSL 2 仅适用于 Windows 10 版本 1903、内部版本 18362 或更高版本。通过按 Windows 徽标键 + R，检查你的 Windows 版本，然后键入 winver，选择“确定”。（或者在 Windows 命令提示符下输入 ver 命令）。 </p>\n<p>Tips: 非常注意，如果系统版本低于 18362 的版本根本不支持 WSL2，如果系统版本低于1709 根本不支持 WSL1。</p>\n<p>Tips：<code>Windows Server 2019 和 2022</code>不支持 WSL2，坑呀。<a href=\"https://github.com/microsoft/WSL/issues/7666\" target=\"_blank\" rel=\"noopener\">https://github.com/microsoft/WSL/issues/7666</a></p>\n<p><br></p>\n<p><strong>在Windows2022服务器上安装配置WSL流程:</strong></p>\n<p>第一步,打开服务器管理器，添加角色和功能，在功能中勾选<code>【适用于Linux的Windows子系统】</code>并重启，然后才能在 Windows 上运行 Linux 发行版。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 命令方式1.以管理员身份打开 PowerShell 并运行：</span></span><br><span class=\"line\">Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 命令方式2.以管理员身份打开 cmd 并运行：</span></span><br><span class=\"line\"><span class=\"comment\"># dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安装 WSL 2 之前，必须启用“虚拟机平台”可选功能,并重启计算机</span></span><br><span class=\"line\">dism.exe /online /<span class=\"built_in\">enable</span>-feature /featurename:VirtualMachinePlatform /all /norestart</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211127201540.png\" alt=\"WeiyiGeek.WindowsSubsytemForLinux\" title=\"\" class=\"\">\n                <p>WeiyiGeek.WindowsSubsytemForLinux</p>\n            </figure>\n<p>第二步，下载 Linux 内核更新包安装完成后，请继续执行在安装新的 Linux 分发时，将 WSL 2 设置为默认版本。 （如果希望将新的 Linux 安装设置为 WSL 1，请跳过此步骤。）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 下载安装 Linux 内核更新包 </span><br><span class=\"line\">curl.exe -L https:&#x2F;&#x2F;wslstorestorage.blob.core.windows.net&#x2F;wslblob&#x2F;wsl_update_x64.msi -o wsl_update_x64.msi</span><br><span class=\"line\"></span><br><span class=\"line\"># 将 WSL 2 设置为默认版本,执行&#96;wsl --set-default-version 2&#96;powershell 命令即可。 WindowsServer2022 不适用于WSL2</span><br><span class=\"line\"># wsl --set-default-version 2</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看默认版本</span><br><span class=\"line\"># wsl --status</span><br><span class=\"line\">默认版本：2</span><br></pre></td></tr></table></figure>\n<p>第三步,下载指定的Linux发行版，下面罗列出一些常用的发行版本下载地址，以下面链接可以直接从浏览器中下载，微软Store(<a href=\"https://aka.ms/wslstore\" target=\"_blank\" rel=\"noopener\">https://aka.ms/wslstore</a>)</p>\n<ul>\n<li><a href=\"https://aka.ms/wslubuntu2004\" target=\"_blank\" rel=\"noopener\">Ubuntu 20.04</a></li>\n<li><a href=\"https://aka.ms/wslubuntu2004arm\" target=\"_blank\" rel=\"noopener\">Ubuntu 20.04 ARM</a></li>\n<li><a href=\"https://aka.ms/wsl-ubuntu-1804\" target=\"_blank\" rel=\"noopener\">Ubuntu 18.04</a></li>\n<li><a href=\"https://aka.ms/wsl-ubuntu-1804-arm\" target=\"_blank\" rel=\"noopener\">Ubuntu 18.04 ARM</a></li>\n<li><a href=\"https://aka.ms/wsl-ubuntu-1604\" target=\"_blank\" rel=\"noopener\">Ubuntu 16.04</a></li>\n<li><a href=\"https://aka.ms/wsl-debian-gnulinux\" target=\"_blank\" rel=\"noopener\">Debian GNU/Linux</a></li>\n<li><a href=\"https://aka.ms/wsl-kali-linux-new\" target=\"_blank\" rel=\"noopener\">Kali Linux</a></li>\n<li><a href=\"https://aka.ms/wsl-opensuse-42\" target=\"_blank\" rel=\"noopener\">OpenSUSE Leap 42</a></li>\n<li><a href=\"https://aka.ms/wsl-sles-12\" target=\"_blank\" rel=\"noopener\">SUSE Linux Enterprise Server 12</a></li>\n<li><a href=\"https://github.com/WhitewaterFoundry/WSLFedoraRemix/releases/\" target=\"_blank\" rel=\"noopener\">Fedora Remix for WSL</a></li>\n</ul>\n<p><strong>命令行下载:</strong><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 方式1.</span><br><span class=\"line\">Invoke-WebRequest -Uri https:&#x2F;&#x2F;aka.ms&#x2F;wslubuntu2004 -OutFile Ubuntu2004.appx -UseBasicParsing</span><br><span class=\"line\"># 方式2.</span><br><span class=\"line\">curl.exe -L -o ubuntu2004.appx https:&#x2F;&#x2F;aka.ms&#x2F;wslubuntu2004</span><br></pre></td></tr></table></figure></p>\n<p>第三步,下载需要将ubuntu2004.appx重命名为ubuntu.zip并解压提取 Linux 分发版。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Rename-Item .\\ubuntu2004.appx .\\Ubuntu.zip</span><br><span class=\"line\">Expand-Archive .\\Ubuntu.zip D:\\Ubuntu</span><br></pre></td></tr></table></figure>\n<p>第四步,系统环境变量的设置，将Ubuntu.exe目录加入到PATH之中，此处是放在<code>D:\\Ubuntu</code>目录下。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$userenv &#x3D; [System.Environment]::GetEnvironmentVariable(&quot;Path&quot;, &quot;User&quot;)</span><br><span class=\"line\">[System.Environment]::SetEnvironmentVariable(&quot;PATH&quot;, $userenv + &quot;;D:\\Ubuntu&quot;, &quot;User&quot;)</span><br></pre></td></tr></table></figure>\n<p>第五步，启动Ubuntu以管理员模式打开PowerShell，在在目标文件夹中运行分发版启动器应用程序；执行<code>D:\\Ubuntu\\ubuntu2004.exe</code>进行启动，非常注意第一次进入需要等待系统初始化完成，并设置好用户名和密码，之后再进入就是如下。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; wsl</span><br><span class=\"line\">&gt; wsl --list --verbose             // 或者 wsl -l -v</span><br><span class=\"line\">  NAME            STATE           VERSION</span><br><span class=\"line\">* Ubuntu-20.04    Stopped         1   // 1表示WSL1版本,2表示WSL2版本,WinServer 2022 不适用WSL2</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211127202611.png\" alt=\"WeiyiGeek.WSL2\"></p>\n<p>祝贺你！现已成功安装并设置了与 Windows 操作系统完全集成的 Linux 分发！</p>\n<p>第七步，若要在 Windows 文件资源管理器 中打开 WSL 项目，请输入：<code>explorer.exe .</code>请务必在命令末尾添加期限以打开当前目录。</p>\n<p>例如，在存储 WSL 项目文件时：</p>\n<ul>\n<li>使用 Linux 文件系统根目录：<code>\\\\wsl$\\\\home\\\\Project</code></li>\n<li>不是Windows根目录： <code>C:\\Users\\\\Project</code> 或<code>/mnt/c/Users//Project$</code></li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://docs.microsoft.com/zh-cn/windows/wsl/media/windows-file-explorer.png\" alt=\"Ubuntu-root-文件存储\" title=\"\" class=\"\">\n                <p>Ubuntu-root-文件存储</p>\n            </figure>\n<p>第八步，WSL执行如下命令，进行查看并在线下载额外的发行版本，例如Debian</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS C:\\Users\\Administrator\\Desktop&gt; wsl --list -o</span><br><span class=\"line\">以下是可安装的有效分发的列表。</span><br><span class=\"line\">请使用 “wsl --install -d &lt;Distro&gt;”安装。</span><br><span class=\"line\">NAME            FRIENDLY NAME</span><br><span class=\"line\">Ubuntu          Ubuntu</span><br><span class=\"line\">Debian          Debian GNU&#x2F;Linux</span><br><span class=\"line\">kali-linux      Kali Linux Rolling</span><br><span class=\"line\">openSUSE-42     openSUSE Leap 42</span><br><span class=\"line\">SLES-12         SUSE Linux Enterprise Server v12</span><br><span class=\"line\">Ubuntu-16.04    Ubuntu 16.04 LTS</span><br><span class=\"line\">Ubuntu-18.04    Ubuntu 18.04 LTS</span><br><span class=\"line\">Ubuntu-20.04    Ubuntu 20.04 LTS</span><br><span class=\"line\"></span><br><span class=\"line\">PS C:\\Users\\Administrator\\Desktop&gt; wsl --install --distribution Debian</span><br><span class=\"line\">正在下载: Debian GNU&#x2F;Linux</span><br><span class=\"line\">[                           1.5%                           ]  &#x2F;&#x2F; 比较慢需要耐心等待</span><br></pre></td></tr></table></figure>\n<p>第九步，安装并开始设置 Windows 终端，如果你无法访问 Microsoft Store，<strong><a href=\"https://github.com/microsoft/terminal/releases\" target=\"_blank\" rel=\"noopener\">GitHub 发布页</a></strong>上发布有内部版本。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装方式1</span></span><br><span class=\"line\">Add-appxpackage .\\Microsoft.WindowsTerminal_1.11.2921.0_8wekyb3d8bbwe.msixbundle</span><br><span class=\"line\"><span class=\"comment\"># 打开 Windows Terminal</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  安装方式2.Microsoft Store</span></span><br></pre></td></tr></table></figure></p>\n<p>第十步， 注销指定名称的分发并删除根文件系统。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; wsl --unregister Ubuntu-20.04</span><br><span class=\"line\">正在注销...</span><br><span class=\"line\">&gt; wsl --list -v</span><br><span class=\"line\">适用于 Linux 的 Windows 子系统没有已安装的分发版。</span><br><span class=\"line\">可以通过访问 Microsoft Store 来安装分发版: https://aka.ms/wslstore</span><br></pre></td></tr></table></figure>\n<p><br/></p>\n<p>Tips： 安装失败并出现错误 0x8007007e：如果收到此错误，则表明系统不支持 WSL。 请确保运行的是 Windows 版本 16215 或更高版本。 检查内部版本。 另外，请进行检查以确认 WSL 已启用，并且在启用此功能后重新启动了计算机。</p>\n<p>Tips: 新 WSL 命令，切换 WSL 2 与 WSL 1 的命令,新的 WSL 还添加了一些命令来帮助用户控制和查看 WSL 版本和相关信息：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl --<span class=\"built_in\">set</span>-version &lt;Distro&gt; &lt;Version&gt;：切换 WSL 2 与 WSL 1</span><br><span class=\"line\">​wsl --<span class=\"built_in\">set</span>-default-version &lt;Version&gt;：更改默认 WSL 版本</span><br><span class=\"line\">​wsl --list --quiet：列出发行版名称</span><br><span class=\"line\">​wsl --list --verbose：显示发行版的详细信息</span><br></pre></td></tr></table></figure></p>\n<p>Tips: WSL内核版本查看与升级。<br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ wsl --status</span><br><span class=\"line\">  <span class=\"comment\">// 默认版本：2</span></span><br><span class=\"line\">  <span class=\"comment\">// 适用于 Linux 的 Windows 子系统最后更新于 2021/12/2</span></span><br><span class=\"line\">  <span class=\"comment\">// 适用于 Linux 的 Windows 子系统内核可以使用“wsl --update”手动更新，但由于你的系统设置，无法进行自动更新。</span></span><br><span class=\"line\">  <span class=\"comment\">// 内核版本： 5.10.16</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ wsl --update</span><br><span class=\"line\">  <span class=\"comment\">// 正在检查下载/安装更新...</span></span><br><span class=\"line\">  <span class=\"comment\">// 此更改将在 WSL 下次完全重启时生效。</span></span><br><span class=\"line\">  <span class=\"comment\">// 内核版本： 5.10.60.1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 若要强制重启，立即终止所有正在运行的发行版和 WSL 2 VM , 在升级后便</span></span><br><span class=\"line\">$ ​wsl --shutdown</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p><strong>参考连接:</strong></p>\n<ul>\n<li>新版本服务器安装方法: <a href=\"https://docs.microsoft.com/zh-cn/windows/wsl/install-on-server\" target=\"_blank\" rel=\"noopener\">https://docs.microsoft.com/zh-cn/windows/wsl/install-on-server</a></li>\n<li>手动安装方式: <a href=\"https://docs.microsoft.com/zh-cn/windows/wsl/install-manual\" target=\"_blank\" rel=\"noopener\">https://docs.microsoft.com/zh-cn/windows/wsl/install-manual</a></li>\n<li>WSL2最佳实践: <a href=\"https://docs.microsoft.com/zh-cn/windows/wsl/setup/environment#set-up-your-linux-user-info\" target=\"_blank\" rel=\"noopener\">https://docs.microsoft.com/zh-cn/windows/wsl/setup/environment#set-up-your-linux-user-info</a></li>\n<li>WSL2磁盘挂载: <a href=\"https://docs.microsoft.com/zh-cn/windows/wsl/wsl2-mount-disk\" target=\"_blank\" rel=\"noopener\">https://docs.microsoft.com/zh-cn/windows/wsl/wsl2-mount-disk</a></li>\n<li>WSL Github项目： <a href=\"https://github.com/microsoft/WSL/\" target=\"_blank\" rel=\"noopener\">https://github.com/microsoft/WSL/</a></li>\n</ul>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"WindowsServer","path":"api/categories/WindowsServer.json"},{"name":"服务器操作系统","path":"api/categories/服务器操作系统.json"}],"tags":[{"name":"WinServer2022","path":"api/tags/WinServer2022.json"}]}