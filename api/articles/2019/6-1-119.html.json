{"title":"运维之LAMP环境安装与配置","slug":"系统运维/Application/Web/LAMP/运维之LAMP环境安装与配置","date":"2019-06-01T05:36:30.000Z","updated":"2023-01-31T02:29:10.469Z","url":"2019/6-1-119.html","path":"api/articles/2019/6-1-119.html.json","covers":["https://img.weiyigeek.top/2019/20190602231017.png","https://img.weiyigeek.top/2019/20190602231137.png","https://img.weiyigeek.top/2019/1/20190922225024.png","https://img.weiyigeek.top/2019/1/20190922225132.png","https://img.weiyigeek.top/2019/20190602112954.png","https://img.weiyigeek.top/2019/20190602231709.png","https://img.weiyigeek.top/2019/20190602231936.png","https://img.weiyigeek.top/2019/20190602232248.png","https://img.weiyigeek.top/2019/20190602232803.png","https://img.weiyigeek.top/2019/20190602233020.png","https://img.weiyigeek.top/2019/20190602232418.png","https://img.weiyigeek.top/2019/20190602233420.png","https://img.weiyigeek.top/2019/20190602233547.png","https://img.weiyigeek.top/2019/20190602233633.png","https://img.weiyigeek.top/2019/20190602234253.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-快速入门\"><a href=\"#0x00-快速入门\" class=\"headerlink\" title=\"0x00 快速入门\"></a>0x00 快速入门</h4><p><strong>LAMP发展</strong><br>LAMP这个特定名词最早出现在1998年，是Linux操作系统、Apache网页服务器、MySQL数据库管理系统和PHP程序模块，四种技术名称开头字母缩写组成的。是一组常用来搭建动态网站或者服务器的开源软件组合， 本身都是各自独立的软件，但是因为常被结合在一起使用，并拥有越来越高的兼容度，共同组成了一个强大的Web应用程序平台。</p>\n<p>随着开源潮流的蓬勃发展，开放源代码的LAMP组合在发展速度上（运行各种商业应用和协作构建各种网络应用程序），已经超过了JavaEE和ASP.net等同类开发平台的商业软件。</p>\n<p>并且在LAMP平台上开发的项目在软件方面的投资成本较低，运行稳定，因此受到整个IT界的关注。 </p>\n<p>所以: <code>Apache＋PHP＋MySQL</code>被认为是在Linux平台上最佳组合之一。</p>\n<p><br></p>\n<p><strong>LAMP介绍</strong><br>LAMP并不是一个独立的软件,由Linux+Apache+PHP+MySQL组合而成的一套可以运行PHP程序体系(并非只有Apache可以通过扩展支持PHP的解析，Nginx, LightHttpd等其他软件同样可以)，经过多年的Web技术的发展，在业内广泛应用于一种Web服务器解决方案之一,由一些独立的系统或者由软件组合而成。</p>\n<p><em>LAMP是怎么产生的？</em><br>由Server OS , Web Server , DataBase , ScriptLanguage来寻找高效运行的Web软件组合。</p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190602231017.png\" alt=\"WeiyiGeek.LAMP\" title=\"\" class=\"\">\n                <p>WeiyiGeek.LAMP</p>\n            </figure>\n<p>LAMP的工作原理:<br>Apache加载Libphp5/7.so模块来支持PHP解析，而PHP引入Mysql.so模块来对数据库进行CURD操作(因为并非所有的php代码都支持CURD操作)。<br>数据库的操作术语：CURD = create（创建） + update（更新） + read（读取） + 删除（delete）</p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190602231137.png\" alt=\"WeiyiGeek.工作原理\" title=\"\" class=\"\">\n                <p>WeiyiGeek.工作原理</p>\n            </figure>\n<p><em>LAMP环境文件目录概述：</em><br>通过apt-get工具安装的软件配置文件均放置在/etc下，并为每个软件建立一个以软件名称为名的文件夹用于区分不同软件的配置文件：</p>\n<ul>\n<li>Ubuntu/redhat系统配置文件目录：/etc/</li>\n<li>各种组件配置文件位置：Apache /etc/apache2 ; MySQL /etc/mysql ; PHP /etc/php5</li>\n<li>对于php有版本变动,其目录也随之而变化:/etc/php/7.0/</li>\n</ul>\n<p><em>一个初级LAMP服务器集群</em><br>通过负载均衡服务器，以轮询或其他方式分发给不同apache服务器，当有数据写入数据库时，则会同步到其他负责读取的mysql服务器中<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20190922225024.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p>国内外著名的巨型服务器集群：</p>\n<ul>\n<li>Google App Engine 是一种让您可以在 Google 的基础架构上运行您的网络应用程序。Google App Engine 应用程序易于构建和维护，并可根据您的访问量和数据存储需要的增长轻松扩展，上面的BAE和SAE就是以此为基础得,<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20190922225132.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure>\n</li>\n</ul>\n<hr/>\n\n<h4 id=\"0x01-CentOS安装LAMP案例\"><a href=\"#0x01-CentOS安装LAMP案例\" class=\"headerlink\" title=\"0x01 CentOS安装LAMP案例\"></a>0x01 CentOS安装LAMP案例</h4><h5 id=\"yum安装\"><a href=\"#yum安装\" class=\"headerlink\" title=\"yum安装\"></a>yum安装</h5><p>安装环境：CentOS Linux release 7.6.1810 (Core) - 3.10.0-957.12.2.el7.x86_64<br>安装步骤：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1.下载一个epel,可以下载第三方资源</span></span><br><span class=\"line\">yum install -y httpd httpd-dev</span><br><span class=\"line\"><span class=\"comment\">#启用httpd服服务项   </span></span><br><span class=\"line\">systemctl start httpd.service</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2.卸载自带的mariadb</span></span><br><span class=\"line\">rpm -qa | grep <span class=\"string\">\"mariadb\"</span></span><br><span class=\"line\">mariadb-libs-5.5.52-1.el7.x86_64</span><br><span class=\"line\">rpm -e --nodeps mariadb-libs-5.5.52-1.el7.x86_64</span><br><span class=\"line\"><span class=\"comment\">#安装mariadb,没有安装MYSQL</span></span><br><span class=\"line\">yum install mariadb mariadb-server mariadb-libs mariadb-devel</span><br><span class=\"line\">systemctl start  mariadb </span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span>  mariadb </span><br><span class=\"line\"><span class=\"comment\">#允许情况</span></span><br><span class=\"line\">netstat -tlnp</span><br><span class=\"line\"><span class=\"comment\"># Active Internet connections (only servers)</span></span><br><span class=\"line\"><span class=\"comment\"># Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span></span><br><span class=\"line\"><span class=\"comment\"># tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      10215/mysqld        </span></span><br><span class=\"line\"><span class=\"comment\">#数据库初始化与安全配置</span></span><br><span class=\"line\">mysql_secure_installation</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3.安装 PHP7.2安装 EPEL 软件包：</span></span><br><span class=\"line\">sudo yum install -y epel-release <span class=\"comment\">#安装 PHP7.2 需要使用到</span></span><br><span class=\"line\">sudo yum install -y http://rpms.remirepo.net/enterprise/remi-release-7.rpm <span class=\"comment\">#安装 remi 源：</span></span><br><span class=\"line\">sudo yum install -y yum-utils  <span class=\"comment\">#安装 yum 扩展包</span></span><br><span class=\"line\">sudo yum-config-manager --<span class=\"built_in\">enable</span> remi-php73 <span class=\"comment\">#启用 remi-php32仓库：</span></span><br><span class=\"line\">sudo yum update</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#4.安装 PHP7.2 安装 php-fpm （注意这里并没有安装httpd中php模块）</span></span><br><span class=\"line\"><span class=\"comment\">#现在使用下面的命令安装PHP 7的必要模块和扩展来支持httpd</span></span><br><span class=\"line\">sudo yum install php73-php-fpm php73-php-gd php73-php-json php73-php-mbstring php73-php-mysqlnd php73-php-xml php73-php-xmlrpc php73-php-opcache</span><br><span class=\"line\">yum --enablerepo=remi-php73 install -y php php-mysqli  <span class=\"comment\">#机器推荐这样的方法</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#安装好后会发现httpd多了两个php静态连接文件</span></span><br><span class=\"line\">ll /etc/httpd/modules/</span><br><span class=\"line\">总用量 12660</span><br><span class=\"line\">-rwxr-xr-x. 1 root root 5136336 5月  28 21:49 libphp7.so</span><br><span class=\"line\">-rwxr-xr-x. 1 root root 5309448 5月  28 21:49 libphp7-zts.so</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#4.验证php和httpd</span></span><br><span class=\"line\">service httpd restart</span><br><span class=\"line\">php -v</span><br><span class=\"line\"><span class=\"comment\"># PHP 7.3.6 (cli) (built: May 28 2019 09:32:59) ( NTS )</span></span><br><span class=\"line\"><span class=\"comment\"># Copyright (c) 1997-2018 The PHP Group</span></span><br><span class=\"line\"><span class=\"comment\"># Zend Engine v3.3.6, Copyright (c) 1998-2018 Zend Technologies</span></span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190602112954.png\" alt=\"WeiyiGeek.phpinfo\" title=\"\" class=\"\">\n                <p>WeiyiGeek.phpinfo</p>\n            </figure>\n<h5 id=\"编译安装\"><a href=\"#编译安装\" class=\"headerlink\" title=\"编译安装\"></a>编译安装</h5><hr/>\n\n<h4 id=\"0x02-Ubuntu安装LAMP案例\"><a href=\"#0x02-Ubuntu安装LAMP案例\" class=\"headerlink\" title=\"0x02 Ubuntu安装LAMP案例\"></a>0x02 Ubuntu安装LAMP案例</h4><p>安装OS环境:Ubuntu 16.04 TLS(Linux ubuntu 4.4.0-47-generic #68-Ubuntu SMP x86_64 x86_64 x86_64 GNU/Linux)<br>应用版本：</p>\n<ul>\n<li>apache/2.4.18(Ubuntu)</li>\n<li>php</li>\n<li>mysql  Ver 14.14 Distrib 5.7.19, for Linux (x86_64) using  EditLine wrapper</li>\n</ul>\n<p>安装步骤：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#0.一条命令完成所有应用的安装 LAMP</span></span><br><span class=\"line\">sudo apt-get install apache2 mysql-server php5-mysql </span><br><span class=\"line\">或者通过:</span><br><span class=\"line\">tasksel install lamp-server</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2.php5安装，在最新Ubuntu 16.04 TLS版本中默认是php7.0</span></span><br><span class=\"line\">sudo apt-get php5</span><br><span class=\"line\"><span class=\"comment\">#sudo apt-get install php7.0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3. 检查php和apache是不是安装成功</span></span><br><span class=\"line\">php5 -v</span><br><span class=\"line\">apache2 -v</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#4.确认apache加载php5.so模块</span></span><br><span class=\"line\">cat /etc/apache2/mods-enabled/php5.load <span class=\"comment\">#12.04 version</span></span><br><span class=\"line\">cat /etc/apache2/mods-enabled/php7.0.load <span class=\"comment\">#16.04 version</span></span><br><span class=\"line\"></span><br><span class=\"line\">sudo apt-get install  libapache2-mod-php  <span class=\"comment\">#16.04 version</span></span><br><span class=\"line\">sudo apt-get install  libapache2-mod-php7.0  <span class=\"comment\">#16.04 version</span></span><br><span class=\"line\"><span class=\"comment\">#(查看php是否被apache 加载) 显示 LoadModule php5_module /usr/lib/apache2/modules/libphp5.so 表示加载成功</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#5. 启动apache和验证php模块是否正常工作</span></span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"test php\"</span>;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190602231709.png\" alt=\"WeiyiGeek.测试php\" title=\"\" class=\"\">\n                <p>WeiyiGeek.测试php</p>\n            </figure></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#6. 安装过程中输出 root 密码 注：此密码为mysql 数据库密码（toor）</span></span><br><span class=\"line\"><span class=\"comment\"># php通过一个mysql.so的模块进行CURD操作，为确保php和mysql正常进行数据交互</span></span><br><span class=\"line\">cat /etc/php5/conf.d/mysql.ini  <span class=\"comment\">#php默认不安装mysql扩展,课程使用的是12.04版本的系统，</span></span><br><span class=\"line\">cat /etc/php5/mods-available/mysql.ini <span class=\"comment\">#14.10版</span></span><br><span class=\"line\">cat /etc/php/7.0/mods-available/mysqli.ini <span class=\"comment\">#16.10版</span></span><br><span class=\"line\"></span><br><span class=\"line\">sudo apt-get install php5-mysql <span class=\"comment\">#如果没有被加载许手动安装，12.04</span></span><br><span class=\"line\">sudo apt-get install php7.0-mysql <span class=\"comment\">#如果没有被加载许手动安装，16.04</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#在php中加入的mysqli扩展模块支持</span></span><br><span class=\"line\">/etc/php/mods-available/mysqli.ini</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#7.重启 mysql apache</span></span><br><span class=\"line\">sudo service mysql restart</span><br><span class=\"line\">sudo service apache2 restart</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190602231936.png\" alt=\"WeiyiGeek.mysqli扩展\" title=\"\" class=\"\">\n                <p>WeiyiGeek.mysqli扩展</p>\n            </figure>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#LAMP之PHP探针:验证php连接mysql数据库</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">echo</span> mysql_connect(<span class=\"string\">'localhost'</span>,<span class=\"string\">'root'</span>,<span class=\"string\">'123456'</span>) ? <span class=\"string\">'连接成功的信息'</span> : <span class=\"string\">'连接失败的信息’;  </span></span><br><span class=\"line\"><span class=\"string\"># php5.0 version-测试连接mysql,有时mysql_connect()函数默认端口被其他程序占用时, 可以指定其他端口;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">echo new mysqli('</span>localhost<span class=\"string\">','</span>root<span class=\"string\">','</span>toor<span class=\"string\">') ? '</span>successful message<span class=\"string\">' : '</span>fail message<span class=\"string\">';</span></span><br><span class=\"line\"><span class=\"string\"># php7.0 version-PHP 5 的使用者可以使用 mysql extension，mysqli 和 PDO_MYSQ，PHP 7移除了mysql extension支持</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">phpinfo();   //查看php版本信息</span></span><br><span class=\"line\"><span class=\"string\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190602232248.png\" alt=\"WeiyiGeek.连接数据库测试\" title=\"\" class=\"\">\n                <p>WeiyiGeek.连接数据库测试</p>\n            </figure>\n<p><br/></p>\n<h5 id=\"配置与实战\"><a href=\"#配置与实战\" class=\"headerlink\" title=\"配置与实战\"></a>配置与实战</h5><p>描述：ubuntu的apache配置文件目录是/etc/apache2/,入口在conf.d/*，进行Include配置文件.</p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190602232803.png\" alt=\"WeiyiGeek.apache目录介绍\" title=\"\" class=\"\">\n                <p>WeiyiGeek.apache目录介绍</p>\n            </figure>\n<p>apache最核心的配置是模块和虚拟主机,mods-enabled文件夹中有软连接指向了modes-available文件,Apache会在加载配置过程中将所有软连接一次性全部加载，以方便软连接误删时再次建立软连接启动模块.</p>\n<ul>\n<li>available表示可以使用</li>\n<li>enabled表示已启用的</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql核心配置文件 /etc/mysql/my.cnf</span><br><span class=\"line\">php5核心配置文件  /etc/php5/php.ini</span><br><span class=\"line\">php7核心配置文件  /etc/php/7.0/php.ini</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190602233020.png\" alt=\"WeiyiGeek.配置文件加载流程\" title=\"\" class=\"\">\n                <p>WeiyiGeek.配置文件加载流程</p>\n            </figure>\n<p><em>配置1：LAMP之给PHP添加常用扩展（Extension）</em><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#测试方法：重启Apache后，利用phpinfo()；查看拓展是否有curl和gd库以及是否被正确加载</span></span><br><span class=\"line\"><span class=\"variable\">$sudo</span> apt-get install php5-gd curl libcurl3 libcurl4-openssl-dev php5-curl     <span class=\"comment\">#12.04 version</span></span><br><span class=\"line\"><span class=\"variable\">$sudo</span> apt-get install php7.0-gd curl libcurl3 libcurl4-openssl-dev php7.0-curl <span class=\"comment\">#16.04  version</span></span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190602232418.png\" alt=\"WeiyiGeek.gd扩展\" title=\"\" class=\"\">\n                <p>WeiyiGeek.gd扩展</p>\n            </figure>\n<p><br></p>\n<p><em>配置2：apache虚拟主机工作原理通过域名来指向访问</em><br>在同一台服务器上，可以访问不同的网站二级域名，让Apache来区分用户是通过哪个二级域名访问这台服务器的，根据不同的二级域名访问对应项目所在的目录，也就是说一台服务器上可以同时放置多个完全独立的网站或者系统，用不同的域名访问对应的系统。<br>配置需求：</p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190602233420.png\" alt=\"WeiyiGeek.虚拟主机\" title=\"\" class=\"\">\n                <p>WeiyiGeek.虚拟主机</p>\n            </figure>\n<p>最新版的ubuntu server Apache默认解析的网页文件是在var/www/html下，如果要修改的话需要修改/etc/apache2/sites-enabled/000-default中的DocumentRoot的值</p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190602233547.png\" alt=\"WeiyiGeek.virtualhost\" title=\"\" class=\"\">\n                <p>WeiyiGeek.virtualhost</p>\n            </figure>\n<p>Step1. 手动模拟,DNS将在host文件里面修改域名指向192.168.0.104:<br>客户端的Host文件:</p>\n<ul>\n<li>Windows是在c:\\windows\\system64\\drivers\\etc\\hosts</li>\n<li>Linux,Mac都是在/etc/hosts，因为都是采用了unix的内核kerner.<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">192.168.133.134 video.ubuntu.com</span><br><span class=\"line\">192.168.133.134 bbs.ubuntu.com</span><br><span class=\"line\">192.168.133.134 oa.ubuntu.com</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#通过终端工具操作服务器创建目录.</span></span><br><span class=\"line\">weiyi@ubuntu:/$ sudo mkdir -p /wwwroot/&#123;oa,bbs,video&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190602233633.png\" alt=\"WeiyiGeek.DNS模拟指向\" title=\"\" class=\"\">\n                <p>WeiyiGeek.DNS模拟指向</p>\n            </figure>\n<p>Step2. 在Apache中配置虚拟主机<br>1、设置配置文件：$sudo cp /etc/apache2/site-aviailable000-defaule.conf video.conf （同理复制成bbs.conf、oa.conf）<br>2、修改配置文件：$sudo vi video.conf （同理修改bbs.conf、oa.conf）<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">添加：ServerName video.imooc.com</span><br><span class=\"line\">修改：DocumentRoot /wwwroot/video</span><br></pre></td></tr></table></figure><br>3、修改Apache配置文件apache2.conf<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$sudo</span> vi /etc/apache2/apache2.conf</span><br><span class=\"line\">&lt;Directory /wwwroot/&gt;</span><br><span class=\"line\">Options Indexes FollowSymLinks</span><br><span class=\"line\">AllowOverride None</span><br><span class=\"line\">Require all granted</span><br><span class=\"line\">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure><br>4、在/etc/apache2/sites-enabled中建立软连接：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo ln -s ../sites-availables/video.conf video.conf <span class=\"comment\">#同理建立bbs.conf和os.conf的软连接</span></span><br></pre></td></tr></table></figure><br>5、重启Apache<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo service apache2 restart</span><br></pre></td></tr></table></figure><br>6、在浏览器中输入二级域名看是否显示对应内容<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190602234253.png\" alt=\"WeiyiGeek.域名访问\" title=\"\" class=\"\">\n                <p>WeiyiGeek.域名访问</p>\n            </figure></p>\n<hr>\n\n<h4 id=\"0x03-Apache安全配置\"><a href=\"#0x03-Apache安全配置\" class=\"headerlink\" title=\"0x03 Apache安全配置\"></a>0x03 Apache安全配置</h4><p>主要是对httpd进行安全配置,有效的防止网站被入侵;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#配置1.禁止上传目录脚本执行</span><br><span class=\"line\">&lt;Directory ~ &quot;&#x2F;website&#x2F;uploads&quot;&gt;  </span><br><span class=\"line\">  Options FollowSymLinks  </span><br><span class=\"line\">  AllowOverride None  </span><br><span class=\"line\">  Order allow,deny  </span><br><span class=\"line\">  Allow from all   </span><br><span class=\"line\">  php_flag engine off  </span><br><span class=\"line\">&lt;&#x2F;Directory&gt; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">#配置2.指定设置错误请求页面文件</span><br><span class=\"line\">#ErrorDocument 500 &quot;The server made a boo boo.&quot;  </span><br><span class=\"line\">ErrorDocument 404 &#x2F;missing.html</span><br><span class=\"line\">#ErrorDocument 404 &quot;&#x2F;cgi-bin&#x2F;missing_handler.pl&quot;</span><br><span class=\"line\">#ErrorDocument 402 http:&#x2F;&#x2F;www.example.com&#x2F;subscription_info.html</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">#配置3.设置目录访问密码</span><br><span class=\"line\">&lt;Directory &quot;&#x2F;var&#x2F;www&#x2F;cgi-bin&#x2F;awstats&#x2F;&quot;&gt;</span><br><span class=\"line\"> AuthType Basic</span><br><span class=\"line\"> AuthName &quot;test&quot;</span><br><span class=\"line\"> AuthUserFile &#x2F;tmp&#x2F;passwd</span><br><span class=\"line\"> Require user test</span><br><span class=\"line\">&lt;&#x2F;Directory&gt;</span><br><span class=\"line\">#生成用户密码在访问目录中使用</span><br><span class=\"line\">&#x2F;etc&#x2F;httpd&#x2F;bin&#x2F;htpasswd -c &#x2F;etc&#x2F;httpd&#x2F;passwd test</span><br></pre></td></tr></table></figure>\n<hr>\n<h4 id=\"0x03-补充知识\"><a href=\"#0x03-补充知识\" class=\"headerlink\" title=\"0x03 补充知识\"></a>0x03 补充知识</h4><h5 id=\"htpasswd-命令\"><a href=\"#htpasswd-命令\" class=\"headerlink\" title=\"htpasswd 命令\"></a>htpasswd 命令</h5><p>描述:Apache的Web服务器内置工具，用于创建和更新储存用户名、域和用户基本认证的密码文件。<br>执行文件目录: /etc/httpd/bin/htpasswd<br>语法参数:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">htpasswd [选项] [参数]</span><br><span class=\"line\"><span class=\"comment\">#选项</span></span><br><span class=\"line\">-b：在命令行中一并输入用户名和密码而不是根据提示输入密码；</span><br><span class=\"line\">-c：创建一个加密文件；</span><br><span class=\"line\">-n：不更新加密文件，只将加密后的用户名密码显示在屏幕上；</span><br><span class=\"line\">-m：默认采用MD5算法对密码进行加密；</span><br><span class=\"line\">-d：采用CRYPT算法对密码进行加密；</span><br><span class=\"line\">-p：不对密码进行进行加密，即明文密码；</span><br><span class=\"line\">-s：采用SHA算法对密码进行加密；</span><br><span class=\"line\">-D：删除指定的用户。</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#参数</span></span><br><span class=\"line\">用户：要创建或者更新密码的用户名；</span><br><span class=\"line\">密码：用户的新密码。</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p>基础实例:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1.利用htpasswd命令添加用户名weiyigeek，密码：123456并生成passwd在当前路径下，默认采用sha1加密方式。</span></span><br><span class=\"line\">htpasswd -bc .password weiyigeek 123456</span><br><span class=\"line\">Adding password <span class=\"keyword\">for</span> user weiyigeek</span><br><span class=\"line\">[root@master ~]<span class=\"comment\"># cat .password</span></span><br><span class=\"line\">weiyigeek:<span class=\"variable\">$apr1</span><span class=\"variable\">$WOXxFnda</span><span class=\"variable\">$ocLFdlzLQXyJydPQYtwLL</span>.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2.在原有密码文件中增加下一个用户</span></span><br><span class=\"line\">htpasswd -b .passwd Jack 123456</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3.不更新密码文件，只显示加密后的用户名和密码</span></span><br><span class=\"line\">htpasswd -nb Jack 123456</span><br><span class=\"line\">Jack:<span class=\"variable\">$apr1</span><span class=\"variable\">$esmjsBIu</span><span class=\"variable\">$eFfutTYZMZp9peHNAdllq0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#4.利用htpasswd命令删除用户名和密码</span></span><br><span class=\"line\">htpasswd -D .passwd Jack</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#利用htpasswd命令修改密码，即先使用htpasswd删除命令删除指定用户，再利用htpasswd添加用户命令创建用户即可实现修改密码的功能。</span></span><br><span class=\"line\">htpasswd -D .passwd Jack</span><br><span class=\"line\">htpasswd -b .passwd Jack 123456</span><br></pre></td></tr></table></figure></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"系统运维","path":"api/categories/系统运维.json"}],"tags":[{"name":"LAMP","path":"api/tags/LAMP.json"},{"name":"Web服务器","path":"api/tags/Web服务器.json"}]}