<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ 5.Jenkinsè¿›é˜¶ä¹‹åˆ†å¸ƒå¼æ¶æ„æ‰©å……çŸ¥è¯†|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="Jenkins">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9134434519967436" crossorigin="anonymous"></script>    
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>5.Jenkinsè¿›é˜¶ä¹‹åˆ†å¸ƒå¼æ¶æ„æ‰©å……çŸ¥è¯†</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">5.Jenkinsè¿›é˜¶ä¹‹åˆ†å¸ƒå¼æ¶æ„æ‰©å……çŸ¥è¯†</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-12-31T04:34:30.000Z" itemprop="datePublished" class="page-time">
  2020-12-31
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/DevOps/">DevOps</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/DevOps/CI-CD/">CI-CD</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
  <article id="post-ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/CI-CD/Jenkins/5.Jenkinsè¿›é˜¶ä¹‹åˆ†å¸ƒå¼æ¶æ„æ‰©å……çŸ¥è¯†"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">5.Jenkinsè¿›é˜¶ä¹‹åˆ†å¸ƒå¼æ¶æ„æ‰©å……çŸ¥è¯†</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-12-31 12:34:30" datetime="2020-12-31T04:34:30.000Z"  itemprop="datePublished">2020-12-31</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/DevOps/">DevOps</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/DevOps/CI-CD/">CI-CD</a></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h2 id="0x00-å‰è¨€ç®€è¿°"><a href="#0x00-å‰è¨€ç®€è¿°" class="headerlink" title="0x00 å‰è¨€ç®€è¿°"></a>0x00 å‰è¨€ç®€è¿°</h2><p>æè¿°: æœ‰äº†ä¸Šä¸€ç« çš„åŸºç¡€<code>&quot;4.Jenkinsè¿›é˜¶ä¹‹åˆ†å¸ƒå¼æ¶æ„ç¯å¢ƒé…ç½®&quot;</code>ä»‹ç»ï¼Œæœ¬ç« ä¸»è¦ä»‹ç»Kubernetes çš„æ’ä»¶ä½¿ç”¨å®ä¾‹, ä»¥åŠè‡ªå®šä¹‰ Slave çš„ Jenkins-Jnlp å®¹å™¨é•œåƒæ¨¡æ¿(é‡ç‚¹)ï¼Œåœ¨è¿›è¡ŒK8såŠ¨æ€èŠ‚ç‚¹ç”Ÿæˆæ—¶æ‹‰å–ä½¿ç”¨ï¼Œæå¤§çš„èŠ‚çº¦äº†ç³»ç»Ÿèµ„æºã€‚</p>
<hr>
<h2 id="0x01-Kubernetes-plugin-ä½¿ç”¨"><a href="#0x01-Kubernetes-plugin-ä½¿ç”¨" class="headerlink" title="0x01 Kubernetes-plugin ä½¿ç”¨"></a>0x01 Kubernetes-plugin ä½¿ç”¨</h2><p>æè¿°: å‰é¢å·²ç»å¯¹Jenkinsé›†æˆKubernetesè¿›è¡Œéƒ¨ç½²å’Œé…ç½®ï¼Œæœ¬ç« å°†è¿›è¡Œä»‹ç»ä¸å®è·µå¦‚ä½•ä½¿ç”¨è¯¥æ’ä»¶ä»¥åŠå¸®åŠ©æ–‡æ¡£çš„è®°å½•;</p>
<p>è¯´æ˜: Kubernetes-plugin å®ƒæ˜¯åœ¨Kubernetesé›†ç¾¤ä¸­è¿è¡ŒåŠ¨æ€ä»£ç†çš„Jenkinsæ’ä»¶, è¯¥æ’ä»¶ä¸ºæ¯ä¸ªå¯åŠ¨çš„ä»£ç†åˆ›å»ºä¸€ä¸ªKubernetes Podï¼Œç”±Dockeræ˜ åƒå®šä¹‰è¿è¡Œï¼Œå¹¶åœ¨æ¯æ¬¡æ„å»ºååœæ­¢ã€‚</p>
<p>å¤‡æ³¨: ä»£ç†æ˜¯ä½¿ç”¨JNLPå¯åŠ¨çš„ï¼Œå› æ­¤é¢„æœŸå›¾åƒä¼šè‡ªåŠ¨è¿æ¥åˆ°Jenkinsä¸»æœºï¼Œä»¥ä¸‹æ˜¯é‡è¦çš„ç¯å¢ƒå˜é‡ï¼ˆæˆ‘ä»¬è¯´è¿‡ä¸å»ºè®®ä½¿ç”¨è‡ªå·±jnlpè¦†ç›–é»˜è®¤çš„jnlpå®¹å™¨ï¼‰ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># jenkins/inbound-agent </span></span><br><span class="line">JENKINS_URL: Jenkins web interface url</span><br><span class="line">JENKINS_SECRET: the secret key <span class="keyword">for</span> authentication</span><br><span class="line">JENKINS_AGENT_NAME: the name of the Jenkins agent</span><br><span class="line">JENKINS_NAME: the name of the Jenkins agent (Deprecated. Only here <span class="keyword">for</span> backwards compatibility)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>æ’ä»¶åœ°å€: <a href="https://github.com/jenkinsci/kubernetes-plugin" target="_blank" rel="noopener">https://github.com/jenkinsci/kubernetes-plugin</a></li>
<li>è‡ªå®šä¹‰jnlpå®¹å™¨æ¨¡æ¿é•œåƒåœ°å€: <a href="https://hub.docker.com/r/weiyigeek/alpine-jenkins-jnlp" target="_blank" rel="noopener">https://hub.docker.com/r/weiyigeek/alpine-jenkins-jnlp</a></li>
</ul>
<p>è¯¥é•œåƒæ˜¯Jenkinsè‡ªå®šä¹‰jnlpå®¹å™¨æ¨¡æ¿ï¼Œä¸»è¦ç”¨äºJenkinså·¥ä½œèŠ‚ç‚¹å®¹å™¨åŒ–ä½¿ç”¨ï¼Œä¸»è¦åŒ…å«Gitlab_releaseå‘å¸ƒã€ docker å®¹å™¨ç®¡ç†ã€kubectl é›†ç¾¤ç®¡ç†åŠŸèƒ½ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨docker çš„ç¯å¢ƒä¸­ <code>docker pull weiyigeek/alpine-jenkins-jnlp</code>ä¸‹æ¥</p>
<p><br></p>
<h3 id="ç¯å¢ƒä¾èµ–"><a href="#ç¯å¢ƒä¾èµ–" class="headerlink" title="ç¯å¢ƒä¾èµ–"></a>ç¯å¢ƒä¾èµ–</h3><ul>
<li><p><strong>1.å…ˆå†³æ¡ä»¶</strong></p>
<ul>
<li>æ­£åœ¨è¿è¡Œçš„Kubernetesé›†ç¾¤1.14æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚å¯¹äºOpenShiftç”¨æˆ·ï¼Œè¿™æ„å‘³ç€OpenShiftå®¹å™¨å¹³å°4.xã€‚</li>
<li>å®‰è£…äº†ä¸€ä¸ªJenkinså®ä¾‹</li>
<li>å·²å®‰è£…Jenkins Kubernetesæ’ä»¶</li>
</ul>
</li>
<li><p><strong>2.å¡«å†™Kubernetesæ’ä»¶é…ç½®</strong></p>
<ul>
<li>æ‚¨å°†æ‰“å¼€Jenkins UIå¹¶å¯¼èˆªè‡³Manage Jenkins-&gt; Configure System-&gt; Cloud-&gt; Kuberneteså¹¶è¾“å…¥ç›¸åº”çš„Kubernetes URLå’ŒJenkins URLï¼Œé™¤éJenkinsåœ¨Kubernetesä¸­è¿è¡Œå¦åˆ™é»˜è®¤å·¥ä½œï¼ˆå‚è€ƒä¸Šä¸€ç« ï¼‰ã€‚</li>
</ul>
</li>
<li><p><strong>3.æ”¯æŒçš„å‡­è¯</strong></p>
<ul>
<li>Username/password - ç”¨æˆ·åå¯†ç </li>
<li>Secret File (kubeconfig file) - ç§˜å¯†æ–‡ä»¶ï¼ˆkubeconfigæ–‡ä»¶ï¼‰</li>
<li>Secret text (Token-based authentication) (OpenShift) - ç§˜å¯†æ–‡æœ¬ï¼ˆåŸºäºä»¤ç‰Œçš„èº«ä»½éªŒè¯ï¼‰ï¼ˆOpenShiftï¼‰</li>
<li>Google Service Account from private key (GKE authentication) - æ¥è‡ªç§é’¥çš„GoogleæœåŠ¡å¸æˆ·ï¼ˆGKEèº«ä»½éªŒè¯ï¼‰</li>
<li>X.509 Client Certificate - X.509å®¢æˆ·ç«¯è¯ä¹¦</li>
</ul>
</li>
</ul>
<p><br></p>
<h3 id="æ’ä»¶å‚æ•°"><a href="#æ’ä»¶å‚æ•°" class="headerlink" title="æ’ä»¶å‚æ•°"></a>æ’ä»¶å‚æ•°</h3><h4 id="podTemplate-Podå’Œå®¹å™¨æ¨¡æ¿"><a href="#podTemplate-Podå’Œå®¹å™¨æ¨¡æ¿" class="headerlink" title="podTemplate - Podå’Œå®¹å™¨æ¨¡æ¿"></a>podTemplate - Podå’Œå®¹å™¨æ¨¡æ¿</h4><p>æè¿°: podTemplate æ˜¯ç”¨äºåˆ›å»ºä»£ç†çš„podçš„æ¨¡æ¿å¯ä»¥é€šè¿‡<code>ç”¨æˆ·ç•Œé¢æˆ–ç®¡é“è¿›è¡Œé…ç½®</code>, æ— è®ºå“ªç§æ–¹å¼å®ƒéƒ½å¯ä»¥è®¿é—®ä»¥ä¸‹å­—æ®µï¼š</p>
<ul>
<li>1) cloud ï¼šåœ¨Jenkinsè®¾ç½®ä¸­å®šä¹‰çš„äº‘çš„åç§°ã€‚é»˜è®¤ä¸ºkubernetes</li>
<li>2) name : Pod åç§°</li>
<li>3) namespace : åç§°ç©ºé—´è®¾ç½®</li>
<li>4) label : æ ‡ç­¾å€¼å¯ä»¥è®¾ç½®ä¸ºå”¯ä¸€çš„å€¼ï¼Œä»¥é¿å…è·¨æ„å»ºå†²çªï¼Œæˆ–çœç•¥ï¼Œå¹¶åœ¨æ­¥éª¤ä¸­å®šä¹‰POD_LABELã€‚</li>
<li>5) yaml : èµ„æºæ¸…å•å£°æ˜</li>
<li>6) yamlFile : æŒ‡å®šèµ„æºæ¸…å•çš„æ–‡ä»¶</li>
<li>7) yamlMergeStrategy : æ§åˆ¶yamlå®šä¹‰æ˜¯è¦†ç›–è¿˜æ˜¯ä¸ä»ç”¨å£°æ˜çš„podæ¨¡æ¿ç»§æ‰¿çš„yamlå®šä¹‰åˆå¹¶inheritFromã€‚é»˜è®¤ä¸ºoverride()ã€‚</li>
<li>8) showRawYaml : å¯ç”¨æˆ–ç¦ç”¨åŸå§‹Yamlæ–‡ä»¶çš„è¾“å‡ºé»˜è®¤ä¸ºtrue (åç»­å®è·µ)</li>
<li>8) serviceAccount : k8sä¸­åˆ›å»ºçš„æœåŠ¡å¸æˆ·</li>
<li>9) nodeSelector ï¼šèŠ‚ç‚¹é€‰æ‹©å™¨</li>
<li>10) nodeUsageMode : èŠ‚ç‚¹è°ƒç”¨æ¨¡å¼(NORMALå®ƒæ§åˆ¶Jenkinsæ˜¯åªè°ƒåº¦æ ‡ç­¾è¡¨è¾¾å¼åŒ¹é…çš„ä½œä¸šï¼ŒEXCLUSIVEå°½å¯èƒ½å¤šåœ°ä½¿ç”¨è¯¥èŠ‚ç‚¹ã€‚)</li>
<li>11) volumes ï¼šä¸ºpodå®šä¹‰å„ç§ç±»å‹çš„å·å¹¶åœ¨æ‰€æœ‰å®¹å™¨ä¸­æŒ‚è½½å·</li>
<li>12) envVars ï¼šåº”ç”¨äºæ‰€æœ‰å®¹å™¨çš„ç¯å¢ƒå˜é‡(<code>envVar ç¯å¢ƒå˜é‡å…¶å€¼æ˜¯å†…è”å®šä¹‰çš„, secretEnvVar ä¸€ä¸ªç¯å¢ƒå˜é‡å…¶å€¼æ˜¯ä»Kubernetesæœºå¯†æ´¾ç”Ÿçš„ã€‚</code>)</li>
<li>13) imagePullSecrets : ä»ç§æœ‰çš„é•œåƒä»“åº“ä¸­æ‹‰å–é•œåƒçš„å‡­æ®</li>
<li>14) annotations : Pod æ³¨è§£</li>
<li>15) InheritFrom ï¼šç»§æ‰¿çš„ä¸€ä¸ªæˆ–å¤šä¸ªPodæ¨¡æ¿çš„åˆ—è¡¨</li>
<li>16) slaveConnectTimeout : ä»£ç†ç¨‹åºè”æœºè¶…æ—¶æ—¶é—´ï¼ˆå•ä½sï¼‰</li>
<li>17) podRetention ï¼šæ§åˆ¶ä¿ç•™ä»£ç†Podçš„è¡Œä¸º(<code>Can be &#39;never()&#39;, &#39;onFailure()&#39;, &#39;always()&#39;, or &#39;default()&#39;</code>),å¦‚æœä¸ºç©ºåˆ™æŒ‰ç…§ä¸‹é¢çš„active Deadline Secondså‚æ•°è¿›è¡Œã€‚</li>
<li>18) activeDeadlineSeconds ï¼š podå°†åœ¨è¿™ä¸ªæˆªæ­¢æ—¥æœŸè¿‡åè¢«åˆ é™¤ã€‚</li>
<li>19) idleMinutes : å…è®¸Podä¿æŒæ´»åŠ¨çŠ¶æ€ä»¥ä¾›é‡ç”¨ï¼Œç›´åˆ°åœ¨æ‰§è¡Œæœ€åä¸€æ­¥ä»¥æ¥ç»è¿‡äº†é…ç½®çš„åˆ†é’Ÿæ•°ä¸ºæ­¢ã€‚</li>
<li>20) runAsUser : ç”¨æˆ·IDï¼Œç”¨äºå°†podä¸­çš„æ‰€æœ‰å®¹å™¨è¿è¡Œä¸ºã€‚</li>
<li>21) runAsGroup : ç»„IDï¼Œç”¨äºå°†Podä¸­çš„æ‰€æœ‰å®¹å™¨è¿è¡Œä¸ºã€‚</li>
<li>22) hostNetwork : ä½¿ç”¨ä¸»æœºç½‘ç»œã€‚</li>
<li>23) container  : ç”¨äºåˆ›å»ºpodå®¹å™¨çš„å®¹å™¨æ¨¡æ¿ (è§ä¸‹æ–‡) - (é‡ç‚¹)ã€‚</li>
<li>24) defaultContainer : æŒ‡å®šPodä¸­é»˜è®¤å®¹å™¨åˆ™åœ¨stagesä¸­ä¸ç”¨åŠ å…¥containerè¿›è¡ŒæŒ‡å®šé€‰æ‹©;</li>
</ul>
<p><br></p>
<h4 id="container-å®¹å™¨æ¨¡æ¿çš„å®šä¹‰"><a href="#container-å®¹å™¨æ¨¡æ¿çš„å®šä¹‰" class="headerlink" title="container - å®¹å™¨æ¨¡æ¿çš„å®šä¹‰"></a>container - å®¹å™¨æ¨¡æ¿çš„å®šä¹‰</h4><p>æè¿°: containerTemplate æ˜¯ä¸€ä¸ªå°†è¢«æ·»åŠ åˆ°podä¸­çš„å®¹å™¨æ¨¡æ¿å®ƒå±äºcontainerä¸­æ•°ç»„å¯¹è±¡ã€‚åŒæ ·å®ƒå¯ä»¥é€šè¿‡ç”¨æˆ·ç•Œé¢æˆ–ç®¡é“è¿›è¡Œé…ç½®ï¼Œå¹¶å…è®¸ä½ è®¾ç½®ä»¥ä¸‹å­—æ®µ:</p>
<p><strong>containerTemplate - å®¹å™¨æ¨¡æ¿</strong></p>
<ul>
<li>name  : å®¹å™¨çš„åç§°ã€‚</li>
<li>image : å®¹å™¨çš„å›¾åƒã€‚</li>
<li>envVars : åº”ç”¨äºå®¹å™¨çš„ç¯å¢ƒå˜é‡ï¼ˆ<code>è¡¥å……å’Œè¦†ç›–åœ¨podçº§åˆ«è®¾ç½®çš„env var</code>ï¼‰ã€‚<ul>
<li>envVar ç¯å¢ƒå˜é‡ï¼Œå…¶å€¼æ˜¯å†…è”å®šä¹‰çš„ã€‚</li>
<li>secretEnvVar ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œå…¶å€¼æ˜¯ä»Kubernetesæœºå¯†æ´¾ç”Ÿçš„ã€‚</li>
</ul>
</li>
<li>workingDir : å·¥ä½œç©ºé—´ç›®å½•</li>
<li>command : å®¹å™¨å°†æ‰§è¡Œçš„å‘½ä»¤ã€‚</li>
<li>args    : ä¼ é€’ç»™å‘½ä»¤çš„å‚æ•°ã€‚</li>
<li>ttyEnabled : æ ‡è®°ä»¥æŒ‡ç¤ºåº”å¯ç”¨ttyã€‚</li>
<li>livenessProbe : è¦æ·»åŠ åˆ°å®¹å™¨ä¸­çš„exec livenessæ¢é’ˆçš„å‚æ•°ï¼ˆä¸æ”¯æŒhttpGet livenessæ¢é’ˆï¼‰</li>
<li>ports : æš´éœ²å®¹å™¨ä¸Šçš„ç«¯å£ã€‚</li>
<li>alwaysPullImage : å®¹å™¨åœ¨å¯åŠ¨æ—¶å°†æ‹‰å‡ºå›¾åƒã€‚</li>
<li>runAsUser : ç”¨äºè¿è¡Œå®¹å™¨çš„ç”¨æˆ·IDã€‚</li>
<li>runAsGroup : è¿è¡Œå®¹å™¨çš„ç»„IDã€‚</li>
</ul>
<p><br/></p>
<p><strong>Liveness Probe Usage</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">containerTemplate(</span><br><span class="line">  name: <span class="string">'busybox'</span>, </span><br><span class="line">  image: <span class="string">'busybox'</span>,</span><br><span class="line">  ttyEnabled: <span class="literal">true</span>, </span><br><span class="line">  <span class="built_in">command</span>: <span class="string">'cat'</span>, </span><br><span class="line">  livenessProbe: containerLivenessProbe( </span><br><span class="line">    execArgs: <span class="string">'some --command'</span>, </span><br><span class="line">    initialDelaySeconds: 30, </span><br><span class="line">    timeoutSeconds: 1, </span><br><span class="line">    failureThreshold: 3, </span><br><span class="line">    periodSeconds: 10, </span><br><span class="line">    successThreshold: 1</span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>Tips : é»˜è®¤æƒ…å†µä¸‹<code>ä»£ç†è¿æ¥è¶…æ—¶è®¾ç½®ä¸º100ç§’</code>ã€‚åœ¨æŸäº›æƒ…å†µä¸‹æ‚¨æƒ³è¦è®¾ç½®ä¸€ä¸ªä¸åŒçš„å€¼ï¼Œå¦‚æœå¯ä»¥å¯ä»¥å°†systemå±æ€§è®¾ç½®<code>org.csanchez.jenkins.plugins.kubernetes.PodTemplate.connectionTimeout</code>ä¸ºä¸€ä¸ªä¸åŒçš„å€¼</p>
<hr>
<h3 id="Pipeline-Support-å®è·µç¤ºä¾‹"><a href="#Pipeline-Support-å®è·µç¤ºä¾‹" class="headerlink" title="Pipeline Support å®è·µç¤ºä¾‹"></a>Pipeline Support å®è·µç¤ºä¾‹</h3><h4 id="Scripted-Pipeline"><a href="#Scripted-Pipeline" class="headerlink" title="Scripted Pipeline"></a>Scripted Pipeline</h4><p>æè¿°ï¼š Scripted Pipeline ç¤ºä¾‹å‚è€ƒ: </p>
<ul>
<li><a href="https://github.com/jenkinsci/kubernetes-plugin/tree/master/examples" target="_blank" rel="noopener">https://github.com/jenkinsci/kubernetes-plugin/tree/master/examples</a></li>
<li><a href="https://github.com/jenkinsci/kubernetes-plugin/tree/master/src/test/resources/org/csanchez/jenkins/plugins/kubernetes/pipeline" target="_blank" rel="noopener">https://github.com/jenkinsci/kubernetes-plugin/tree/master/src/test/resources/org/csanchez/jenkins/plugins/kubernetes/pipeline</a></li>
</ul>
<p><br></p>
<p><strong>(1) containerTemplate</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">podTemplate(</span><br><span class="line"><span class="symbol">  cloud:</span> <span class="string">'kubernetes'</span>,</span><br><span class="line"><span class="symbol">  name:</span> <span class="string">'jenkins-slave'</span>,</span><br><span class="line"><span class="symbol">  namespace:</span> <span class="string">'devops'</span>,</span><br><span class="line"><span class="symbol">  label:</span> <span class="string">'k8s-slave'</span>,</span><br><span class="line">  <span class="comment">// å®¹å™¨åŠå®¹å™¨æ¨¡æ¿å®šä¹‰</span></span><br><span class="line"><span class="symbol">  containers:</span> [</span><br><span class="line">    containerTemplate(</span><br><span class="line"><span class="symbol">      name:</span> <span class="string">'maven'</span>,</span><br><span class="line"><span class="symbol">      image:</span> <span class="string">'maven:3.6-jdk-8-alpine'</span>,</span><br><span class="line"><span class="symbol">      ttyEnabled:</span> <span class="literal">true</span>,</span><br><span class="line"><span class="symbol">      command:</span> <span class="string">'cat'</span>,</span><br><span class="line"><span class="symbol">      privileged:</span> <span class="literal">false</span>,</span><br><span class="line"><span class="symbol">      alwaysPullImage:</span> <span class="literal">false</span>,</span><br><span class="line"><span class="symbol">      workingDir:</span> <span class="string">'/home/jenkins/agent'</span>,</span><br><span class="line"><span class="symbol">      resourceRequestCpu:</span> <span class="string">'100m'</span>,</span><br><span class="line"><span class="symbol">      resourceLimitCpu:</span> <span class="string">'500m'</span>,</span><br><span class="line"><span class="symbol">      resourceRequestMemory:</span> <span class="string">'100Mi'</span>,</span><br><span class="line"><span class="symbol">      resourceLimitMemory:</span> <span class="string">'500Mi'</span>,</span><br><span class="line"><span class="symbol">      envVars:</span> [</span><br><span class="line">        envVar(<span class="string">key:</span> <span class="string">'MYSQL_ALLOW_EMPTY_PASSWORD'</span>, <span class="string">value:</span> <span class="string">'true'</span>)</span><br><span class="line">       <span class="comment">//, secretEnvVar(key: 'MYSQL_PASSWORD', secretName: 'mysql-secret', secretKey: 'password')</span></span><br><span class="line">      ]</span><br><span class="line">      <span class="comment">//,ports: [portMapping(name: 'mysql', containerPort: 3306, hostPort: 3306)]</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment">//     ),</span></span><br><span class="line">    <span class="comment">// containerTemplate(</span></span><br><span class="line">    <span class="comment">//         name: 'jnlp',</span></span><br><span class="line">    <span class="comment">//         image: 'registry.cn-hangzhou.aliyuncs.com/google-containers/jnlp-slave:alpine',</span></span><br><span class="line">    <span class="comment">//         args: '$&#123;computer.jnlpmac&#125; $&#123;computer.name&#125;',</span></span><br><span class="line">    <span class="comment">//         command: ''</span></span><br><span class="line">    <span class="comment">//     )</span></span><br><span class="line">  ]</span><br><span class="line">  ,<span class="string">volumes:</span> [</span><br><span class="line">    hostPathVolume(<span class="string">hostPath:</span> <span class="string">'/nfsdisk-31/appstorage/mavenRepo'</span>, <span class="string">mountPath:</span> <span class="string">'/home/jenkins'</span>),</span><br><span class="line">    hostPathVolume(<span class="string">hostPath:</span> <span class="string">'/var/run/docker.sock'</span>, <span class="string">mountPath:</span> <span class="string">'/var/run/docker.sock'</span>),</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    emptyDirVolume(mountPath: '/etc/mount1', memory: false),</span></span><br><span class="line"><span class="comment">    secretVolume(mountPath: '/etc/mount2', secretName: 'my-secret'),</span></span><br><span class="line"><span class="comment">    configMapVolume(mountPath: '/etc/mount3', configMapName: 'my-config'),</span></span><br><span class="line"><span class="comment">    hostPathVolume(mountPath: '/etc/mount4', hostPath: '/mnt/my-mount'),</span></span><br><span class="line"><span class="comment">    nfsVolume(mountPath: '/etc/mount5', serverAddress: '127.0.0.1', serverPath: '/', readOnly: true),</span></span><br><span class="line"><span class="comment">    persistentVolumeClaim(mountPath: '/home/jenkins', claimName: 'jenkins', readOnly: false),</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  ],</span><br><span class="line"><span class="symbol">  annotations:</span> [</span><br><span class="line">    podAnnotation(<span class="string">key:</span> <span class="string">"maven-pod"</span>, <span class="string">value:</span> <span class="string">"Kubernetes-jenkins-Test"</span>)</span><br><span class="line">  ],</span><br><span class="line"><span class="symbol">  showRawYaml:</span> <span class="string">'flase'</span></span><br><span class="line">  <span class="comment">//,defaultContainer: 'maven'   # scripted pipeline ä¸æ”¯æŒè¯¥å‚æ•°</span></span><br><span class="line">  <span class="comment">//,imagePullSecrets: [ 'pull-secret' ]</span></span><br><span class="line">)</span><br><span class="line">&#123;</span><br><span class="line"> <span class="comment">// æ³¨æ„æ­¤æ¬¡nodeä¸­åˆ™ä¸ºPodæ¨¡æ¿åç§°</span></span><br><span class="line"> node (<span class="string">'k8s-slave'</span>) &#123;</span><br><span class="line">    <span class="comment">// container ä¸­æŒ‡å®šPodä¸­å®¹å™¨åç§°</span></span><br><span class="line">    container(<span class="string">'maven'</span>) &#123;</span><br><span class="line">      stage(<span class="string">'maven'</span>) &#123;</span><br><span class="line">        container(<span class="string">'maven'</span>) &#123;</span><br><span class="line">          sh <span class="string">"hostname &amp;&amp; ip addr"</span></span><br><span class="line">          sh (<span class="string">"mvn -version"</span>)</span><br><span class="line">          sh <span class="string">"env"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿è¡Œç»“æœ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Still waiting to schedule task</span></span><br><span class="line"><span class="comment"># Waiting for next available executor on 'jenkins-slave-09vf0-sf3k6' </span></span><br><span class="line"><span class="comment"># ç­‰å¾…ä¸‹ä¸€ä¸ªå¯ç”¨çš„æ‰§è¡Œå™¨å¯åŠ¨</span></span><br><span class="line"></span><br><span class="line">Created Pod: kubernetes devops/jenkins-slave-rtjxx-q3nhn</span><br><span class="line">[Normal][devops/jenkins-slave-rtjxx-q3nhn][Scheduled] Successfully assigned devops/jenkins-slave-rtjxx-q3nhn to work-223</span><br><span class="line"></span><br><span class="line">[Normal][devops/jenkins-slave-rtjxx-q3nhn][Pulled] Container image <span class="string">"maven:3.6-jdk-8-alpine"</span> already present on machine</span><br><span class="line">[Normal][devops/jenkins-slave-rtjxx-q3nhn][Created] Created container maven | Started container maven</span><br><span class="line"></span><br><span class="line">[Normal][devops/jenkins-slave-rtjxx-q3nhn][Pulled] Container image <span class="string">"jenkins/inbound-agent:4.3-4"</span> already present on machine</span><br><span class="line">[Normal][devops/jenkins-slave-rtjxx-q3nhn][Created] Created container jnlp | Started container jnlp</span><br><span class="line"></span><br><span class="line">Agent jenkins-slave-rtjxx-q3nhn is provisioned from template jenkins-slave-rtjxx</span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------------</span></span><br><span class="line">apiVersion: <span class="string">"v1"</span></span><br><span class="line">kind: <span class="string">"Pod"</span></span><br><span class="line">metadata:</span><br><span class="line">  annotations:</span><br><span class="line">    maven-pod: <span class="string">"Kubernetes-jenkins-Test"</span>   <span class="comment"># æˆ‘ä»¬æ·»åŠ çš„æ³¨è§£</span></span><br><span class="line">    buildUrl: <span class="string">"http://jenkins.devops.svc.cluster.local:8080/job/Kubernetes-jenkins-slave/23/"</span></span><br><span class="line">    runUrl: <span class="string">"job/Kubernetes-jenkins-slave/23/"</span></span><br><span class="line">  labels:</span><br><span class="line">    jenkins: <span class="string">"slave"</span></span><br><span class="line">    jenkins/label-digest: <span class="string">"823e2bb3db243573786b7a360a483f1acc7a0f96"</span></span><br><span class="line">    jenkins/label: <span class="string">"k8s-slave"</span></span><br><span class="line">  name: <span class="string">"jenkins-slave-rtjxx-q3nhn"</span></span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - <span class="built_in">command</span>:</span><br><span class="line">    - <span class="string">"cat"</span>   <span class="comment"># è¿è¡Œçš„å‘½ä»¤</span></span><br><span class="line">    env:</span><br><span class="line">    - name: <span class="string">"MYSQL_ALLOW_EMPTY_PASSWORD"</span>  <span class="comment"># è¿è¡Œçš„ç¯å¢ƒå˜é‡</span></span><br><span class="line">      value: <span class="string">"true"</span></span><br><span class="line">    image: <span class="string">"maven:3.6-jdk-8-alpine"</span></span><br><span class="line">    imagePullPolicy: <span class="string">"IfNotPresent"</span>    <span class="comment"># é•œåƒæ‹‰å–ç­–ç•¥</span></span><br><span class="line">    name: <span class="string">"maven"</span>                      <span class="comment"># å®¹å™¨åç§°</span></span><br><span class="line">    resources: </span><br><span class="line">      limits:</span><br><span class="line">        memory: <span class="string">"500Mi"</span></span><br><span class="line">        cpu: <span class="string">"500m"</span></span><br><span class="line">      requests:</span><br><span class="line">        memory: <span class="string">"100Mi"</span></span><br><span class="line">        cpu: <span class="string">"100m"</span></span><br><span class="line">    tty: <span class="literal">true</span></span><br><span class="line">    volumeMounts:                      <span class="comment"># å·æŒ‚è½½æƒ…å†µ</span></span><br><span class="line">    - mountPath: <span class="string">"/home/jenkins"</span></span><br><span class="line">      name: <span class="string">"volume-0"</span></span><br><span class="line">      readOnly: <span class="literal">false</span></span><br><span class="line">    - mountPath: <span class="string">"/var/run/docker.sock"</span></span><br><span class="line">      name: <span class="string">"volume-1"</span></span><br><span class="line">      readOnly: <span class="literal">false</span></span><br><span class="line">    - mountPath: <span class="string">"/home/jenkins/agent"</span></span><br><span class="line">      name: <span class="string">"workspace-volume"</span></span><br><span class="line">      readOnly: <span class="literal">false</span></span><br><span class="line">    workingDir: <span class="string">"/home/jenkins/agent"</span></span><br><span class="line">  - env:                                   <span class="comment"># jnlp ç¯å¢ƒå˜é‡</span></span><br><span class="line">    - name: <span class="string">"JENKINS_SECRET"</span></span><br><span class="line">      value: <span class="string">"********"</span></span><br><span class="line">    - name: <span class="string">"JENKINS_AGENT_NAME"</span></span><br><span class="line">      value: <span class="string">"jenkins-slave-rtjxx-q3nhn"</span></span><br><span class="line">    - name: <span class="string">"JENKINS_NAME"</span></span><br><span class="line">      value: <span class="string">"jenkins-slave-rtjxx-q3nhn"</span></span><br><span class="line">    - name: <span class="string">"JENKINS_AGENT_WORKDIR"</span></span><br><span class="line">      value: <span class="string">"/home/jenkins/agent"</span></span><br><span class="line">    - name: <span class="string">"JENKINS_URL"</span></span><br><span class="line">      value: <span class="string">"http://jenkins.devops.svc.cluster.local:8080/"</span></span><br><span class="line">    image: <span class="string">"jenkins/inbound-agent:4.3-4"</span></span><br><span class="line">    name: <span class="string">"jnlp"</span>                         <span class="comment"># jenkins-jnlp å®¹å™¨çš„åç§° </span></span><br><span class="line">    resources:</span><br><span class="line">      limits: &#123;&#125;</span><br><span class="line">      requests:</span><br><span class="line">        memory: <span class="string">"256Mi"</span></span><br><span class="line">        cpu: <span class="string">"100m"</span></span><br><span class="line">    volumeMounts:</span><br><span class="line">    - mountPath: <span class="string">"/home/jenkins"</span></span><br><span class="line">      name: <span class="string">"volume-0"</span></span><br><span class="line">      readOnly: <span class="literal">false</span></span><br><span class="line">    - mountPath: <span class="string">"/var/run/docker.sock"</span></span><br><span class="line">      name: <span class="string">"volume-1"</span></span><br><span class="line">      readOnly: <span class="literal">false</span></span><br><span class="line">    - mountPath: <span class="string">"/home/jenkins/agent"</span></span><br><span class="line">      name: <span class="string">"workspace-volume"</span></span><br><span class="line">      readOnly: <span class="literal">false</span></span><br><span class="line">  nodeSelector:</span><br><span class="line">    kubernetes.io/os: <span class="string">"linux"</span></span><br><span class="line">  restartPolicy: <span class="string">"Never"</span></span><br><span class="line">  volumes:</span><br><span class="line">  - hostPath:</span><br><span class="line">      path: <span class="string">"/nfsdisk-31/appstorage/mavenRepo"</span></span><br><span class="line">    name: <span class="string">"volume-0"</span></span><br><span class="line">  - hostPath:</span><br><span class="line">      path: <span class="string">"/var/run/docker.sock"</span></span><br><span class="line">    name: <span class="string">"volume-1"</span></span><br><span class="line">  - emptyDir:</span><br><span class="line">      medium: <span class="string">""</span></span><br><span class="line">    name: <span class="string">"workspace-volume"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ------------------------------</span></span><br><span class="line">+ hostname</span><br><span class="line">  <span class="comment"># jenkins-slave-rtjxx-q3nhn</span></span><br><span class="line"></span><br><span class="line">+ ip addr</span><br><span class="line">  <span class="comment"># 1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1000</span></span><br><span class="line">  <span class="comment">#     link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span></span><br><span class="line">  <span class="comment">#     inet 127.0.0.1/8 scope host lo</span></span><br><span class="line">  <span class="comment">#        valid_lft forever preferred_lft forever</span></span><br><span class="line">  <span class="comment"># 2: tunl0@NONE: &lt;NOARP&gt; mtu 1480 qdisc noop state DOWN qlen 1000</span></span><br><span class="line">  <span class="comment">#     link/ipip 0.0.0.0 brd 0.0.0.0</span></span><br><span class="line">  <span class="comment"># 4: eth0@if162: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1480 qdisc noqueue state UP </span></span><br><span class="line">  <span class="comment">#     link/ether de:c6:df:23:e1:7f brd ff:ff:ff:ff:ff:ff</span></span><br><span class="line">  <span class="comment">#     inet 172.16.24.220/32 brd 172.16.24.220 scope global eth0</span></span><br><span class="line">  <span class="comment">#        valid_lft forever preferred_lft forever</span></span><br><span class="line">+ mvn -version</span><br><span class="line">  <span class="comment"># Apache Maven 3.6.1 (d66c9c0b3152b2e69ee9bac180bb8fcc8e6af555; 2019-04-04T19:00:29Z)</span></span><br><span class="line">  <span class="comment"># Maven home: /usr/share/maven</span></span><br><span class="line">  <span class="comment"># Java version: 1.8.0_212, vendor: IcedTea, runtime: /usr/lib/jvm/java-1.8-openjdk/jre</span></span><br><span class="line">  <span class="comment"># Default locale: en_US, platform encoding: UTF-8</span></span><br><span class="line">  <span class="comment"># OS name: "linux", version: "5.4.0-42-generic", arch: "amd64", family: "unix"</span></span><br><span class="line"></span><br><span class="line">+ env</span><br><span class="line">  <span class="comment"># JENKINS_HOME=/var/jenkins_home</span></span><br><span class="line">  <span class="comment"># POD_CONTAINER=maven</span></span><br><span class="line">  <span class="comment"># STAGE_NAME=maven</span></span><br><span class="line">  <span class="comment"># KUBERNETES_SERVICE_PORT=443</span></span><br><span class="line">  <span class="comment"># JAVA_VERSION=8u212</span></span><br><span class="line">  <span class="comment"># MAVEN_HOME=/usr/share/maven</span></span><br><span class="line">  <span class="comment"># MAVEN_CONFIG=/root/.m2</span></span><br></pre></td></tr></table></figure></p>
<p>Tips : åœ¨PodTemplateæ¨¡æ¿ä¸­è®¾ç½® <code>showRawYaml: &#39;flase&#39;</code> åˆ™å°†ä¸ä¼šæ˜¾ç¤ºèµ„æºæ¸…å•åœ¨æ—¥å¿—ä¸­;</p>
<figure class="image-box">
                <a rel=5.Jenkinsè¿›é˜¶ä¹‹åˆ†å¸ƒå¼æ¶æ„æ‰©å……çŸ¥è¯† href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210207131120.png" target="_blank" title="WeiyiGeek.è„šæœ¬å¼æµæ°´çº¿k8sæ’ä»¶ä½¿ç”¨" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210207131120.png" alt="WeiyiGeek.è„šæœ¬å¼æµæ°´çº¿k8sæ’ä»¶ä½¿ç”¨" title="" class=""></a>
                <p>WeiyiGeek.è„šæœ¬å¼æµæ°´çº¿k8sæ’ä»¶ä½¿ç”¨</p>
            </figure>
<p>Tips : è¦ä½¿ç”¨ secretEnvVar æˆ‘ä»¬å¿…é¡»åœ¨ <code>Dashboard -&gt; å‡­æ® -&gt; ç³»ç»Ÿ -&gt; å…¨å±€å‡­æ® (unrestricted)</code> è¿›è¡Œæ·»åŠ ä¸€ä¸ªSecret-textå‡­æ®(æœªèƒ½æˆåŠŸå¤ç°);<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Secret text	4fc93636-d8f1-4051-8011-d852873fc740	mysql-secret	Secret text	mysql-secret</span><br></pre></td></tr></table></figure></p>
<hr>
<h4 id="Declarative-Pipeline"><a href="#Declarative-Pipeline" class="headerlink" title="Declarative Pipeline"></a>Declarative Pipeline</h4><p>æè¿°: å£°æ˜å¼ç®¡é“æ”¯æŒéœ€è¦Jenkins 2.66+, åœ¨Declarative Pipelineä½¿ç”¨çš„ kubernetes é€‰é¡¹è¯´æ˜;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options are [activeDeadlineSeconds, cloud, containerTemplate, containerTemplates, customWorkspace, defaultContainer, idleMinutes, inheritFrom, instanceCap, label, namespace, nodeSelector, podRetention, serviceAccount, slaveConnectTimeout, supplementalGroups, workingDir, workspaceVolume, yaml, yamlFile, yamlMergeStrategy]</span><br></pre></td></tr></table></figure></p>
<p>ç¤ºä¾‹å¸®åŠ©: <a href="https://github.com/jenkinsci/kubernetes-plugin/tree/master/src/main/resources/org/csanchez/jenkins/plugins/kubernetes/pipeline/samples" target="_blank" rel="noopener">https://github.com/jenkinsci/kubernetes-plugin/tree/master/src/main/resources/org/csanchez/jenkins/plugins/kubernetes/pipeline/samples</a></p>
<p><br></p>
<p><strong>ç¤ºä¾‹1.é€šè¿‡yamlæ–‡ä»¶èµ„æºæ¸…å•åˆ›å»º</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent &#123;</span><br><span class="line">    kubernetes &#123;</span><br><span class="line">      cloud <span class="string">'kubernetes'</span></span><br><span class="line">      namespace <span class="string">'devops'</span></span><br><span class="line">      workingDir <span class="string">'/home/jenkins/agent'</span></span><br><span class="line">      <span class="comment">// ç»§æ‰¿æ¨¡æ¿</span></span><br><span class="line">      inheritFrom <span class="string">'jenkins-slave'</span></span><br><span class="line">      defaultContainer <span class="string">'maven'</span> </span><br><span class="line">      <span class="comment">// yamlFile 'KubernetesPod.yaml'</span></span><br><span class="line">      yaml <span class="string">"""\</span></span><br><span class="line"><span class="string">apiVersion:</span></span><br><span class="line"><span class="string">kind: Pod</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  labels:</span></span><br><span class="line"><span class="string">    jenkins: "slave"</span></span><br><span class="line"><span class="string">    jenkins/label: 'k8s-slave'</span></span><br><span class="line"><span class="string">spec:</span></span><br><span class="line"><span class="string">  containers:</span></span><br><span class="line"><span class="string">  - name: 'maven'</span></span><br><span class="line"><span class="string">    image: 'maven:3.6-jdk-8-alpine'</span></span><br><span class="line"><span class="string">    imagePullPolicy: 'IfNotPresent'     # é•œåƒæ‹‰å–ç­–ç•¥</span></span><br><span class="line"><span class="string">    command:</span></span><br><span class="line"><span class="string">    - cat</span></span><br><span class="line"><span class="string">    tty: true</span></span><br><span class="line"><span class="string">    """</span>.stripIndent()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  stages &#123;</span><br><span class="line">    stage (<span class="string">'declarative Pipeline - kubernetes'</span>) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        echo <span class="string">"declarative Pipeline - kubernetes"</span></span><br><span class="line">        container (<span class="string">'maven'</span>) &#123;</span><br><span class="line">          sh <span class="string">"echo $&#123;POD_CONTAINER&#125;"</span></span><br><span class="line">          sh <span class="string">"mvn -version"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œç»“æœ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">[Pipeline] Start of Pipeline</span><br><span class="line">[Pipeline] podTemplate</span><br><span class="line">[Pipeline] &#123;</span><br><span class="line">[Pipeline] node</span><br><span class="line"><span class="comment"># 'kubernetes-jenkins-slave-49-fcd1s-m3n3q-t33d8' is offline</span></span><br><span class="line"><span class="comment"># Agent kubernetes-jenkins-slave-49-fcd1s-m3n3q-t33d8 is provisioned from template Kubernetes-jenkins-slave_49-fcd1s-m3n3q</span></span><br><span class="line">---</span><br><span class="line">kind: <span class="string">"Pod"</span></span><br><span class="line">metadata:</span><br><span class="line">  annotations:</span><br><span class="line">    buildUrl: <span class="string">"http://jenkins.devops.svc.cluster.local:8080/job/Kubernetes-jenkins-slave/49/"</span></span><br><span class="line">    runUrl: <span class="string">"job/Kubernetes-jenkins-slave/49/"</span></span><br><span class="line">  labels:</span><br><span class="line">    jenkins: <span class="string">"slave"</span></span><br><span class="line">    jenkins/label: <span class="string">"Kubernetes-jenkins-slave_49-fcd1s"</span></span><br><span class="line">    jenkins/label-digest: <span class="string">"95508e0ca05226ba84989959dc886ad4011cf125"</span></span><br><span class="line">  name: <span class="string">"kubernetes-jenkins-slave-49-fcd1s-m3n3q-t33d8"</span></span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - <span class="built_in">command</span>:</span><br><span class="line">    - <span class="string">"cat"</span></span><br><span class="line">    image: <span class="string">"maven:3.6-jdk-8-alpine"</span></span><br><span class="line">    imagePullPolicy: <span class="string">"IfNotPresent"</span></span><br><span class="line">    name: <span class="string">"maven"</span></span><br><span class="line">    tty: <span class="literal">true</span></span><br><span class="line">    volumeMounts:</span><br><span class="line">    - mountPath: <span class="string">"/home/jenkins/agent"</span></span><br><span class="line">      name: <span class="string">"workspace-volume"</span></span><br><span class="line">      readOnly: <span class="literal">false</span></span><br><span class="line">  - env:</span><br><span class="line">    - name: <span class="string">"JENKINS_SECRET"</span></span><br><span class="line">      value: <span class="string">"********"</span></span><br><span class="line">    - name: <span class="string">"JENKINS_AGENT_NAME"</span></span><br><span class="line">      value: <span class="string">"kubernetes-jenkins-slave-49-fcd1s-m3n3q-t33d8"</span></span><br><span class="line">    - name: <span class="string">"JENKINS_NAME"</span></span><br><span class="line">      value: <span class="string">"kubernetes-jenkins-slave-49-fcd1s-m3n3q-t33d8"</span></span><br><span class="line">    - name: <span class="string">"JENKINS_AGENT_WORKDIR"</span></span><br><span class="line">      value: <span class="string">"/home/jenkins/agent"</span></span><br><span class="line">    - name: <span class="string">"JENKINS_URL"</span></span><br><span class="line">      value: <span class="string">"http://jenkins.devops.svc.cluster.local:8080/"</span></span><br><span class="line">    image: <span class="string">"jenkins/inbound-agent:4.3-4"</span></span><br><span class="line">    name: <span class="string">"jnlp"</span></span><br><span class="line">    resources:</span><br><span class="line">      limits: &#123;&#125;</span><br><span class="line">      requests:</span><br><span class="line">        memory: <span class="string">"256Mi"</span></span><br><span class="line">        cpu: <span class="string">"100m"</span></span><br><span class="line">    volumeMounts:</span><br><span class="line">    - mountPath: <span class="string">"/home/jenkins/.m2"</span></span><br><span class="line">      name: <span class="string">"volume-0"</span></span><br><span class="line">      readOnly: <span class="literal">false</span></span><br><span class="line">    - mountPath: <span class="string">"/home/jenkins/agent"</span></span><br><span class="line">      name: <span class="string">"workspace-volume"</span></span><br><span class="line">      readOnly: <span class="literal">false</span></span><br><span class="line">  hostNetwork: <span class="literal">false</span></span><br><span class="line">  nodeSelector:</span><br><span class="line">    kubernetes.io/os: <span class="string">"linux"</span></span><br><span class="line">  restartPolicy: <span class="string">"Never"</span></span><br><span class="line">  volumes:</span><br><span class="line">  - hostPath:</span><br><span class="line">      path: <span class="string">"/nfsdisk-31/appstorage/mavenRepo"</span></span><br><span class="line">    name: <span class="string">"volume-0"</span></span><br><span class="line">  - emptyDir:</span><br><span class="line">      medium: <span class="string">""</span></span><br><span class="line">    name: <span class="string">"workspace-volume"</span></span><br><span class="line"></span><br><span class="line">Running on kubernetes-jenkins-slave-49-fcd1s-m3n3q-t33d8 <span class="keyword">in</span> /home/jenkins/agent/workspace/Kubernetes-jenkins-slave</span><br><span class="line">  <span class="comment"># [Pipeline] &#123;</span></span><br><span class="line">  <span class="comment"># [Pipeline] container</span></span><br><span class="line">  <span class="comment"># [Pipeline] &#123;</span></span><br><span class="line">  <span class="comment"># [Pipeline] stage</span></span><br><span class="line">  <span class="comment"># [Pipeline] &#123; (declarative Pipeline - kubernetes)</span></span><br><span class="line">[Pipeline] <span class="built_in">echo</span></span><br><span class="line">declarative Pipeline - kubernetes</span><br><span class="line">  <span class="comment"># [Pipeline] container</span></span><br><span class="line">  <span class="comment"># [Pipeline] &#123;</span></span><br><span class="line">  <span class="comment"># [Pipeline] sh</span></span><br><span class="line">+ <span class="built_in">echo</span> maven</span><br><span class="line">maven</span><br><span class="line">  <span class="comment"># [Pipeline] sh</span></span><br><span class="line">+ mvn -version</span><br><span class="line">Apache Maven 3.6.1 (d66c9c0b3152b2e69ee9bac180bb8fcc8e6af555; 2019-04-04T19:00:29Z)</span><br><span class="line">Maven home: /usr/share/maven</span><br><span class="line">Java version: 1.8.0_212, vendor: IcedTea, runtime: /usr/lib/jvm/java-1.8-openjdk/jre</span><br><span class="line">Default locale: en_US, platform encoding: UTF-8</span><br><span class="line">OS name: <span class="string">"linux"</span>, version: <span class="string">"5.4.0-42-generic"</span>, arch: <span class="string">"amd64"</span>, family: <span class="string">"unix"</span></span><br><span class="line">  <span class="comment"># [Pipeline] &#125;</span></span><br><span class="line">  <span class="comment"># [Pipeline] // container</span></span><br><span class="line">  <span class="comment"># [Pipeline] &#125;</span></span><br><span class="line">  <span class="comment"># [Pipeline] // stage</span></span><br><span class="line">  <span class="comment"># [Pipeline] &#125;</span></span><br><span class="line">  <span class="comment"># [Pipeline] // container</span></span><br><span class="line">  <span class="comment"># [Pipeline] &#125;</span></span><br><span class="line">  <span class="comment"># [Pipeline] // node</span></span><br><span class="line">  <span class="comment"># [Pipeline] &#125;</span></span><br><span class="line">  <span class="comment"># [Pipeline] // podTemplate</span></span><br><span class="line">  <span class="comment"># [Pipeline] End of Pipeline</span></span><br><span class="line">Finished: SUCCESS</span><br></pre></td></tr></table></figure></p>
<p>Tips :é»˜è®¤æƒ…å†µä¸‹åœ¨å®¹å™¨ä¸­è¿è¡Œæ­¥éª¤, æ­¥éª¤å°†åµŒå¥—åœ¨éšå¼containerï¼ˆnameï¼‰{â€¦}å—ä¸­ï¼Œè€Œä¸æ˜¯åœ¨jnlpå®¹å™¨ä¸­æ‰§è¡Œã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaultContainer <span class="string">'maven'</span></span><br></pre></td></tr></table></figure></p>
<p>Tips : æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨yamlFileå°†podæ¨¡æ¿ä¿å­˜åœ¨å•ç‹¬çš„KubernetesPod.yamlæ–‡ä»¶ä¸­<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent &#123;</span><br><span class="line">    kubernetes &#123;</span><br><span class="line">      yamlFile <span class="string">'KubernetesPod.yaml'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  stages &#123;</span><br><span class="line">     ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="0x02-è‡ªå®šä¹‰Jenkinså·¥ä½œèŠ‚ç‚¹ä¹‹jnlp-slaveé•œåƒæ¨¡æ¿æ„å»º"><a href="#0x02-è‡ªå®šä¹‰Jenkinså·¥ä½œèŠ‚ç‚¹ä¹‹jnlp-slaveé•œåƒæ¨¡æ¿æ„å»º" class="headerlink" title="0x02 è‡ªå®šä¹‰Jenkinså·¥ä½œèŠ‚ç‚¹ä¹‹jnlp-slaveé•œåƒæ¨¡æ¿æ„å»º"></a>0x02 è‡ªå®šä¹‰Jenkinså·¥ä½œèŠ‚ç‚¹ä¹‹jnlp-slaveé•œåƒæ¨¡æ¿æ„å»º</h2><h3 id="Dockerfile-æ„å»ºä¾èµ–"><a href="#Dockerfile-æ„å»ºä¾èµ–" class="headerlink" title="Dockerfile æ„å»ºä¾èµ–"></a>Dockerfile æ„å»ºä¾èµ–</h3><p>æè¿°: ä¸‹è¿°ç›¸å…³è„šæœ¬ä»¥åŠæ–‡ä»¶ä¸‹è½½åœ°å€è¯·åœ¨<code>WeiyiGeek</code>å¾®ä¿¡å…¬ä¼—å·å›å¤<code>jenkins-jnlp-dockerfile</code>å…³é”®å­—è·å–; </p>
<p>è‡ªå®šä¹‰çš„jnlpå®¹å™¨æ¨¡æ¿ä¸»è¦å®ç°åŠŸèƒ½: </p>
<ul>
<li>ç”¨æˆ·æƒé™æ§åˆ¶(sudo)</li>
<li>ssh è¿œç¨‹è¿æ¥</li>
<li>git ä»£ç ç‰ˆæœ¬æ§åˆ¶</li>
<li>docker å®¹å™¨ç®¡ç†</li>
<li>kubectl é›†ç¾¤ç®¡ç†</li>
<li>Java è¿è¡Œç¯å¢ƒ</li>
<li>Maven è¿è¡Œç¯å¢ƒ</li>
<li>SonarQube æ‰«æç¯å¢ƒ</li>
<li>Gitlab_release ä¸Šä¼ ç¯å¢ƒ</li>
<li>ä¸­æ–‡ç¯å¢ƒæ”¯æŒ</li>
<li>æ—¶åŒºæ›´æ”¹é…ç½®</li>
</ul>
<p><br></p>
<p>Tips: åœ¨K8sé›†ç¾¤ä¸­æµ‹è¯•alpineé•œåƒæ‰§è¡Œç›¸åº”çš„å®‰è£…(éœ€è¦åœ¨Alpineè°ƒè¯•æ–°å®‰è£…è½¯ä»¶æ—¶ä½¿ç”¨):<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF | kubectl apply -f -</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: alpine-app</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: alpine-app</span><br><span class="line">    image: alpine:latest</span><br><span class="line">    args:</span><br><span class="line">    - sleep</span><br><span class="line">    - <span class="string">"100000"</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">pod/alpine-app created</span><br><span class="line"></span><br><span class="line">$ kubectl get pods -o wide</span><br><span class="line">  <span class="comment"># NAME                                       READY   STATUS    RESTARTS   AGE    IP              NODE        NOMINATED NODE   READINESS GATES</span></span><br><span class="line">  <span class="comment"># alpine-app                                 1/1     Running   0          116s   10.100.37.194   worker-02   &lt;none&gt;           &lt;none&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>Dockerfile</strong></p>
<p>è‡ªå®šä¹‰jnlpå®¹å™¨æ¨¡æ¿é•œåƒåœ°å€: <a href="https://hub.docker.com/r/weiyigeek/alpine-jenkins-jnlp" target="_blank" rel="noopener">https://hub.docker.com/r/weiyigeek/alpine-jenkins-jnlp</a></p>
<p>è¯¥é•œåƒæ˜¯Jenkinsè‡ªå®šä¹‰jnlpå®¹å™¨æ¨¡æ¿ï¼Œä¸»è¦ç”¨äºJenkinså·¥ä½œèŠ‚ç‚¹å®¹å™¨åŒ–ä½¿ç”¨ï¼Œä¸»è¦åŒ…å«Gitlab_releaseå‘å¸ƒã€ docker å®¹å™¨ç®¡ç†ã€kubectl é›†ç¾¤ç®¡ç†åŠŸèƒ½ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨docker çš„ç¯å¢ƒä¸­ <code>docker pull weiyigeek/alpine-jenkins-jnlp</code>ä¸‹æ¥</p>
<p>è¯´æ˜: é•œåƒæ„å»ºæ–‡ä»¶<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#----------------------------------------------------------------------#</span></span><br><span class="line"><span class="comment"># Title: Base in Alpine Images Create Custom Jenkins Kubernetes jnlp Images</span></span><br><span class="line"><span class="comment"># Author: WeiyiGeek</span></span><br><span class="line"><span class="comment"># WebSite: https://weiyigeek.top</span></span><br><span class="line"><span class="comment"># MainFunction:</span></span><br><span class="line"><span class="comment">#   Install ssh-server docker git openssh tzdata curl tar sudo git ca-certificates wget unzip docker zlib nodejs npm jq</span></span><br><span class="line"><span class="comment">#   Install JDK8</span></span><br><span class="line"><span class="comment">#   - https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html</span></span><br><span class="line"><span class="comment">#   - https://github.com/sgerrand/alpine-pkg-glibc/releases/</span></span><br><span class="line"><span class="comment">#   - https://alpine-pkgs.sgerrand.com/sgerrand.rsa.pub</span></span><br><span class="line"><span class="comment">#   Install jnlp</span></span><br><span class="line"><span class="comment">#   - https://repo.jenkins-ci.org/public/org/jenkins-ci/main/remoting/</span></span><br><span class="line"><span class="comment">#   Install Maven</span></span><br><span class="line"><span class="comment">#   - https://apache.osuosl.org/maven/maven-3/$&#123;MAVEN_VERSION&#125;/binaries</span></span><br><span class="line"><span class="comment">#   Install SonarqubeScan</span></span><br><span class="line"><span class="comment">#   - https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-4.5.0.2216-linux.zip</span></span><br><span class="line"><span class="comment">#   Install Gitlab Release Version: 0.0.6</span></span><br><span class="line"><span class="comment">#   - https://gitlab.com/gitlab-org/release-cli/-/releases</span></span><br><span class="line"><span class="comment">#   Install kubernetes cli</span></span><br><span class="line"><span class="comment">#   - kubectl Version: 1.19.3</span></span><br><span class="line"><span class="comment"># Version: alpine-3.13.1</span></span><br><span class="line"><span class="comment"># Release: v1.10</span></span><br><span class="line"><span class="comment"># ChangeLog:</span></span><br><span class="line"><span class="comment"># v1.9 -  å¢åŠ  ä¸­æ–‡ç¯å¢ƒ</span></span><br><span class="line"><span class="comment"># v1.10 - å¢åŠ  node.js ç¯å¢ƒæ”¯æŒ</span></span><br><span class="line"><span class="comment">#-------------------------------------------------#</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> alpine:<span class="number">3.13</span>.<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">MAINTAINER</span>  Jenkins Custom Work Node Jnlp Container - &lt;master@weiyigeek.top&gt; - WeiyiGeek</span><br><span class="line"></span><br><span class="line"><span class="keyword">ARG</span> USERNAME=jenkins \</span><br><span class="line">    AGENT_WORKDIR=/home/jenkins \</span><br><span class="line">    BASE_DIR=/usr/local  \</span><br><span class="line">    BASE_BIN=/usr/local/bin  \</span><br><span class="line">    BASE_URL=http://<span class="number">192.168</span>.<span class="number">12.107</span>:<span class="number">8080</span>  \</span><br><span class="line">    LOCALE=locale.md \</span><br><span class="line">    JDK_NAME=jdk-<span class="number">8</span>u281-linux-x64   \</span><br><span class="line">    JDK_DIR=/usr/local/jdk1.<span class="number">8.0</span>_281  \</span><br><span class="line">    GLIBC_NAME=glibc-<span class="number">2.32</span>-r0.apk \</span><br><span class="line">    GLIBC_BIN_NAME=glibc-bin-<span class="number">2.32</span>-r0.apk \</span><br><span class="line">    GLIBC_I18N_NAME=glibc-i18n-<span class="number">2.32</span>-r0.apk \</span><br><span class="line">    MAVEN_NAME=apache-maven-<span class="number">3.6</span>.<span class="number">3</span>-bin \</span><br><span class="line">    MAVEN_DIR=/usr/local/apache-maven-<span class="number">3.6</span>.<span class="number">3</span> \</span><br><span class="line">    SONAR_SCANNER_NAME=sonar-scanner-cli-<span class="number">4.5</span>.<span class="number">0.2216</span>-linux \</span><br><span class="line">    SONAR_SCANNER_DIR=/usr/local/sonar-scanner-<span class="number">4.5</span>.<span class="number">0.2216</span>-linux \</span><br><span class="line">    GITLAB_CLI=release-cli-<span class="number">0.6</span>.<span class="number">0</span>-linux-amd64 </span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> LANG=en_US.UTF-<span class="number">8</span> \</span><br><span class="line">    LC_ALL=en_US.UTF-<span class="number">8</span> \</span><br><span class="line">    JAVA_HOME=/usr/local/jdk8  \ </span><br><span class="line">    JRE_HOME=/usr/local/jdk8/jre \ </span><br><span class="line">    MAVEN_HOME=/usr/local/maven \ </span><br><span class="line">    MAVEN_RPEO=/home/jenkins/.m2 \</span><br><span class="line">    SONAR_SCANNER_HOME=/usr/local/sonar-scanner \</span><br><span class="line">    NODEJS_MODULES=/usr/lib/node_modules</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨æˆ·ROOTåˆ‡æ¢</span></span><br><span class="line"><span class="keyword">USER</span> root</span><br><span class="line"></span><br><span class="line"><span class="comment"># Shell å‘½ä»¤ - æ­¤ç§æ–¹å¼æå¤§å‡å°‘äº†æ„å»ºçš„é•œåƒå¤§å°;</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> sed -i <span class="string">'s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g'</span> /etc/apk/repositories \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apk update \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apk add --no-cache openssh tzdata curl tar sudo git ca-certificates wget unzip docker zlib nodejs npm jq \</span></span><br><span class="line"><span class="bash">    &amp;&amp; cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \</span></span><br><span class="line"><span class="bash">    &amp;&amp; chmod 4755 /bin/busybox \</span></span><br><span class="line"><span class="bash">    &amp;&amp; addgroup -g 1000 -S <span class="variable">$&#123;USERNAME&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; adduser <span class="variable">$&#123;USERNAME&#125;</span> -D -g <span class="variable">$&#123;USERNAME&#125;</span> -G root -u 1000 -s /bin/sh \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">echo</span> <span class="string">"jenkins   ALL=(root) NOPASSWD:ALL"</span> &gt;&gt; /etc/sudoers \</span></span><br><span class="line"><span class="bash">    &amp;&amp; mkdir -p <span class="variable">$&#123;AGENT_WORKDIR&#125;</span>/.ssh <span class="variable">$&#123;AGENT_WORKDIR&#125;</span>/.m2 \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -q -O /tmp/<span class="variable">$&#123;GLIBC_NAME&#125;</span> <span class="variable">$&#123;BASE_URL&#125;</span>/<span class="variable">$&#123;GLIBC_NAME&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -q -O /tmp/<span class="variable">$&#123;GLIBC_BIN_NAME&#125;</span> <span class="variable">$&#123;BASE_URL&#125;</span>/<span class="variable">$&#123;GLIBC_BIN_NAME&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -q -O /tmp/<span class="variable">$&#123;GLIBC_I18N_NAME&#125;</span> <span class="variable">$&#123;BASE_URL&#125;</span>/<span class="variable">$&#123;GLIBC_I18N_NAME&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -q -O /etc/apk/keys/sgerrand.rsa.pub <span class="variable">$&#123;BASE_URL&#125;</span>/sgerrand.rsa.pub \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -q -O /tmp/<span class="variable">$&#123;LOCALE&#125;</span> <span class="variable">$&#123;BASE_URL&#125;</span>/<span class="variable">$&#123;LOCALE&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -q -O /tmp/<span class="variable">$&#123;JDK_NAME&#125;</span>.tar.gz <span class="variable">$&#123;BASE_URL&#125;</span>/<span class="variable">$&#123;JDK_NAME&#125;</span>.tar.gz \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -q -O <span class="variable">$&#123;BASE_BIN&#125;</span>/agent.jar <span class="variable">$&#123;BASE_URL&#125;</span>/agent.jar \</span></span><br><span class="line"><span class="bash">    &amp;&amp; curl -fsSL -o <span class="variable">$&#123;BASE_BIN&#125;</span>/jenkins-agent.sh <span class="variable">$&#123;BASE_URL&#125;</span>/jenkins-agent.sh \</span></span><br><span class="line"><span class="bash">    &amp;&amp; curl -fsSL -o /tmp/<span class="variable">$&#123;MAVEN_NAME&#125;</span>.tar.gz <span class="variable">$&#123;BASE_URL&#125;</span>/<span class="variable">$&#123;MAVEN_NAME&#125;</span>.tar.gz \</span></span><br><span class="line"><span class="bash">    &amp;&amp; curl -fsSL -o /tmp/<span class="variable">$&#123;SONAR_SCANNER_NAME&#125;</span>.zip <span class="variable">$&#123;BASE_URL&#125;</span>/<span class="variable">$&#123;SONAR_SCANNER_NAME&#125;</span>.zip \</span></span><br><span class="line"><span class="bash">    &amp;&amp; curl -fsSL -o /usr/<span class="built_in">local</span>/bin/release-cli <span class="variable">$&#123;BASE_URL&#125;</span>/<span class="variable">$&#123;GITLAB_CLI&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; curl -fsSL -o /usr/<span class="built_in">local</span>/bin/kubectl <span class="variable">$&#123;BASE_URL&#125;</span>/kubectl \</span></span><br><span class="line"><span class="bash">    &amp;&amp; sed -i <span class="string">"s/#PermitRootLogin.*/PermitRootLogin yes/g"</span> /etc/ssh/sshd_config \</span></span><br><span class="line"><span class="bash">    &amp;&amp; sed -i <span class="string">"s/^#\s*StrictHostKeyChecking ask/StrictHostKeyChecking no/g"</span> /etc/ssh/ssh_config \</span></span><br><span class="line"><span class="bash">    &amp;&amp; ssh-keygen -t dsa -P <span class="string">""</span> -f /etc/ssh/ssh_host_dsa_key \</span></span><br><span class="line"><span class="bash">    &amp;&amp; ssh-keygen -t rsa -P <span class="string">""</span> -f /etc/ssh/ssh_host_rsa_key \</span></span><br><span class="line"><span class="bash">    &amp;&amp; ssh-keygen -t ecdsa -P <span class="string">""</span> -f /etc/ssh/ssh_host_ecdsa_key \</span></span><br><span class="line"><span class="bash">    &amp;&amp; ssh-keygen -t ed25519 -P <span class="string">""</span> -f /etc/ssh/ssh_host_ed25519_key \</span></span><br><span class="line"><span class="bash">    &amp;&amp; ssh-keygen -t ed25519 -P <span class="string">""</span> -C <span class="string">"master@weiyigeek.top"</span> -f /home/jenkins/.ssh/id_ed25519 \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apk add /tmp/<span class="variable">$&#123;GLIBC_NAME&#125;</span> /tmp/<span class="variable">$&#123;GLIBC_BIN_NAME&#125;</span> /tmp/<span class="variable">$&#123;GLIBC_I18N_NAME&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; tar -zxf /tmp/<span class="variable">$&#123;JDK_NAME&#125;</span>.tar.gz -C <span class="variable">$&#123;BASE_DIR&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; mv <span class="variable">$&#123;JDK_DIR&#125;</span> <span class="variable">$&#123;JAVA_HOME&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; tar -zxf /tmp/<span class="variable">$&#123;MAVEN_NAME&#125;</span>.tar.gz -C <span class="variable">$&#123;BASE_DIR&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; mv <span class="variable">$&#123;MAVEN_DIR&#125;</span> <span class="variable">$&#123;MAVEN_HOME&#125;</span> \ </span></span><br><span class="line">    &amp;&amp; unzip /tmp/$&#123;SONAR_SCANNER_NAME&#125;.zip -d $&#123;BASE_DIR&#125; \</span><br><span class="line">    &amp;&amp; mv $&#123;SONAR_SCANNER_DIR&#125; $&#123;SONAR_SCANNER_HOME&#125; \</span><br><span class="line">    &amp;&amp; npm config set registry https://registry.npmmirror.com \</span><br><span class="line">    &amp;&amp; chmod a+x $&#123;BASE_BIN&#125;/* \</span><br><span class="line">    &amp;&amp; chown -R jenkins:jenkins $&#123;BASE_DIR&#125;/ $&#123;AGENT_WORKDIR&#125;/ $&#123;NODEJS_MODULES&#125;/ \</span><br><span class="line">    &amp;&amp; echo <span class="string">"root:WeiyiGeek"</span> | chpasswd \</span><br><span class="line">    &amp;&amp; echo <span class="string">"jenkins:WeiyiGeek"</span> | chpasswd \</span><br><span class="line">    &amp;&amp; cat /tmp/$&#123;LOCALE&#125; | xargs -i /usr/glibc-compat/bin/localedef -i &#123;&#125; -f UTF-<span class="number">8</span> &#123;&#125;.UTF-<span class="number">8</span> \</span><br><span class="line">    &amp;&amp; sed -i <span class="string">"s#use_embedded_jre=true#use_embedded_jre=false#g"</span> $&#123;SONAR_SCANNER_HOME&#125;/bin/sonar-scanner \</span><br><span class="line">    &amp;&amp; rm -rf /var/cache/apk/* /tmp/* $&#123;SONAR_SCANNER_HOME&#125;/jre/* \</span><br><span class="line">    &amp;&amp; cd $&#123;JAVA_HOME&#125; \</span><br><span class="line">    &amp;&amp; rm -rf COPYRIGHT LICENSE README release THIRDPARTYLICENSEREADME-JAVAFX.txt THIRDPARTYLICENSEREADME.txt Welcome.html  javafx-src.zip src.zip \</span><br><span class="line">    lib/plugin.jar \</span><br><span class="line">    lib/ext/jfxrt.jar \</span><br><span class="line">    bin/javaws \</span><br><span class="line">    lib/javaws.jar \</span><br><span class="line">    lib/desktop \</span><br><span class="line">    plugin \</span><br><span class="line">    lib/deploy* \</span><br><span class="line">    lib/*javafx* \</span><br><span class="line">    lib/*jfx* \</span><br><span class="line">    lib/amd64/libdecora_sse.so \</span><br><span class="line">    lib/amd64/libprism_*.so \</span><br><span class="line">    lib/amd64/libfxplugins.so \</span><br><span class="line">    lib/amd64/libglass.so \</span><br><span class="line">    lib/amd64/libgstreamer-lite.so \</span><br><span class="line">    lib/amd64/libjavafx*.so \</span><br><span class="line">    lib/amd64/libjfx*.so</span><br><span class="line">    &amp;&amp; echo <span class="string">"export LANG=zh_CN.UTF-8"</span> &gt; /etc/profile.d/locale.sh </span><br><span class="line"></span><br><span class="line"><span class="keyword">USER</span> jenkins </span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> <span class="variable">$&#123;AGENT_WORKDIR&#125;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib/dt.jar:$&#123;JAVA_HOME&#125;/lib/tools.jar \</span><br><span class="line">    PATH=$&#123;JAVA_HOME&#125;/bin:$&#123;MAVEN_HOME&#125;/bin:$&#123;SONAR_SCANNER_HOME&#125;/bin:$PATH</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"/usr/local/bin/jenkins-agent.sh"</span>]</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>local.md</strong><br>æè¿°ï¼šè®©alpineæ“ä½œç³»ç»Ÿä¸­æ–‡å­—ç¬¦æ”¯æŒ;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">tee local.md &lt;&lt;<span class="string">'END'</span></span><br><span class="line">en_AG</span><br><span class="line">en_AU</span><br><span class="line">en_BW</span><br><span class="line">en_CA</span><br><span class="line">en_DK</span><br><span class="line">en_GB</span><br><span class="line">en_HK</span><br><span class="line">en_IE</span><br><span class="line">en_IN</span><br><span class="line">en_NG</span><br><span class="line">en_NZ</span><br><span class="line">en_PH</span><br><span class="line">en_SG</span><br><span class="line">en_US</span><br><span class="line">en_ZA</span><br><span class="line">en_ZM</span><br><span class="line">en_ZW</span><br><span class="line">zh_CN</span><br><span class="line">zh_HK</span><br><span class="line">zh_SG</span><br><span class="line">zh_TW</span><br><span class="line">zu_ZA</span><br><span class="line">END</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>jenkins-agent.sh</strong><br>æè¿°: å®¹å™¨å¯åŠ¨æ—¶ä¸<code>jenkins</code>åˆ©ç”¨Java jnlp è¿›è¡Œè¿æ¥çš„è„šæœ¬;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Usage jenkins-agent.sh [options] -url http://jenkins [SECRET] [AGENT_NAME]</span></span><br><span class="line"><span class="comment"># Optional environment variables :</span></span><br><span class="line"><span class="comment"># * JENKINS_TUNNEL : HOST:PORT for a tunnel to route TCP traffic to jenkins host, when jenkins can't be directly accessed over network</span></span><br><span class="line"><span class="comment"># * JENKINS_URL : alternate jenkins URL</span></span><br><span class="line"><span class="comment"># * JENKINS_SECRET : agent secret, if not set as an argument</span></span><br><span class="line"><span class="comment"># * JENKINS_AGENT_NAME : agent name, if not set as an argument</span></span><br><span class="line"><span class="comment"># * JENKINS_AGENT_WORKDIR : agent work directory, if not set by optional parameter -workDir</span></span><br><span class="line"><span class="comment"># * JENKINS_WEB_SOCKET: true if the connection should be made via WebSocket rather than TCP</span></span><br><span class="line"><span class="comment"># * JENKINS_DIRECT_CONNECTION: Connect directly to this TCP agent port, skipping the HTTP(S) connection parameter download.</span></span><br><span class="line"><span class="comment">#                              Value: "&lt;HOST&gt;:&lt;PORT&gt;"</span></span><br><span class="line"><span class="comment"># * JENKINS_INSTANCE_IDENTITY: The base64 encoded InstanceIdentity byte array of the Jenkins master. When this is set,</span></span><br><span class="line"><span class="comment">#                              the agent skips connecting to an HTTP(S) port for connection info.</span></span><br><span class="line"><span class="comment"># * JENKINS_PROTOCOLS:         Specify the remoting protocols to attempt when instanceIdentity is provided.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -eq 1 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="comment"># if `docker run` only has one arguments, we assume user is running alternate command like `bash` to inspect the image</span></span><br><span class="line">        <span class="built_in">exec</span> <span class="string">"<span class="variable">$@</span>"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="comment"># if -tunnel is not provided, try env vars</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">"<span class="variable">$@</span>"</span> <span class="keyword">in</span></span><br><span class="line">                *<span class="string">"-tunnel "</span>*) ;;</span><br><span class="line">                *)</span><br><span class="line">                <span class="keyword">if</span> [ ! -z <span class="string">"<span class="variable">$JENKINS_TUNNEL</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">                  TUNNEL=<span class="string">"-tunnel <span class="variable">$JENKINS_TUNNEL</span>"</span></span><br><span class="line">                <span class="keyword">fi</span> ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># if -workDir is not provided, try env vars</span></span><br><span class="line">        <span class="keyword">if</span> [ ! -z <span class="string">"<span class="variable">$JENKINS_AGENT_WORKDIR</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">case</span> <span class="string">"<span class="variable">$@</span>"</span> <span class="keyword">in</span></span><br><span class="line">                        *<span class="string">"-workDir"</span>*) <span class="built_in">echo</span> <span class="string">"Warning: Work directory is defined twice in command-line arguments and the environment variable"</span> ;;</span><br><span class="line">                        *)</span><br><span class="line">                        WORKDIR=<span class="string">"-workDir <span class="variable">$JENKINS_AGENT_WORKDIR</span>"</span> ;;</span><br><span class="line">                <span class="keyword">esac</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$JENKINS_URL</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">                URL=<span class="string">"-url <span class="variable">$JENKINS_URL</span>"</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$JENKINS_NAME</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">                JENKINS_AGENT_NAME=<span class="string">"<span class="variable">$JENKINS_NAME</span>"</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">"<span class="variable">$JENKINS_WEB_SOCKET</span>"</span> = <span class="literal">true</span> ]; <span class="keyword">then</span></span><br><span class="line">                WEB_SOCKET=-webSocket</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$JENKINS_PROTOCOLS</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">                PROTOCOLS=<span class="string">"-protocols <span class="variable">$JENKINS_PROTOCOLS</span>"</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$JENKINS_DIRECT_CONNECTION</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">                DIRECT=<span class="string">"-direct <span class="variable">$JENKINS_DIRECT_CONNECTION</span>"</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$JENKINS_INSTANCE_IDENTITY</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">                INSTANCE_IDENTITY=<span class="string">"-instanceIdentity <span class="variable">$JENKINS_INSTANCE_IDENTITY</span>"</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># if java home is defined, use it</span></span><br><span class="line">        JAVA_BIN=<span class="string">"java"</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">"<span class="variable">$JAVA_HOME</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">                JAVA_BIN=<span class="string">"<span class="variable">$JAVA_HOME</span>/bin/java"</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># if both required options are defined, do not pass the parameters</span></span><br><span class="line">        OPT_JENKINS_SECRET=<span class="string">""</span></span><br><span class="line">        <span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$JENKINS_SECRET</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">case</span> <span class="string">"<span class="variable">$@</span>"</span> <span class="keyword">in</span></span><br><span class="line">                        *<span class="string">"<span class="variable">$&#123;JENKINS_SECRET&#125;</span>"</span>*) <span class="built_in">echo</span> <span class="string">"Warning: SECRET is defined twice in command-line arguments and the environment variable"</span> ;;</span><br><span class="line">                        *)</span><br><span class="line">                        OPT_JENKINS_SECRET=<span class="string">"<span class="variable">$&#123;JENKINS_SECRET&#125;</span>"</span> ;;</span><br><span class="line">                <span class="keyword">esac</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">        OPT_JENKINS_AGENT_NAME=<span class="string">""</span></span><br><span class="line">        <span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$JENKINS_AGENT_NAME</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">case</span> <span class="string">"<span class="variable">$@</span>"</span> <span class="keyword">in</span></span><br><span class="line">                        *<span class="string">"<span class="variable">$&#123;JENKINS_AGENT_NAME&#125;</span>"</span>*) <span class="built_in">echo</span> <span class="string">"Warning: AGENT_NAME is defined twice in command-line arguments and the environment variable"</span> ;;</span><br><span class="line">                        *)</span><br><span class="line">                        OPT_JENKINS_AGENT_NAME=<span class="string">"<span class="variable">$&#123;JENKINS_AGENT_NAME&#125;</span>"</span> ;;</span><br><span class="line">                <span class="keyword">esac</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#<span class="doctag">TODO:</span> Handle the case when the command-line and Environment variable contain different values.</span></span><br><span class="line">        <span class="comment">#It is fine it blows up for now since it should lead to an error anyway.</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">exec</span> <span class="variable">$JAVA_BIN</span> <span class="variable">$JAVA_OPTS</span> -cp /usr/<span class="built_in">local</span>/bin/agent.jar hudson.remoting.jnlp.Main -headless <span class="variable">$TUNNEL</span> <span class="variable">$URL</span> <span class="variable">$WORKDIR</span> <span class="variable">$WEB_SOCKET</span> <span class="variable">$DIRECT</span> <span class="variable">$PROTOCOLS</span> <span class="variable">$INSTANCE_IDENTITY</span> <span class="variable">$OPT_JENKINS_SECRET</span> <span class="variable">$OPT_JENKINS_AGENT_NAME</span> <span class="string">"<span class="variable">$@</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>é•œåƒæ„å»ºæ‰€éœ€è½¯ä»¶</strong><br>å¤‡æ³¨: åœ¨Jenkins 2.277ç‰ˆæœ¬ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ä¸­è·å–åŒ¹é…å½“å‰ç‰ˆæœ¬çš„ agent.jar, æˆ–è€…æ˜¯åœ¨ jenkins å®˜ç½‘ <a href="https://repo.jenkins-ci.org/public/org/jenkins-ci/main/remoting" target="_blank" rel="noopener">https://repo.jenkins-ci.org/public/org/jenkins-ci/main/remoting</a> è¿›è¡Œä¸‹è½½;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/k8s/jenkins/jnlp-slave$ ls</span><br><span class="line">agent.jar                      build              jdk-8u281-linux-x64.tar.gz  Jenkins.zip  release-cli-0.6.0-linux-amd64  sonar-scanner-cli-4.5.0.2216-linux.zip</span><br><span class="line">apache-maven-3.6.3-bin.tar.gz  glibc-2.32-r0.apk  jenkins-agent.sh            kubectl      sgerrand.rsa.pub</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="Dockerfile-æ„å»ºæ“ä½œ"><a href="#Dockerfile-æ„å»ºæ“ä½œ" class="headerlink" title="Dockerfile æ„å»ºæ“ä½œ"></a>Dockerfile æ„å»ºæ“ä½œ</h3><p><strong>æ“ä½œæµç¨‹</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (0) å¯åŠ¨ä¸€ä¸ªä¸´æ—¶çš„webæœåŠ¡å™¨ï¼ˆ`å­˜æ”¾ä¸Šé¢çš„é•œåƒæ„å»ºæ‰€éœ€è½¯ä»¶`-éå¸¸é‡è¦-å¦åˆ™å°†ä¼šå¯¼è‡´æ„å»ºå¤±è´¥ï¼‰</span></span><br><span class="line">~/k8s/jenkins/jnlp-slave$ python3 -m http.server 8080</span><br><span class="line">Serving HTTP on 0.0.0.0 port 8080 (http://0.0.0.0:8080/) ...</span><br><span class="line"><span class="comment"># 172.17.0.4 - - [30/Mar/2021 17:32:00] "GET /glibc-2.32-r0.apk HTTP/1.1" 200 -</span></span><br><span class="line"><span class="comment"># 172.17.0.4 - - [30/Mar/2021 17:32:00] "GET /glibc-bin-2.32-r0.apk HTTP/1.1" 200 -</span></span><br><span class="line"><span class="comment"># 172.17.0.4 - - [30/Mar/2021 17:32:00] "GET /glibc-i18n-2.32-r0.apk HTTP/1.1" 200 -</span></span><br><span class="line"><span class="comment"># 172.17.0.4 - - [30/Mar/2021 17:32:00] "GET /sgerrand.rsa.pub HTTP/1.1" 200 -</span></span><br><span class="line"><span class="comment"># 172.17.0.4 - - [30/Mar/2021 17:32:00] "GET /locale.md HTTP/1.1" 200 -</span></span><br><span class="line"><span class="comment"># 172.17.0.4 - - [30/Mar/2021 17:32:00] "GET /jdk-8u281-linux-x64.tar.gz HTTP/1.1" 200 -</span></span><br><span class="line"><span class="comment"># 172.17.0.4 - - [30/Mar/2021 17:32:00] "GET /agent.jar HTTP/1.1" 200 -</span></span><br><span class="line"><span class="comment"># 172.17.0.4 - - [30/Mar/2021 17:32:00] "GET /jenkins-agent.sh HTTP/1.1" 200 -</span></span><br><span class="line"><span class="comment"># 172.17.0.4 - - [30/Mar/2021 17:32:00] "GET /apache-maven-3.6.3-bin.tar.gz HTTP/1.1" 200 -</span></span><br><span class="line"><span class="comment"># 172.17.0.4 - - [30/Mar/2021 17:32:00] "GET /sonar-scanner-cli-4.5.0.2216-linux.zip HTTP/1.1" 200 -</span></span><br><span class="line"><span class="comment"># 172.17.0.4 - - [30/Mar/2021 17:32:00] "GET /release-cli-0.6.0-linux-amd64 HTTP/1.1" 200 -</span></span><br><span class="line"><span class="comment"># 172.17.0.4 - - [30/Mar/2021 17:32:00] "GET /kubectl HTTP/1.1" 200 -</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (1) é•œåƒæ„å»º</span></span><br><span class="line">docker build -t weiyigeek/alpine-jenkins-jnlp .</span><br><span class="line">  <span class="comment"># Successfully built b47b6581b712</span></span><br><span class="line">  <span class="comment"># Successfully tagged weiyigeek/alpine-jenkins-jnlp</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) æŸ¥çœ‹æ„å»ºä¿¡æ¯</span></span><br><span class="line">docker images weiyigeek/alpine-jenkins-jnlp --all</span><br><span class="line">  <span class="comment"># REPOSITORY                               TAG           IMAGE ID       CREATED             SIZE</span></span><br><span class="line">  <span class="comment"># harbor.weiyigeek.top/devops/jenkins-jnlp   3.13.1-alpine   b47b6581b712   About an hour ago   715MB</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) æ¨é€é•œåƒ</span></span><br><span class="line">docker push weiyigeek/alpine-jenkins-jnlp</span><br><span class="line">  <span class="comment"># The push refers to repository [harbor.weiyigeek.top/devops/jenkins-jnlp]</span></span><br><span class="line">  <span class="comment"># 059ea3fbd3b3: Pushed</span></span><br><span class="line">  <span class="comment"># 1119ff37d4a9: Layer already exists</span></span><br><span class="line">  <span class="comment"># 3.13.1-alpine: digest: sha256:1f869c553340c9399c7db9072169600a17ddb0ec41d41d3a4365b8c1571fc201 size: 741</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) é‡‡ç”¨Ansibleå„èŠ‚ç‚¹æ‹‰å–é•œåƒ</span></span><br><span class="line">ansible node -m shell -a <span class="string">"docker pull weiyigeek/alpine-jenkins-jnlp"</span></span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=5.Jenkinsè¿›é˜¶ä¹‹åˆ†å¸ƒå¼æ¶æ„æ‰©å……çŸ¥è¯† href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210330173121.png" target="_blank" title="WeiyiGeek.DockerFileæ„å»ºè‡ªå®šä¹‰Jnlpå®¹å™¨" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210330173121.png" alt="WeiyiGeek.DockerFileæ„å»ºè‡ªå®šä¹‰Jnlpå®¹å™¨" title="" class=""></a>
                <p>WeiyiGeek.DockerFileæ„å»ºè‡ªå®šä¹‰Jnlpå®¹å™¨</p>
            </figure>
<p><br></p>
<h3 id="è‡ªå®šä¹‰-jenkins-jnlp-slave-é•œåƒçš„ä½¿ç”¨"><a href="#è‡ªå®šä¹‰-jenkins-jnlp-slave-é•œåƒçš„ä½¿ç”¨" class="headerlink" title="è‡ªå®šä¹‰ jenkins-jnlp-slave é•œåƒçš„ä½¿ç”¨"></a>è‡ªå®šä¹‰ jenkins-jnlp-slave é•œåƒçš„ä½¿ç”¨</h3><p>æè¿°: æ­¤å¤„è¿˜æ˜¯åˆ©ç”¨Jenkinsçš„kubernetesæ’ä»¶ï¼Œè®©jenkinsåœ¨è¿›jobæ—¶åŠ¨æ€çš„ç”Ÿæˆå·¥ä½œèŠ‚ç‚¹(Pod)ï¼Œå¹¶åœ¨ç»“æŸåé”€æ¯å®¹å™¨ã€‚</p>
<ul>
<li><p>Step 1.åˆ›å»ºæµæ°´çº¿ <code>Kubernetes-jenkins-slave</code> Job åœ¨æµæ°´çº¿ä¸­é‡‡ç”¨Pipeline Scriptè„šæœ¬</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent &#123;</span><br><span class="line">    kubernetes &#123;</span><br><span class="line">      cloud <span class="string">'kubernetes'</span></span><br><span class="line">      namespace <span class="string">'devops'</span></span><br><span class="line">      inheritFrom <span class="string">'jenkins-slave'</span></span><br><span class="line">      workingDir <span class="string">'/home/jenkins/agent'</span></span><br><span class="line">      <span class="comment">// yamlFile 'KubernetesPod.yaml'</span></span><br><span class="line">      yaml <span class="string">"""\</span></span><br><span class="line"><span class="string">apiVersion:</span></span><br><span class="line"><span class="string">kind: Pod</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  labels:</span></span><br><span class="line"><span class="string">    jenkins: "slave"</span></span><br><span class="line"><span class="string">    jenkins/label: 'k8s-slave'</span></span><br><span class="line"><span class="string">spec:</span></span><br><span class="line"><span class="string">  containers:</span></span><br><span class="line"><span class="string">  - name: 'jnlp'</span></span><br><span class="line"><span class="string">    image: 'weiyigeek/alpine-jenkins-jnlp'</span></span><br><span class="line"><span class="string">    imagePullPolicy: 'IfNotPresent'                                     # é•œåƒæ‹‰å–ç­–ç•¥</span></span><br><span class="line"><span class="string">    command: ["/bin/sh","-c","/usr/local/bin/jenkins-agent.sh &amp;&amp; cat"]  # é‡ç‚¹æµ‹è¯•çš„æ—¶å€™(å¿ƒé…¸ç´¯)å¸Œæœ›è¯»è€…ä½“éªŒä¸€å“ˆ</span></span><br><span class="line"><span class="string">    tty: true</span></span><br><span class="line"><span class="string">    volumeMounts:</span></span><br><span class="line"><span class="string">    - mountPath: "/home/jenkins/.m2"</span></span><br><span class="line"><span class="string">      name: "volume-0"</span></span><br><span class="line"><span class="string">    - mountPath: "/var/run/docker.sock"</span></span><br><span class="line"><span class="string">      name: "volume-1"</span></span><br><span class="line"><span class="string">    """</span>.stripIndent()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  stages &#123;</span><br><span class="line">    stage (<span class="string">'declarative Pipeline - kubernetes'</span>) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        echo <span class="string">"declarative Pipeline - kubernetes"</span></span><br><span class="line">        sh <span class="string">"mvn -version"</span></span><br><span class="line">        sh <span class="string">"release-cli -v"</span></span><br><span class="line">        sh <span class="string">"sonar-scanner -v"</span></span><br><span class="line">        sh <span class="string">"kubectl version"</span></span><br><span class="line">        sh <span class="string">"docker --version &amp;&amp; sudo docker ps"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Step 2.é…ç½®<code>Pod Templates</code>æ¨¡æ¿å¦‚ä¸‹å› ä¸ºæˆ‘ä»¬éœ€è¦ç»§æ‰¿ä¸€å“ˆ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">åç§°ï¼šjenkins-slave</span><br><span class="line">å‘½åç©ºé—´: devops</span><br><span class="line">æ ‡ç­¾åˆ—è¡¨: k8s-slave</span><br><span class="line">æ·»åŠ ä¸»æœºå·: </span><br><span class="line"> - ä¸»æœº: /nfsdisk-31/appstorage/mavenRepo</span><br><span class="line"> - Pod æŒ‚è½½è·¯å¾„: /home/jenkins/.m2</span><br><span class="line"> - ä¸»æœº: /var/run/docker.sock</span><br><span class="line"> - Pod æŒ‚è½½è·¯å¾„: /var/run/docker.sock</span><br></pre></td></tr></table></figure>
</li>
<li><p>Step 3.åœ¨BlueOcenä¸­è¿è¡Œå¹¶æŸ¥çœ‹ç»“æœ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) å¯ä»¥çœ‹è§å½“è¿›è¡Œè°ƒåº¦æ—¶k8sä¼šåŠ¨æ€çš„æ‹‰å–é•œåƒå¹¶è¿è¡Œï¼Œå½“ä»»åŠ¡ç»“æŸåä¼šè‡ªåŠ¨é”€æ¯Pod</span></span><br><span class="line">kubernetes-jenkins-slave-63-01h9j-txdgn-cdwb5   0/1     Pending   0          0s</span><br><span class="line">kubernetes-jenkins-slave-63-01h9j-txdgn-cdwb5   0/1     Pending   0          0s</span><br><span class="line">kubernetes-jenkins-slave-63-01h9j-txdgn-cdwb5   0/1     ContainerCreating   0          0s</span><br><span class="line">kubernetes-jenkins-slave-63-01h9j-txdgn-cdwb5   1/1     Running             0          3s</span><br><span class="line">kubernetes-jenkins-slave-63-01h9j-txdgn-cdwb5   1/1     Terminating         0          13s</span><br><span class="line">kubernetes-jenkins-slave-63-01h9j-txdgn-cdwb5   0/1     Terminating         0          45s</span><br><span class="line">kubernetes-jenkins-slave-63-01h9j-txdgn-cdwb5   0/1     Terminating         0          46s</span><br><span class="line">kubernetes-jenkins-slave-63-01h9j-txdgn-cdwb5   0/1     Terminating         0          46s</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) åŠ¨æ€åˆ›å»ºçš„slaveå¯åŠ¨çš„Podè„šæœ¬</span></span><br><span class="line">---</span><br><span class="line">kind: <span class="string">"Pod"</span></span><br><span class="line">metadata:</span><br><span class="line">  annotations:</span><br><span class="line">    buildUrl: <span class="string">"http://jenkins.devops.svc.cluster.local:8080/job/Kubernetes-jenkins-slave/63/"</span></span><br><span class="line">    runUrl: <span class="string">"job/Kubernetes-jenkins-slave/63/"</span></span><br><span class="line">  labels:</span><br><span class="line">    jenkins: <span class="string">"slave"</span></span><br><span class="line">    jenkins/label: <span class="string">"Kubernetes-jenkins-slave_63-01h9j"</span></span><br><span class="line">    jenkins/label-digest: <span class="string">"0fe6224168b9ce0350e7db8678c10953c2e6f533"</span></span><br><span class="line">  name: <span class="string">"kubernetes-jenkins-slave-63-01h9j-txdgn-cdwb5"</span></span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - <span class="built_in">command</span>:</span><br><span class="line">    - <span class="string">"/bin/sh"</span></span><br><span class="line">    - <span class="string">"-c"</span></span><br><span class="line">    - <span class="string">"/usr/local/bin/jenkins-agent.sh &amp;&amp; cat"</span></span><br><span class="line">    env:</span><br><span class="line">    - name: <span class="string">"JENKINS_SECRET"</span></span><br><span class="line">      value: <span class="string">"********"</span></span><br><span class="line">    - name: <span class="string">"JENKINS_AGENT_NAME"</span></span><br><span class="line">      value: <span class="string">"kubernetes-jenkins-slave-63-01h9j-txdgn-cdwb5"</span></span><br><span class="line">    - name: <span class="string">"JENKINS_NAME"</span></span><br><span class="line">      value: <span class="string">"kubernetes-jenkins-slave-63-01h9j-txdgn-cdwb5"</span></span><br><span class="line">    - name: <span class="string">"JENKINS_AGENT_WORKDIR"</span></span><br><span class="line">      value: <span class="string">"/home/jenkins/agent"</span></span><br><span class="line">    - name: <span class="string">"JENKINS_URL"</span></span><br><span class="line">      value: <span class="string">"http://jenkins.devops.svc.cluster.local:8080/"</span></span><br><span class="line">    image: <span class="string">"weiyigeek/alpine-jenkins-jnlp"</span></span><br><span class="line">    imagePullPolicy: <span class="string">"IfNotPresent"</span></span><br><span class="line">    name: <span class="string">"jnlp"</span></span><br><span class="line">    resources:</span><br><span class="line">      limits: &#123;&#125;</span><br><span class="line">      requests:</span><br><span class="line">        memory: <span class="string">"256Mi"</span></span><br><span class="line">        cpu: <span class="string">"100m"</span></span><br><span class="line">    tty: <span class="literal">true</span></span><br><span class="line">    volumeMounts:</span><br><span class="line">    - mountPath: <span class="string">"/home/jenkins/.m2"</span></span><br><span class="line">      name: <span class="string">"volume-0"</span></span><br><span class="line">    - mountPath: <span class="string">"/var/run/docker.sock"</span></span><br><span class="line">      name: <span class="string">"volume-1"</span></span><br><span class="line">    - mountPath: <span class="string">"/home/jenkins/agent"</span></span><br><span class="line">      name: <span class="string">"workspace-volume"</span></span><br><span class="line">      readOnly: <span class="literal">false</span></span><br><span class="line">  hostNetwork: <span class="literal">false</span></span><br><span class="line">  nodeSelector:</span><br><span class="line">    kubernetes.io/os: <span class="string">"linux"</span></span><br><span class="line">  restartPolicy: <span class="string">"Never"</span></span><br><span class="line">  volumes:</span><br><span class="line">  - hostPath:</span><br><span class="line">      path: <span class="string">"/nfsdisk-31/appstorage/mavenRepo"</span></span><br><span class="line">    name: <span class="string">"volume-0"</span></span><br><span class="line">  - hostPath:</span><br><span class="line">      path: <span class="string">"/var/run/docker.sock"</span></span><br><span class="line">    name: <span class="string">"volume-1"</span></span><br><span class="line">  - emptyDir:</span><br><span class="line">      medium: <span class="string">""</span></span><br><span class="line">    name: <span class="string">"workspace-volume"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Running on kubernetes-jenkins-slave-63-01h9j-txdgn-cdwb5 in /home/jenkins/agent/workspace/Kubernetes-jenkins-slave</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è„šæœ¬åé¦ˆ</span></span><br><span class="line">declarative Pipeline - kubernetes</span><br><span class="line">+ mvn -version</span><br><span class="line">  Apache Maven 3.6.3 (cecedd343002696d0abb50b32b541b8a6ba2883f)</span><br><span class="line">  Maven home: /usr/<span class="built_in">local</span>/maven</span><br><span class="line">  Java version: 1.8.0_281, vendor: Oracle Corporation, runtime: /usr/<span class="built_in">local</span>/jdk8/jre</span><br><span class="line">  Default locale: en_US, platform encoding: ANSI_X3.4-1968</span><br><span class="line">  OS name: <span class="string">"linux"</span>, version: <span class="string">"5.4.0-42-generic"</span>, arch: <span class="string">"amd64"</span>, family: <span class="string">"unix"</span></span><br><span class="line"></span><br><span class="line">+ release-cli -v</span><br><span class="line">     version 0.6.0</span><br><span class="line"></span><br><span class="line">+ sonar-scanner -v</span><br><span class="line">  INFO: Scanner configuration file: /usr/<span class="built_in">local</span>/sonar-scanner/conf/sonar-scanner.properties</span><br><span class="line">  INFO: Project root configuration file: NONE</span><br><span class="line">  INFO: SonarScanner 4.5.0.2216</span><br><span class="line">  INFO: Java 1.8.0_281 Oracle Corporation (64-bit)</span><br><span class="line">  INFO: Linux 5.4.0-42-generic amd64</span><br><span class="line"></span><br><span class="line">+ kubectl version</span><br><span class="line">  Client Version: version.Info&#123;Major:<span class="string">"1"</span>, Minor:<span class="string">"19"</span>, GitVersion:<span class="string">"v1.19.6"</span>, GitCommit:<span class="string">"fbf646b339dc52336b55d8ec85c181981b86331a"</span>, GitTreeState:<span class="string">"clean"</span>, BuildDate:<span class="string">"2020-12-18T12:09:30Z"</span>, GoVersion:<span class="string">"go1.15.5"</span>, Compiler:<span class="string">"gc"</span>, Platform:<span class="string">"linux/amd64"</span>&#125;</span><br><span class="line">  Server Version: version.Info&#123;Major:<span class="string">"1"</span>, Minor:<span class="string">"19"</span>, GitVersion:<span class="string">"v1.19.6"</span>, GitCommit:<span class="string">"fbf646b339dc52336b55d8ec85c181981b86331a"</span>, GitTreeState:<span class="string">"clean"</span>, BuildDate:<span class="string">"2020-12-18T12:01:36Z"</span>, GoVersion:<span class="string">"go1.15.5"</span>, Compiler:<span class="string">"gc"</span>, Platform:<span class="string">"linux/amd64"</span>&#125;</span><br><span class="line"></span><br><span class="line">+ docker --version</span><br><span class="line">  Docker version 20.10.3, build 48d30b5b32e99c932b4ea3edca74353feddd83ff</span><br><span class="line"></span><br><span class="line">+ sudo docker ps  <span class="comment"># éå¸¸æ³¨æ„æƒé™</span></span><br><span class="line">CONTAINER ID   IMAGE                                                           COMMAND                  CREATED              STATUS          PORTS     NAMES</span><br><span class="line">bd9948326a78   harbor.weiyigeek.top/devops/jenkins-jnlp                          <span class="string">"/bin/sh -c '/usr/loâ€¦"</span>   39 seconds ago       Up 32 seconds             k8s_jnlp_kubernetes-jenkins-slave-68-91jbw-svtg2-3vq9b_devops_6d4bc0d2-b34f-46fc-9c9d-65537cb2bff8_0</span><br><span class="line">84538d2017c2   registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.2   <span class="string">"/pause"</span>                 About a minute ago   Up 58 seconds             k8s_POD_kubernetes-jenkins-slave-68-91jbw-svtg2-3vq9b_devops_6d4bc0d2-b34f-46fc-9c9d-65537cb2bff8_0</span><br><span class="line"></span><br><span class="line">Finished: SUCCESS</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="image-box">
                <a rel=5.Jenkinsè¿›é˜¶ä¹‹åˆ†å¸ƒå¼æ¶æ„æ‰©å……çŸ¥è¯† href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210208155114.png" target="_blank" title="WeiyiGeek.custom-jenkins-jnlp" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210208155114.png" alt="WeiyiGeek.custom-jenkins-jnlp" title="" class=""></a>
                <p>WeiyiGeek.custom-jenkins-jnlp</p>
            </figure>
<p><br></p>
<h3 id="Dockerfile-è¿­ä»£æ›´æ–°"><a href="#Dockerfile-è¿­ä»£æ›´æ–°" class="headerlink" title="Dockerfile è¿­ä»£æ›´æ–°"></a>Dockerfile è¿­ä»£æ›´æ–°</h3><ul>
<li>æˆªæ­¢äºã€2021å¹´5æœˆ17æ—¥ 16:41:37ã€‘æœ€æ–°æ›´æ–°çš„Dockerfile<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#----------------------------------------------------------------------#</span></span><br><span class="line"><span class="comment"># Title: Base in Alpine Images Create Custom Jenkins Kubernetes jnlp Images</span></span><br><span class="line"><span class="comment"># Author: WeiyiGeek</span></span><br><span class="line"><span class="comment"># WebSite: https://weiyigeek.top</span></span><br><span class="line"><span class="comment"># Email: mastr@weiyigeek.top</span></span><br><span class="line"><span class="comment"># Release: v1.11</span></span><br><span class="line"><span class="comment"># Image Version: alpine-3.13.1</span></span><br><span class="line"><span class="comment"># MainFunction:</span></span><br><span class="line"><span class="comment">#   Install ssh-server docker git openssh tzdata curl tar sudo git ca-certificates wget unzip docker zlib nodejs npm jq</span></span><br><span class="line"><span class="comment">#   Install JDK8 Version: 1.8.0_281</span></span><br><span class="line"><span class="comment">#   - https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html</span></span><br><span class="line"><span class="comment">#   - https://github.com/sgerrand/alpine-pkg-glibc/releases/</span></span><br><span class="line"><span class="comment">#   - https://alpine-pkgs.sgerrand.com/sgerrand.rsa.pub</span></span><br><span class="line"><span class="comment">#   Install jnlp Version: 4.11.2 (ä¸¤é’Ÿæ–¹å¼éƒ½å¯ä»¥ä¸‹è½½agent)</span></span><br><span class="line"><span class="comment">#   - https://repo.jenkins-ci.org/public/org/jenkins-ci/main/remoting/</span></span><br><span class="line"><span class="comment">#   - http://youjenkins-domainname/jnlpJars/agent.jar</span></span><br><span class="line"><span class="comment">#   Install Maven Version: 3.8.4</span></span><br><span class="line"><span class="comment">#   - https://apache.osuosl.org/maven/maven-3/$&#123;MAVEN_VERSION&#125;/binaries</span></span><br><span class="line"><span class="comment">#   Install SonarqubeScan Version: 4.5.0</span></span><br><span class="line"><span class="comment">#   - https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-4.5.0.2216-linux.zip</span></span><br><span class="line"><span class="comment">#   Install Gitlab Release Version: 0.10.0</span></span><br><span class="line"><span class="comment">#   - https://gitlab.com/gitlab-org/release-cli/-/releases</span></span><br><span class="line"><span class="comment">#   Install kubernetes cli</span></span><br><span class="line"><span class="comment">#   - kubectl Version: 1.23.1</span></span><br><span class="line"><span class="comment">#   Install docker cli</span></span><br><span class="line"><span class="comment">#   - kubectl Version: 20.10.3</span></span><br><span class="line"><span class="comment"># ChangeLog:</span></span><br><span class="line"><span class="comment"># v1.8 - å¢åŠ  docker</span></span><br><span class="line"><span class="comment"># v1.9 -  å¢åŠ  ä¸­æ–‡ç¯å¢ƒ</span></span><br><span class="line"><span class="comment"># v1.10 - å¢åŠ  node.js ç¯å¢ƒæ”¯æŒ</span></span><br><span class="line"><span class="comment"># v1.11 - æ›´æ–°ä¾èµ–è½¯ä»¶ç‰ˆæœ¬åŠå…¶agent.jarç‰ˆæœ¬</span></span><br><span class="line"><span class="comment">#-------------------------------------------------#</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> alpine:<span class="number">3.13</span>.<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">MAINTAINER</span>  Jenkins Custom Work Node Jnlp Container - &lt;master@weiyigeek.top&gt; - WeiyiGeek</span><br><span class="line"></span><br><span class="line"><span class="keyword">ARG</span> USERNAME=jenkins \</span><br><span class="line">    AGENT_WORKDIR=/home/jenkins \</span><br><span class="line">    BASE_DIR=/usr/local  \</span><br><span class="line">    BASE_BIN=/usr/local/bin  \</span><br><span class="line">    BASE_URL=http://<span class="number">192.168</span>.<span class="number">12.107</span>:<span class="number">8080</span>  \</span><br><span class="line">    LOCALE=locale.md \</span><br><span class="line">    JDK_NAME=jdk-<span class="number">8</span>u281-linux-x64   \</span><br><span class="line">    JDK_DIR=/usr/local/jdk1.<span class="number">8.0</span>_281  \</span><br><span class="line">    GLIBC_NAME=glibc-<span class="number">2.32</span>-r0.apk \</span><br><span class="line">    GLIBC_BIN_NAME=glibc-bin-<span class="number">2.32</span>-r0.apk \</span><br><span class="line">    GLIBC_I18N_NAME=glibc-i18n-<span class="number">2.32</span>-r0.apk \</span><br><span class="line">    MAVEN_NAME=apache-maven-<span class="number">3.8</span>.<span class="number">4</span>-bin \</span><br><span class="line">    MAVEN_DIR=/usr/local/apache-maven-<span class="number">3.8</span>.<span class="number">4</span> \</span><br><span class="line">    SONAR_SCANNER_NAME=sonar-scanner-cli-<span class="number">4.5</span>.<span class="number">0.2216</span>-linux \</span><br><span class="line">    SONAR_SCANNER_DIR=/usr/local/sonar-scanner-<span class="number">4.5</span>.<span class="number">0.2216</span>-linux \</span><br><span class="line">    GITLAB_CLI=release-cli-<span class="number">0.10</span>.<span class="number">0</span>-linux-amd64</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> LANG=en_US.UTF-<span class="number">8</span> \</span><br><span class="line">    LC_ALL=en_US.UTF-<span class="number">8</span> \</span><br><span class="line">    JAVA_HOME=/usr/local/jdk8  \</span><br><span class="line">    JRE_HOME=/usr/local/jdk8/jre \</span><br><span class="line">    MAVEN_HOME=/usr/local/maven \</span><br><span class="line">    MAVEN_RPEO=/home/jenkins/.m2 \</span><br><span class="line">    SONAR_SCANNER_HOME=/usr/local/sonar-scanner \</span><br><span class="line">    NODEJS_MODULES=/usr/lib/node_modules</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨æˆ·ROOTåˆ‡æ¢</span></span><br><span class="line"><span class="keyword">USER</span> root</span><br><span class="line"></span><br><span class="line"><span class="comment"># Shell å‘½ä»¤ - æ­¤ç§æ–¹å¼æå¤§å‡å°‘äº†æ„å»ºçš„é•œåƒå¤§å°;</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> sed -i <span class="string">'s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g'</span> /etc/apk/repositories \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apk update \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apk add --no-cache openssh tzdata curl tar sudo git ca-certificates wget unzip docker zlib nodejs npm bash jq \</span></span><br><span class="line"><span class="bash">    &amp;&amp; cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \</span></span><br><span class="line"><span class="bash">    &amp;&amp; chmod 4755 /bin/busybox \</span></span><br><span class="line"><span class="bash">    &amp;&amp; addgroup -g 1000 -S <span class="variable">$&#123;USERNAME&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; adduser <span class="variable">$&#123;USERNAME&#125;</span> -D -g <span class="variable">$&#123;USERNAME&#125;</span> -G root -u 1000 -s /bin/sh \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">echo</span> <span class="string">"jenkins   ALL=(root) NOPASSWD:ALL"</span> &gt;&gt; /etc/sudoers \</span></span><br><span class="line"><span class="bash">    &amp;&amp; mkdir -p <span class="variable">$&#123;AGENT_WORKDIR&#125;</span>/.ssh <span class="variable">$&#123;AGENT_WORKDIR&#125;</span>/.m2 \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -q -O /tmp/<span class="variable">$&#123;GLIBC_NAME&#125;</span> <span class="variable">$&#123;BASE_URL&#125;</span>/<span class="variable">$&#123;GLIBC_NAME&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -q -O /tmp/<span class="variable">$&#123;GLIBC_BIN_NAME&#125;</span> <span class="variable">$&#123;BASE_URL&#125;</span>/<span class="variable">$&#123;GLIBC_BIN_NAME&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -q -O /tmp/<span class="variable">$&#123;GLIBC_I18N_NAME&#125;</span> <span class="variable">$&#123;BASE_URL&#125;</span>/<span class="variable">$&#123;GLIBC_I18N_NAME&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -q -O /etc/apk/keys/sgerrand.rsa.pub <span class="variable">$&#123;BASE_URL&#125;</span>/sgerrand.rsa.pub \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -q -O /tmp/<span class="variable">$&#123;LOCALE&#125;</span> <span class="variable">$&#123;BASE_URL&#125;</span>/<span class="variable">$&#123;LOCALE&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -q -O /tmp/<span class="variable">$&#123;JDK_NAME&#125;</span>.tar.gz <span class="variable">$&#123;BASE_URL&#125;</span>/<span class="variable">$&#123;JDK_NAME&#125;</span>.tar.gz \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -q -O <span class="variable">$&#123;BASE_BIN&#125;</span>/agent.jar <span class="variable">$&#123;BASE_URL&#125;</span>/agent.jar \</span></span><br><span class="line"><span class="bash">    &amp;&amp; curl -fsSL -o <span class="variable">$&#123;BASE_BIN&#125;</span>/jenkins-agent.sh <span class="variable">$&#123;BASE_URL&#125;</span>/jenkins-agent.sh \</span></span><br><span class="line"><span class="bash">    &amp;&amp; curl -fsSL -o /tmp/<span class="variable">$&#123;MAVEN_NAME&#125;</span>.tar.gz <span class="variable">$&#123;BASE_URL&#125;</span>/<span class="variable">$&#123;MAVEN_NAME&#125;</span>.tar.gz \</span></span><br><span class="line"><span class="bash">    &amp;&amp; curl -fsSL -o /tmp/<span class="variable">$&#123;SONAR_SCANNER_NAME&#125;</span>.zip <span class="variable">$&#123;BASE_URL&#125;</span>/<span class="variable">$&#123;SONAR_SCANNER_NAME&#125;</span>.zip \</span></span><br><span class="line"><span class="bash">    &amp;&amp; curl -fsSL -o /usr/<span class="built_in">local</span>/bin/release-cli <span class="variable">$&#123;BASE_URL&#125;</span>/<span class="variable">$&#123;GITLAB_CLI&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; curl -fsSL -o /usr/<span class="built_in">local</span>/bin/kubectl <span class="variable">$&#123;BASE_URL&#125;</span>/kubectl \</span></span><br><span class="line"><span class="bash">    &amp;&amp; curl -fsSL -o /usr/<span class="built_in">local</span>/bin/docker <span class="variable">$&#123;BASE_URL&#125;</span>/docker \</span></span><br><span class="line"><span class="bash">    &amp;&amp; sed -i <span class="string">"s/#PermitRootLogin.*/PermitRootLogin yes/g"</span> /etc/ssh/sshd_config \</span></span><br><span class="line"><span class="bash">    &amp;&amp; sed -i <span class="string">"s/^#\s*StrictHostKeyChecking ask/StrictHostKeyChecking no/g"</span> /etc/ssh/ssh_config \</span></span><br><span class="line"><span class="bash">    &amp;&amp; ssh-keygen -t dsa -P <span class="string">""</span> -f /etc/ssh/ssh_host_dsa_key \</span></span><br><span class="line"><span class="bash">    &amp;&amp; ssh-keygen -t rsa -P <span class="string">""</span> -f /etc/ssh/ssh_host_rsa_key \</span></span><br><span class="line"><span class="bash">    &amp;&amp; ssh-keygen -t ecdsa -P <span class="string">""</span> -f /etc/ssh/ssh_host_ecdsa_key \</span></span><br><span class="line"><span class="bash">    &amp;&amp; ssh-keygen -t ed25519 -P <span class="string">""</span> -f /etc/ssh/ssh_host_ed25519_key \</span></span><br><span class="line"><span class="bash">    &amp;&amp; ssh-keygen -t ed25519 -P <span class="string">""</span> -C <span class="string">"master@weiyigeek.top"</span> -f /home/jenkins/.ssh/id_ed25519 \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apk add /tmp/<span class="variable">$&#123;GLIBC_NAME&#125;</span> /tmp/<span class="variable">$&#123;GLIBC_BIN_NAME&#125;</span> /tmp/<span class="variable">$&#123;GLIBC_I18N_NAME&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; tar -zxf /tmp/<span class="variable">$&#123;JDK_NAME&#125;</span>.tar.gz -C <span class="variable">$&#123;BASE_DIR&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; mv <span class="variable">$&#123;JDK_DIR&#125;</span> <span class="variable">$&#123;JAVA_HOME&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; tar -zxf /tmp/<span class="variable">$&#123;MAVEN_NAME&#125;</span>.tar.gz -C <span class="variable">$&#123;BASE_DIR&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; mv <span class="variable">$&#123;MAVEN_DIR&#125;</span> <span class="variable">$&#123;MAVEN_HOME&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; unzip /tmp/<span class="variable">$&#123;SONAR_SCANNER_NAME&#125;</span>.zip -d <span class="variable">$&#123;BASE_DIR&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; mv <span class="variable">$&#123;SONAR_SCANNER_DIR&#125;</span> <span class="variable">$&#123;SONAR_SCANNER_HOME&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; npm config <span class="built_in">set</span> registry https://registry.npmmirror.com \</span></span><br><span class="line"><span class="bash">    &amp;&amp; chmod a+x <span class="variable">$&#123;BASE_BIN&#125;</span>/* \</span></span><br><span class="line"><span class="bash">    &amp;&amp; chown -R jenkins:jenkins <span class="variable">$&#123;BASE_DIR&#125;</span>/ <span class="variable">$&#123;AGENT_WORKDIR&#125;</span>/ <span class="variable">$&#123;NODEJS_MODULES&#125;</span>/ \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">echo</span> <span class="string">"root:WeiyiGeek"</span> | chpasswd \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">echo</span> <span class="string">"jenkins:WeiyiGeek"</span> | chpasswd \</span></span><br><span class="line"><span class="bash">    &amp;&amp; cat /tmp/<span class="variable">$&#123;LOCALE&#125;</span> | xargs -i /usr/glibc-compat/bin/localedef -i &#123;&#125; -f UTF-8 &#123;&#125;.UTF-8 \</span></span><br><span class="line"><span class="bash">    &amp;&amp; sed -i <span class="string">"s#use_embedded_jre=true#use_embedded_jre=false#g"</span> <span class="variable">$&#123;SONAR_SCANNER_HOME&#125;</span>/bin/sonar-scanner \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf /var/cache/apk/* /tmp/* <span class="variable">$&#123;SONAR_SCANNER_HOME&#125;</span>/jre/* \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">cd</span> <span class="variable">$&#123;JAVA_HOME&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf COPYRIGHT LICENSE README release THIRDPARTYLICENSEREADME-JAVAFX.txt THIRDPARTYLICENSEREADME.txt Welcome.html  javafx-src.zip src.zip \</span></span><br><span class="line"><span class="bash">    lib/plugin.jar \</span></span><br><span class="line"><span class="bash">    lib/ext/jfxrt.jar \</span></span><br><span class="line"><span class="bash">    bin/javaws \</span></span><br><span class="line"><span class="bash">    lib/javaws.jar \</span></span><br><span class="line"><span class="bash">    lib/desktop \</span></span><br><span class="line"><span class="bash">    plugin \</span></span><br><span class="line"><span class="bash">    lib/deploy* \</span></span><br><span class="line"><span class="bash">    lib/*javafx* \</span></span><br><span class="line"><span class="bash">    lib/*jfx* \</span></span><br><span class="line"><span class="bash">    lib/amd64/libdecora_sse.so \</span></span><br><span class="line"><span class="bash">    lib/amd64/libprism_*.so \</span></span><br><span class="line"><span class="bash">    lib/amd64/libfxplugins.so \</span></span><br><span class="line"><span class="bash">    lib/amd64/libglass.so \</span></span><br><span class="line"><span class="bash">    lib/amd64/libgstreamer-lite.so \</span></span><br><span class="line"><span class="bash">    lib/amd64/libjavafx*.so \</span></span><br><span class="line"><span class="bash">    lib/amd64/libjfx*.so \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">echo</span> <span class="string">"export LANG=zh_CN.UTF-8"</span> &gt; /etc/profile.d/locale.sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">USER</span> jenkins</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> <span class="variable">$&#123;AGENT_WORKDIR&#125;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib/dt.jar:$&#123;JAVA_HOME&#125;/lib/tools.jar \</span><br><span class="line">    PATH=$&#123;JAVA_HOME&#125;/bin:$&#123;MAVEN_HOME&#125;/bin:$&#123;SONAR_SCANNER_HOME&#125;/bin:$PATH</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"/usr/local/bin/jenkins-agent.sh"</span>]</span></span><br></pre></td></tr></table></figure>
</li>
</ul>

        </div>
        <!-- Google å¹¿å‘Š -->
        
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-9134434519967436" data-ad-slot="7905848205"></ins>
  

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>
  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·ä¸Visit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº" >
    <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ã€è½¬ä¸ªå‘ã€èµä¸ªåŠ©ã€‘</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°†æŒç»­æ•´ç†å‘å¸ƒæ›´å¤šä¼˜è´¨åŸåˆ›æ–‡ç« ï¼ã€‚</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-07-20T08:36:07.727Z" itemprop="dateUpdated">2022-07-20 16:36:07</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/CI-CD/Jenkins/5.Jenkinsè¿›é˜¶ä¹‹åˆ†å¸ƒå¼æ¶æ„æ‰©å……çŸ¥è¯†.md" target="_blank" rel="noopener noreferrer">_posts/ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/CI-CD/Jenkins/5.Jenkinsè¿›é˜¶ä¹‹åˆ†å¸ƒå¼æ¶æ„æ‰©å……çŸ¥è¯†.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2020/12-31-533.html" target="_blank" rel="external">https://blog.weiyigeek.top/2020/12-31-533.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">â˜•ï¸ è¯·ä½œè€…å–æ¯å’–å•¡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/12-31-533.html&title=ã€Š5.Jenkinsè¿›é˜¶ä¹‹åˆ†å¸ƒå¼æ¶æ„æ‰©å……çŸ¥è¯†ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/12-31-533.html&title=ã€Š5.Jenkinsè¿›é˜¶ä¹‹åˆ†å¸ƒå¼æ¶æ„æ‰©å……çŸ¥è¯†ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/12-31-533.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š5.Jenkinsè¿›é˜¶ä¹‹åˆ†å¸ƒå¼æ¶æ„æ‰©å……çŸ¥è¯†ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/12-31-533.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/12-31-533.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2020/12-31-618.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">8.Jenkinsè¿›é˜¶ä¹‹å·¥ä½œå­¦ä¹ æ‰€é‡è¡¥å……</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2020/12-30-523.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">3.Jenkinsè¿›é˜¶ä¹‹æµæ°´çº¿pipelineåŸºç¡€ä½¿ç”¨å®è·µ</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-å‰è¨€ç®€è¿°"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 å‰è¨€ç®€è¿°</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-Kubernetes-plugin-ä½¿ç”¨"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 Kubernetes-plugin ä½¿ç”¨</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ç¯å¢ƒä¾èµ–"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">ç¯å¢ƒä¾èµ–</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#æ’ä»¶å‚æ•°"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">æ’ä»¶å‚æ•°</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#podTemplate-Podå’Œå®¹å™¨æ¨¡æ¿"><span class="post-toc-number">2.2.1.</span> <span class="post-toc-text">podTemplate - Podå’Œå®¹å™¨æ¨¡æ¿</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#container-å®¹å™¨æ¨¡æ¿çš„å®šä¹‰"><span class="post-toc-number">2.2.2.</span> <span class="post-toc-text">container - å®¹å™¨æ¨¡æ¿çš„å®šä¹‰</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Pipeline-Support-å®è·µç¤ºä¾‹"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">Pipeline Support å®è·µç¤ºä¾‹</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Scripted-Pipeline"><span class="post-toc-number">2.3.1.</span> <span class="post-toc-text">Scripted Pipeline</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Declarative-Pipeline"><span class="post-toc-number">2.3.2.</span> <span class="post-toc-text">Declarative Pipeline</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x02-è‡ªå®šä¹‰Jenkinså·¥ä½œèŠ‚ç‚¹ä¹‹jnlp-slaveé•œåƒæ¨¡æ¿æ„å»º"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 è‡ªå®šä¹‰Jenkinså·¥ä½œèŠ‚ç‚¹ä¹‹jnlp-slaveé•œåƒæ¨¡æ¿æ„å»º</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Dockerfile-æ„å»ºä¾èµ–"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">Dockerfile æ„å»ºä¾èµ–</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Dockerfile-æ„å»ºæ“ä½œ"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">Dockerfile æ„å»ºæ“ä½œ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#è‡ªå®šä¹‰-jenkins-jnlp-slave-é•œåƒçš„ä½¿ç”¨"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">è‡ªå®šä¹‰ jenkins-jnlp-slave é•œåƒçš„ä½¿ç”¨</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Dockerfile-è¿­ä»£æ›´æ–°"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">Dockerfile è¿­ä»£æ›´æ–°</span></a></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    


    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå°±è¯·ä½œè€…å–æ¯ Coffee â˜•ï¸â˜•ï¸!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      

    <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
    
      <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½æœ‹å‹,å¯ä»¥å…³ä¸ªæ³¨å—? â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
        
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">ä¸ªäººGithub</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">ä¸ªäººGitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">ä¸ªäººçŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘+äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener"><img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto"></a>
        </div>
      </p>
    </div>
</footer>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/12-31-533.html&title=ã€Š5.Jenkinsè¿›é˜¶ä¹‹åˆ†å¸ƒå¼æ¶æ„æ‰©å……çŸ¥è¯†ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/12-31-533.html&title=ã€Š5.Jenkinsè¿›é˜¶ä¹‹åˆ†å¸ƒå¼æ¶æ„æ‰©å……çŸ¥è¯†ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/12-31-533.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š5.Jenkinsè¿›é˜¶ä¹‹åˆ†å¸ƒå¼æ¶æ„æ‰©å……çŸ¥è¯†ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/12-31-533.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/12-31-533.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACIElEQVR42u3aS27jMBAFQN//0plNFgEytt9rygFEFldGIFEqLTr94eMRr69f6+ffV655th6fWBgYGLdlJNu1Wz/b4TWvZWNgYJzGePYq+dav70o+R/75MDAwMPIXWlkJFQMDA6Nl5AVqgp/tgIGBcTIjCYvtldHj/74Wx8DAuCEjb5/9/e+PzDcwMDBuxVgpO2dB+dp7v3fAwMDYmjEbYc4aZHkx/LrofZpoYmBgHMD4RNN/fZCZXImBgbE3I7e248xZoz+/9z8ZLgYGxtaMPBGcBdYZMmm6YWBgnMCY3ZCH0ZXxQ/IhoukoBgbGFow8aVspU2eJY33AAgMDYztGmxS24Xg2WmiTSwwMjNMYs8I1aootBPE3oRkDA+MARn2soQzB7bPqNBEDA+NgRhsQZ8ll/g5LvUAMDIyNGCsN+tkhjJaKgYFxMqMNu8XMoRyOtuNVDAyMkxkraWJ+bzKRfAPDwMDYmtEGxDZMXzUKXTpFgoGBsQUjP7A1KzhnQ9Dkq2NgYJzGuLaIXUkxh405DAyMrRntEYoWdlWumgdiDAyMnRhf5bqqEE0K3bwwxsDA2JvR9tVnhW47pMzbdjUGAwPjtow8yK4E6FkqWc9jMTAwtmasDBTzgLv+H+DNCBMDAwOjbI2tHPbKU0YMDAyMNiy2Y8u23K1nGhgYGBsxZuPJ2RGKJKDXCSUGBsbWjLx0zEPqrNzNnz4cZGJgYNyP8Q/hYxQZCpLd2wAAAABJRU5ErkJggg==" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<script> (adsbygoogle = window.adsbygoogle || []).push({});</script>    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
</body>
</html>